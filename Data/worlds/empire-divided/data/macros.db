{"name":"Cast Spell","permission":{"default":0,"yNgzYxeWiwvRCpcF":3,"hNHeJbKl47AOkoOO":3},"type":"script","sort":100001,"flags":{"furnace":{"runAsGM":false},"core":{"sourceId":"Macro.XB7xBRA7QbFtwHxo"}},"scope":"global","command":"function castSpell(effect) {\n    const tokens = canvas.tokens.controlled;\n    if (tokens.length == 0) {\n        ui.notifications.error(\"Please select a token\");\n        return;\n    }\n    game.user.targets.forEach((i, t) => {\n        canvas.fxmaster.drawSpecialToward(effect, tokens[0], t);\n    })\n}\n\ncastSpell({\n    file: \"modules/fxmaster/specials/jinker/dragonBornBlack-CopperAcid30x5Line.webm\",\n    anchor: {\n        x: -.08,\n        y: 0.5\n    },\n    speed: 0,\n    angle: 0,\n    scale: {\n    x: 1.0,\n    y: 1.0\n}\n});","author":"hNHeJbKl47AOkoOO","img":"icons/svg/sun.svg","actorIds":[],"_id":"3suLKjeCENdZNZAC"}
{"name":"Hide Estimate","type":"script","author":"hNHeJbKl47AOkoOO","img":"icons/svg/cowled.svg","scope":"global","command":"/**\n*  This macro will hide the Health Estimate from selected tokens.\n*/\n\nfor (let e of canvas.tokens.controlled) {\n\tlet hidden = !e.document.getFlag(\"healthEstimate\", \"hideHealthEstimate\");\n\te.document.setFlag(\"healthEstimate\", \"hideHealthEstimate\", hidden)\n\tif (hidden) ui.notifications.info(`${e.actor.data.name}'s health estimate is hidden from players.`);\n\telse ui.notifications.info(`${e.actor.data.name}'s health estimate is shown to players.`);\n}","folder":null,"sort":0,"permission":{"default":0,"hNHeJbKl47AOkoOO":3},"flags":{"core":{"sourceId":"Macro.f1dST0uSVk2pCby1"}},"_id":"5qijChjAwltJiSfC"}
{"name":"Mark Dead","type":"script","author":"hNHeJbKl47AOkoOO","img":"icons/svg/bones.svg","scope":"global","command":"/**\n*  This macro will mark the selected tokens as dead.\n*  If all the selected tokens are dead, they will be marked\n   as alive instead.\n*/\n\nfor (let e of canvas.tokens.controlled) {\n\tlet hasAlive = !e.document.getFlag(\"healthEstimate\", \"dead\")\n\te.document.setFlag(\"healthEstimate\", \"dead\", hasAlive)\n}","folder":null,"sort":0,"permission":{"default":0,"hNHeJbKl47AOkoOO":3},"flags":{"core":{"sourceId":"Macro.bCMlVEb7wx14ACIB"}},"_id":"69LWPed2eU2l8udv"}
{"name":"Dieter Schippel","permission":{"default":0,"hNHeJbKl47AOkoOO":3},"type":"script","sort":100001,"flags":{},"scope":"global","command":"game.actors.get(\"fcIUXb2sCaEDcomN\").sheet.render(true)","author":"hNHeJbKl47AOkoOO","img":"Images/Portraits/Dieter.webp","actorIds":[],"_id":"7nmvz6TyIAs1VCaw"}
{"name":"Cast Spell","permission":{"default":0,"yNgzYxeWiwvRCpcF":3,"hNHeJbKl47AOkoOO":3},"type":"script","sort":100001,"flags":{"furnace":{"runAsGM":false},"core":{"sourceId":"Macro.XB7xBRA7QbFtwHxo"}},"scope":"global","command":"function castSpell(effect) {\n    const tokens = canvas.tokens.controlled;\n    if (tokens.length == 0) {\n        ui.notifications.error(\"Please select a token\");\n        return;\n    }\n    game.user.targets.forEach((i, t) => {\n        canvas.fxmaster.drawSpecialToward(effect, tokens[0], t);\n    })\n}\n\ncastSpell({\n    file: \"modules/fxmaster/specials/jinker/dragonBornBlack-CopperAcid30x5Line.webm\",\n    anchor: {\n        x: -.08,\n        y: 0.5\n    },\n    speed: 0,\n    angle: 0,\n    scale: {\n    x: 1.0,\n    y: 1.0\n}\n});","author":"hNHeJbKl47AOkoOO","img":"icons/svg/sun.svg","actorIds":[],"_id":"8Uw6FmNCw2M0sIae"}
{"_id":"CVeY9NFmHcjJt8VG","name":"Characteristics Generator","permission":{"default":0,"hWNxrHgD6tOVKAVx":3},"type":"chat","sort":100001,"flags":{},"scope":"global","command":"/roll 2d10[Weapon Skill]+2d10[Ballistic Skill]+2d10[Strength]+2d10[Toughness]+2d10[Initiative]+2d10[Agility]+2d10[Dexterity]+2d10[Intelligence]+2d10[Willpower]+2d10[Fellowship]","author":"hWNxrHgD6tOVKAVx","img":"icons/svg/dice-target.svg","actorIds":[]}
{"_id":"J4BfD26N5V7jGFbC","name":"Downtime Events","type":"script","author":"hNHeJbKl47AOkoOO","img":"Images/Icons/Age%20of%20Reckoning%20Icons/Treasure/4542.png","scope":"global","command":"await game.tables.getName('Downtime Events').draw();","folder":null,"sort":100001,"permission":{"default":2,"hNHeJbKl47AOkoOO":3,"0ASvjGC88ifVZG73":2,"dTxv7GfGrqg79wSI":2},"flags":{}}
{"name":"Don't Mark Dead","type":"script","author":"hNHeJbKl47AOkoOO","img":"icons/svg/aura.svg","scope":"global","command":"/**\n*  This macro will make this NPC show as Unconscious (or whatever is the first stage).\n*  This is meant for people that use the \"NPCs die immediately\" setting but still want some NPCs to not be shown as dead.\n*  Use it again to toggle it.\n*/\n\nfor (let e of canvas.tokens.controlled) {\n\tlet hasAlive = !e.document.getFlag(\"healthEstimate\", \"treatAsPC\")\n\te.document.setFlag(\"healthEstimate\", \"treatAsPC\", hasAlive)\n}","folder":null,"sort":0,"permission":{"default":0,"oPuS5iW18dRDcW4r":3,"hNHeJbKl47AOkoOO":3},"flags":{"core":{"sourceId":"Macro.bCMlVEb7wx14ACIB"},"advanced-macros":{"runAsGM":false}},"_id":"JzHURbwTvxihuMNA"}
{"_id":"K93kJFWPEV9oJEch","name":"Morrslieb","type":"script","author":"hNHeJbKl47AOkoOO","img":"Images/Icons/Age%20of%20Reckoning%20Icons/5584.png","scope":"global","command":"await game.tables.getName('Morrslieb').draw();","folder":null,"sort":100001,"permission":{"default":0,"hNHeJbKl47AOkoOO":3},"flags":{}}
{"_id":"OGoizYOnJoemVVCP","name":"Random Party Member","type":"script","author":"hNHeJbKl47AOkoOO","img":"icons/svg/aura.svg","scope":"global","command":"await game.tables.getName('Random Party Member').draw();","folder":null,"sort":100001,"permission":{"default":0,"hNHeJbKl47AOkoOO":3},"flags":{}}
{"_id":"On23q7SEZiJ4NP4z","name":"Characteristic Generation","permission":{"default":0,"H2RjuFIPa2NET2Bt":3},"type":"chat","sort":100001,"flags":{},"scope":"global","command":"/roll 2d10[Weapon Skill]\n+2d10[Ballistic Skill]\n+2d10[Strength]\n+2d10[Toughness]\n+2d10[Initiative]\n+2d10[Agility]\n+2d10[Dexterity]\n+2d10[Intelligence]\n+2d10[Willpower]\n+2d10[Fellowship]","author":"H2RjuFIPa2NET2Bt","img":"icons/svg/dice-target.svg","actorIds":[]}
{"_id":"TL0IOnYx0Q0jQxKi","name":"Income","permission":{"default":0,"hWNxrHgD6tOVKAVx":3},"type":"chat","sort":100001,"flags":{},"scope":"global","command":"/r 3d10 Shillings","author":"hWNxrHgD6tOVKAVx","img":"icons/svg/dice-target.svg","actorIds":[]}
{"_id":"TsYIjpKJV08rIBgA","name":"d100","permission":{"default":0,"hNHeJbKl47AOkoOO":3},"type":"chat","sort":100001,"flags":{},"scope":"global","command":"/r d100","author":"hNHeJbKl47AOkoOO","img":"icons/svg/dice-target.svg","actorIds":[]}
{"_id":"WdlcZmBbEEWVN75s","name":"Entertainment in Altdorf - Gold Tier","permission":{"default":0,"hNHeJbKl47AOkoOO":3,"0ASvjGC88ifVZG73":2,"dTxv7GfGrqg79wSI":2},"type":"script","sort":100001,"flags":{},"scope":"global","command":"const table = game.tables.entities.find(t => t.name === \"Daily Entertainment in Altdorf - Gold Tier\");\ntable.draw();","author":"hNHeJbKl47AOkoOO","img":"Images/Icons/Age%20of%20Reckoning%20Icons/Misc/5140.png","actorIds":[]}
{"_id":"XLeIkDipnDoWy0tX","name":"D100","permission":{"default":0,"hWNxrHgD6tOVKAVx":3},"type":"chat","sort":100001,"flags":{},"scope":"global","command":"/r d100","author":"hWNxrHgD6tOVKAVx","img":"icons/svg/dice-target.svg","actorIds":[]}
{"_id":"aJLj3OKP06Z6uAkP","name":"New Macro","type":"script","author":"hNHeJbKl47AOkoOO","img":"icons/svg/dice-target.svg","scope":"global","command":"this.actor.modifyAdvantage(-1)","folder":null,"sort":0,"permission":{"default":0,"hNHeJbKl47AOkoOO":3},"flags":{}}
{"name":"Talfwick \"Adefredo \"Anso Kotchmann\" von Hochsvoll\" Lostpocket","type":"script","author":"hNHeJbKl47AOkoOO","img":"Images/Portraits/auerswald/aloysius-the-butcher.webp","scope":"global","command":"game.actors.get(\"gJDT3AzPQRltg6Iy\").sheet.render(true)","folder":null,"sort":0,"permission":{"default":0,"hNHeJbKl47AOkoOO":3},"flags":{},"_id":"aeL3EBnMCvy9yOgH"}
{"_id":"ahpw5CQrGeC8jiEa","name":"Altdorf Fog - Summer","type":"script","author":"hNHeJbKl47AOkoOO","img":"Images/Icons/Age%20of%20Reckoning%20Icons/Magic/1562.png","scope":"global","command":"await game.tables.getName('Summer (Sigmarzeit, Sommerzeit, Vorgeheim)').draw();","folder":null,"sort":100001,"permission":{"default":0,"hNHeJbKl47AOkoOO":3},"flags":{}}
{"_id":"b86fAIxdJ5lsvS0t","name":"Characteristic Generation","permission":{"default":0,"hNHeJbKl47AOkoOO":3},"type":"chat","sort":100001,"flags":{},"scope":"global","command":"/roll 2d10[Weapon Skill]\n+2d10[Ballistic Skill]\n+2d10[Strength]\n+2d10[Toughness]\n+2d10[Initiative]\n+2d10[Agility]\n+2d10[Dexterity]\n+2d10[Intelligence]\n+2d10[Willpower]\n+2d10[Fellowship]","author":"hNHeJbKl47AOkoOO","img":"icons/svg/dice-target.svg","actorIds":[]}
{"name":"New Macro","permission":{"default":0,"hNHeJbKl47AOkoOO":3},"type":"chat","sort":100001,"flags":{},"scope":"global","command":"","author":"hNHeJbKl47AOkoOO","img":"icons/svg/dice-target.svg","actorIds":[],"_id":"c2dgAdtztfzwbAyy"}
{"_id":"cBMkb76pnWzGugfq","name":"Gunpowder Fumble Table","type":"script","author":"hNHeJbKl47AOkoOO","img":"icons/weapons/guns/gun-pistol-flintlock.webp","scope":"global","command":"await game.tables.getName('Gunpowder Fumble Table (Moo)').draw();","folder":null,"sort":0,"permission":{"default":0,"hNHeJbKl47AOkoOO":3},"flags":{}}
{"_id":"cHu0psp9Sl07vWRV","name":"Coin Flip","permission":{"default":0,"hNHeJbKl47AOkoOO":3},"type":"chat","sort":100001,"flags":{},"scope":"global","command":"/roll 1dc","author":"hNHeJbKl47AOkoOO","img":"icons/svg/coins.svg","actorIds":[]}
{"_id":"f75Vp815PvYzrQw3","name":"Reveal All","permission":{"default":0,"hNHeJbKl47AOkoOO":3},"type":"script","sort":100001,"flags":{},"scope":"global","command":"canvas.scene.update({globalLight: true})\ncanvas.scene.update({globalLight: false})","author":"hNHeJbKl47AOkoOO","img":"icons/svg/blind.svg","actorIds":[]}
{"name":"Jurgen von Haalstein","permission":{"default":0,"hNHeJbKl47AOkoOO":3},"type":"script","sort":100001,"flags":{},"scope":"global","command":"game.actors.get(\"T6Yj9vHdvwEeweRu\").sheet.render(true)","author":"hNHeJbKl47AOkoOO","img":"Images/Portraits/Jurgen.webp","actorIds":[],"_id":"fDlvGI5L95Hs1xck"}
{"name":"Frida Soldat","type":"script","author":"hNHeJbKl47AOkoOO","img":"modules/wfrp4e-core/art/careers/racketeer.webp","scope":"global","command":"game.actors.get(\"Wrn0Ged1WDU8vkRf\").sheet.render(true)","folder":null,"sort":0,"permission":{"default":0,"hNHeJbKl47AOkoOO":3},"flags":{},"_id":"fI1HjvoQSqlWtumU"}
{"_id":"fdrMaLJ2BxRsHNGL","name":"Skill Test","permission":{"default":0,"hNHeJbKl47AOkoOO":3},"type":"script","sort":100001,"flags":{},"scope":"global","command":"game.wfrp4e.utility.rollItemMacro(\"Athletics\", \"skill\");","author":"hNHeJbKl47AOkoOO","img":"Images/Icons/Age%20of%20Reckoning%20Icons/Own%20Icons/Swords/arming-sword.png","actorIds":[]}
{"_id":"pW4oQavhoaq8IqpY","name":"Characteristic Generation","permission":{"default":0,"t9SH8naBT8sh8PEQ":3},"type":"chat","sort":100001,"flags":{},"scope":"global","command":"/roll 2d10[Weapon Skill]\n+2d10[Ballistic Skill]\n+2d10[Strength]\n+2d10[Toughness]\n+2d10[Initiative]\n+2d10[Agility]\n+2d10[Dexterity]\n+2d10[Intelligence]\n+2d10[Willpower]\n+2d10[Fellowship]","author":"t9SH8naBT8sh8PEQ","img":"icons/svg/dice-target.svg","actorIds":[]}
{"name":"Kazrik Leadfoot","permission":{"default":0,"hNHeJbKl47AOkoOO":3},"type":"script","sort":100001,"flags":{},"scope":"global","command":"game.actors.get(\"BNxW5IDuKy9Yws0J\").sheet.render(true)","author":"hNHeJbKl47AOkoOO","img":"Images/Portraits/kazrik-2.webp","actorIds":[],"_id":"qWuyX6mLuwSpyY6R"}
{"name":"New Macro","permission":{"default":0,"0ASvjGC88ifVZG73":3},"type":"chat","sort":100001,"flags":{},"scope":"global","command":"","author":"0ASvjGC88ifVZG73","img":"icons/svg/dice-target.svg","actorIds":[],"_id":"rGBJRlCwpEQHoYOO"}
{"name":"Play Video","permission":{"default":0,"yNgzYxeWiwvRCpcF":3,"hNHeJbKl47AOkoOO":3},"type":"script","sort":100001,"flags":{"core":{"sourceId":"Macro.hs4guV2BNe47cEvj"}},"scope":"global","command":"const data = {\n  file: \"modules/fxmaster/specials/fxmaster/smokeBomb.webm\",\n  position: {\n    x: 1000,\n    y: 1000\n  },\n  anchor: {\n   x: 0.5,\n   y: 0.5\n  },\n  angle: 0,\n  scale: {\n    x: 2.5,\n    y: 10\n  }\n}\ncanvas.fxmaster.playVideo(data);\ngame.socket.emit('fxmaster', data);","author":"hNHeJbKl47AOkoOO","img":"icons/svg/video.svg","actorIds":[],"_id":"rRhIN1tRsme9dmFw"}
{"_id":"tkMPQa9TQpay05tO","name":"Entertainment in Altdorf - Silver Tier","type":"script","author":"hNHeJbKl47AOkoOO","img":"Images/Icons/Age%20of%20Reckoning%20Icons/Misc/5140.png","scope":"global","command":"await game.tables.getName('Daily Entertainment in Altdorf - Silver Tier').draw();","folder":null,"sort":100001,"permission":{"default":0,"hNHeJbKl47AOkoOO":3,"dTxv7GfGrqg79wSI":2,"hWNxrHgD6tOVKAVx":2,"Jvf2teS6cv0359RH":2},"flags":{}}
{"_id":"xZGvJCWoDwlb8Sjm","name":"d10","permission":{"default":0,"hNHeJbKl47AOkoOO":3},"type":"chat","sort":100001,"flags":{},"scope":"global","command":"/r d10","author":"hNHeJbKl47AOkoOO","img":"icons/svg/dice-target.svg","actorIds":[]}
{"name":"Export Statblock to Journal","type":"script","author":"hNHeJbKl47AOkoOO","img":"modules/wfrp4e-statblockexporter/icons/quill.svg","scope":"global","command":"function replaceAll(str, find, replace) {\n    return str.replace(new RegExp(find, 'g'), replace);\n}\n\nfunction getOccurrence(array, value) {\n    var count = 0;\n    array.forEach((v) => (v === value && count++));\n    return count;\n}\n\nfunction onlyUnique(value, index, self) {\n    return self.indexOf(value) === index;\n}\n\n/* Builds a string holding all the selected actor's talent's names and numerical suffixes if appropriate. One-off Talents (e.g. Noble Blood) have no numerical suffix. */\n\nfunction outputTrappings(trappings, weapons, armour, money) {\n    var trappingString = [];\n    if (trappings == null) return [];\n\n\n\t// weapons\n    for (var i = 0; i < weapons.length; i++) {\n        var str = weapons[i].name;\n        if (weapons[i].rangedWeaponType) {\n            str += \" (\" + weapons[i].data.range.value + \")\";\n        }\n        if (weapons[i].damage >= 0){\n            str += \" +\" + weapons[i].damage;\n        }\n        else {\n            str += \" -\" + weapons[i].damage;\n        }\n        trappingString.push(str);\n    }\n\n\t// armour\n\n    for (var j = 0; j < armour.length; j++) {\n        var areaCnt=0;\n        var str = armour[j].name + \" (\";\n        if (armour[j].data.maxAP[\"body\"] > 0){\n\t\t\tstr += \"Body \" + armour[j].data.currentAP[\"body\"];\n\t\t\tareaCnt++;\n\t\t}\n        if (armour[j].data.maxAP[\"lArm\"] > 0){\n\t\t\tif (areaCnt>0) str += \" \";\n\t\t\tstr += \"Arms \" + armour[j].data.currentAP[\"lArm\"];\n\t\t\tareaCnt++;\n\t\t}\n\t\t\t\t\n        if (armour[j].data.maxAP[\"head\"] > 0){\n\t\t\tif (areaCnt>0) str += \" \";\n\t\t\tstr += \"Head \" + armour[j].data.currentAP[\"head\"];\n\t\t\tareaCnt++;\n\t\t}\n        if (armour[j].data.maxAP[\"lLeg\"] > 0){ \n\t\t\tif (areaCnt>0) str += \" \";\n\t\t\tstr += \"Legs \" + armour[j].data.currentAP[\"lLeg\"];\n\t\t}\n        str += \")\";\n        trappingString.push(str);\n    }\n\n\t// others\n\n    trappings.forEach(function(t) {\n        trappingString.push(t.name);\n    })\n\n\t\n\t// money\n\tvar gc, ss, bp, moneyString;\n\t\n\tfor (var i = 0; i < money.length; i++) {\n\t\tif (money[i].name == \"Silver Shilling\"){\n\t\t\tss = money[i].data.quantity.value;\n\t\t}\n\t\tif (money[i].name == \"Gold Crown\"){\n\t\t\tgc = money[i].data.quantity.value;\n\t\t}\n\t\tif (money[i].name == \"Brass Penny\"){\n\t\t\tbp = money[i].data.quantity.value;\n\t\t}\t\t\n\t}\n\tmoneyString=\"\";\n\tif (gc>0) {\n\t\tmoneyString += gc + \" gc\";\n\t}\n\tif (ss>0) {\n\t\tif (moneyString != \"\") moneyString += \" \";\n\t\tmoneyString += ss + \" ss\";\n\t}\n\tif (bp>0) {\n\t\tif (moneyString != \"\") moneyString += \" \";\n\t\tmoneyString += bp + \" bp\";\n\t}\t\n\tif (moneyString != \"\") trappingString.push(moneyString);\n\tconsole.log(\"######################\");\n\tconsole.log(\"\" + gc + \" \" + ss + \" \" + bp);\n\tconsole.log(moneyString);\n    return trappingString;\t\n\t\n    //return trappingString.sort();\n}\n\nfunction outputTalents(talents) {\n    var talentstring = [];\n    if (talents != null) {\n        talents.forEach(function(talent) {\n            if (talent.data.max.value != \"1\") {\n                var instances = talents.filter((i) => i.name == talent.name);\n                //\t// console.log(instances);\n                talentstring.push(talent.name + \" \" + instances.length);\n            } else {\n                talentstring.push(talent.name);\n            }\n        })\n    }\n    return talentstring.filter(onlyUnique).sort();\n}\n\n/* Builds a string holding the actor's skills that they have at least 1 rank in, and the total for that skill. */\n\nfunction outputSkills(skills) {\n    var skillstring = [];\n    if (skills != null) {\n        skills.forEach(function(skill) {\n            // console.log(skill);\n            if (skill.data.advances.value != \"0\") {\n                skillstring.push(skill.name + \" \" + skill.data.total.value);\n            }\n        })\n    }\n    return skillstring.sort();\n}\n\n/* Output monster/NPC traits. */\n\nfunction outputTraits(traits) {\n    var traitsstring = \"\";\n    if (traits != null) {\n        traits.forEach(function(trait) {\n            if (traitsstring != \"\") traitsstring += \", \";\n            traitsstring += trait.name;\n        })\n    }\n    return traitsstring;\n}\n\n/* Output spells */\nfunction outputSpells(spells) {\n    var spellString = [];\n    for (var i = 0; i < spells.length; i++) {\n        // console.log(\"spell \" + i);\n        spellString.push(\"<em>\" + spells[i].name + \"</em>\");\n    }\n    return spellString.sort();\n}\n\n/* Output spells */\nfunction convertToStats(actor) {\n\n    var prep = actor.prepare();\n    // console.log(\"------------\");\n\n\n    var weapons = prep.weapons;\n    var armour = prep.armour;\n\n    // console.log(weapons);\n    // console.log(\"------------\");\n\n    var char1 = \"<td align=\\\"center\\\">\";\n    var char2 = \"</td>\";\n    var output;\n\n    output = \"<h1>\" + actor.name;\n    var st = actor.data.data.details.status.value;\n\n    if (st != null && st != \"\")\n        output += \" (\" + st + \")\";\n    // console.log(st);\n    output += \"</h1>\";\n    output += \"<table border=\\\"1\\\" class=\\\"exportOutput\\\"><tr><th style=\\\"width:8%;\\\">M</th><th style=\\\"width:8%;\\\">WS</th><th style=\\\"width:8%;\\\">BS</th><th style=\\\"width:8%;\\\">S</th><th style=\\\"width:8%;\\\">T</th><th style=\\\"width:8%;\\\">I</th><th style=\\\"width:8%;\\\">Ag</th><th style=\\\"width:8%;\\\">Dex</th><th style=\\\"width:8%;\\\">Int</th><th style=\\\"width:8%;\\\">WP</th><th style=\\\"width:8%;\\\">Fel</th><th style=\\\"width:8%;\\\">W</th></tr><tr>\";\n\n    output += char1 + prep.data.details.move.value + char2;\n    output += char1 + prep.data.characteristics.ws.value + char2;\n    output += char1 + prep.data.characteristics.bs.value + char2;\n    output += char1 + prep.data.characteristics.s.value + char2;\n    output += char1 + prep.data.characteristics.t.value + char2;\n    output += char1 + prep.data.characteristics.i.value + char2;\n    output += char1 + prep.data.characteristics.ag.value + char2;\n    output += char1 + prep.data.characteristics.dex.value + char2;\n    output += char1 + prep.data.characteristics.int.value + char2;\n    output += char1 + prep.data.characteristics.wp.value + char2;\n    output += char1 + prep.data.characteristics.fel.value + char2;\n    output += char1 + prep.data.status.wounds.value + char2;\n\n\n    output += \"</tr></table>\";\n\n    const skills = prep.basicSkills.concat(prep.advancedOrGroupedSkills);\n    const talents = actor.data.items.filter((i) => i.type === \"talent\");\n    const traits = prep.traits;\n    const trappings = actor.data.items.filter((i) => i.type === \"trapping\" || i.type === \"container\" || i.type === \"ammunition\");\n\tconst spells = prep.petty.concat(prep.grimoire.concat(prep.miracles.concat(prep.blessings)));\n\tconst money = prep.money.coins;\n\n\n\n    // console.log(\"##################\");\n    // console.log(spells);\n    // console.log(money);\n\n\n    var skillsString = outputSkills(skills);\n    var talentsString = outputTalents(talents);\n    var traitsString = outputTraits(traits);\n    var trappingString = outputTrappings(trappings, weapons, armour, money);\n    var spellString = outputSpells(spells);\n\n    if (skillsString != null && skillsString != \"\")\n        output += \"<p><strong>Skills:</strong> \" + replaceAll(skillsString.toString(), \",\", \", \") + \"<p>\";\n    if (talentsString != null && talentsString != \"\")\n        output += \"<p><strong>Talents:</strong> \" + replaceAll(talentsString.toString(), \",\", \", \") + \"<p>\";\n    if (traitsString != null && traitsString != \"\")\n        output += \"<p><strong>Traits:</strong> \" + traitsString + \"<p>\";\n    if (trappingString != null && trappingString != \"\")\n        output += \"<p><strong>Trappings:</strong> \" + replaceAll(trappingString.toString(), \",\", \", \") + \"</p>\";\n    if (spellString != null && spellString != \"\")\n        output += \"<p><strong>Spells:</strong> \" + replaceAll(spellString.toString(), \",\", \", \") + \"<p>\";\n\n\n    let chatData = {\n        user: game.user._id,\n        content: output\n    };\n    return output;\n}\n\n/* Given an actor make a JournalEntry for their stats. */\n\nfunction doConversion(exportActor) {\n    var filename = exportActor.name + \" export\";\n    var existing = game.journal.entities.find(e => e.name == filename);\n    if (existing != null) {\n        existing.delete();\n    }\n    let content = convertToStats(exportActor);\n    var j = JournalEntry.create({\n        name: filename,\n        content: `${content}`\n    });\n    ui.notifications.notify(\"Actor Converted Successfully. Check Journals for \" + filename);\n}\n\n/* Main code */\nvar actorToConvert = null;\nvar selectedToken = canvas.tokens.controlled[0];\nif (selectedToken != null || canvas.tokens.controlled.length > 1) {\n    actorToConvert = selectedToken.actor;\n    doConversion(actorToConvert);\n} else {\n    var output = \"<p>Please select a statblock.</p><form><div class=\\\"form-group\\\"><select id=\\\"export-choice\\\" name=\\\"selectedActor\\\">\";\n    let options = Array.from(game.actors);\n    for (var i = 0; i < options.length; i++) {\n        var currActor = options[i];\n        output += \"<option value=\\\"\" + i + \"\\\">\" + currActor.name + \"</option>\";\n    }\n    output += \"</select></form>\";\n    var exporting = false;\n    let d = new Dialog({\n        title: \"Export WFRP 4E Statblock\",\n        content: output,\n        buttons: {\n            one: {\n                icon: '<i class=\"fas fa-check\"></i>',\n                label: \"Export to Journal\",\n                callback: () => exporting = true\n            }\n        },\n        default: \"two\",\n        render: html => console.log(\"Register interactivity in the rendered dialog\"),\n        close: html => {\n            if (exporting) {\n                var actorNumber = html.find('[name=selectedActor]')[0].value;\n                doConversion(options[actorNumber]);\n            }\n        }\n    });\n    d.render(true);\n}","folder":null,"sort":0,"permission":{"hNHeJbKl47AOkoOO":3},"flags":{"furnace":{"runAsGM":false},"core":{"sourceId":"Macro.3sFmplIGgtI1bx0t"}},"_id":"zCiwuvoubkbSEn6i"}
