{"version":3,"file":"fxmaster.js","sources":["../src/constants.js","../src/logger.js","../src/utils.js","../src/migration.js","../src/settings.js","../src/hooks.js","../src/weatherEffects/effects/AbstractWeatherEffect.js","../src/weatherEffects/effects/BubblesWeatherEffect.js","../src/weatherEffects/effects/CloudsWeatherEffect.js","../src/weatherEffects/effects/EmbersWeatherEffect.js","../src/weatherEffects/effects/CrowsWeatherEffect.js","../src/weatherEffects/effects/BatsWeatherEffect.js","../src/weatherEffects/effects/FogWeatherEffect.js","../src/weatherEffects/effects/RaintopWeatherEffect.js","../src/weatherEffects/effects/RainSimpleWeatherEffect.js","../src/weatherEffects/effects/SnowstormWeatherEffect.js","../src/weatherEffects/effects/BirdsWeatherEffect.js","../src/weatherEffects/effects/StarsWeatherEffect.js","../src/weatherEffects/effects/RainWeatherEffect.js","../src/weatherEffects/effects/SnowWeatherEffect.js","../src/weatherEffects/effects/AutumnLeavesWeatherEffect.js","../src/weatherEffects/effects/SpiderWeatherEffect.js","../src/weatherEffects/effects/EaglesWeatherEffect.js","../src/weatherEffects/weatherDB.js","../src/filterEffects/filters/FXColorFilter.js","../src/filterEffects/filters/FXUnderwaterFilter.js","../src/canvasanimation.js","../src/ease.js","../src/filterEffects/filters/FXLightningFilter.js","../src/filterEffects/filters/FXPredatorFilter.js","../src/filterEffects/filters/FXOldFilmFilter.js","../src/filterEffects/filters/FXBloomFilter.js","../src/filterEffects/filtersDB.js","../src/config.js","../src/specialEffects/specialsDB.js","../src/weatherEffects/WeatherLayer.js","../src/pixi-helpers.js","../src/filterEffects/FilterManager.js","../src/specialEffects/applications/specials-create.js","../src/specialEffects/applications/specials-config.js","../src/specialEffects/SpecialsLayer.js","../src/weatherEffects/applications/weather-config.js","../src/filterEffects/applications/filters-config.js","../src/macro.js","../src/controls.js","../src/shims/lib-wrapper.js","../src/wrappers/canvas.js","../src/wrappers/index.js","../src/fxmaster.js","../src/helpers.js"],"sourcesContent":["export const packageId = \"fxmaster\";\n","const loggingContext = \"FXMaster\";\nconst loggingSeparator = \"|\";\n\n/**\n * Gets a logging function for the requested log level.\n * @typedef {'debug' | 'info' | 'warn' | 'error'} LogLevel\n * @typedef {(...args: unknown[]) => void} LoggingFunction\n * @param {LogLevel} [type = 'info'] - The log level of the requested logger\n * @returns {LoggingFunction}\n */\nfunction getLoggingFunction(type = \"info\") {\n  const log = console[type];\n  return (...data) => log(loggingContext, loggingSeparator, ...data);\n}\n\n/**\n * A singleton logger object.\n */\nexport const logger = Object.freeze({\n  debug: getLoggingFunction(\"debug\"),\n  info: getLoggingFunction(\"info\"),\n  warn: getLoggingFunction(\"warn\"),\n  error: getLoggingFunction(\"error\"),\n  getLoggingFunction,\n});\n","import { packageId } from \"./constants.js\";\n\nexport const resetFlags = function (document, flaglabel, newFlags) {\n  const oldFlags = document.getFlag(packageId, flaglabel);\n  const keys = oldFlags ? Object.keys(oldFlags) : [];\n  keys.forEach((k) => {\n    if (newFlags[k]) return;\n    newFlags[`-=${k}`] = null;\n  });\n  return document.setFlag(packageId, flaglabel, newFlags);\n};\n\nexport function formatString(format, ...args) {\n  return format.replace(/{(\\d+)}/g, function (match, number) {\n    return typeof args[number] != \"undefined\" ? args[number] : match;\n  });\n}\n\nexport function isV9OrLater() {\n  return game.release?.generation ?? 0 >= 9;\n}\n\nexport function roundToDecimals(number, decimals) {\n  return Number(Math.round(number + \"e\" + decimals) + \"e-\" + decimals);\n}\n","import { packageId } from \"./constants.js\";\nimport { logger } from \"./logger.js\";\nimport { isV9OrLater, resetFlags } from \"./utils.js\";\n\nexport const targetServerMigration = 2;\nexport const targetClientMigration = 1;\n\nexport async function migrate() {\n  await migrateClient();\n  if (game.user.isGM) {\n    await migrateWolrd();\n  }\n}\n\nasync function migrateWolrd() {\n  const migration = game.settings.get(packageId, \"migration\");\n  if (migration === -1) {\n    return game.settings.set(packageId, \"migration\", targetServerMigration);\n  }\n\n  if (migration < targetServerMigration) {\n    ui.notifications.info(\"FXMASTER.MigrationWorldStart\", { localize: true, permanent: true });\n    let isError = false;\n\n    switch (migration) {\n      case 0:\n      case 1:\n        isError |= await migrateWorld1to2();\n    }\n\n    if (isError) {\n      await game.settings.set(packageId, \"disableAll\", true);\n      ui.notifications.error(\"FXMASTER.MigrationWorldCompletedWithErrors\", { localize: true, permanent: true });\n    } else {\n      ui.notifications.info(\"FXMASTER.MigrationWorldCompletedSuccessfully\", { localize: true, permanent: true });\n    }\n    await game.settings.set(packageId, \"migration\", targetServerMigration);\n  }\n}\n\nasync function migrateWorld1to2() {\n  let isError = false;\n\n  const migrateScene = async (scene) => {\n    const weatherEffects = scene.getFlag(packageId, \"effects\") ?? {};\n    if (Object.keys(weatherEffects).length > 0) {\n      const newWeatherEffects = Object.fromEntries(\n        Object.entries(weatherEffects).map(([id, effect]) => {\n          const weatherEffectClass = CONFIG.fxmaster.weather[effect.type];\n          return [id, { ...effect, options: weatherEffectClass.convertOptionsToV2(effect.options, scene) }];\n        }),\n      );\n      await resetFlags(scene, \"effects\", newWeatherEffects);\n    }\n  };\n\n  for (const scene of game.scenes) {\n    logger.debug(`Migrating Scene '${scene.name}' (${scene.id}).`);\n    try {\n      await migrateScene(scene);\n    } catch (e) {\n      logger.error(`Migration of Scene '${scene.name}' (${scene.id}) failed.`, e);\n      isError = true;\n    }\n  }\n\n  const migrateSceneCompendium = async (pack) => {\n    const type = isV9OrLater() ? pack.metadata.type : pack.metadata.entity;\n    if (type !== \"Scene\") {\n      return;\n    }\n\n    const wasLocked = pack.locked;\n    await pack.configure({ locked: false });\n\n    await pack.migrate();\n    const scenes = await pack.getDocuments();\n\n    for (const scene of scenes) {\n      logger.debug(`Migrating Scene '${scene.name}' (${scene.id}) in compendium ${pack.collection}.`);\n      try {\n        await migrateScene(scene);\n      } catch (e) {\n        logger.error(`Migration of Scene '${scene.name}' (${scene.id}) in compendium ${pack.collection} failed.`, e);\n        isError = true;\n      }\n    }\n\n    await pack.configure({ locked: wasLocked });\n  };\n\n  for (const pack of game.packs) {\n    const type = isV9OrLater() ? pack.metadata.type : pack.metadata.entity;\n    if (pack.metadata.package !== \"world\" || type !== \"Scene\") continue;\n    await migrateSceneCompendium(pack);\n  }\n\n  return isError;\n}\n\nasync function migrateClient() {\n  const migration = game.settings.get(packageId, \"clientMigration\");\n  if (migration === -1) {\n    return game.settings.set(packageId, \"clientMigration\", targetClientMigration);\n  }\n\n  if (migration < targetClientMigration) {\n    ui.notifications.info(\"FXMASTER.MigrationClientStart\", { permanent: true, localize: true });\n    let isError = false;\n\n    switch (migration) {\n      case 0:\n        isError |= await migrateClient0to1();\n    }\n\n    if (isError) {\n      ui.notifications.error(\"FXMASTER.MigrationClientCompletedWithErrors\", { localize: true, permanent: true });\n    } else {\n      ui.notifications.info(\"FXMASTER.MigrationClientCompletedSuccessfully\", { localize: true, permanent: true });\n    }\n    await game.settings.set(packageId, \"clientMigration\", targetClientMigration);\n  }\n}\n\nasync function migrateClient0to1() {\n  const effects = game.settings.get(packageId, \"specialEffects\");\n  for (let i = 0; i < effects.length; ++i) {\n    if (typeof effects[i].scale !== \"object\") {\n      effects[i].scale = {\n        x: effects[i].scale,\n        y: effects[i].scale,\n      };\n    }\n  }\n  await game.settings.set(packageId, \"specialEffects\", effects);\n  return false;\n}\n\nexport function isOnTargetMigration() {\n  return (\n    game.settings.get(packageId, \"migration\") === targetServerMigration &&\n    game.settings.get(packageId, \"clientMigration\") === targetClientMigration\n  );\n}\n\n/**\n * Schedule a callback to be executed as soon as the world has been migrated to the target migration. If it is on the\n * latest migration already, the callback is executed immediately. Callbacks are executed in the order in that they have\n * been registered.\n * @param {() => (Promise<void> | void)} callback A callback to execute when the world is migrated\n */\nexport function executeWhenWorldIsMigratedToLatest(callback) {\n  if (game.settings.get(packageId, \"migration\") !== targetServerMigration) {\n    worldMigrationCallbacks.push(callback);\n  } else {\n    callback();\n  }\n}\n\n/** @type {Array<() => (Promise<void> | void)>} */\nconst worldMigrationCallbacks = [];\n\nexport async function onWorldMigrated() {\n  if (game.settings.get(packageId, \"migration\") === targetServerMigration) {\n    for (const callback of worldMigrationCallbacks) {\n      await callback();\n    }\n  }\n}\n","import { packageId } from \"./constants.js\";\nimport { onWorldMigrated } from \"./migration.js\";\n\nexport const registerSettings = function () {\n  game.settings.register(packageId, \"enable\", {\n    name: \"FXMASTER.Enable\",\n    default: true,\n    scope: \"client\",\n    type: Boolean,\n    config: true,\n    onChange: debouncedReload,\n  });\n\n  game.settings.register(packageId, \"specialEffects\", {\n    name: \"specialEffects\",\n    default: [],\n    scope: \"world\",\n    type: Array,\n    config: false,\n  });\n\n  game.settings.register(packageId, \"migration\", {\n    name: \"migration\",\n    default: -1,\n    scope: \"world\",\n    type: Number,\n    config: false,\n    onChange: onWorldMigrated,\n  });\n\n  game.settings.register(packageId, \"clientMigration\", {\n    name: \"clientMigration\",\n    default: -1,\n    scope: \"client\",\n    type: Number,\n    config: false,\n  });\n\n  game.settings.register(packageId, \"permission-create\", {\n    name: \"FXMASTER.PermissionCreate\",\n    hint: \"FXMASTER.PermissionCreateHint\",\n    scope: \"world\",\n    config: true,\n    default: foundry.CONST.USER_ROLES.ASSISTANT,\n    type: Number,\n    choices: {\n      [foundry.CONST.USER_ROLES.PLAYER]: \"USER.RolePlayer\",\n      [foundry.CONST.USER_ROLES.TRUSTED]: \"USER.RoleTrusted\",\n      [foundry.CONST.USER_ROLES.ASSISTANT]: \"USER.RoleAssistant\",\n      [foundry.CONST.USER_ROLES.GAMEMASTER]: \"USER.RoleGamemaster\",\n    },\n    onChange: debouncedReload,\n  });\n\n  game.settings.register(packageId, \"disableAll\", {\n    name: \"FXMASTER.DisableAll\",\n    hint: \"FXMASTER.DisableAllHint\",\n    default: false,\n    scope: \"world\",\n    type: Boolean,\n    config: true,\n  });\n};\n\nconst debouncedReload = foundry.utils.debounce(() => {\n  window.location.reload();\n}, 100);\n","import { packageId } from \"./constants.js\";\nimport { logger } from \"./logger.js\";\nimport { formatString, resetFlags } from \"./utils.js\";\n\nexport const registerHooks = function () {\n  // ------------------------------------------------------------------\n  // Hooks API\n  Hooks.on(`${packageId}.switchWeather`, onSwitchWeather);\n  Hooks.on(`${packageId}.updateWeather`, onUpdateWeather);\n\n  // deprecated hooks\n  Hooks.on(\"switchWeather\", onSwitchWeatherDeprecated);\n  Hooks.on(\"updateWeather\", onUpdateWeatherDeprecated);\n};\n\n/**\n * Handle a request to toggle named a weather effect in the current scene.\n * @param {{name: string, type: string, options: object}} parameters The parameters that define the named weather effect\n */\nasync function onSwitchWeather(parameters) {\n  if (!canvas.scene) {\n    return;\n  }\n  const newEffect = { [parameters.name]: { type: parameters.type, options: parameters.options } };\n\n  let flags = (await canvas.scene.getFlag(packageId, \"effects\")) ?? {};\n  let effects = {};\n\n  if (foundry.utils.hasProperty(flags, parameters.name)) {\n    effects = flags;\n    delete effects[parameters.name];\n  } else {\n    effects = foundry.utils.mergeObject(flags, newEffect);\n  }\n  if (Object.keys(effects).length == 0) {\n    await canvas.scene.unsetFlag(packageId, \"effects\");\n  } else {\n    resetFlags(canvas.scene, \"effects\", effects);\n  }\n}\n\n/**\n * Handle a request to set the weather effects in the current scene.\n * @param {Array<object>} parametersArray The array of parameters defining the effects to be activated\n */\nasync function onUpdateWeather(parametersArray) {\n  const effects = Object.fromEntries(parametersArray.map((parameters) => [foundry.utils.randomID(), parameters]));\n  resetFlags(canvas.scene, \"effects\", effects);\n}\n\nconst deprecationFormatString =\n  \"The '{0}' hook is deprecated and will be removed in a future version. Please use the \" +\n  `'${packageId}.{0}' hook instead. Be aware that the meaning of some options changed for the new hook. ` +\n  \"Consult the documentation for more details: https://github.com/ghost-fvtt/fxmaster/blob/v2.0.0/README.md#weather-effect-options. \" +\n  \"To get the same effect for this scene, the given parameters should look as follows for the new hook:\";\n\nasync function onSwitchWeatherDeprecated(parameters) {\n  const weatherEffectClass = CONFIG.fxmaster.weather[parameters.type];\n\n  const v2Parameters = {\n    ...parameters,\n    options: weatherEffectClass.convertOptionsToV2(parameters.options, canvas.scene),\n  };\n\n  logger.warn(formatString(deprecationFormatString, \"switchWeather\"), v2Parameters);\n\n  return onSwitchWeather(v2Parameters);\n}\n\nasync function onUpdateWeatherDeprecated(parametersArray) {\n  const v2ParametersArray = parametersArray.map((parameters) => {\n    const weatherEffectClass = CONFIG.fxmaster.weather[parameters.type];\n    return {\n      ...parameters,\n      options: weatherEffectClass.convertOptionsToV2(parameters.options, canvas.scene),\n    };\n  });\n\n  logger.warn(formatString(deprecationFormatString, \"updateWeather\"), v2ParametersArray);\n\n  return onUpdateWeather(v2ParametersArray);\n}\n","import { roundToDecimals } from \"../../utils.js\";\n\nexport class AbstractWeatherEffect extends SpecialEffect {\n  static get parameters() {\n    return {\n      scale: {\n        label: \"FXMASTER.Scale\",\n        type: \"range\",\n        min: 0.1,\n        value: 1,\n        max: 5,\n        step: 0.1,\n        decimals: 1,\n      },\n      direction: {\n        label: \"FXMASTER.Direction\",\n        type: \"range\",\n        min: 0,\n        value: (this.CONFIG.startRotation.min + this.CONFIG.startRotation.max) / 2,\n        max: 360,\n        step: 5,\n        decimals: 0,\n      },\n      speed: {\n        label: \"FXMASTER.Speed\",\n        type: \"range\",\n        min: 0.1,\n        value: 1,\n        max: 5,\n        step: 0.1,\n        decimals: 1,\n      },\n      lifetime: {\n        label: \"FXMASTER.Lifetime\",\n        type: \"range\",\n        min: 0.1,\n        value: 1,\n        max: 5,\n        step: 0.1,\n        decimals: 1,\n      },\n      density: {\n        label: \"FXMASTER.Density\",\n        type: \"range\",\n        min: 0.1,\n        value: 0.5,\n        max: 5,\n        step: 0.1,\n        decimals: 1,\n      },\n      tint: {\n        label: \"FXMASTER.Tint\",\n        type: \"color\",\n        value: {\n          value: \"#FFFFFF\",\n          apply: false,\n        },\n      },\n    };\n  }\n\n  static get default() {\n    return Object.fromEntries(\n      Object.entries(this.parameters).map(([parameterName, parameterConfig]) => [parameterName, parameterConfig.value]),\n    );\n  }\n\n  /** @override */\n  static get effectOptions() {\n    const optionTypeMapping = {\n      color: SpecialEffect.OPTION_TYPES.value,\n      number: SpecialEffect.OPTION_TYPES.VALUE,\n      range: SpecialEffect.OPTION_TYPES.RANGE,\n    };\n    return Object.fromEntries(\n      Object.entries(this.parameters).map(([parameterName, parameterConfig]) => [\n        parameterName,\n        { ...parameterConfig, type: optionTypeMapping[parameterConfig.type] },\n      ]),\n    );\n  }\n\n  applyOptionsToConfig(config) {\n    this._applyScaleToConfig(config);\n    this._applySpeedToConfig(config);\n    this._applyDirectionToConfig(config);\n    this._applyLifetimeToConfig(config);\n    this._applyTintToConfig(config);\n  }\n\n  /** @protected */\n  _applyFactorToBasicTweenableOrValueListOrRandNumber(basicTweenableOrValueListOrRandNumber, factor) {\n    if (\"start\" in basicTweenableOrValueListOrRandNumber) {\n      basicTweenableOrValueListOrRandNumber.start = basicTweenableOrValueListOrRandNumber.start * factor;\n    }\n    if (\"end\" in basicTweenableOrValueListOrRandNumber) {\n      basicTweenableOrValueListOrRandNumber.end = basicTweenableOrValueListOrRandNumber.end * factor;\n    }\n    if (\"list\" in basicTweenableOrValueListOrRandNumber) {\n      basicTweenableOrValueListOrRandNumber.list = basicTweenableOrValueListOrRandNumber.list.map((valueStep) => ({\n        ...valueStep,\n        value: valueStep.value * factor,\n      }));\n    }\n    if (\"min\" in basicTweenableOrValueListOrRandNumber) {\n      basicTweenableOrValueListOrRandNumber.min = basicTweenableOrValueListOrRandNumber.min * factor;\n    }\n    if (\"max\" in basicTweenableOrValueListOrRandNumber) {\n      basicTweenableOrValueListOrRandNumber.max = basicTweenableOrValueListOrRandNumber.max * factor;\n    }\n  }\n\n  /** @protected */\n  _applyScaleToConfig(config) {\n    const scale = config.scale ?? {};\n    const factor = (this.options.scale?.value ?? 1) * (canvas.dimensions.size / 100);\n    this._applyFactorToBasicTweenableOrValueListOrRandNumber(scale, factor);\n  }\n\n  /** @protected */\n  _applySpeedToConfig(config) {\n    const factor = (this.options.speed?.value ?? 1) * (canvas.dimensions.size / 100);\n\n    const speed = config.speed ?? {};\n    this._applyFactorToBasicTweenableOrValueListOrRandNumber(speed, factor);\n\n    const lifeTime = config.lifetime ?? {};\n    this._applyFactorToBasicTweenableOrValueListOrRandNumber(lifeTime, 1 / factor);\n\n    config.frequency /= factor;\n  }\n\n  /** @protected */\n  _applyDirectionToConfig(config) {\n    const direction = this.options.direction?.value;\n    const range = (config.startRotation?.max ?? 0) - (config.startRotation?.min ?? 0);\n    if (direction !== undefined) {\n      config.startRotation = { min: direction - range / 2, max: direction + range / 2 };\n    }\n  }\n\n  /** @protected */\n  _applyLifetimeToConfig(config) {\n    const lifetime = config.lifetime ?? {};\n    const factor = this.options.lifetime?.value ?? 1;\n    this._applyFactorToBasicTweenableOrValueListOrRandNumber(lifetime, factor);\n    config.frequency *= factor;\n  }\n\n  /** @protected */\n  _applyTintToConfig(config) {\n    if (this.options.tint?.value.apply) {\n      const value = this.options.tint.value.value;\n      config.color = {\n        list: [\n          { value, time: 0 },\n          { value, time: 1 },\n        ],\n      };\n    }\n  }\n\n  /**\n   * Fade this effect out, playing it once and then stopping it.\n   * @param {{timeout?: number}} [options]         Additional options to configure the fade out\n   * @param {number}             [options.timeout] If given, the effect will be stopped after the given number in ms,\n   *                                               regardless of if it has finished playing or not.\n   * @returns {Promise<void>}                      A promise that resolves as soon as this effect has finished fading out\n   */\n  async fadeOut({ timeout } = {}) {\n    const emitterPromises = this.emitters.map(\n      (emitter) =>\n        new Promise((resolve) => {\n          emitter.emitterLifetime = 0.1;\n          emitter.playOnceAndDestroy(() => {\n            resolve();\n          });\n        }),\n    );\n    const promises = [Promise.all(emitterPromises)];\n    if (timeout !== undefined) {\n      promises.push(new Promise((resolve) => setTimeout(resolve, timeout)));\n    }\n\n    await Promise.race(promises);\n    this.stop();\n  }\n\n  static convertOptionsToV2(options, scene) {\n    return Object.fromEntries(\n      Object.entries(options).map(([optionKey, optionValue]) => {\n        switch (optionKey) {\n          case \"scale\": {\n            return [optionKey, this._convertScaleToV2(optionValue, scene)];\n          }\n          case \"speed\": {\n            return [optionKey, this._convertSpeedToV2(optionValue, scene)];\n          }\n          case \"density\": {\n            return [optionKey, this._convertDensityToV2(optionValue, scene)];\n          }\n          default: {\n            return [optionKey, optionValue];\n          }\n        }\n      }),\n    );\n  }\n\n  /** @protected */\n  static _convertScaleToV2(scale, scene) {\n    const decimals = this.parameters.scale?.decimals ?? 1;\n    return roundToDecimals(scale * (100 / scene.dimensions.size), decimals);\n  }\n\n  /** @protected */\n  static _convertSpeedToV2(speed, scene) {\n    const speeds = this.CONFIG.speed?.list?.map((valueStep) => valueStep.value) ?? [];\n    if (\"start\" in (this.CONFIG.speed ?? {})) {\n      speeds.push(this.CONFIG.speed.start);\n    }\n    if (\"end\" in (this.CONFIG.speed ?? {})) {\n      speeds.push(this.CONFIG.speed.end);\n    }\n    const maximumSpeed = Math.max(...speeds);\n\n    const decimals = this.parameters.speed?.decimals ?? 1;\n    return roundToDecimals((speed / maximumSpeed) * (100 / scene.dimensions.size), decimals);\n  }\n\n  /** @protected */\n  static _convertDensityToV2(density, scene) {\n    const d = scene.dimensions;\n    const gridUnits = (d.width / d.size) * (d.height / d.size);\n\n    const decimals = this.parameters.density?.decimals ?? 1;\n    return roundToDecimals(density / gridUnits, decimals);\n  }\n}\n","import { AbstractWeatherEffect } from \"./AbstractWeatherEffect.js\";\n\nexport class BubblesWeatherEffect extends AbstractWeatherEffect {\n  static get label() {\n    return \"Bubbles\";\n  }\n\n  static get icon() {\n    return \"modules/fxmaster/assets/weatherEffects/icons/bubbles.png\";\n  }\n\n  static get parameters() {\n    return foundry.utils.mergeObject(super.parameters, {\n      density: { min: 0.01, value: 0.15, max: 0.5, step: 0.01, decimals: 2 },\n      \"-=direction\": undefined,\n    });\n  }\n\n  getParticleEmitters() {\n    return [this._getBubbleEmitter(this.parent)];\n  }\n\n  _getBubbleEmitter(parent) {\n    const d = canvas.dimensions;\n    const p = (d.width / d.size) * (d.height / d.size) * this.options.density.value;\n    const config = foundry.utils.mergeObject(\n      this.constructor.CONFIG,\n      {\n        spawnRect: {\n          x: d.sceneRect.x,\n          y: d.sceneRect.y,\n          w: d.sceneRect.width,\n          h: d.sceneRect.height,\n        },\n        maxParticles: p,\n        frequency: this.constructor.CONFIG.lifetime.min / p,\n      },\n      { inplace: false },\n    );\n    this.applyOptionsToConfig(config);\n\n    const art = [\"modules/fxmaster/assets/weatherEffects/effects/bubbles.png\"];\n    const emitter = new PIXI.particles.Emitter(parent, art, config);\n    return emitter;\n  }\n\n  /**\n   * Configuration for the Bubbles particle effect\n   * @type {Object}\n   */\n  static CONFIG = foundry.utils.mergeObject(\n    SpecialEffect.DEFAULT_CONFIG,\n    {\n      alpha: {\n        list: [\n          { value: 0, time: 0 },\n          { value: 0.85, time: 0.05 },\n          { value: 0.85, time: 0.98 },\n          { value: 0, time: 1 },\n        ],\n      },\n      scale: {\n        start: 0.25,\n        end: 0.5,\n        minimumScaleMultiplier: 0.5,\n      },\n      speed: {\n        start: 20,\n        end: 60,\n        minimumSpeedMultiplier: 0.6,\n      },\n      color: {\n        list: [\n          { value: \"ffffff\", time: 0 },\n          { value: \"ffffff\", time: 1 },\n        ],\n      },\n      startRotation: {\n        min: 0,\n        max: 360,\n      },\n      rotationSpeed: {\n        min: 100,\n        max: 200,\n      },\n      lifetime: {\n        min: 8,\n        max: 10,\n      },\n      blendMode: \"normal\",\n      emitterLifetime: -1,\n    },\n    { inplace: false },\n  );\n}\n","import { AbstractWeatherEffect } from \"./AbstractWeatherEffect.js\";\n\nexport class CloudsWeatherEffect extends AbstractWeatherEffect {\n  static get label() {\n    return \"Clouds\";\n  }\n\n  static get icon() {\n    return \"modules/fxmaster/assets/weatherEffects/icons/fog.png\";\n  }\n\n  /** @override */\n  static get parameters() {\n    return foundry.utils.mergeObject(super.parameters, {\n      density: { min: 0.001, value: 0.03, max: 0.2, step: 0.001, decimals: 3 },\n    });\n  }\n\n  /** @override */\n  getParticleEmitters() {\n    return [this._getCloudEmitter(this.parent)];\n  }\n\n  _getCloudEmitter(parent) {\n    const d = canvas.dimensions;\n    const p = (d.sceneRect.width / d.size) * (d.sceneRect.height / d.size) * this.options.density.value;\n\n    const offsetFactor = 2 / 3;\n\n    const diagonal = Math.sqrt(d.sceneRect.width * d.sceneRect.width + d.sceneRect.height * d.sceneRect.height);\n    const maximumAverageSpeed = (this.constructor.CONFIG.speed.start + this.constructor.CONFIG.speed.end) / 2;\n    const averageSpeed = (maximumAverageSpeed * (1 + this.constructor.CONFIG.speed.minimumSpeedMultiplier)) / 2;\n    const averageDiagonalTime = diagonal / averageSpeed;\n    const minLifetime = averageDiagonalTime / offsetFactor / 2;\n    const maxLifetime = averageDiagonalTime / offsetFactor;\n\n    const angle = Math.toRadians(this.options.direction.value);\n    const directionVector = {\n      x: Math.cos(angle),\n      y: Math.sin(angle),\n    };\n\n    const config = foundry.utils.mergeObject(\n      this.constructor.CONFIG,\n      {\n        spawnRect: {\n          x: d.sceneRect.x - directionVector.x * d.sceneRect.width * offsetFactor,\n          y: d.sceneRect.y - directionVector.y * d.sceneRect.height * offsetFactor,\n          w: d.sceneRect.width,\n          h: d.sceneRect.height,\n        },\n        maxParticles: p,\n        frequency: (minLifetime + maxLifetime) / 2 / p,\n        lifetime: {\n          min: minLifetime,\n          max: maxLifetime,\n        },\n      },\n      { inplace: false },\n    );\n    this.applyOptionsToConfig(config);\n\n    // Animation\n    const art = [\n      \"modules/fxmaster/assets/weatherEffects/effects/cloud1.png\",\n      \"modules/fxmaster/assets/weatherEffects/effects/cloud2.png\",\n      \"modules/fxmaster/assets/weatherEffects/effects/cloud3.png\",\n      \"modules/fxmaster/assets/weatherEffects/effects/cloud4.png\",\n    ];\n    const emitter = new PIXI.particles.Emitter(parent, art, config);\n    return emitter;\n  }\n\n  /**\n   * Configuration for the Clouds particle effect\n   * @type {Object}\n   */\n  static CONFIG = foundry.utils.mergeObject(\n    SpecialEffect.DEFAULT_CONFIG,\n    {\n      alpha: {\n        list: [\n          { value: 0, time: 0 },\n          { value: 0.5, time: 0.05 },\n          { value: 0.5, time: 0.95 },\n          { value: 0, time: 1 },\n        ],\n        isStepped: false,\n      },\n      scale: {\n        start: 0.8,\n        end: 0.8,\n        minimumScaleMultiplier: 0.1,\n      },\n      speed: {\n        start: 100,\n        end: 100,\n        minimumSpeedMultiplier: 0.3,\n      },\n      color: {\n        list: [\n          { value: \"ffffff\", time: 0 },\n          { value: \"ffffff\", time: 1 },\n        ],\n      },\n      startRotation: {\n        min: 80,\n        max: 100,\n      },\n      blendMode: \"normal\",\n      emitterLifetime: -1,\n    },\n    { inplace: false },\n  );\n}\n","import { AbstractWeatherEffect } from \"./AbstractWeatherEffect.js\";\n\nexport class EmbersWeatherEffect extends AbstractWeatherEffect {\n  static get label() {\n    return \"Embers\";\n  }\n\n  static get icon() {\n    return \"modules/fxmaster/assets/weatherEffects/icons/embers.png\";\n  }\n\n  static get parameters() {\n    return foundry.utils.mergeObject(super.parameters, {\n      density: { min: 0.05, value: 0.7, max: 1.4, step: 0.05, decimals: 2 },\n      tint: { value: { value: \"#f77300\" } },\n      \"-=direction\": undefined,\n    });\n  }\n\n  getParticleEmitters() {\n    return [this._getEmbersEmitter(this.parent)];\n  }\n\n  // This is where the magic happens\n  _getEmbersEmitter(parent) {\n    const d = canvas.dimensions;\n    const p = (d.width / d.size) * (d.height / d.size) * this.options.density.value;\n    const config = foundry.utils.mergeObject(\n      this.constructor.CONFIG,\n      {\n        spawnRect: {\n          x: d.sceneRect.x,\n          y: d.sceneRect.y,\n          w: d.sceneRect.width,\n          h: d.sceneRect.height,\n        },\n        maxParticles: p,\n        frequency: this.constructor.CONFIG.lifetime.min / p,\n      },\n      { inplace: false },\n    );\n    this.applyOptionsToConfig(config);\n\n    // Assets are selected randomly from the list for each particle\n    const art = [\"modules/fxmaster/assets/weatherEffects/effects/ember.png\"];\n    const emitter = new PIXI.particles.Emitter(parent, art, config);\n    emitter.startColor = PIXI.particles.ParticleUtils.createSteppedGradient(config.color.list, true);\n    return emitter;\n  }\n\n  /**\n   * Configuration for the Embers particle effect\n   * @type {Object}\n   */\n  static CONFIG = foundry.utils.mergeObject(\n    SpecialEffect.DEFAULT_CONFIG,\n    {\n      alpha: {\n        list: [\n          { value: 0, time: 0 },\n          { value: 0.9, time: 0.3 },\n          { value: 0.9, time: 0.95 },\n          { value: 0, time: 1 },\n        ],\n      },\n      scale: {\n        start: 0.15,\n        end: 0.01,\n        minimumScaleMultiplier: 0.85,\n      },\n      speed: {\n        start: 40,\n        end: 40,\n        minimumSpeedMultiplier: 0.6,\n      },\n      color: {\n        list: [\n          { value: \"f77300\", time: 0 },\n          { value: \"f72100\", time: 1 },\n        ],\n      },\n      startRotation: {\n        min: 0,\n        max: 360,\n      },\n      rotationSpeed: {\n        min: 100,\n        max: 200,\n      },\n      lifetime: {\n        min: 4,\n        max: 6,\n      },\n      blendMode: \"screen\",\n      emitterLifetime: -1,\n    },\n    { inplace: false },\n  );\n}\n","import { AbstractWeatherEffect } from \"./AbstractWeatherEffect.js\";\n\nexport class CrowsWeatherEffect extends AbstractWeatherEffect {\n  static get label() {\n    return \"Crows\";\n  }\n\n  static get icon() {\n    return \"modules/fxmaster/assets/weatherEffects/icons/crows.png\";\n  }\n\n  static get parameters() {\n    return foundry.utils.mergeObject(super.parameters, {\n      density: { min: 0.001, value: 0.006, max: 0.01, step: 0.001, decimals: 3 },\n      \"-=direction\": undefined,\n    });\n  }\n\n  getParticleEmitters() {\n    return [this._getCrowsEmitter(this.parent)];\n  }\n\n  // This is where the magic happens\n  _getCrowsEmitter(parent) {\n    const d = canvas.dimensions;\n    const p = (d.width / d.size) * (d.height / d.size) * this.options.density.value;\n    const config = foundry.utils.mergeObject(\n      this.constructor.CONFIG,\n      {\n        spawnRect: {\n          x: d.sceneRect.x,\n          y: d.sceneRect.y,\n          w: d.sceneRect.width,\n          h: d.sceneRect.height,\n        },\n        maxParticles: p,\n        frequency: this.constructor.CONFIG.lifetime.min / p,\n      },\n      { inplace: false },\n    );\n    this.applyOptionsToConfig(config);\n\n    // Assets are selected randomly from the list for each particle\n    const anim_sheet = {\n      framerate: \"15\",\n      textures: [\n        {\n          texture: \"modules/fxmaster/assets/weatherEffects/effects/raven1.png\",\n          count: 20,\n        },\n        {\n          texture: \"modules/fxmaster/assets/weatherEffects/effects/raven2.png\",\n          count: 3,\n        },\n        {\n          texture: \"modules/fxmaster/assets/weatherEffects/effects/raven3.png\",\n          count: 2,\n        },\n        {\n          texture: \"modules/fxmaster/assets/weatherEffects/effects/raven4.png\",\n          count: 2,\n        },\n        {\n          texture: \"modules/fxmaster/assets/weatherEffects/effects/raven3.png\",\n          count: 2,\n        },\n        {\n          texture: \"modules/fxmaster/assets/weatherEffects/effects/raven2.png\",\n          count: 3,\n        },\n      ],\n      loop: true,\n    };\n    const emitter = new PIXI.particles.Emitter(parent, anim_sheet, config);\n    emitter.particleConstructor = PIXI.particles.AnimatedParticle;\n    return emitter;\n  }\n\n  /**\n   * Configuration for the Crows particle effect\n   * @type {Object}\n   */\n  static CONFIG = foundry.utils.mergeObject(\n    SpecialEffect.DEFAULT_CONFIG,\n    {\n      alpha: {\n        list: [\n          { value: 0, time: 0 },\n          { value: 1, time: 0.02 },\n          { value: 1, time: 0.98 },\n          { value: 0, time: 1 },\n        ],\n        isStepped: false,\n      },\n      scale: {\n        list: [\n          { value: 0.03, time: 0 },\n          { value: 0.12, time: 0.1 },\n          { value: 0.12, time: 0.9 },\n          { value: 0.03, time: 1 },\n        ],\n        isStepped: false,\n      },\n      speed: {\n        start: 90,\n        end: 100,\n        minimumSpeedMultiplier: 0.6,\n      },\n      startRotation: {\n        min: 0,\n        max: 360,\n      },\n      lifetime: {\n        min: 20,\n        max: 40,\n      },\n      blendMode: \"normal\",\n      emitterLifetime: -1,\n    },\n    { inplace: false },\n  );\n}\n","import { AbstractWeatherEffect } from \"./AbstractWeatherEffect.js\";\n\nexport class BatsWeatherEffect extends AbstractWeatherEffect {\n  static get label() {\n    return \"Bats\";\n  }\n\n  static get icon() {\n    return \"modules/fxmaster/assets/weatherEffects/icons/bats.png\";\n  }\n\n  static get parameters() {\n    return foundry.utils.mergeObject(super.parameters, {\n      density: { min: 0.005, value: 0.05, max: 0.1, step: 0.005, decimals: 3 },\n      \"-=direction\": undefined,\n    });\n  }\n\n  getParticleEmitters() {\n    return [this._getBatsEmitter(this.parent)];\n  }\n\n  // This is where the magic happens\n  _getBatsEmitter(parent) {\n    const d = canvas.dimensions;\n    const p = (d.width / d.size) * (d.height / d.size) * this.options.density.value;\n    const config = foundry.utils.mergeObject(\n      this.constructor.CONFIG,\n      {\n        spawnRect: {\n          x: d.sceneRect.x,\n          y: d.sceneRect.y,\n          w: d.sceneRect.width,\n          h: d.sceneRect.height,\n        },\n        maxParticles: p,\n        frequency: this.constructor.CONFIG.lifetime.min / p,\n      },\n      { inplace: false },\n    );\n    this.applyOptionsToConfig(config);\n\n    // Assets are selected randomly from the list for each particle\n    const anim_sheet = {\n      framerate: \"30\",\n      textures: [\n        {\n          texture: \"modules/fxmaster/assets/weatherEffects/effects/bat0.png\",\n          count: 1,\n        },\n        {\n          texture: \"modules/fxmaster/assets/weatherEffects/effects/bat1.png\",\n          count: 1,\n        },\n        {\n          texture: \"modules/fxmaster/assets/weatherEffects/effects/bat2.png\",\n          count: 1,\n        },\n        {\n          texture: \"modules/fxmaster/assets/weatherEffects/effects/bat3.png\",\n          count: 1,\n        },\n        {\n          texture: \"modules/fxmaster/assets/weatherEffects/effects/bat4.png\",\n          count: 2,\n        },\n        {\n          texture: \"modules/fxmaster/assets/weatherEffects/effects/bat3.png\",\n          count: 1,\n        },\n        {\n          texture: \"modules/fxmaster/assets/weatherEffects/effects/bat2.png\",\n          count: 1,\n        },\n        {\n          texture: \"modules/fxmaster/assets/weatherEffects/effects/bat1.png\",\n          count: 1,\n        },\n      ],\n      loop: true,\n    };\n    const emitter = new PIXI.particles.Emitter(parent, anim_sheet, config);\n    emitter.particleConstructor = PIXI.particles.AnimatedParticle;\n    return emitter;\n  }\n\n  /**\n   * Configuration for the Bats particle effect\n   * @type {Object}\n   */\n  static CONFIG = foundry.utils.mergeObject(\n    SpecialEffect.DEFAULT_CONFIG,\n    {\n      alpha: {\n        list: [\n          { value: 0, time: 0 },\n          { value: 1, time: 0.02 },\n          { value: 1, time: 0.98 },\n          { value: 0, time: 1 },\n        ],\n        isStepped: false,\n      },\n      scale: {\n        list: [\n          { value: 0.02, time: 0 },\n          { value: 0.1, time: 0.05 },\n          { value: 0.1, time: 0.95 },\n          { value: 0.02, time: 1 },\n        ],\n        isStepped: false,\n      },\n      speed: {\n        start: 200,\n        end: 260,\n        minimumSpeedMultiplier: 0.8,\n      },\n      startRotation: {\n        min: 0,\n        max: 360,\n      },\n      lifetime: {\n        min: 20,\n        max: 40,\n      },\n      blendMode: \"normal\",\n      emitterLifetime: -1,\n    },\n    { inplace: false },\n  );\n}\n","import { AbstractWeatherEffect } from \"./AbstractWeatherEffect.js\";\n\nexport class FogWeatherEffect extends AbstractWeatherEffect {\n  static get label() {\n    return \"Fog\";\n  }\n\n  static get icon() {\n    return \"modules/fxmaster/assets/weatherEffects/icons/fog.png\";\n  }\n\n  static get parameters() {\n    return foundry.utils.mergeObject(super.parameters, {\n      density: { min: 0.01, value: 0.08, max: 0.15, step: 0.01, decimals: 2 },\n      \"-=direction\": undefined,\n    });\n  }\n\n  getParticleEmitters() {\n    return [this._getFogEmitter(this.parent)];\n  }\n\n  _getFogEmitter(parent) {\n    const d = canvas.dimensions;\n    const p = (d.width / d.size) * (d.height / d.size) * this.options.density.value;\n    const config = foundry.utils.mergeObject(\n      this.constructor.CONFIG,\n      {\n        spawnRect: {\n          x: d.sceneRect.x,\n          y: d.sceneRect.y,\n          w: d.sceneRect.width,\n          h: d.sceneRect.height,\n        },\n        maxParticles: p,\n        frequency: this.constructor.CONFIG.lifetime.min / p,\n      },\n      { inplace: false },\n    );\n    this.applyOptionsToConfig(config);\n\n    // Animation\n    const art = [\n      \"modules/fxmaster/assets/weatherEffects/effects/cloud1.png\",\n      \"modules/fxmaster/assets/weatherEffects/effects/cloud2.png\",\n      \"modules/fxmaster/assets/weatherEffects/effects/cloud3.png\",\n      \"modules/fxmaster/assets/weatherEffects/effects/cloud4.png\",\n    ];\n    const emitter = new PIXI.particles.Emitter(parent, art, config);\n    return emitter;\n  }\n\n  /**\n   * Configuration for the Fog particle effect\n   * @type {Object}\n   */\n  static CONFIG = foundry.utils.mergeObject(\n    SpecialEffect.DEFAULT_CONFIG,\n    {\n      alpha: {\n        list: [\n          { value: 0, time: 0 },\n          { value: 0.1, time: 0.1 },\n          { value: 0.3, time: 0.5 },\n          { value: 0.1, time: 0.9 },\n          { value: 0, time: 1 },\n        ],\n        isStepped: false,\n      },\n      scale: {\n        start: 1.5,\n        end: 1.0,\n        minimumScaleMultiplier: 0.5,\n      },\n      speed: {\n        start: 15,\n        end: 10,\n        minimumSpeedMultiplier: 0.2,\n      },\n      color: {\n        list: [\n          { value: \"dddddd\", time: 0 },\n          { value: \"dddddd\", time: 1 },\n        ],\n      },\n      startRotation: {\n        min: 0,\n        max: 360,\n      },\n      rotationSpeed: {\n        min: 0.15,\n        max: 0.35,\n      },\n      lifetime: {\n        min: 10,\n        max: 25,\n      },\n      blendMode: \"normal\",\n      emitterLifetime: -1,\n    },\n    { inplace: false },\n  );\n}\n","import { AbstractWeatherEffect } from \"./AbstractWeatherEffect.js\";\n\nexport class RaintopWeatherEffect extends AbstractWeatherEffect {\n  static get label() {\n    return \"Topdown Rain\";\n  }\n\n  static get icon() {\n    return \"modules/fxmaster/assets/weatherEffects/icons/rain.png\";\n  }\n\n  static get parameters() {\n    return foundry.utils.mergeObject(super.parameters, {\n      density: { min: 0.01, value: 0.3, max: 1, step: 0.01, decimals: 2 },\n      \"-=direction\": null,\n    });\n  }\n\n  getParticleEmitters() {\n    return [this._getEmitter(this.parent)];\n  }\n\n  _getEmitter(parent) {\n    const d = canvas.dimensions;\n    const p = (d.width / d.size) * (d.height / d.size) * this.options.density.value;\n    const sceneRadius = Math.sqrt(d.sceneWidth * d.sceneWidth + d.sceneHeight * d.sceneHeight) / 2;\n    const config = foundry.utils.mergeObject(\n      this.constructor.CONFIG,\n      {\n        spawnType: \"ring\",\n        speed: {\n          start: d.width / 3,\n          end: d.height / 4,\n          minimumSpeedMultiplier: 0.8,\n        },\n        spawnCircle: {\n          x: d.sceneRect.x + d.sceneWidth / 2,\n          y: d.sceneRect.y + d.sceneHeight / 2,\n          r: sceneRadius * 1.3,\n          minR: sceneRadius / 2,\n        },\n        maxParticles: p,\n        frequency: 1 / p,\n      },\n      { inplace: false },\n    );\n    this.applyOptionsToConfig(config);\n\n    const art = [\"ui/particles/rain.png\"];\n    const emitter = new PIXI.particles.Emitter(parent, art, config);\n    return emitter;\n  }\n\n  /**\n   * Configuration for the Rain Top particle effect\n   * @type {Object}\n   */\n  static CONFIG = foundry.utils.mergeObject(\n    SpecialEffect.DEFAULT_CONFIG,\n\n    {\n      alpha: {\n        list: [\n          { value: 0, time: 0 },\n          { value: 0.6, time: 0.1 },\n          { value: 0.23, time: 1 },\n        ],\n        isStepped: false,\n      },\n      scale: {\n        start: 3,\n        end: 0.4,\n        minimumScaleMultiplier: 0.7,\n      },\n      color: {\n        start: \"dddddd\",\n        end: \"dddddd\",\n      },\n      startRotation: {\n        min: 180,\n        max: 180,\n      },\n      lifetime: {\n        min: 0.3,\n        max: 0.7,\n      },\n      blendMode: \"normal\",\n      emitterLifetime: -1,\n    },\n    { inplace: false },\n  );\n}\n","import { AbstractWeatherEffect } from \"./AbstractWeatherEffect.js\";\n\nexport class RainSimpleWeatherEffect extends AbstractWeatherEffect {\n  static get label() {\n    return \"Rain without splash\";\n  }\n\n  static get icon() {\n    return \"modules/fxmaster/assets/weatherEffects/icons/rain.png\";\n  }\n\n  getParticleEmitters() {\n    return [this._getRainEmitter(this.parent)];\n  }\n\n  _getRainEmitter(parent) {\n    const d = canvas.dimensions;\n    const p = (d.width / d.size) * (d.height / d.size) * this.options.density.value;\n    const config = foundry.utils.mergeObject(\n      this.constructor.CONFIG,\n      {\n        spawnRect: {\n          x: -0.05 * d.width,\n          y: -0.1 * d.height,\n          w: d.width,\n          h: 0.8 * d.height,\n        },\n        maxParticles: p,\n        frequency: 1 / p,\n      },\n      { inplace: false },\n    );\n    this.applyOptionsToConfig(config);\n\n    return new PIXI.particles.Emitter(parent, [\"ui/particles/rain.png\"], config);\n  }\n\n  /**\n   * Configuration for the Rain Simple particle effect\n   * @type {Object}\n   */\n  static CONFIG = foundry.utils.mergeObject(\n    SpecialEffect.DEFAULT_CONFIG,\n    {\n      alpha: {\n        start: 0.7,\n        end: 0.1,\n      },\n      scale: {\n        start: 1.0,\n        end: 1.0,\n        minimumScaleMultiplier: 0.8,\n      },\n      speed: {\n        start: 3500,\n        end: 3500,\n        minimumSpeedMultiplier: 0.8,\n      },\n      startRotation: {\n        min: 75,\n        max: 75,\n      },\n      lifetime: {\n        min: 0.5,\n        max: 0.5,\n      },\n    },\n    { inplace: false },\n  );\n}\n","import { AbstractWeatherEffect } from \"./AbstractWeatherEffect.js\";\n\nexport class SnowstormWeatherEffect extends AbstractWeatherEffect {\n  static get label() {\n    return \"Snowstorm\";\n  }\n\n  static get icon() {\n    return \"modules/fxmaster/assets/weatherEffects/icons/snow.png\";\n  }\n\n  /** @override */\n  static get parameters() {\n    return foundry.utils.mergeObject(super.parameters, {\n      density: { min: 0.05, value: 0.6, max: 1, step: 0.05, decimals: 2 },\n    });\n  }\n\n  getParticleEmitters() {\n    return [this._getSnowEmitter(this.parent)];\n  }\n\n  _getSnowEmitter(parent) {\n    const d = canvas.dimensions;\n    const p = (d.width / d.size) * (d.height / d.size) * this.options.density.value;\n    const config = foundry.utils.mergeObject(\n      this.constructor.CONFIG,\n      {\n        spawnRect: {\n          x: d.sceneRect.x,\n          y: d.sceneRect.y,\n          w: d.sceneRect.width,\n          h: d.sceneRect.height,\n        },\n        maxParticles: p,\n        frequency: (this.constructor.CONFIG.lifetime.min + this.constructor.CONFIG.lifetime.max) / 2 / p,\n      },\n      { inplace: false },\n    );\n    this.applyOptionsToConfig(config);\n\n    const art = [\n      \"modules/fxmaster/assets/weatherEffects/effects/snow_01.png\",\n      \"modules/fxmaster/assets/weatherEffects/effects/snow_02.png\",\n    ];\n    const emitter = new PIXI.particles.Emitter(parent, art, config);\n    emitter.particleConstructor = PIXI.particles.PathParticle;\n    return emitter;\n  }\n\n  /**\n   * Configuration for the Snowstorm particle effect\n   * @type {Object}\n   */\n  static CONFIG = foundry.utils.mergeObject(\n    SpecialEffect.DEFAULT_CONFIG,\n    {\n      alpha: {\n        start: 1.0,\n        end: 1.0,\n      },\n      scale: {\n        start: 0.2,\n        end: 0.08,\n        minimumScaleMultiplier: 0.8,\n      },\n      speed: {\n        start: 400,\n        end: 350,\n        minimumSpeedMultiplier: 0.2,\n      },\n      startRotation: {\n        min: 86,\n        max: 94,\n      },\n      rotationSpeed: {\n        min: -60.0,\n        max: 60.0,\n      },\n      lifetime: {\n        min: 2.5,\n        max: 6,\n      },\n      extraData: {\n        path: \"sin(x/150)*25\",\n      },\n    },\n    { inplace: false },\n  );\n}\n","import { formatString } from \"../../utils.js\";\nimport { AbstractWeatherEffect } from \"./AbstractWeatherEffect.js\";\n\nexport class BirdsWeatherEffect extends AbstractWeatherEffect {\n  static get label() {\n    return \"Birds\";\n  }\n\n  static get icon() {\n    return \"modules/fxmaster/assets/weatherEffects/icons/crows.png\";\n  }\n\n  static get parameters() {\n    return foundry.utils.mergeObject(super.parameters, {\n      density: { min: 0.001, value: 0.006, max: 0.01, step: 0.001, decimals: 3 },\n      \"-=direction\": undefined,\n      animations: {\n        label: \"FXMASTER.Animations\",\n        type: \"multi-select\",\n        options: {\n          glide: \"FXMASTER.WeatherBirdsAnimationsGlide\",\n          flap: \"FXMASTER.WeatherBirdsAnimationsFlap\",\n          mixed: \"FXMASTER.WeatherBirdsAnimationsMixed\",\n        },\n        value: [\"mixed\"],\n      },\n    });\n  }\n\n  getParticleEmitters() {\n    return [this._getEmitter(this.parent)];\n  }\n\n  // This is where the magic happens\n  _getEmitter(parent) {\n    const d = canvas.dimensions;\n    const p = (d.width / d.size) * (d.height / d.size) * this.options.density.value;\n    const config = foundry.utils.mergeObject(\n      this.constructor.CONFIG,\n      {\n        spawnRect: {\n          x: d.sceneRect.x,\n          y: d.sceneRect.y,\n          w: d.sceneRect.width,\n          h: d.sceneRect.height,\n        },\n        maxParticles: p,\n        frequency: this.constructor.CONFIG.lifetime.min / p,\n      },\n      { inplace: false },\n    );\n    this.applyOptionsToConfig(config);\n\n    const animations = {\n      glide: [\n        { textureNumber: 2, count: 30 },\n        ...Array(4)\n          .fill([\n            { textureNumber: 1, count: 3 },\n            { textureNumber: 2, count: 2 },\n            { textureNumber: 3, count: 3 },\n            { textureNumber: 2, count: 2 },\n          ])\n          .deepFlatten(),\n        { textureNumber: 2, count: 68 },\n      ],\n      flap: [\n        { textureNumber: 1, count: 3 },\n        { textureNumber: 2, count: 2 },\n        { textureNumber: 3, count: 3 },\n        { textureNumber: 2, count: 2 },\n      ],\n      mixed: [\n        { textureNumber: 2, count: 7 },\n        { textureNumber: 1, count: 3 },\n        { textureNumber: 2, count: 2 },\n        { textureNumber: 3, count: 3 },\n        { textureNumber: 2, count: 7 },\n      ],\n    };\n\n    const getAnim = (animation, textureFormatString) => ({\n      framerate: 20,\n      loop: true,\n      textures: animation.map(({ textureNumber, count }) => ({\n        texture: formatString(textureFormatString, textureNumber),\n        count,\n      })),\n    });\n\n    const textureFormatString = \"modules/fxmaster/assets/weatherEffects/effects/seagull_{0}.png\";\n\n    // Assets are selected randomly from the list for each particle\n    const anims = (this.options.animations?.value ?? [])\n      .filter((animation) => Object.keys(animations).includes(animation))\n      .map((animation) => getAnim(animations[animation], textureFormatString));\n\n    if (anims.length === 0) {\n      anims.push(getAnim(animations.mixed, textureFormatString));\n    }\n\n    const emitter = new PIXI.particles.Emitter(parent, anims, config);\n    emitter.particleConstructor = PIXI.particles.AnimatedParticle;\n    return emitter;\n  }\n\n  /**\n   * Configuration for the Birds particle effect\n   * @type {Object}\n   */\n  static CONFIG = foundry.utils.mergeObject(\n    SpecialEffect.DEFAULT_CONFIG,\n    {\n      alpha: {\n        list: [\n          { value: 0, time: 0 },\n          { value: 1, time: 0.02 },\n          { value: 1, time: 0.98 },\n          { value: 0, time: 1 },\n        ],\n        isStepped: false,\n      },\n      scale: {\n        list: [\n          { value: 0.3, time: 0 },\n          { value: 0.7, time: 0.1 },\n          { value: 0.7, time: 0.9 },\n          { value: 0.3, time: 1 },\n        ],\n        isStepped: false,\n      },\n      speed: {\n        start: 90,\n        end: 100,\n        minimumSpeedMultiplier: 0.6,\n      },\n      startRotation: {\n        min: 0,\n        max: 360,\n      },\n      lifetime: {\n        min: 20,\n        max: 40,\n      },\n      blendMode: \"normal\",\n      emitterLifetime: -1,\n    },\n    { inplace: false },\n  );\n}\n","import { AbstractWeatherEffect } from \"./AbstractWeatherEffect.js\";\n\nexport class StarsWeatherEffect extends AbstractWeatherEffect {\n  static get label() {\n    return \"Stars\";\n  }\n\n  static get icon() {\n    return \"modules/fxmaster/assets/weatherEffects/icons/stars.png\";\n  }\n\n  static get parameters() {\n    return foundry.utils.mergeObject(super.parameters, {\n      density: { min: 0.05, value: 0.3, max: 1, step: 0.05, decimals: 2 },\n      tint: { value: { value: \"#bee8ee\" } },\n      \"-=direction\": undefined,\n    });\n  }\n\n  getParticleEmitters() {\n    return [this._getEmitter(this.parent)];\n  }\n\n  // This is where the magic happens\n  _getEmitter(parent) {\n    const d = canvas.dimensions;\n    const p = (d.width / d.size) * (d.height / d.size) * this.options.density.value;\n    const config = foundry.utils.mergeObject(\n      this.constructor.CONFIG,\n      {\n        spawnRect: {\n          x: d.sceneRect.x,\n          y: d.sceneRect.y,\n          w: d.sceneRect.width,\n          h: d.sceneRect.height,\n        },\n        maxParticles: p,\n        frequency: this.constructor.CONFIG.lifetime.min / p,\n      },\n      { inplace: false },\n    );\n    this.applyOptionsToConfig(config);\n\n    // Assets are selected randomly from the list for each particle\n    const art = [\n      \"modules/fxmaster/assets/weatherEffects/effects/star_01.png\",\n      \"modules/fxmaster/assets/weatherEffects/effects/star_02.png\",\n      \"modules/fxmaster/assets/weatherEffects/effects/star_04.png\",\n      \"modules/fxmaster/assets/weatherEffects/effects/star_05.png\",\n      \"modules/fxmaster/assets/weatherEffects/effects/star_06.png\",\n      \"modules/fxmaster/assets/weatherEffects/effects/star_07.png\",\n      \"modules/fxmaster/assets/weatherEffects/effects/star_08.png\",\n      \"modules/fxmaster/assets/weatherEffects/effects/star_09.png\",\n    ];\n    const emitter = new PIXI.particles.Emitter(parent, art, config);\n    emitter.startColor = PIXI.particles.ParticleUtils.createSteppedGradient(config.color.list, true);\n    return emitter;\n  }\n\n  /**\n   * Configuration for the Stars particle effect\n   * @type {Object}\n   */\n  static CONFIG = foundry.utils.mergeObject(\n    SpecialEffect.DEFAULT_CONFIG,\n\n    {\n      alpha: {\n        list: [\n          { value: 0, time: 0 },\n          { value: 0.9, time: 0.3 },\n          { value: 0.9, time: 0.95 },\n          { value: 0, time: 1 },\n        ],\n      },\n      scale: {\n        start: 0.05,\n        end: 0.03,\n        minimumScaleMultiplier: 0.85,\n      },\n      speed: {\n        start: 5,\n        end: 5,\n        minimumSpeedMultiplier: 0.6,\n      },\n      color: {\n        list: [\n          { value: \"bee8ee\", time: 0 },\n          { value: \"d0e8ec\", time: 1 },\n        ],\n      },\n      startRotation: {\n        min: 0,\n        max: 360,\n      },\n      rotationSpeed: {\n        min: 20,\n        max: 50,\n      },\n      lifetime: {\n        min: 8,\n        max: 15,\n      },\n      blendMode: \"screen\",\n      emitterLifetime: -1,\n    },\n    { inplace: false },\n  );\n}\n","import { AbstractWeatherEffect } from \"./AbstractWeatherEffect.js\";\n\n/**\n * A special full-screen weather effect which uses two Emitters to render drops and splashes\n * @type {SpecialEffect}\n */\nexport class RainWeatherEffect extends AbstractWeatherEffect {\n  static get label() {\n    return \"Rain\";\n  }\n\n  static get icon() {\n    return \"modules/fxmaster/assets/weatherEffects/icons/rain.png\";\n  }\n\n  /**\n   * Configuration for the particle emitter for rain\n   * @type {Object}\n   */\n  static CONFIG = foundry.utils.mergeObject(\n    SpecialEffect.DEFAULT_CONFIG,\n    {\n      alpha: {\n        start: 0.7,\n        end: 0.1,\n      },\n      scale: {\n        start: 1.0,\n        end: 1.0,\n        minimumScaleMultiplier: 0.8,\n      },\n      speed: {\n        start: 3500,\n        end: 3500,\n        minimumSpeedMultiplier: 0.8,\n      },\n      startRotation: {\n        min: 75,\n        max: 75,\n      },\n      lifetime: {\n        min: 0.5,\n        max: 0.5,\n      },\n    },\n    { inplace: false },\n  );\n\n  /**\n   * Configuration for the particle emitter for splashes\n   * @type {Object}\n   */\n  static SPLASH_CONFIG = foundry.utils.mergeObject(\n    SpecialEffect.DEFAULT_CONFIG,\n    {\n      alpha: {\n        start: 1,\n        end: 1,\n      },\n      scale: {\n        start: 0.6,\n        end: 0.6,\n        minimumScaleMultiplier: 0.8,\n      },\n      speed: {\n        start: 0,\n        end: 0,\n      },\n      startRotation: {\n        min: -90,\n        max: -90,\n      },\n      noRotation: true,\n      lifetime: {\n        min: 0.5,\n        max: 0.5,\n      },\n    },\n    { inplace: false },\n  );\n\n  /** @override */\n  getParticleEmitters() {\n    return [this._getRainEmitter(this.parent), this._getSplashEmitter(this.parent)];\n  }\n\n  _getRainEmitter(parent) {\n    const d = canvas.dimensions;\n    const p = (d.width / d.size) * (d.height / d.size) * this.options.density.value;\n    const config = foundry.utils.mergeObject(\n      this.constructor.CONFIG,\n      {\n        spawnRect: {\n          x: -0.05 * d.width,\n          y: -0.1 * d.height,\n          w: d.width,\n          h: 0.8 * d.height,\n        },\n        maxParticles: p,\n        frequency: 1 / p,\n      },\n      { inplace: false },\n    );\n    this.applyOptionsToConfig(config);\n\n    return new PIXI.particles.Emitter(parent, [\"ui/particles/rain.png\"], config);\n  }\n\n  _getSplashEmitter(parent) {\n    const d = canvas.dimensions;\n    const p = (d.width / d.size) * (d.height / d.size) * this.options.density.value;\n    const config = foundry.utils.mergeObject(\n      this.constructor.SPLASH_CONFIG,\n      {\n        spawnRect: {\n          x: 0,\n          y: 0.25 * d.height,\n          w: d.width,\n          h: 0.75 * d.height,\n        },\n        maxParticles: 0.5 * p,\n        frequency: 2 / p,\n      },\n      { inplace: false },\n    );\n    this.applyOptionsToConfig(config);\n\n    return new PIXI.particles.Emitter(parent, [\"ui/particles/drop.png\"], config);\n  }\n}\n","import { AbstractWeatherEffect } from \"./AbstractWeatherEffect.js\";\n\n/**\n * A special full-screen weather effect which uses one Emitters to render snowflakes\n * @type {SpecialEffect}\n */\nexport class SnowWeatherEffect extends AbstractWeatherEffect {\n  static get label() {\n    return \"Snow\";\n  }\n\n  static get icon() {\n    return \"modules/fxmaster/assets/weatherEffects/icons/snow.png\";\n  }\n\n  /**\n   * Configuration of the particle emitter for snowflakes\n   * @type {object}\n   */\n  static CONFIG = foundry.utils.mergeObject(\n    SpecialEffect.DEFAULT_CONFIG,\n    {\n      alpha: {\n        start: 0.9,\n        end: 0.5,\n      },\n      scale: {\n        start: 0.2,\n        end: 0.4,\n        minimumScaleMultiplier: 0.5,\n      },\n      speed: {\n        start: 190,\n        end: 210,\n        minimumSpeedMultiplier: 0.6,\n      },\n      startRotation: {\n        min: 50,\n        max: 75,\n      },\n      rotationSpeed: {\n        min: 0,\n        max: 200,\n      },\n      lifetime: {\n        min: 4,\n        max: 4,\n      },\n    },\n    { inplace: false },\n  );\n\n  getParticleEmitters() {\n    return [this._getSnowEmitter(this.parent)];\n  }\n\n  _getSnowEmitter(parent) {\n    const d = canvas.dimensions;\n    const p = (d.width / d.size) * (d.height / d.size) * this.options.density.value;\n    const config = foundry.utils.mergeObject(\n      this.constructor.CONFIG,\n      {\n        spawnRect: {\n          x: 0,\n          y: -0.1 * d.height,\n          w: d.width,\n          h: d.height,\n        },\n        maxParticles: p,\n        frequency: (this.constructor.CONFIG.lifetime.min + this.constructor.CONFIG.lifetime.max) / 2 / p,\n      },\n      { inplace: false },\n    );\n    this.applyOptionsToConfig(config);\n\n    return new PIXI.particles.Emitter(parent, [\"ui/particles/snow.png\"], config);\n  }\n}\n","import { AbstractWeatherEffect } from \"./AbstractWeatherEffect.js\";\n\n/**\n * A special full-screen weather effect which uses one Emitters to render gently falling autumn leaves\n * @extends {SpecialEffect}\n */\nexport class AutumnLeavesWeatherEffect extends AbstractWeatherEffect {\n  static get label() {\n    return \"Autumn Leaves\";\n  }\n\n  static get icon() {\n    return \"modules/fxmaster/assets/weatherEffects/icons/leaves.png\";\n  }\n\n  /** @override */\n  static get parameters() {\n    return foundry.utils.mergeObject(super.parameters, {\n      density: { min: 0.05, value: 0.25, max: 1, step: 0.05, decimals: 2 },\n      \"-=direction\": null,\n    });\n  }\n\n  /**\n   * Configuration for the falling leaves particle effect\n   * @type {Object}\n   */\n  static CONFIG = foundry.utils.mergeObject(\n    SpecialEffect.DEFAULT_CONFIG,\n    {\n      alpha: {\n        start: 0.9,\n        end: 0.5,\n      },\n      scale: {\n        start: 0.2,\n        end: 0.4,\n        minimumScaleMultiplier: 0.5,\n      },\n      speed: {\n        start: 20,\n        end: 60,\n        minimumSpeedMultiplier: 0.6,\n      },\n      startRotation: {\n        min: 0,\n        max: 365,\n      },\n      rotation: 180,\n      rotationSpeed: {\n        min: 100,\n        max: 200,\n      },\n      lifetime: {\n        min: 10,\n        max: 10,\n      },\n    },\n    { inplace: false },\n  );\n\n  getParticleEmitters() {\n    return [this._getLeafEmitter(this.parent)];\n  }\n\n  _getLeafEmitter(parent) {\n    const d = canvas.dimensions;\n    const p = (d.width / d.size) * (d.height / d.size) * this.options.density.value;\n    const config = foundry.utils.mergeObject(\n      this.constructor.CONFIG,\n      {\n        spawnRect: {\n          x: d.sceneRect.x,\n          y: d.sceneRect.y,\n          w: d.sceneRect.width,\n          h: d.sceneRect.height,\n        },\n        maxParticles: p,\n        frequency: this.constructor.CONFIG.lifetime.min / p,\n      },\n      { inplace: false },\n    );\n    this.applyOptionsToConfig(config);\n\n    const sprites = Array.fromRange(6).map((n) => `ui/particles/leaf${n + 1}.png`);\n    return new PIXI.particles.Emitter(parent, sprites, config);\n  }\n}\n","import { AbstractWeatherEffect } from \"./AbstractWeatherEffect.js\";\n\nexport class SpiderWeatherEffect extends AbstractWeatherEffect {\n  static get label() {\n    return \"Spider\";\n  }\n\n  static get icon() {\n    return \"modules/fxmaster/assets/weatherEffects/icons/spiders.png\";\n  }\n\n  static get parameters() {\n    return foundry.utils.mergeObject(super.parameters, {\n      density: { min: 0.05, value: 0.3, max: 0.7, step: 0.05, decimals: 2 },\n      \"-=direction\": undefined,\n    });\n  }\n\n  getParticleEmitters() {\n    return [this._getSpidersEmitter(this.parent)];\n  }\n\n  // This is where the magic happens\n  _getSpidersEmitter(parent) {\n    const d = canvas.dimensions;\n    const p = (d.width / d.size) * (d.height / d.size) * this.options.density.value;\n    const config = foundry.utils.mergeObject(\n      this.constructor.CONFIG,\n      {\n        spawnRect: {\n          x: d.sceneRect.x,\n          y: d.sceneRect.y,\n          w: d.sceneRect.width,\n          h: d.sceneRect.height,\n        },\n        maxParticles: p,\n        frequency: this.constructor.CONFIG.lifetime.min / p,\n      },\n      { inplace: false },\n    );\n    this.applyOptionsToConfig(config);\n\n    // Assets are selected randomly from the list for each particle\n    const anim_sheet = {\n      framerate: \"24\",\n      textures: [],\n      loop: true,\n    };\n    for (let i = 0; i < 25; i++) {\n      anim_sheet.textures.push({\n        count: 1,\n        texture: `modules/fxmaster/assets/weatherEffects/effects/Spider.${String(i).padStart(4, \"0\")}.png`,\n      });\n    }\n    const emitter = new PIXI.particles.Emitter(parent, anim_sheet, config);\n    emitter.particleConstructor = PIXI.particles.AnimatedParticle;\n\n    return emitter;\n  }\n\n  /**\n   * Configuration for the Spider particle effect\n   * @type {Object}\n   */\n  static CONFIG = foundry.utils.mergeObject(\n    SpecialEffect.DEFAULT_CONFIG,\n    {\n      alpha: {\n        list: [\n          { value: 0, time: 0 },\n          { value: 1, time: 0.02 },\n          { value: 1, time: 0.98 },\n          { value: 0, time: 1 },\n        ],\n      },\n      scale: {\n        list: [\n          { value: 0.05, time: 0 },\n          { value: 0.08, time: 0.05 },\n          { value: 0.08, time: 0.95 },\n          { value: 0.05, time: 1 },\n        ],\n        minimumScaleMultiplier: 0.2,\n      },\n      speed: {\n        start: 15,\n        end: 25,\n        minimumSpeedMultiplier: 0.6,\n      },\n      startRotation: {\n        min: 0,\n        max: 360,\n      },\n      lifetime: {\n        min: 5,\n        max: 10,\n      },\n      blendMode: \"normal\",\n      emitterLifetime: -1,\n    },\n    { inplace: false },\n  );\n}\n","import { AbstractWeatherEffect } from \"./AbstractWeatherEffect.js\";\n\nexport class EaglesWeatherEffect extends AbstractWeatherEffect {\n  /**\n   * The cached textures for this weather effect.\n   * @type {PIXI.Texture[] | undefined}\n   * @private\n   */\n  static _textureCache = undefined;\n\n  static get label() {\n    return \"Eagles\";\n  }\n\n  static get icon() {\n    return \"modules/fxmaster/assets/weatherEffects/icons/crows.png\";\n  }\n\n  static get parameters() {\n    return foundry.utils.mergeObject(super.parameters, {\n      density: { min: 0.001, value: 0.006, max: 0.01, step: 0.001, decimals: 3 },\n      \"-=direction\": undefined,\n      animations: {\n        label: \"FXMASTER.Animations\",\n        type: \"multi-select\",\n        options: {\n          flap: \"FXMASTER.WeatherBirdsAnimationsFlap\",\n          glide: \"FXMASTER.WeatherBirdsAnimationsGlide\",\n        },\n        value: [\"glide\"],\n      },\n    });\n  }\n\n  getParticleEmitters() {\n    return [this._getEmitter(this.parent)];\n  }\n\n  // This is where the magic happens\n  _getEmitter(parent) {\n    const d = canvas.dimensions;\n    const p = (d.width / d.size) * (d.height / d.size) * this.options.density.value;\n    const config = foundry.utils.mergeObject(\n      this.constructor.CONFIG,\n      {\n        spawnRect: {\n          x: d.sceneRect.x,\n          y: d.sceneRect.y,\n          w: d.sceneRect.width,\n          h: d.sceneRect.height,\n        },\n        maxParticles: p,\n        frequency: this.constructor.CONFIG.lifetime.min / p,\n      },\n      { inplace: false },\n    );\n    this.applyOptionsToConfig(config);\n\n    if (!this._textures) {\n      this._initializeTextures();\n    }\n\n    const flap = Array.fromRange(19).map((textureNumber) => ({\n      textureNumber,\n      count: 1,\n    }));\n\n    const glide = [\n      { textureNumber: 0, count: 30 },\n      ...Array(4).fill(flap).deepFlatten(),\n      { textureNumber: 0, count: 68 },\n    ];\n\n    const animations = {\n      glide,\n      flap,\n    };\n\n    const getAnim = (animation) => ({\n      framerate: 20,\n      loop: true,\n      textures: animation.map(({ textureNumber, count }) => ({\n        texture: this._textures[textureNumber],\n        count,\n      })),\n    });\n\n    // Assets are selected randomly from the list for each particle\n    const anims = (this.options.animations?.value ?? [])\n      .filter((animation) => Object.keys(animations).includes(animation))\n      .map((animation) => getAnim(animations[animation]));\n\n    if (anims.length === 0) {\n      anims.push(getAnim(animations.glide));\n    }\n\n    const emitter = new PIXI.particles.Emitter(parent, anims, config);\n    emitter.particleConstructor = PIXI.particles.AnimatedParticle;\n    return emitter;\n  }\n\n  /**\n   * Configuration for the Eagles particle effect\n   * @type {Object}\n   */\n  static CONFIG = foundry.utils.mergeObject(\n    SpecialEffect.DEFAULT_CONFIG,\n    {\n      alpha: {\n        list: [\n          { value: 0, time: 0 },\n          { value: 1, time: 0.02 },\n          { value: 1, time: 0.98 },\n          { value: 0, time: 1 },\n        ],\n        isStepped: false,\n      },\n      scale: {\n        list: [\n          { value: 0.15, time: 0 },\n          { value: 0.3, time: 0.1 },\n          { value: 0.3, time: 0.9 },\n          { value: 0.15, time: 1 },\n        ],\n        isStepped: false,\n      },\n      speed: {\n        start: 360,\n        end: 400,\n        minimumSpeedMultiplier: 0.6,\n      },\n      startRotation: {\n        min: 0,\n        max: 360,\n      },\n      lifetime: {\n        min: 7,\n        max: 14,\n      },\n      blendMode: \"normal\",\n      emitterLifetime: -1,\n    },\n    { inplace: false },\n  );\n\n  /**\n   * Get the textures for this weather effect.\n   * @private\n   * @returns {PIXI.Texture[]}\n   */\n  get _textures() {\n    if (!this.constructor._textureCache) {\n      const spriteSheetTexture = PIXI.Texture.from(\"modules/fxmaster/assets/weatherEffects/effects/eagle.png\");\n      const spriteSheetData = {\n        meta: {\n          scale: \"1\",\n        },\n        frames: {\n          \"eagle0000.png\": {\n            frame: { x: 0, y: 0, w: 512, h: 512 },\n            rotated: false,\n            trimmed: false,\n            spriteSourceSize: { x: 0, y: 0, w: 512, h: 512 },\n            sourceSize: { w: 512, h: 512 },\n          },\n          \"eagle0001.png\": {\n            frame: { x: 512, y: 0, w: 512, h: 512 },\n            rotated: false,\n            trimmed: false,\n            spriteSourceSize: { x: 0, y: 0, w: 512, h: 512 },\n            sourceSize: { w: 512, h: 512 },\n          },\n          \"eagle0002.png\": {\n            frame: { x: 0, y: 512, w: 512, h: 512 },\n            rotated: false,\n            trimmed: false,\n            spriteSourceSize: { x: 0, y: 0, w: 512, h: 512 },\n            sourceSize: { w: 512, h: 512 },\n          },\n          \"eagle0003.png\": {\n            frame: { x: 512, y: 512, w: 512, h: 512 },\n            rotated: false,\n            trimmed: false,\n            spriteSourceSize: { x: 0, y: 0, w: 512, h: 512 },\n            sourceSize: { w: 512, h: 512 },\n          },\n          \"eagle0004.png\": {\n            frame: { x: 1024, y: 0, w: 512, h: 512 },\n            rotated: false,\n            trimmed: false,\n            spriteSourceSize: { x: 0, y: 0, w: 512, h: 512 },\n            sourceSize: { w: 512, h: 512 },\n          },\n          \"eagle0005.png\": {\n            frame: { x: 1024, y: 512, w: 512, h: 512 },\n            rotated: false,\n            trimmed: false,\n            spriteSourceSize: { x: 0, y: 0, w: 512, h: 512 },\n            sourceSize: { w: 512, h: 512 },\n          },\n          \"eagle0006.png\": {\n            frame: { x: 0, y: 1024, w: 512, h: 512 },\n            rotated: false,\n            trimmed: false,\n            spriteSourceSize: { x: 0, y: 0, w: 512, h: 512 },\n            sourceSize: { w: 512, h: 512 },\n          },\n          \"eagle0007.png\": {\n            frame: { x: 512, y: 1024, w: 512, h: 512 },\n            rotated: false,\n            trimmed: false,\n            spriteSourceSize: { x: 0, y: 0, w: 512, h: 512 },\n            sourceSize: { w: 512, h: 512 },\n          },\n          \"eagle0008.png\": {\n            frame: { x: 1024, y: 1024, w: 512, h: 512 },\n            rotated: false,\n            trimmed: false,\n            spriteSourceSize: { x: 0, y: 0, w: 512, h: 512 },\n            sourceSize: { w: 512, h: 512 },\n          },\n          \"eagle0009.png\": {\n            frame: { x: 1536, y: 0, w: 512, h: 512 },\n            rotated: false,\n            trimmed: false,\n            spriteSourceSize: { x: 0, y: 0, w: 512, h: 512 },\n            sourceSize: { w: 512, h: 512 },\n          },\n          \"eagle0010.png\": {\n            frame: { x: 1536, y: 512, w: 512, h: 512 },\n            rotated: false,\n            trimmed: false,\n            spriteSourceSize: { x: 0, y: 0, w: 512, h: 512 },\n            sourceSize: { w: 512, h: 512 },\n          },\n          \"eagle0011.png\": {\n            frame: { x: 1536, y: 1024, w: 512, h: 512 },\n            rotated: false,\n            trimmed: false,\n            spriteSourceSize: { x: 0, y: 0, w: 512, h: 512 },\n            sourceSize: { w: 512, h: 512 },\n          },\n          \"eagle0012.png\": {\n            frame: { x: 0, y: 1536, w: 512, h: 512 },\n            rotated: false,\n            trimmed: false,\n            spriteSourceSize: { x: 0, y: 0, w: 512, h: 512 },\n            sourceSize: { w: 512, h: 512 },\n          },\n          \"eagle0013.png\": {\n            frame: { x: 512, y: 1536, w: 512, h: 512 },\n            rotated: false,\n            trimmed: false,\n            spriteSourceSize: { x: 0, y: 0, w: 512, h: 512 },\n            sourceSize: { w: 512, h: 512 },\n          },\n          \"eagle0014.png\": {\n            frame: { x: 1024, y: 1536, w: 512, h: 512 },\n            rotated: false,\n            trimmed: false,\n            spriteSourceSize: { x: 0, y: 0, w: 512, h: 512 },\n            sourceSize: { w: 512, h: 512 },\n          },\n          \"eagle0015.png\": {\n            frame: { x: 1536, y: 1536, w: 512, h: 512 },\n            rotated: false,\n            trimmed: false,\n            spriteSourceSize: { x: 0, y: 0, w: 512, h: 512 },\n            sourceSize: { w: 512, h: 512 },\n          },\n          \"eagle0016.png\": {\n            frame: { x: 2048, y: 0, w: 512, h: 512 },\n            rotated: false,\n            trimmed: false,\n            spriteSourceSize: { x: 0, y: 0, w: 512, h: 512 },\n            sourceSize: { w: 512, h: 512 },\n          },\n          \"eagle0017.png\": {\n            frame: { x: 2048, y: 512, w: 512, h: 512 },\n            rotated: false,\n            trimmed: false,\n            spriteSourceSize: { x: 0, y: 0, w: 512, h: 512 },\n            sourceSize: { w: 512, h: 512 },\n          },\n          \"eagle0018.png\": {\n            frame: { x: 2048, y: 1024, w: 512, h: 512 },\n            rotated: false,\n            trimmed: false,\n            spriteSourceSize: { x: 0, y: 0, w: 512, h: 512 },\n            sourceSize: { w: 512, h: 512 },\n          },\n          \"eagle0019.png\": {\n            frame: { x: 2048, y: 1536, w: 512, h: 512 },\n            rotated: false,\n            trimmed: false,\n            spriteSourceSize: { x: 0, y: 0, w: 512, h: 512 },\n            sourceSize: { w: 512, h: 512 },\n          },\n        },\n      };\n      const spriteSheet = new PIXI.Spritesheet(spriteSheetTexture, spriteSheetData);\n      spriteSheet.parse((textures) => {\n        this.constructor._textureCache = Object.values(textures);\n      }); // This is known to complete synchronously because there are only 20 textures and PIXI only starts batching when there are more than 1000.\n    }\n    return this.constructor._textureCache;\n  }\n}\n","import { BubblesWeatherEffect } from \"./effects/BubblesWeatherEffect.js\";\nimport { CloudsWeatherEffect } from \"./effects/CloudsWeatherEffect.js\";\nimport { EmbersWeatherEffect } from \"./effects/EmbersWeatherEffect.js\";\nimport { CrowsWeatherEffect } from \"./effects/CrowsWeatherEffect.js\";\nimport { BatsWeatherEffect } from \"./effects/BatsWeatherEffect.js\";\nimport { FogWeatherEffect } from \"./effects/FogWeatherEffect.js\";\nimport { RaintopWeatherEffect } from \"./effects/RaintopWeatherEffect.js\";\nimport { RainSimpleWeatherEffect } from \"./effects/RainSimpleWeatherEffect.js\";\nimport { SnowstormWeatherEffect } from \"./effects/SnowstormWeatherEffect.js\";\nimport { BirdsWeatherEffect } from \"./effects/BirdsWeatherEffect.js\";\nimport { StarsWeatherEffect } from \"./effects/StarsWeatherEffect.js\";\nimport { RainWeatherEffect } from \"./effects/RainWeatherEffect.js\";\nimport { SnowWeatherEffect } from \"./effects/SnowWeatherEffect.js\";\nimport { AutumnLeavesWeatherEffect } from \"./effects/AutumnLeavesWeatherEffect.js\";\nimport { SpiderWeatherEffect } from \"./effects/SpiderWeatherEffect.js\";\nimport { EaglesWeatherEffect } from \"./effects/EaglesWeatherEffect.js\";\n\nexport const weatherDB = {\n  snowstorm: SnowstormWeatherEffect,\n  bubbles: BubblesWeatherEffect,\n  clouds: CloudsWeatherEffect,\n  embers: EmbersWeatherEffect,\n  rainsimple: RainSimpleWeatherEffect,\n  stars: StarsWeatherEffect,\n  crows: CrowsWeatherEffect,\n  bats: BatsWeatherEffect,\n  spiders: SpiderWeatherEffect,\n  fog: FogWeatherEffect,\n  raintop: RaintopWeatherEffect,\n  birds: BirdsWeatherEffect,\n  leaves: AutumnLeavesWeatherEffect,\n  rain: RainWeatherEffect,\n  snow: SnowWeatherEffect,\n  eagles: EaglesWeatherEffect,\n};\n","import { packageId } from \"../../constants.js\";\n\nexport class FXColorFilter extends PIXI.filters.AdjustmentFilter {\n  constructor(options, id) {\n    super();\n    this.id = id;\n\n    this.enabled = false;\n    this.skipFading = false;\n    this.configure(options);\n  }\n\n  static get label() {\n    return \"Color\";\n  }\n\n  static get faIcon() {\n    return \"fas fa-palette\";\n  }\n\n  static get parameters() {\n    return {\n      color: {\n        label: \"FXMASTER.Tint\",\n        type: \"color\",\n        value: {\n          value: \"#FFFFFF\",\n          apply: false,\n        },\n      },\n      saturation: {\n        label: \"FXMASTER.Saturation\",\n        type: \"range\",\n        max: 2.0,\n        min: 0.0,\n        step: 0.1,\n        value: 1.0,\n      },\n      contrast: {\n        label: \"FXMASTER.Contrast\",\n        type: \"range\",\n        max: 2.0,\n        min: 0.0,\n        step: 0.1,\n        value: 1.0,\n      },\n      brightness: {\n        label: \"FXMASTER.Brightness\",\n        type: \"range\",\n        max: 2.0,\n        min: 0.0,\n        step: 0.1,\n        value: 1.0,\n      },\n      gamma: {\n        label: \"FXMASTER.Gamma\",\n        type: \"range\",\n        max: 2.0,\n        min: 0.0,\n        step: 0.1,\n        value: 1.0,\n      },\n    };\n  }\n\n  static get zeros() {\n    return {\n      red: 1,\n      green: 1,\n      blue: 1,\n      saturation: 1,\n      gamma: 1,\n      brightness: 1,\n      contrast: 1,\n    };\n  }\n\n  static get default() {\n    return Object.fromEntries(\n      Object.entries(this.parameters).map(([parameterName, parameterConfig]) => [parameterName, parameterConfig.value]),\n    );\n  }\n\n  configure(opts) {\n    if (opts.color.apply) {\n      const colors = foundry.utils.hexToRGB(colorStringToHex(opts.color.value));\n      opts.red = colors[0];\n      opts.green = colors[1];\n      opts.blue = colors[2];\n    } else {\n      opts.red = opts.green = opts.blue = 1;\n    }\n    this.options = { ...this.constructor.default, ...opts };\n  }\n\n  applyOptions(opts = this.options) {\n    if (!opts) return;\n    const keys = Object.keys(opts);\n    for (const key of keys) {\n      this[key] = opts[key];\n    }\n  }\n\n  animateOptions(values = this.options) {\n    const data = {\n      name: `${packageId}.${this.constructor.name}.${this.id}`,\n      duration: 4000,\n    };\n    const anim = Object.keys(values).reduce((arr, key) => {\n      arr.push({\n        parent: this,\n        attribute: key,\n        to: values[key],\n      });\n      return arr;\n    }, []);\n    return CanvasAnimation.animateLinear(anim, data);\n  }\n\n  step() {}\n\n  play() {\n    this.enabled = true;\n    if (this.skipFading) {\n      this.skipFading = false;\n      this.applyOptions();\n      return;\n    }\n    return this.animateOptions();\n  }\n\n  // So we can destroy object afterwards\n  stop() {\n    return new Promise((resolve) => {\n      if (this.skipFading) {\n        this.skipFading = false;\n        this.enabled = false;\n        this.applyOptions(this.constructor.zeros);\n        resolve();\n        return;\n      }\n      this.animateOptions(this.constructor.zeros).finally(() => {\n        this.enabled = false;\n        resolve();\n      });\n    });\n  }\n}\n","export class FXUnderwaterFilter extends PIXI.filters.DisplacementFilter {\n  constructor(options, id) {\n    let dizzyMap = new PIXI.Sprite.from(\"modules/fxmaster/assets/filterEffects/clouds.png\");\n    super(dizzyMap);\n    this.id = id;\n\n    this.dizzyMap = dizzyMap;\n\n    this.speedConfig = {};\n    this.configure(options);\n\n    this.dizzyMap.texture.baseTexture.wrapMode = PIXI.WRAP_MODES.REPEAT;\n    this.dizzyMap.anchor.set(0.5);\n    this.dizzyMap.x = canvas.scene.data.width / 2;\n    this.dizzyMap.y = canvas.scene.data.height / 2;\n    this.dizzyMap.scale.x = 4;\n    this.dizzyMap.scale.y = 4;\n\n    this.enabled = false;\n  }\n\n  static get label() {\n    return \"Underwater\";\n  }\n\n  static get faIcon() {\n    return \"fas fa-water\";\n  }\n\n  static get parameters() {\n    return {\n      speed: {\n        label: \"FXMASTER.Speed\",\n        type: \"range\",\n        max: 5.0,\n        min: 0.0,\n        step: 0.1,\n        value: 0.3,\n      },\n      scale: {\n        label: \"FXMASTER.Scale\",\n        type: \"number\",\n        value: 4.0,\n      },\n    };\n  }\n\n  static get zeros() {\n    return {\n      speed: 0,\n      scale: 1.0,\n    };\n  }\n\n  step() {\n    this.maskSprite.x += this.speedConfig.speed;\n  }\n\n  play() {\n    canvas.background.addChild(this.dizzyMap);\n    this.enabled = true;\n    this.dizzyMap.scale.x = this.speedConfig.scale;\n    this.dizzyMap.scale.y = this.speedConfig.scale;\n  }\n\n  static get default() {\n    return Object.fromEntries(\n      Object.entries(this.parameters).map(([parameterName, parameterConfig]) => [parameterName, parameterConfig.value]),\n    );\n  }\n\n  configure(opts) {\n    this.speedConfig = { ...this.constructor.defaults, ...opts };\n  }\n\n  applyOptions() {\n    if (!this.options) return;\n    const keys = Object.keys(this.options);\n    for (const key of keys) {\n      this[key] = this.options[key];\n    }\n  }\n\n  // So we can destroy object afterwards\n  stop() {\n    return new Promise((resolve) => {\n      canvas.background.removeChild(this.dizzyMap);\n      this.enabled = false;\n      resolve();\n    });\n  }\n}\n","export class FXCanvasAnimation extends CanvasAnimation {\n  static async animateSmooth(attributes, { context, name = null, duration = 1000, ontick, ease } = {}) {\n    // Prepare attributes\n    attributes = attributes\n      .map((a) => {\n        a.delta = a.to - a.parent[a.attribute];\n        a.done = 0;\n        a.remaining = duration;\n        return a;\n      })\n      .filter((a) => a.delta !== 0);\n\n    // Register the request function and context\n    context = context ?? canvas.stage;\n\n    // Dispatch the animation request and return as a Promise\n    return this._animatePromise(this._animateFrameSmooth(ease), context, name, attributes, duration, ontick);\n  }\n\n  static _animateFrameSmooth(ease) {\n    return function (deltaTime, resolve, reject, attributes, duration, ontick) {\n      let complete = attributes.length === 0;\n      let dt = (duration * PIXI.settings.TARGET_FPMS) / deltaTime;\n\n      // Update each attribute\n      try {\n        for (let a of attributes) {\n          let da = a.delta / dt;\n          a.d = da;\n          if (a.remaining < Math.abs(da) * 1.25) {\n            a.parent[a.attribute] = a.to;\n            a.done = a.delta;\n            a.remaining = 0;\n            complete = true;\n          } else {\n            let progress = a.done / a.delta;\n            let start = a.to - a.delta;\n            a.done += da;\n            a.remaining = Math.abs(a.delta) - Math.abs(a.done);\n            a.parent[a.attribute] = ease(progress) * a.delta + start;\n          }\n        }\n        if (ontick) ontick(dt, attributes);\n      } catch (err) {\n        reject(err);\n      }\n\n      // Resolve the original promise once the animation is complete\n      if (complete) resolve();\n    };\n  }\n}\n","export const easeFunctions = {\n  Linear: easeLinear,\n  InSine: easeInSine,\n  OutSine: easeOutSine,\n  InOutSine: easeInOutSine,\n  InBack: easeInBack,\n  OutBack: easeOutBack,\n  InOutBack: easeInOutBack,\n  InCubic: easeInCubic,\n  OutCubic: easeOutCubic,\n  InOutCubic: easeInOutCubic,\n  InCirc: easeInCirc,\n  OutCirc: easeOutCirc,\n  InOutCirc: easeInOutCirc,\n};\n\nexport function easeLinear(x) {\n  return x;\n}\n\nexport function easeInSine(x) {\n  return 1 - Math.cos((x * Math.PI) / 2);\n}\n\nexport function easeOutSine(x) {\n  return Math.sin((x * Math.PI) / 2);\n}\n\nexport function easeInOutSine(x) {\n  return -(Math.cos(Math.PI * x) - 1) / 2;\n}\n\nexport function easeInBack(x) {\n  const c1 = 1.70158;\n  const c3 = c1 + 1;\n  return c3 * x * x * x - c1 * x * x;\n}\n\nexport function easeOutBack(x) {\n  const c1 = 1.70158;\n  const c3 = c1 + 1;\n  return 1 + c3 * Math.pow(x - 1, 3) + c1 * Math.pow(x - 1, 2);\n}\n\nexport function easeInOutBack(x) {\n  const c1 = 1.70158;\n  const c2 = c1 * 1.525;\n  return x < 0.5\n    ? (Math.pow(2 * x, 2) * ((c2 + 1) * 2 * x - c2)) / 2\n    : (Math.pow(2 * x - 2, 2) * ((c2 + 1) * (x * 2 - 2) + c2) + 2) / 2;\n}\n\nexport function easeInCubic(x) {\n  return x * x * x;\n}\n\nexport function easeOutCubic(x) {\n  return 1 - Math.pow(1 - x, 3);\n}\n\nexport function easeInOutCubic(x) {\n  return x < 0.5 ? 4 * x * x * x : 1 - Math.pow(-2 * x + 2, 3) / 2;\n}\n\nexport function easeInCirc(x) {\n  return 1 - Math.sqrt(1 - Math.pow(x, 2));\n}\n\nexport function easeOutCirc(x) {\n  return Math.sqrt(1 - Math.pow(x - 1, 2));\n}\n\nexport function easeInOutCirc(x) {\n  return x < 0.5 ? (1 - Math.sqrt(1 - Math.pow(2 * x, 2))) / 2 : (Math.sqrt(1 - Math.pow(-2 * x + 2, 2)) + 1) / 2;\n}\n","import { FXCanvasAnimation } from \"../../canvasanimation.js\";\nimport { packageId } from \"../../constants.js\";\nimport { easeFunctions } from \"../../ease.js\";\n\nexport class FXLightningFilter extends PIXI.filters.AdjustmentFilter {\n  constructor(options, id) {\n    super();\n    this.id = id;\n\n    this.enabled = false;\n    this.configure(options);\n\n    this.next = canvas.app.ticker.lastTime / 10;\n  }\n\n  static get label() {\n    return \"Lightning\";\n  }\n\n  static get faIcon() {\n    return \"fas fa-bolt\";\n  }\n\n  static get parameters() {\n    return {\n      frequency: {\n        label: \"FXMASTER.Period\",\n        type: \"range\",\n        max: 2000,\n        min: 100,\n        step: 5,\n        value: 500,\n      },\n      spark_duration: {\n        label: \"FXMASTER.Duration\",\n        type: \"range\",\n        max: 2000,\n        min: 100,\n        step: 5,\n        value: 300,\n      },\n      brightness: {\n        label: \"FXMASTER.Brightness\",\n        type: \"range\",\n        max: 4.0,\n        min: 0.0,\n        step: 0.1,\n        value: 1.3,\n      },\n    };\n  }\n\n  static get zeros() {\n    return {\n      frequency: 0.0,\n      spark_duration: 0.0,\n      brightness: 1.0,\n    };\n  }\n\n  play() {\n    this.enabled = true;\n  }\n\n  step() {\n    if (canvas.app.ticker.lastTime / 10 > this.next) {\n      this.next = canvas.app.ticker.lastTime / 10 + 40 + this.options.frequency * Math.random();\n\n      const animate = (target) => {\n        const attributes = [\n          {\n            parent: this,\n            attribute: \"brightness\",\n            to: target,\n          },\n        ];\n        return FXCanvasAnimation.animateSmooth(attributes, {\n          name: `${packageId}.${this.constructor.name}.${this.id}.${randomID()}`,\n          context: this,\n          duration: 100 + this.options.spark_duration * Math.random(),\n          ease: easeFunctions.InOutBack,\n        });\n      };\n\n      animate(this.options.brightness).then(() => {\n        animate(1.0);\n      });\n    }\n  }\n\n  static get default() {\n    return Object.fromEntries(\n      Object.entries(this.parameters).map(([parameterName, parameterConfig]) => [parameterName, parameterConfig.value]),\n    );\n  }\n  configure(opts) {\n    const merged = { ...this.constructor.default, ...opts };\n    this.options = merged;\n  }\n\n  applyOptions(opts = this.options) {\n    if (!opts) return;\n    const keys = Object.keys(opts);\n    for (const key of keys) {\n      this[key] = opts[key];\n    }\n  }\n\n  // So we can destroy object afterwards\n  stop() {\n    return new Promise((resolve) => {\n      this.enabled = false;\n      resolve();\n    });\n  }\n}\n","export class FXPredatorFilter extends PIXI.filters.CRTFilter {\n  constructor(options, id) {\n    super();\n    this.id = id;\n\n    this.enabled = false;\n    this.vignetting = 0;\n    this.curvature = 0;\n\n    this.configure(options);\n  }\n\n  static get label() {\n    return \"Predator\";\n  }\n\n  static get faIcon() {\n    return \"fas fa-wave-square\";\n  }\n\n  static get parameters() {\n    return {\n      noise: {\n        label: \"FXMASTER.Noise\",\n        type: \"range\",\n        max: 1.0,\n        min: 0.0,\n        step: 0.1,\n        value: 0.1,\n      },\n      period: {\n        label: \"FXMASTER.Speed\",\n        type: \"range\",\n        max: 0.5,\n        min: 0.0,\n        step: 0.01,\n        value: 0.02,\n      },\n    };\n  }\n\n  static get zeros() {\n    return {\n      noise: 0,\n      period: 1000,\n    };\n  }\n\n  play() {\n    this.enabled = true;\n    this.seed = Math.random();\n    this.applyOptions();\n  }\n\n  step() {\n    this.seed += 1;\n    const frequency = 1.0 / this.options.period;\n    this.time = canvas.app.ticker.lastTime / frequency;\n  }\n\n  static get default() {\n    return Object.fromEntries(\n      Object.entries(this.parameters).map(([parameterName, parameterConfig]) => [parameterName, parameterConfig.value]),\n    );\n  }\n\n  configure(opts) {\n    this.options = { ...this.constructor.default, ...opts };\n  }\n\n  applyOptions() {\n    if (!this.options) return;\n    const keys = Object.keys(this.options);\n    for (const key of keys) {\n      this[key] = this.options[key];\n    }\n  }\n\n  // So we can destroy object afterwards\n  stop() {\n    return new Promise((resolve) => {\n      this.enabled = false;\n      this.applyOptions(this.constructor.zeros);\n      resolve();\n    });\n  }\n}\n","export class FXOldFilmFilter extends PIXI.filters.OldFilmFilter {\n  constructor(options, id) {\n    super();\n    this.id = id;\n\n    this.enabled = false;\n    this.skipFading = false;\n\n    this.vignetting = 0;\n    this.vignettingAlpha = 0;\n\n    this.configure(options);\n  }\n\n  static get label() {\n    return \"Old Film\";\n  }\n\n  static get faIcon() {\n    return \"fas fa-film\";\n  }\n\n  static get parameters() {\n    return {\n      sepia: {\n        label: \"FXMASTER.Sepia\",\n        type: \"range\",\n        max: 1.0,\n        min: 0.0,\n        step: 0.1,\n        value: 0.3,\n      },\n      noise: {\n        label: \"FXMASTER.Noise\",\n        type: \"range\",\n        max: 1.0,\n        min: 0.0,\n        step: 0.1,\n        value: 0.1,\n      },\n    };\n  }\n\n  static get zeros() {\n    return {\n      sepia: 0.0,\n      noise: 0.0,\n    };\n  }\n\n  play() {\n    this.enabled = true;\n    this.seed = Math.random();\n    this.applyOptions();\n  }\n\n  step() {\n    this.seed++;\n  }\n\n  static get default() {\n    return Object.fromEntries(\n      Object.entries(this.parameters).map(([parameterName, parameterConfig]) => [parameterName, parameterConfig.value]),\n    );\n  }\n\n  configure(opts) {\n    this.options = { ...this.constructor.default, ...opts };\n  }\n\n  applyOptions() {\n    if (!this.options) return;\n    const keys = Object.keys(this.options);\n    for (const key of keys) {\n      this[key] = this.options[key];\n    }\n  }\n\n  // So we can destroy object afterwards\n  stop() {\n    return new Promise((resolve) => {\n      this.enabled = false;\n      this.applyOptions(this.constructor.zeros);\n      resolve();\n    });\n  }\n}\n","import { packageId } from \"../../constants.js\";\n\nexport class FXBloomFilter extends PIXI.filters.AdvancedBloomFilter {\n  constructor(options, id) {\n    super();\n    this.id = id;\n\n    this.enabled = false;\n    this.skipFading = false;\n    this.configure(options);\n  }\n\n  static get label() {\n    return \"Bloom\";\n  }\n\n  static get faIcon() {\n    return \"fas fa-ghost\";\n  }\n\n  static get parameters() {\n    return {\n      blur: {\n        label: \"FXMASTER.Blur\",\n        type: \"range\",\n        max: 10.0,\n        min: 0.0,\n        step: 1.0,\n        value: 1.0,\n      },\n      bloomScale: {\n        label: \"FXMASTER.Bloom\",\n        type: \"range\",\n        max: 1.0,\n        min: 0.0,\n        step: 0.1,\n        value: 0.1,\n      },\n      threshold: {\n        label: \"FXMASTER.Threshold\",\n        type: \"range\",\n        max: 1.0,\n        min: 0.0,\n        step: 0.1,\n        value: 0.5,\n      },\n    };\n  }\n\n  static get zeros() {\n    return {\n      noise: 0.0,\n      bloomScale: 0.0,\n      threshold: 1.0,\n    };\n  }\n\n  static get default() {\n    return Object.fromEntries(\n      Object.entries(this.parameters).map(([parameterName, parameterConfig]) => [parameterName, parameterConfig.value]),\n    );\n  }\n\n  play() {\n    this.enabled = true;\n    if (this.skipFading) {\n      this.skipFading = false;\n      this.applyOptions();\n      return;\n    }\n    return this.animateOptions();\n  }\n\n  step() {}\n\n  configure(opts) {\n    this.options = { ...this.constructor.default, ...opts };\n  }\n\n  applyOptions(opts = this.options) {\n    if (!opts) return;\n    const keys = Object.keys(opts);\n    for (const key of keys) {\n      this[key] = opts[key];\n    }\n  }\n\n  animateOptions(values = this.options) {\n    const data = {\n      name: `${packageId}.${this.constructor.name}.${this.id}`,\n      duration: 4000,\n    };\n    const anim = Object.keys(values).reduce((arr, key) => {\n      arr.push({\n        parent: this,\n        attribute: key,\n        to: values[key],\n      });\n      return arr;\n    }, []);\n    return CanvasAnimation.animateLinear(anim, data);\n  }\n\n  // So we can destroy object afterwards\n  async stop() {\n    await CanvasAnimation.terminateAnimation(`${packageId}.${this.constructor.name}.${this.id}`);\n    if (this.skipFading) {\n      this.skipFading = false;\n      this.enabled = false;\n      this.applyOptions(this.constructor.zeros);\n      return;\n    }\n    this.animateOptions(this.constructor.zeros).finally(() => {\n      this.enabled = false;\n    });\n  }\n}\n","import { FXColorFilter } from \"./filters/FXColorFilter.js\";\nimport { FXUnderwaterFilter } from \"./filters/FXUnderwaterFilter.js\";\nimport { FXLightningFilter } from \"./filters/FXLightningFilter.js\";\nimport { FXPredatorFilter } from \"./filters/FXPredatorFilter.js\";\nimport { FXOldFilmFilter } from \"./filters/FXOldFilmFilter.js\";\nimport { FXBloomFilter } from \"./filters/FXBloomFilter.js\";\n// import {FXFogFilter} from \"./filters/FXFogFilter.js\"\n\nexport const filtersDB = {\n  lightning: FXLightningFilter,\n  underwater: FXUnderwaterFilter,\n  predator: FXPredatorFilter,\n  color: FXColorFilter,\n  bloom: FXBloomFilter,\n  oldfilm: FXOldFilmFilter,\n  // fog: FXFogFilter\n};\n","import { weatherDB } from \"./weatherEffects/weatherDB.js\";\nimport { filtersDB } from \"./filterEffects/filtersDB.js\";\nimport { specialsDB } from \"./specialEffects/specialsDB.js\";\n\nexport const FXMASTER = {\n  weatherEffects: weatherDB,\n  filters: filtersDB,\n  specials: specialsDB,\n};\n","export const specialsDB = {\n  fxmaster: {\n    label: \"FXMaster\",\n    effects: [\n      {\n        label: \"Smoke Bomb\",\n        file: \"modules/fxmaster/assets/specialEffects/fxmaster/smokeBomb.webm\",\n        scale: {\n          x: 1.0,\n          y: 1.0,\n        },\n        angle: 0,\n        anchor: {\n          x: 0.5,\n          y: 0.5,\n        },\n        speed: 0,\n        author: \"U~man\",\n      },\n      {\n        label: \"Fireball\",\n        file: \"modules/fxmaster/assets/specialEffects/fxmaster/fireball.webm\",\n        scale: {\n          x: 1.0,\n          y: 1.0,\n        },\n        angle: 0,\n        anchor: {\n          x: 0.5,\n          y: 0.5,\n        },\n        author: \"U~man\",\n      },\n      {\n        label: \"Blood Splatter\",\n        file: \"modules/fxmaster/assets/specialEffects/fxmaster/blood.webm\",\n        scale: {\n          x: 0.7,\n          y: 0.7,\n        },\n        angle: 0,\n        anchor: {\n          x: 0.5,\n          y: 0.5,\n        },\n        author: \"U~man\",\n      },\n      {\n        label: \"Red Fire Cone\",\n        file: \"modules/fxmaster/assets/specialEffects/jinker/dragonBornGold-RedFire15Cone.webm\",\n        scale: {\n          x: 1.0,\n          y: 1.0,\n        },\n        angle: 0,\n        anchor: {\n          x: 0,\n          y: 0.5,\n        },\n        author: \"Jinker\",\n      },\n      {\n        label: \"Acid Line\",\n        file: \"modules/fxmaster/assets/specialEffects/jinker/dragonBornBlack-CopperAcid30x5Line.webm\",\n        scale: {\n          x: 1.0,\n          y: 1.0,\n        },\n        angle: 0,\n        anchor: {\n          x: 0,\n          y: 0.5,\n        },\n        author: \"Jinker\",\n      },\n      {\n        label: \"Witch Bolt\",\n        file: \"modules/fxmaster/assets/specialEffects/jb2a/Witch_Bolt_Blue_600x200.webm\",\n        scale: {\n          x: 0.7,\n          y: 0.7,\n        },\n        angle: 0,\n        anchor: {\n          x: 0,\n          y: 0.5,\n        },\n        author: \"JB2A\",\n      },\n    ],\n  },\n};\n","import { packageId } from \"../constants.js\";\nimport { logger } from \"../logger.js\";\nimport { executeWhenWorldIsMigratedToLatest, isOnTargetMigration } from \"../migration.js\";\nimport { intersectRectangles } from \"../pixi-helpers.js\";\n\n// holes are broken in @pixi/smooth-graphics@0.0.17 (see https://github.com/pixijs/graphics-smooth/pull/7), so we need to use the legacy graphics in V9 and above.\nconst Graphics = PIXI.LegacyGraphics ?? PIXI.Graphics;\n\nexport class WeatherLayer extends CanvasLayer {\n  /**\n   * The weather overlay container\n   * @type {PIXI.Container | undefined}\n   */\n  weather = undefined;\n\n  /**\n   * The currently active weather effects.\n   * @type {Record<string, {type: string, fx: import('./effects/AbstractWeatherEffect.js').AbstractWeatherEffect}>}\n   */\n  weatherEffects = {};\n\n  /**\n   * The scene mask.\n   * @type {CachedContainer | undefined}\n   * @private\n   */\n  _sceneMask = undefined;\n\n  /**\n   * The filter used to apply the scene mask.\n   * @type {InverseOcclusionMaskFilter | undefined}\n   * @private\n   */\n  _sceneMaskFilter = undefined;\n\n  static get layerOptions() {\n    return foundry.utils.mergeObject(super.layerOptions, {\n      name: \"weather\",\n      zIndex: 250,\n    });\n  }\n\n  /**\n   * Whether or not the weather effects should be masked to the scene.\n   * @type {boolean}\n   */\n  get shouldMaskToScene() {\n    return !!canvas.scene?.img;\n  }\n\n  _createInvertedMask() {\n    const mask = new Graphics();\n    canvas.drawings.placeables.forEach((drawing) => {\n      const isMask = drawing.document.getFlag(packageId, \"masking\");\n      if (!isMask) return;\n      mask.beginFill(0x000000);\n      const shape = drawing.shape.geometry.graphicsData[0].shape.clone();\n      switch (drawing.data.type) {\n        case CONST.DRAWING_TYPES.ELLIPSE: {\n          shape.x = drawing.center.x;\n          shape.y = drawing.center.y;\n          mask.drawShape(shape);\n          break;\n        }\n        case CONST.DRAWING_TYPES.POLYGON:\n        case CONST.DRAWING_TYPES.FREEHAND: {\n          const points = drawing.data.points.reduce((acc, v) => {\n            acc.push(v[0] + drawing.x, v[1] + drawing.y);\n            return acc;\n          }, []);\n          mask.drawPolygon(points);\n          break;\n        }\n        default: {\n          shape.x = drawing.x;\n          shape.y = drawing.y;\n          mask.drawShape(shape);\n        }\n      }\n      mask.endFill();\n    });\n    return mask;\n  }\n\n  _createMask() {\n    const mask = new Graphics();\n    mask.beginFill(0x000000).drawShape(canvas.dimensions.rect).endFill();\n\n    canvas.drawings.placeables.forEach((drawing) => {\n      const isMask = drawing.document.getFlag(packageId, \"masking\");\n      if (!isMask) return;\n      mask.beginHole();\n      const shape = drawing.shape.geometry.graphicsData[0].shape.clone();\n      switch (drawing.data.type) {\n        case CONST.DRAWING_TYPES.ELLIPSE: {\n          shape.x = drawing.center.x;\n          shape.y = drawing.center.y;\n          mask.drawShape(shape);\n          break;\n        }\n        case CONST.DRAWING_TYPES.POLYGON:\n        case CONST.DRAWING_TYPES.FREEHAND: {\n          const points = drawing.data.points.reduce((acc, v) => {\n            acc.push(v[0] + drawing.x, v[1] + drawing.y);\n            return acc;\n          }, []);\n          mask.drawPolygon(points);\n          break;\n        }\n        default: {\n          shape.x = drawing.x;\n          shape.y = drawing.y;\n          mask.drawShape(shape);\n        }\n      }\n      mask.endHole();\n    });\n    return mask;\n  }\n\n  updateMask() {\n    if (!this.weather || !canvas.scene) return;\n\n    if (this.weather.mask) {\n      this.weather.removeChild(this.weather.mask);\n      this.weather.mask.destroy();\n      this.weather.mask = null;\n    }\n    const invert = canvas.scene.getFlag(packageId, \"invert\");\n\n    // Mask zones masked by drawings\n    const mask = invert ? this._createInvertedMask() : this._createMask();\n    this.weather.addChild(mask);\n\n    Hooks.callAll(\"updateMask\", this, this.weather, mask);\n    this.weather.mask = mask;\n  }\n\n  /** @override */\n  async tearDown() {\n    Object.values(this.weatherEffects).forEach(({ fx }) => fx.stop());\n\n    this.weather = undefined;\n    this.mask = null;\n    this.weatherEffects = {};\n    this._sceneMask?.destroy();\n    this._sceneMask = undefined;\n    this._sceneMaskFilter = undefined;\n\n    return super.tearDown();\n  }\n\n  /** @override */\n  async draw() {\n    if (!game.settings.get(packageId, \"enable\") || game.settings.get(packageId, \"disableAll\")) {\n      return;\n    }\n    if (isOnTargetMigration()) {\n      await this._draw();\n    } else {\n      // If migrations need to be performed, defer drawing to when they are done.\n      executeWhenWorldIsMigratedToLatest(this._draw.bind(this));\n    }\n\n    return this;\n  }\n\n  /**\n   * Actual implementation of drawing the layer.\n   * @private\n   */\n  async _draw() {\n    if (this.shouldMaskToScene) {\n      this._sceneMask = this._drawSceneMask();\n      this.addChild(this._sceneMask);\n      this._sceneMaskFilter = this._createSceneMaskFilter();\n    }\n\n    await this.drawWeather();\n    this.updateMask();\n  }\n\n  async drawWeather({ soft = false } = {}) {\n    if (!canvas.scene) {\n      return;\n    }\n    if (!this.weather) {\n      this.weather = this.addChild(new PIXI.Container());\n      if (this._sceneMaskFilter) {\n        this.weather.filters = [this._sceneMaskFilter];\n      }\n    }\n    Hooks.callAll(\"drawWeather\", this, this.weather, this.weatherEffects);\n\n    const stopPromise = Promise.all(\n      Object.entries(this.weatherEffects).map(async ([id, effect]) => {\n        if (soft) {\n          await effect.fx.fadeOut({ timeout: 20000 });\n        } else {\n          effect.fx.stop();\n        }\n        // The check is needed because a new effect might have been set already.\n        if (this.weatherEffects[id] === effect) {\n          delete this.weatherEffects[id];\n        }\n      }),\n    );\n\n    // Updating scene weather\n    const flags = canvas.scene.getFlag(packageId, \"effects\") ?? {};\n    for (const id in flags) {\n      if (!(flags[id].type in CONFIG.fxmaster.weather)) {\n        logger.warn(`Weather effect '${id}' is of unknown type '${flags[id].type}', skipping it.`);\n        continue;\n      }\n      const options = Object.fromEntries(\n        Object.entries(flags[id].options).map(([optionName, value]) => [optionName, { value }]),\n      );\n\n      this.weatherEffects[id] = {\n        type: flags[id].type,\n        fx: new CONFIG.fxmaster.weather[flags[id].type](this.weather, options),\n      };\n      this.weatherEffects[id].fx.play();\n    }\n\n    await stopPromise;\n  }\n\n  /**\n   * Draw the scene mask.\n   * @returns {CachedContainer}\n   * @private\n   */\n  _drawSceneMask() {\n    const cachedContainer = new CachedContainer();\n    const mask = new Graphics()\n      .beginFill(0xffffff)\n      .drawShape(canvas.dimensions.rect)\n      .endFill()\n      .beginHole()\n      .drawShape(intersectRectangles(canvas.dimensions.sceneRect, canvas.dimensions.rect))\n      .endHole();\n    cachedContainer.addChild(mask);\n    return cachedContainer;\n  }\n\n  /**\n   * Create the filter for applying the scene mask.\n   * @returns {InverseOcclusionMaskFilter | undefined} The filter for applying the scene mask or undefined if it doesn't exist\n   * @private\n   */\n  _createSceneMaskFilter() {\n    if (!this._sceneMask) {\n      return undefined;\n    }\n    const sceneMaskFilter = InverseOcclusionMaskFilter.create(\n      {\n        alphaOcclusion: 0,\n        uMaskSampler: this._sceneMask.renderTexture,\n      },\n      \"b\",\n    );\n    sceneMaskFilter.enabled = true;\n    return sceneMaskFilter;\n  }\n\n  /**\n   * This used to set the layer mask in v2.0.1 But has been replaced by using a filter instead.\n   * @deprecated since v2.0.2\n   */\n  _setLayerMask() {\n    logger.warn(\n      \"'canvas.fxmaster._setLayerMask' doesn't actually do anything anymore and is only kept for compatibility reasons. It will be removed in a futue version. Please don't use it anymore.\",\n    );\n  }\n\n  /** @deprecated since v2.0.0 */\n  _createInvertMask() {\n    logger.warn(\n      \"'canvas.fxmaster._createInvertMask' is deprecated and will be removed in a future version. Please use 'canvas.fxmaster._createInvertedMask' instead.\",\n    );\n    return this._createInvertedMask();\n  }\n}\n","/**\n * If the area of the intersection between the Rectangles `a` and `b` is not zero,\n * returns the area of intersection as a Rectangle object. Otherwise, returns an empty Rectangle\n * with its properties set to zero.\n * Rectangles without area (width or height equal to zero) can't intersect or be intersected\n * and will always return an empty rectangle with its properties set to zero.\n *\n * @method intersects\n * @memberof PIXI.Rectangle#\n * @param {Rectangle} a - The Rectangle to intersect with `b`.\n * @param {Rectangle} b - The Rectangle to intersect with `a`.\n * @param {Rectangle} [outRect] - A Rectangle object in which to store the value,\n * optional (otherwise will create a new Rectangle).\n * @returns {Rectangle} The intersection of `a` and `b`.\n * @remarks Incorporated from https://github.com/pixijs/pixijs/tree/dev/packages/math-extras\n * @license MIT\n */\nexport function intersectRectangles(a, b, outRect) {\n  if (!outRect) {\n    outRect = new PIXI.Rectangle();\n  }\n\n  const x0 = a.x < b.x ? b.x : a.x;\n  const x1 = a.right > b.right ? b.right : a.right;\n\n  if (x1 <= x0) {\n    outRect.x = outRect.y = outRect.width = outRect.height = 0;\n\n    return outRect;\n  }\n\n  const y0 = a.y < b.y ? b.y : a.y;\n  const y1 = a.bottom > b.bottom ? b.bottom : a.bottom;\n\n  if (y1 <= y0) {\n    outRect.x = outRect.y = outRect.width = outRect.height = 0;\n\n    return outRect;\n  }\n\n  outRect.x = x0;\n  outRect.y = y0;\n  outRect.width = x1 - x0;\n  outRect.height = y1 - y0;\n\n  return outRect;\n}\n","import { packageId } from \"../constants.js\";\nimport { logger } from \"../logger.js\";\nimport { resetFlags } from \"../utils.js\";\n\nclass FilterManager {\n  constructor() {\n    this.filterInfos = {};\n    this.filters = {};\n    this._ticker = false;\n    this.filteredLayers = {\n      background: true,\n      foreground: true,\n      drawings: true,\n      tokens: true,\n    };\n  }\n\n  /**\n   * Activate this {@link FilterManager}. This includes creating all the necessary filters, attaching them to the\n   * configured layers, starting their animations.\n   * @returns {Promise<void>} A promise that resolves as soon as filters are activated\n   */\n  async activate() {\n    await this.update({ skipFading: true });\n\n    if (!this._ticker) {\n      canvas.app.ticker.add(this._animate, this);\n      this._ticker = true;\n    }\n  }\n\n  /**\n   * Update the filters to the state that is configured for the active scene.\n   * @param {{skipFading?: boolean}} [options]            Additional options to configure this update\n   * @param {boolean}                [options.skipFading] Whether or not newly created filters should skip their fading\n   * @returns {Promise<void>}                             A promise that resolves as soon as the filters have been updated\n   */\n  async update({ skipFading = false } = {}) {\n    if (!canvas.scene) {\n      return;\n    }\n    this.filterInfos = Object.fromEntries(\n      Object.entries(canvas.scene.getFlag(packageId, \"filters\") ?? {}).filter(([id, filterInfo]) => {\n        if (!(filterInfo.type in CONFIG.fxmaster.filters)) {\n          logger.warn(`Filter effect '${id}' is of unknown type '${filterInfo.type}', skipping it.`);\n          return false;\n        }\n        return true;\n      }),\n    );\n    this.filteredLayers = canvas.scene.getFlag(packageId, \"filteredLayers\") ?? this.filteredLayers;\n\n    const filtersToCreate = Object.keys(this.filterInfos).filter((key) => !(key in this.filters));\n    const filtersToUpdate = Object.keys(this.filterInfos).filter((key) => key in this.filters);\n    const filtersToDelete = Object.keys(this.filters).filter((key) => !(key in this.filterInfos));\n\n    for (const key of filtersToCreate) {\n      const { type, options } = this.filterInfos[key];\n      this.filters[key] = new CONFIG.fxmaster.filters[type](options, key);\n      this.filters[key].skipFading = skipFading;\n      this.filters[key].play();\n    }\n\n    for (const key of filtersToUpdate) {\n      const { options } = this.filterInfos[key];\n      const filter = this.filters[key];\n      filter.configure(options);\n      filter.play();\n    }\n\n    const deletePromises = filtersToDelete.map(async (key) => {\n      const filter = this.filters[key];\n      await filter.stop();\n\n      // delete filters preemptively so that they disappear as soon as they have stopped\n      [canvas.background, canvas.foreground, canvas.drawings, canvas.tokens].forEach((layer) =>\n        FilterManager._removeFilterFromContainer(layer, filter),\n      );\n      delete this.filters[key];\n    });\n    await Promise.all(deletePromises);\n\n    this.applyFiltersToLayers();\n  }\n\n  /**\n   * Apply the filters to the configured canvas layers.\n   * @returns {void} Nothing\n   */\n  applyFiltersToLayers() {\n    const filters = Object.values(this.filters);\n    Object.entries(this.filteredLayers).forEach(([layerName, filtered]) => {\n      const layer = canvas[layerName];\n      const otherFilters = layer.filters?.filter((f) => !filters.includes(f)) ?? [];\n      layer.filters = otherFilters.concat(filtered ? filters : []);\n    });\n  }\n\n  /**\n   * Remove a filter from a container.\n   * @param {PIXI.container} container A container\n   * @param {PIXI.Filter} filter A filter\n   */\n  static _removeFilterFromContainer(container, filter) {\n    container.filters = container.filters?.filter((f) => f !== filter) ?? null;\n  }\n\n  /**\n   * Set the filters stored in the scene's fxmaster flags to the current values of `filterInfos` of this\n   * {@link FilterManager}.\n   * @returns {Promise<void>} A promise that resolves as soon as the scene's fxmaster flags have been updated\n   */\n  async dump() {\n    await resetFlags(canvas.scene, \"filters\", this.filterInfos);\n  }\n\n  /**\n   * Stop all filters and remove them from the manager.\n   * @remarks This does _not_ remove the filters from the canvas layers.\n   * @returns {Promise<void>} A promise that resolves as soon as all filters have been stopped and removed from the\n   *                          manager\n   */\n  async clear() {\n    const promises = Object.values(this.filters).map((filter) => filter.stop());\n    this.filters = {};\n    await Promise.all(promises);\n  }\n\n  /**\n   * Add a named filter.\n   * @param {string} name    The name of the filter\n   * @param {string} type    The type of the filter\n   * @param {object} options The options for the filter\n   * @returns {Prmise<void>} A promise that resolves as soon as the filter has been added to the scene's fxmaster flags\n   */\n  async addFilter(name, type, options) {\n    name = name ?? randomID();\n    this.filterInfos[name] = { type, options };\n    await this.dump();\n  }\n\n  /**\n   * Remove a named filter.\n   * @param {string} name     The name of the filter to remove\n   * @returns {Promise<void>} A promise that resolves when the filter has been removed from the scene's fxmaster flags\n   */\n  async removeFilter(name) {\n    if (!canvas.scene) {\n      return;\n    }\n    const filter = this.filters[name];\n    if (filter) {\n      await filter.stop();\n    }\n    const rmFilter = {\n      [`-=${name}`]: null,\n    };\n    await canvas.scene.setFlag(packageId, \"filters\", rmFilter);\n  }\n\n  /**\n   * Remove all filters.\n   * @returns {Promise<void>} A promise that resolves as soon as all filters have been removed from the scene's fxmaster\n   *                          flags\n   */\n  async removeAll() {\n    if (!canvas.scene) {\n      return;\n    }\n    await canvas.scene.unsetFlag(packageId, \"filters\");\n  }\n\n  /**\n   * Toggle a named filter on or off.\n   * @param {string} name     The name of the filter\n   * @param {string} type     The type of the filter\n   * @param {object} options  The options for the filter\n   * @returns {Promise<void>} A promise that resolves as soon as the filter has been toggled\n   */\n  async switch(name, type, options) {\n    if (this.filterInfos[name]) {\n      return this.removeFilter(name);\n    }\n    return this.addFilter(name, type, options);\n  }\n\n  async setFilters(filterInfoArray) {\n    this.filterInfos = Object.fromEntries(filterInfoArray.map((filterInfo) => [foundry.utils.randomID(), filterInfo]));\n    await this.dump();\n  }\n\n  _animate() {\n    for (const key in this.filters) {\n      this.filters[key].step();\n    }\n  }\n\n  /**\n   * @deprecated since v2.0.0\n   */\n  get apply_to() {\n    logger.warn(\n      \"'FXMASTER.filters.apply_to' is deprecated and will be removed in a future version. Please use 'FXMASTER.filters.filteredLayers' instead.\",\n    );\n    return this.filteredLayers;\n  }\n}\n\nexport const filterManager = new FilterManager();\n","import { easeFunctions } from \"../../ease.js\";\nimport { packageId } from \"../../constants.js\";\n\nexport class SpecialCreate extends FormApplication {\n  static get defaultOptions() {\n    return foundry.utils.mergeObject(super.defaultOptions, {\n      classes: [\"form\"],\n      closeOnSubmit: true,\n      submitOnChange: false,\n      submitOnClose: false,\n      popOut: true,\n      editable: game.user.isGM,\n      width: 320,\n      height: \"auto\",\n      template: \"modules/fxmaster/templates/special-create.hbs\",\n      id: \"add-effect\",\n      title: game.i18n.localize(\"FXMASTER.AddSpecialEffect\"),\n    });\n  }\n\n  /* -------------------------------------------- */\n\n  setDefault(object) {\n    this.default = object;\n  }\n\n  /**\n   * Obtain module metadata and merge it with game settings which track current module visibility\n   * @return {Object}   The data provided to the template when rendering the form\n   */\n  getData() {\n    const eases = easeFunctions;\n    const values = foundry.utils.mergeObject(\n      {\n        folder: \"Custom\",\n        angle: 0,\n        position: {\n          x: 0,\n          y: 0,\n        },\n        anchor: {\n          x: 0.5,\n          y: 0.5,\n        },\n        scale: {\n          x: 1.0,\n          y: 1.0,\n        },\n        speed: 0,\n        animationDelay: {\n          start: 0,\n          end: 0,\n        },\n        ease: \"Linear\",\n        author: \"\",\n        preset: false,\n      },\n      this.default,\n    );\n\n    // Return data to the template\n    return {\n      default: values,\n      ease: Object.keys(eases),\n    };\n  }\n\n  /* -------------------------------------------- */\n  /*  Event Listeners and Handlers                */\n  /* -------------------------------------------- */\n\n  /** @override */\n  activateListeners(html) {\n    super.activateListeners(html);\n    html.find('input[type=\"range\"]').on(\"input\", (event) => this._onChangeRange(event));\n  }\n\n  /**\n   * This method is called upon form submission after form data is validated\n   * @param event {Event}       The initial triggering submission event\n   * @param formData {object}   The object of validated form data with which to update the object\n   * @protected\n   */\n  async _updateObject(_, formData) {\n    const fxs = game.settings.get(packageId, \"specialEffects\");\n\n    const newData = {\n      folder: formData[\"folder\"],\n      label: formData[\"label\"],\n      file: formData[\"file\"],\n      scale: {\n        x: parseFloat(formData[\"scaleX\"]),\n        y: parseFloat(formData[\"scaleY\"]),\n      },\n      angle: parseFloat(formData[\"angle\"]),\n      anchor: {\n        x: formData[\"anchorX\"],\n        y: formData[\"anchorY\"],\n      },\n      speed: parseFloat(formData[\"speed\"]),\n      animationDelay: {\n        start: parseFloat(formData[\"animationDelayStart\"]),\n        end: parseFloat(formData[\"animationDelayEnd\"]),\n      },\n      ease: formData[\"ease\"],\n      preset: false,\n      author: \"\",\n    };\n    const fx = fxs.filter((f) => f.label == newData.label);\n    if (fx.length > 0) {\n      fx[0] = foundry.utils.mergeObject(fx[0], newData);\n    } else {\n      fxs.push(newData);\n    }\n    await game.settings.set(packageId, \"specialEffects\", fxs);\n  }\n}\n","import { SpecialCreate } from \"./specials-create.js\";\nimport \"../../../css/specials-config.css\";\nimport { packageId } from \"../../constants.js\";\n\nexport class SpecialsConfig extends Application {\n  static get defaultOptions() {\n    return foundry.utils.mergeObject(super.defaultOptions, {\n      classes: [\"fxmaster\", \"specials\", \"sidebar-popout\"],\n      closeOnSubmit: true,\n      submitOnChange: false,\n      submitOnClose: false,\n      popOut: true,\n      editable: game.user.isGM,\n      width: 120,\n      height: 200,\n      resizable: true,\n      dragDrop: [{ dragSelector: \".special-effects\" }],\n      template: \"modules/fxmaster/templates/specials-config.hbs\",\n      id: \"specials-config\",\n      title: game.i18n.localize(\"FXMASTER.SpecialsConfigTitle\"),\n    });\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Obtain module metadata and merge it with game settings which track current module visibility\n   * @return {Object}   The data provided to the template when rendering the form\n   */\n  getData() {\n    return {\n      folders: CONFIG.fxmaster.userSpecials,\n    };\n  }\n\n  /* -------------------------------------------- */\n  /*  Event Listeners and Handlers                */\n  /* -------------------------------------------- */\n\n  /** @override */\n  activateListeners(html) {\n    html.find(\".special-effects .description\").click((event) => {\n      let list = event.currentTarget.closest(\".directory-list\");\n      let items = $(list).find(\".directory-item\");\n      for (let i = 0; i < items.length; i++) {\n        items[i].classList.remove(\"active\");\n      }\n      event.currentTarget.parentElement.classList.add(\"active\");\n    });\n\n    // Dialog\n    html.find(\"a[data-action=add-effect]\").click(async () => {\n      new SpecialCreate().render(true);\n    });\n\n    html.find(\".preview video\").hover((ev) => {\n      ev.currentTarget.play();\n    });\n\n    html.find(\".del-effect\").click((ev) => {\n      const folderId = ev.currentTarget.closest(\".folder\").dataset[\"folderId\"];\n      const effectId = ev.currentTarget.closest(\".special-effects\").dataset[\"effectId\"];\n      const data = CONFIG.fxmaster.userSpecials[folderId].effects[effectId];\n      const settings = game.settings.get(packageId, \"specialEffects\");\n      const id = settings.findIndex((v) => {\n        return v.label === data.label && v.folder === data.folder;\n      });\n      if (id === -1) {\n        return;\n      }\n      settings.splice(id, 1);\n      game.settings.set(packageId, \"specialEffects\", settings);\n    });\n\n    html.find(\".edit-effect\").click((ev) => {\n      const folderId = ev.currentTarget.closest(\".folder\").dataset[\"folderId\"];\n      const effectId = ev.currentTarget.closest(\".special-effects\").dataset[\"effectId\"];\n      const d = new SpecialCreate();\n      d.setDefault(CONFIG.fxmaster.userSpecials[folderId].effects[effectId]);\n      d.render(true);\n    });\n\n    html.find(\".action-toggle\").click((ev) => {\n      for (const c of ev.currentTarget.parentElement.children) {\n        c.classList.remove(\"active\");\n      }\n      ev.currentTarget.classList.add(\"active\");\n    });\n\n    const directory = html.find(\".directory-list\");\n    directory.on(\"click\", \".folder-header\", this._toggleFolder.bind(this));\n  }\n\n  _toggleFolder(event) {\n    let folder = $(event.currentTarget.parentElement);\n    let collapsed = folder.hasClass(\"collapsed\");\n\n    // Expand\n    if (collapsed) folder.removeClass(\"collapsed\");\n    // Collapse\n    else {\n      folder.addClass(\"collapsed\");\n      folder.find(\".folder\").addClass(\"collapsed\");\n    }\n  }\n\n  _onDragStart(event) {\n    const effectId = event.currentTarget.closest(\".special-effects\").dataset.effectId;\n    const folderId = event.currentTarget.closest(\".folder\").dataset.folderId;\n    const effectData = CONFIG.fxmaster.userSpecials[folderId].effects[effectId];\n    effectData.type = \"SpecialEffect\";\n    event.dataTransfer.setData(\"text/plain\", JSON.stringify(effectData));\n  }\n}\n","import { FXCanvasAnimation } from \"../canvasanimation.js\";\nimport { packageId } from \"../constants.js\";\nimport { easeFunctions } from \"../ease.js\";\n\nexport class SpecialsLayer extends CanvasLayer {\n  constructor() {\n    super();\n    this.videos = [];\n    this._dragging = false;\n    this.ruler = null;\n    this.windowVisible = false;\n    // Listen to the socket\n    game.socket.on(`module.${packageId}`, (data) => {\n      this.playVideo(data);\n    });\n  }\n\n  static get layerOptions() {\n    return foundry.utils.mergeObject(super.layerOptions, {\n      name: \"specials\",\n      zIndex: 245,\n    });\n  }\n\n  /** @override */\n  async draw() {\n    await super.draw();\n    this.ruler = this.addChild(new PIXI.Graphics());\n    this.visible = true;\n    return this;\n  }\n\n  /** @inheritdoc */\n  async tearDown() {\n    this.ruler = null;\n    for (const video of this.videos) {\n      video.remove();\n    }\n    this.videos = [];\n    return super.tearDown();\n  }\n\n  _configureProjectile(vidSprite, data) {\n    if (data.distance && (!data.speed || data.speed == \"auto\")) {\n      data.speed = data.distance / data.duration;\n    }\n    // Compute final position\n    const delta = data.duration * data.speed;\n    const deltaX = delta * Math.cos(data.rotation);\n    const deltaY = delta * Math.sin(data.rotation);\n\n    // Move the sprite\n    const attributes = [\n      {\n        parent: vidSprite,\n        attribute: \"x\",\n        to: data.position.x + deltaX,\n      },\n      {\n        parent: vidSprite,\n        attribute: \"y\",\n        to: data.position.y + deltaY,\n      },\n    ];\n\n    let animationDuration = data.duration * 1000;\n    if (foundry.utils.hasProperty(data, \"animationDelay\")) {\n      animationDuration -= Math.max(0, 1000 * (data.animationDelay.end + data.animationDelay.start));\n    }\n    const animate = function () {\n      FXCanvasAnimation.animateSmooth(attributes, {\n        name: `${packageId}.video.${randomID()}.move`,\n        context: this,\n        duration: animationDuration,\n        ease: easeFunctions[data.ease],\n      });\n    };\n    if (foundry.utils.hasProperty(data, \"animationDelay.start\")) {\n      setTimeout(animate, data.animationDelay.start * 1000.0);\n    } else {\n      animate();\n    }\n  }\n\n  _configureRotate(vidSprite, data) {\n    const attributes = [\n      {\n        parent: vidSprite,\n        attribute: \"angle\",\n        to: 90 * data.rotationSpeed,\n      },\n    ];\n    let animationDuration = data.duration * 1000;\n    if (foundry.utils.hasProperty(data, \"animationDelay\")) {\n      animationDuration -= Math.max(0, 1000 * (data.animationDelay.end + data.animationDelay.start));\n    }\n    const animate = function () {\n      FXCanvasAnimation.animateSmooth(attributes, {\n        name: `${packageId}.video.${randomID()}.rotate`,\n        context: this,\n        duration: animationDuration,\n        ease: easeFunctions[data.ease],\n      });\n    };\n    if (foundry.utils.hasProperty(data, \"animationDelay.start\")) {\n      setTimeout(animate, data.animationDelay.start * 1000.0);\n    } else {\n      animate();\n    }\n  }\n\n  _configureSprite(vidSprite, data) {\n    // Set values\n    vidSprite.anchor.set(data.anchor.x, data.anchor.y);\n    vidSprite.rotation = Math.normalizeRadians(data.rotation - Math.toRadians(data.angle));\n    vidSprite.scale.set(data.scale.x, data.scale.y);\n    vidSprite.position.set(data.position.x, data.position.y);\n\n    // Extend sprite if a width is forced\n    if (data.width) {\n      if (data.keepAspect) {\n        const aspectRatio = vidSprite.height / vidSprite.width;\n        vidSprite.height = data.width * aspectRatio;\n      }\n      vidSprite.width = data.width;\n    }\n\n    if (data.speed || data.distance) {\n      this._configureProjectile(vidSprite, data);\n    }\n    if (data.rotationSpeed) {\n      this._configureRotate(vidSprite, data);\n    }\n  }\n\n  playVideo(data) {\n    return new Promise((resolve) => {\n      // Set default values\n      data = foundry.utils.mergeObject(\n        {\n          anchor: { x: 0.5, y: 0.5 },\n          rotation: 0,\n          scale: { x: 1.0, y: 1.0 },\n          position: { x: 0, y: 0 },\n          playbackRate: 1.0,\n          ease: \"Linear\",\n        },\n        data,\n      );\n\n      // Create video\n      const video = document.createElement(\"video\");\n      video.preload = \"auto\";\n      video.crossOrigin = \"anonymous\";\n      video.src = data.file;\n      video.playbackRate = data.playbackRate;\n      this.videos.push(video);\n\n      // Create PIXI sprite\n      let vidSprite;\n      video.oncanplay = () => {\n        const texture = PIXI.Texture.from(video);\n        vidSprite = new PIXI.Sprite(texture);\n        this.addChild(vidSprite);\n        data.dimensions = { w: video.videoWidth, h: video.videoHeight };\n        data.duration = video.duration;\n        this._configureSprite(vidSprite, data);\n      };\n      video.onerror = () => {\n        this.removeChild(vidSprite);\n        resolve();\n        vidSprite?.destroy();\n      };\n      video.onended = () => {\n        this.removeChild(vidSprite);\n        vidSprite?.destroy();\n        resolve();\n      };\n    });\n  }\n\n  static _createMacro(effectData) {\n    return `\n      const data = {\n        file: \"${effectData.file}\",\n        position: {\n          x: canvas.scene.dimensions.width / 2,\n          y: canvas.scene.dimensions.height / 2\n        },\n        anchor : {\n          x: ${effectData.anchor.x},\n          y: ${effectData.anchor.y}\n        },\n        angle: ${effectData.angle},\n        speed: ${effectData.speed},\n        scale: {\n          x: ${effectData.scale.x},\n          y: ${effectData.scale.y}\n        }\n      };\n      const tokens = canvas.tokens.controlled;\n      // No tokens are selected, play in a random position\n      if (tokens.length === 0) {\n        canvas.specials.playVideo(data);\n        game.socket.emit(\"module.${packageId}\", data);\n        return;\n      }\n      const targets = game.user.targets;\n      if (targets.size !== 0) {\n        tokens.forEach(t1 => {\n          targets.forEach(t2 => {\n            canvas.specials.drawFacing(data, t1, t2);\n          })\n        })\n        return;\n      }\n      // Play effect on each token\n      tokens.forEach(t => {\n        data.position = {\n          x: t.position.x + t.w / 2,\n          y: t.position.y + t.h / 2\n        };\n        canvas.specials.playVideo(data);\n        game.socket.emit(\"module.${packageId}\", data);\n      })\n\n    `;\n  }\n\n  drawSpecialToward(effect, tok1, tok2) {\n    const origin = {\n      x: tok1.position.x + tok1.w / 2,\n      y: tok1.position.y + tok1.h / 2,\n    };\n    const effectData = foundry.utils.mergeObject(effect, {\n      position: {\n        x: origin.x,\n        y: origin.y,\n      },\n    });\n    const target = {\n      x: tok2.position.x + tok2.w / 2,\n      y: tok2.position.y + tok2.h / 2,\n    };\n    // Compute angle\n    const ray = new Ray(origin, target);\n    effectData.distance = ray.distance;\n    effectData.rotation = ray.angle;\n    // Play to other clients\n    game.socket.emit(`module.${packageId}`, effectData);\n    // Play effect locally\n    return this.playVideo(effectData);\n  }\n\n  drawFacing(effect, tok1, tok2) {\n    const origin = {\n      x: tok1.position.x + tok1.w / 2,\n      y: tok1.position.y + tok1.h / 2,\n    };\n    const effectData = foundry.utils.mergeObject(effect, {\n      position: {\n        x: origin.x,\n        y: origin.y,\n      },\n    });\n    const target = {\n      x: tok2.position.x + tok2.w / 2,\n      y: tok2.position.y + tok2.h / 2,\n    };\n    // Compute angle\n    const ray = new Ray(origin, target);\n    effectData.rotation = ray.angle;\n    // Play to other clients\n    game.socket.emit(`module.${packageId}`, effectData);\n    // Play effect locally\n    return this.playVideo(effectData);\n  }\n\n  /**\n   * Draw a special effect.\n   * @param {PIXI.InteractionEvent} event         The event that triggered the drawing of the special effect\n   * @param {PIXI.Point}            [savedOrigin] The point that was originally clicked on\n   * @returns {Promise<void>}\n   * @remarks\n   * The savedOrigin parameter is required for regular click events because for some reason, the origin has been removed\n   * from the event's data by the time the event is handled.\n   * TODO: investigate further.\n   */\n  _drawSpecial(event, savedOrigin) {\n    event.stopPropagation();\n\n    const windows = Object.values(ui.windows);\n    const effectConfig = windows.find((w) => w.id == \"specials-config\");\n    if (!effectConfig) return;\n    const active = effectConfig.element.find(\".special-effects.active\");\n    if (active.length == 0) return;\n\n    const id = active[0].dataset.effectId;\n    const folder = active[0].closest(\".folder\").dataset.folderId;\n    const effect = CONFIG.fxmaster.userSpecials[folder].effects[id];\n\n    const effectData = foundry.utils.deepClone(effect);\n    const { x, y } = event.data.origin ?? savedOrigin;\n    const data = {\n      ...effectData,\n      ...{\n        position: { x, y },\n        rotation: event.data.rotation,\n      },\n    };\n\n    if (!event.data.destination) {\n      game.socket.emit(`module.${packageId}`, data);\n      return this.playVideo(data);\n    }\n\n    // Handling different casting modes\n    const actionToggle = effectConfig.element.find(\".action-toggle.active a\");\n    const mode = actionToggle[0].dataset.action;\n    const ray = new Ray(event.data.origin, event.data.destination);\n    switch (mode) {\n      case \"cast-throw\":\n        data.distance = ray.distance;\n        data.speed = \"auto\";\n        break;\n      case \"cast-extend\":\n        data.width = ray.distance || data.width;\n        data.speed = 0;\n        break;\n      case \"cast-expand\":\n        data.width = ray.distance || data.width;\n        data.keepAspect = true;\n        data.speed = 0;\n        break;\n      case \"cast-rotate\":\n        data.rotationSpeed = ray.distance / canvas.grid.w;\n        data.speed = 0;\n        break;\n      case \"cast-static\":\n        break;\n    }\n\n    game.socket.emit(`module.${packageId}`, data);\n    return this.playVideo(data);\n  }\n\n  /** @override */\n  _onDragLeftDrop(event) {\n    const u = {\n      x: event.data.destination.x - event.data.origin.x,\n      y: event.data.destination.y - event.data.origin.y,\n    };\n    const cos = u.x / Math.hypot(u.x, u.y);\n    event.data.rotation = u.y > 0 ? Math.acos(cos) : -Math.acos(cos);\n    this._drawSpecial(event);\n    this.ruler.clear();\n  }\n\n  /** @override */\n  _onDragLeftStart() {\n    this.windowVisible = this._isWindowVisible();\n    if (!this.windowVisible) return;\n    this._dragging = true;\n  }\n\n  _onDragLeftMove(event) {\n    if (!this.windowVisible) return;\n    const ray = new Ray(event.data.origin, event.data.destination);\n    this.ruler.clear();\n    this.ruler\n      .lineStyle(3, 0xaa0033, 0.6)\n      .drawCircle(ray.A.x, ray.A.y, 2)\n      .moveTo(ray.A.x, ray.A.y)\n      .lineTo(ray.B.x, ray.B.y)\n      .drawCircle(ray.B.x, ray.B.y, 2);\n  }\n\n  _isWindowVisible() {\n    const windows = Object.values(ui.windows);\n    const effectConfig = windows.find((w) => w.id == \"specials-config\");\n    if (!effectConfig) return false;\n    return true;\n  }\n\n  _onClickLeft(event) {\n    this._dragging = false;\n    const origin = event.data.origin;\n    setTimeout(() => {\n      if (!this._dragging) {\n        event.data.rotation = 0;\n        event.data.destination = undefined;\n        this._drawSpecial(event, origin);\n      }\n      this._dragging = false;\n    }, 400);\n  }\n}\n","import { resetFlags } from \"../../utils.js\";\nimport \"../../../css/weather-config.css\";\nimport { packageId } from \"../../constants.js\";\n\nexport class WeatherConfig extends FormApplication {\n  constructor() {\n    super();\n  }\n\n  static get defaultOptions() {\n    return foundry.utils.mergeObject(super.defaultOptions, {\n      classes: [\"form\", \"fxmaster\", \"weathers\", \"sidebar-popout\"],\n      closeOnSubmit: true,\n      submitOnChange: false,\n      submitOnClose: false,\n      popOut: true,\n      editable: game.user.isGM,\n      width: 300,\n      height: \"auto\",\n      template: \"modules/fxmaster/templates/weather-config.hbs\",\n      id: \"effects-config\",\n      title: game.i18n.localize(\"FXMASTER.WeatherConfigTitle\"),\n    });\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Obtain module metadata and merge it with game settings which track current module visibility\n   * @return {Object}   The data provided to the template when rendering the form\n   */\n  getData() {\n    const currentEffects = canvas.scene?.getFlag(packageId, \"effects\") ?? {};\n\n    const activeEffects = Object.fromEntries(\n      Object.values(currentEffects).map((effect) => [effect.type, effect.options]),\n    );\n\n    return {\n      effects: CONFIG.fxmaster.weather,\n      activeEffects,\n    };\n  }\n\n  /* -------------------------------------------- */\n  /*  Event Listeners and Handlers                */\n  /* -------------------------------------------- */\n\n  /** @override */\n  activateListeners(html) {\n    super.activateListeners(html);\n    html.find(\".config.weather .collapse\").click((event) => this._onWeatherCollapse(event));\n    html.find('.config.weather input[type=\"range\"]').on(\"input\", (event) => this._onChangeRange(event));\n  }\n\n  /**\n   * Handle Weather collapse toggle\n   * @private\n   */\n  _onWeatherCollapse(event) {\n    let li = $(event.currentTarget).parents(\".config.weather\"),\n      expanded = !li.children(\".config.collapsible\").hasClass(\"collapsed\");\n    this._collapse(li, expanded);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Helper method to render the expansion or collapse of playlists\n   * @param {HTMLElement} li\n   * @param {boolean} collapse\n   * @param {number} speed\n   * @private\n   */\n  _collapse(li, collapse, speed = 250) {\n    li = $(li);\n    let ol = li.children(\".config.collapsible\"),\n      icon = li.find(\"header i.fa\");\n    // Collapse the Playlist\n    if (collapse) {\n      ol.slideUp(speed, () => {\n        ol.addClass(\"collapsed\");\n        icon.removeClass(\"fa-angle-up\").addClass(\"fa-angle-down\");\n      });\n    }\n\n    // Expand the Playlist\n    else {\n      ol.slideDown(speed, () => {\n        ol.removeClass(\"collapsed\");\n        icon.removeClass(\"fa-angle-down\").addClass(\"fa-angle-up\");\n      });\n    }\n  }\n\n  /**\n   * This method is called upon form submission after form data is validated\n   * @param event {Event}       The initial triggering submission event\n   * @param formData {Object}   The object of validated form data with which to update the object\n   * @private\n   */\n  async _updateObject(_, formData) {\n    const weathersDB = CONFIG.fxmaster.weather;\n    const effects = Object.fromEntries(\n      Object.entries(weathersDB)\n        .filter(([, weatherCls]) => !!formData[weatherCls.label])\n        .map(([weatherName, weatherCls]) => {\n          const label = weatherCls.label;\n\n          const options = Object.fromEntries(\n            Object.entries(weatherCls.parameters).map(([key, parameter]) => {\n              const optionValue =\n                parameter.type === \"color\"\n                  ? { apply: formData[`${label}_${key}_apply`], value: formData[`${label}_${key}`] }\n                  : formData[`${label}_${key}`];\n\n              return [key, optionValue];\n            }),\n          );\n\n          const weather = {\n            type: weatherName,\n            options,\n          };\n          return [`core_${weatherName}`, weather];\n        }),\n    );\n    resetFlags(canvas.scene, \"effects\", effects);\n  }\n}\n","import { packageId } from \"../../constants.js\";\nimport { resetFlags } from \"../../utils.js\";\nimport \"../../../css/filters-config.css\";\n\nexport class FiltersConfig extends FormApplication {\n  static get defaultOptions() {\n    return foundry.utils.mergeObject(super.defaultOptions, {\n      classes: [\"form\", \"fxmaster\", \"filters\", \"sidebar-popout\"],\n      closeOnSubmit: true,\n      submitOnChange: false,\n      submitOnClose: false,\n      popOut: true,\n      editable: game.user.isGM,\n      width: 300,\n      height: \"auto\",\n      template: \"modules/fxmaster/templates/filters-config.hbs\",\n      id: \"filters-config\",\n      title: game.i18n.localize(\"FXMASTER.FiltersConfigTitle\"),\n    });\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Obtain module metadata and merge it with game settings which track current module visibility\n   * @return {Object}   The data provided to the template when rendering the form\n   */\n  getData() {\n    const currentFilters = canvas.scene?.getFlag(packageId, \"filters\") ?? {};\n    const activeFilters = Object.fromEntries(\n      Object.values(currentFilters).map((filter) => [filter.type, filter.options]),\n    );\n\n    const filteredLayers = canvas.scene?.getFlag(packageId, \"filteredLayers\") ?? {\n      background: true,\n      foreground: true,\n      tokens: true,\n      drawings: true,\n    };\n    // Return data to the template\n    return {\n      filters: CONFIG.fxmaster.filters,\n      activeFilters,\n      filteredLayers,\n    };\n  }\n\n  /* -------------------------------------------- */\n  /*  Event Listeners and Handlers                */\n  /* -------------------------------------------- */\n\n  /** @override */\n  activateListeners(html) {\n    super.activateListeners(html);\n    html.find(\".config.filter .collapse\").click((event) => this._onFilterCollapse(event));\n    html.find('.config.filter input[type=\"range\"]').on(\"input\", (event) => this._onChangeRange(event));\n  }\n\n  /**\n   * Handle Weather collapse toggle\n   * @private\n   */\n  _onFilterCollapse(event) {\n    let li = $(event.currentTarget).parents(\".config.filter\"),\n      expanded = !li.children(\".config.collapsible\").hasClass(\"collapsed\");\n    this._collapse(li, expanded);\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Helper method to render the expansion or collapse of playlists\n   * @param {HTMLElement} li\n   * @param {boolean} collapse\n   * @param {number} speed\n   * @private\n   */\n  _collapse(li, collapse, speed = 250) {\n    li = $(li);\n    let ol = li.children(\".config.collapsible\"),\n      icon = li.find(\"header i.fa\");\n    // Collapse the Playlist\n    if (collapse) {\n      ol.slideUp(speed, () => {\n        ol.addClass(\"collapsed\");\n        icon.removeClass(\"fa-angle-up\").addClass(\"fa-angle-down\");\n      });\n    }\n\n    // Expand the Playlist\n    else {\n      ol.slideDown(speed, () => {\n        ol.removeClass(\"collapsed\");\n        icon.removeClass(\"fa-angle-down\").addClass(\"fa-angle-up\");\n      });\n    }\n  }\n\n  /**\n   * This method is called upon form submission after form data is validated\n   * @param {Event}  event    The initial triggering submission event\n   * @param {object} formData The object of validated form data with which to update the object\n   * @private\n   */\n  async _updateObject(_, formData) {\n    if (!canvas.scene) {\n      return;\n    }\n    const filtersDB = CONFIG.fxmaster.filters;\n\n    const filters = Object.fromEntries(\n      Object.entries(filtersDB)\n        .filter(([, filterCls]) => !!formData[filterCls.label])\n        .map(([filterName, filterCls]) => {\n          const label = filterCls.label;\n\n          const options = Object.fromEntries(\n            Object.entries(filterCls.parameters).map(([key, parameter]) => {\n              const optionValue =\n                parameter.type === \"color\"\n                  ? { apply: formData[`${label}_${key}_apply`], value: formData[`${label}_${key}`] }\n                  : formData[`${label}_${key}`];\n\n              return [key, optionValue];\n            }),\n          );\n\n          const filter = {\n            type: filterName,\n            options,\n          };\n          return [`core_${filterName}`, filter];\n        }),\n    );\n\n    const filteredLayers = {\n      background: formData[\"background\"],\n      foreground: formData[\"foreground\"],\n      drawings: formData[\"drawings\"],\n      tokens: formData[\"tokens\"],\n    };\n\n    await canvas.scene.setFlag(packageId, \"filteredLayers\", filteredLayers);\n    resetFlags(canvas.scene, \"filters\", filters);\n  }\n}\n","import { packageId } from \"./constants.js\";\n\nconst defaultMacroImg = \"icons/svg/windmill.svg\";\n\nexport async function saveWeatherAndFiltersAsMacro() {\n  const weatherFlags = canvas.scene?.getFlag(packageId, \"effects\") ?? {};\n  const weatherEffects = Object.values(weatherFlags);\n\n  const filterFlags = canvas.scene?.getFlag(packageId, \"filters\") ?? {};\n  const filterEffects = Object.values(filterFlags);\n\n  const { name, img } = getMacroNameAndImg(weatherEffects, filterEffects);\n\n  const commands = [];\n  if (weatherEffects.length > 0) {\n    commands.push(`Hooks.call('${packageId}.updateWeather', ${JSON.stringify(weatherEffects)});`);\n  }\n  if (filterEffects.length > 0) {\n    commands.push(`FXMASTER.filters.setFilters(${JSON.stringify(filterEffects)});`);\n  }\n  const command = commands.join(\"\\n\");\n\n  await Macro.create({ type: \"script\", name, command, img });\n  ui.notifications.info(`Macro ${name} has been saved in the macro directory`);\n}\n\nfunction getMacroNameAndImg(weatherEffects, filterEffects) {\n  const weatherLabelsAndIcons = weatherEffects.flatMap(({ type }) => {\n    const weatherEffectCls = CONFIG.fxmaster.weather[type];\n    if (!weatherEffectCls) {\n      logger.warn(`Encountered unknown weather effect type '${type}' during macro creation, skipping it.`);\n      return [];\n    }\n    return [{ label: weatherEffectCls.label, icon: weatherEffectCls.icon }];\n  });\n  const filterLabels = filterEffects.flatMap(({ type }) => {\n    const filterEffectCls = CONFIG.fxmaster.filters[type];\n    if (!filterEffectCls) {\n      logger.warn(`Encountered unknown filter effect type '${type}' during macro creation, skipping it.`);\n      return [];\n    }\n    return [{ label: filterEffectCls.label }];\n  });\n\n  if (filterLabels.length === 0) {\n    return weatherLabelsAndIcons.length === 1\n      ? {\n          name: `Weather: ${weatherLabelsAndIcons[0].label}`,\n          img: weatherLabelsAndIcons[0].icon,\n        }\n      : { name: \"Weather\", img: defaultMacroImg };\n  } else if (weatherLabelsAndIcons.length === 0) {\n    return filterLabels.length === 1\n      ? {\n          name: `Filter: ${filterLabels[0].label}`,\n          img: defaultMacroImg,\n        }\n      : { name: \"Filters\", img: defaultMacroImg };\n  } else {\n    return { name: `Weather & Filters`, img: defaultMacroImg };\n  }\n}\n","import { packageId } from \"./constants.js\";\nimport { filterManager } from \"./filterEffects/FilterManager.js\";\nimport { WeatherConfig } from \"./weatherEffects/applications/weather-config.js\";\nimport { SpecialsConfig } from \"./specialEffects/applications/specials-config.js\";\nimport { FiltersConfig } from \"./filterEffects/applications/filters-config.js\";\nimport { saveWeatherAndFiltersAsMacro } from \"./macro.js\";\n\nexport function registerGetSceneControlButtonsHook() {\n  Hooks.on(\"getSceneControlButtons\", getSceneControlButtons);\n}\n\nfunction getSceneControlButtons(controls) {\n  if (canvas == null) {\n    return;\n  }\n  controls.push({\n    name: \"effects\",\n    title: \"CONTROLS.Effects\",\n    icon: \"fas fa-magic\",\n    layer: \"specials\",\n    visible: game.user.role >= game.settings.get(packageId, \"permission-create\"),\n    tools: [\n      {\n        name: \"specials\",\n        title: \"CONTROLS.SpecialFX\",\n        icon: \"fas fa-hat-wizard\",\n        onClick: () => {\n          new SpecialsConfig().render(true);\n        },\n        button: true,\n      },\n      {\n        name: \"weather\",\n        title: \"CONTROLS.Weather\",\n        icon: \"fas fa-cloud-rain\",\n        onClick: () => {\n          new WeatherConfig().render(true);\n        },\n        visible: game.user.isGM,\n        button: true,\n      },\n      {\n        name: \"invertmask\",\n        title: \"CONTROLS.InvertMask\",\n        icon: \"fas fa-mask\",\n        onClick: () => {\n          if (canvas.scene) {\n            const invert = canvas.scene.getFlag(packageId, \"invert\") ?? false;\n            canvas.scene.setFlag(packageId, \"invert\", !invert);\n          }\n        },\n        visible: game.user.isGM,\n        active: canvas.scene?.getFlag(packageId, \"invert\") ?? false,\n        toggle: true,\n      },\n      {\n        name: \"filters\",\n        title: \"CONTROLS.Filters\",\n        icon: \"fas fa-filter\",\n        onClick: () => {\n          new FiltersConfig().render(true);\n        },\n        visible: game.user.isGM,\n        button: true,\n      },\n      {\n        name: \"save\",\n        title: \"CONTROLS.SaveMacro\",\n        icon: \"fas fa-save\",\n        onClick: saveWeatherAndFiltersAsMacro,\n        visible: game.user.isGM,\n        button: true,\n      },\n      {\n        name: \"clearfx\",\n        title: \"CONTROLS.ClearFX\",\n        icon: \"fas fa-trash\",\n        onClick: () => {\n          Dialog.confirm({\n            title: game.i18n.localize(\"FXMASTER.ClearWeatherAndFiltersTitle\"),\n            content: game.i18n.localize(\"FXMASTER.ClearWeatherAndFiltersContent\"),\n            yes: () => {\n              if (canvas.scene) {\n                filterManager.removeAll();\n                canvas.scene.unsetFlag(packageId, \"effects\");\n              }\n            },\n            defaultYes: true,\n          });\n        },\n        visible: game.user.isGM,\n        button: true,\n      },\n    ],\n  });\n}\n","// SPDX-License-Identifier: MIT\n// Copyright © 2021 fvtt-lib-wrapper Rui Pinheiro\n\n\"use strict\";\n\n// A shim for the libWrapper library\nexport let libWrapper = undefined;\n\nexport const VERSIONS = [1, 12, 1];\nexport const TGT_SPLIT_RE = new RegExp(\"([^.[]+|\\\\[('([^'\\\\\\\\]|\\\\\\\\.)+?'|\\\"([^\\\"\\\\\\\\]|\\\\\\\\.)+?\\\")\\\\])\", \"g\");\nexport const TGT_CLEANUP_RE = new RegExp(\"(^\\\\['|'\\\\]$|^\\\\[\\\"|\\\"\\\\]$)\", \"g\");\n\n// Main shim code\nHooks.once(\"init\", () => {\n  // Check if the real module is already loaded - if so, use it\n  if (globalThis.libWrapper && !(globalThis.libWrapper.is_fallback ?? true)) {\n    libWrapper = globalThis.libWrapper;\n    return;\n  }\n\n  // Fallback implementation\n  libWrapper = class {\n    static get is_fallback() {\n      return true;\n    }\n\n    static get WRAPPER() {\n      return \"WRAPPER\";\n    }\n    static get MIXED() {\n      return \"MIXED\";\n    }\n    static get OVERRIDE() {\n      return \"OVERRIDE\";\n    }\n\n    static register(package_id, target, fn, type = \"MIXED\", { chain = undefined, bind = [] } = {}) {\n      const is_setter = target.endsWith(\"#set\");\n      target = !is_setter ? target : target.slice(0, -4);\n      const split = target.match(TGT_SPLIT_RE).map((x) => x.replace(/\\\\(.)/g, \"$1\").replace(TGT_CLEANUP_RE, \"\"));\n      const root_nm = split.splice(0, 1)[0];\n\n      let obj, fn_name;\n      if (split.length == 0) {\n        obj = globalThis;\n        fn_name = root_nm;\n      } else {\n        const _eval = eval;\n        fn_name = split.pop();\n        obj = split.reduce((x, y) => x[y], globalThis[root_nm] ?? _eval(root_nm));\n      }\n\n      let iObj = obj;\n      let descriptor = null;\n      while (iObj) {\n        descriptor = Object.getOwnPropertyDescriptor(iObj, fn_name);\n        if (descriptor) break;\n        iObj = Object.getPrototypeOf(iObj);\n      }\n      if (!descriptor || descriptor?.configurable === false)\n        throw new Error(\n          `libWrapper Shim: '${target}' does not exist, could not be found, or has a non-configurable descriptor.`,\n        );\n\n      let original = null;\n      const wrapper =\n        chain ?? (type.toUpperCase?.() != \"OVERRIDE\" && type != 3)\n          ? function (...args) {\n              return fn.call(this, original.bind(this), ...bind, ...args);\n            }\n          : function (...args) {\n              return fn.call(this, ...bind, ...args);\n            };\n      if (!is_setter) {\n        if (descriptor.value) {\n          original = descriptor.value;\n          descriptor.value = wrapper;\n        } else {\n          original = descriptor.get;\n          descriptor.get = wrapper;\n        }\n      } else {\n        if (!descriptor.set) throw new Error(`libWrapper Shim: '${target}' does not have a setter`);\n        original = descriptor.set;\n        descriptor.set = wrapper;\n      }\n\n      descriptor.configurable = true;\n      Object.defineProperty(obj, fn_name, descriptor);\n    }\n  };\n\n  //************** USER CUSTOMIZABLE:\n  // Set up the ready hook that shows the \"libWrapper not installed\" warning dialog. Remove if undesired.\n  {\n    //************** USER CUSTOMIZABLE:\n    // Package ID & Package Title - by default attempts to auto-detect, but you might want to hardcode your package ID and title here to avoid potential auto-detect issues\n    const [PACKAGE_ID, PACKAGE_TITLE] = (() => {\n      const match = (import.meta?.url ?? Error().stack)?.match(/\\/(worlds|systems|modules)\\/(.+)(?=\\/)/i);\n      if (match?.length !== 3) return [null, null];\n      const dirs = match[2].split(\"/\");\n      if (match[1] === \"worlds\")\n        return dirs.find((n) => n && game.world.id === n) ? [game.world.id, game.world.title] : [null, null];\n      if (match[1] === \"systems\")\n        return dirs.find((n) => n && game.system.id === n) ? [game.system.id, game.system.data.title] : [null, null];\n      const id = dirs.find((n) => n && game.modules.has(n));\n      return [id, game.modules.get(id)?.data?.title];\n    })();\n\n    if (!PACKAGE_ID || !PACKAGE_TITLE) {\n      console.error(\n        \"libWrapper Shim: Could not auto-detect package ID and/or title. The libWrapper fallback warning dialog will be disabled.\",\n      );\n      return;\n    }\n\n    Hooks.once(\"ready\", () => {\n      //************** USER CUSTOMIZABLE:\n      // Title and message for the dialog shown when the real libWrapper is not installed.\n      const FALLBACK_MESSAGE_TITLE = PACKAGE_TITLE;\n      const FALLBACK_MESSAGE = `\n\t\t\t\t<p><b>'${PACKAGE_TITLE}' depends on the 'libWrapper' module, which is not present.</b></p>\n\t\t\t\t<p>A fallback implementation will be used, which increases the chance of compatibility issues with other modules.</p>\n\t\t\t\t<small><p>'libWrapper' is a library which provides package developers with a simple way to modify core Foundry VTT code, while reducing the likelihood of conflict with other packages.</p>\n\t\t\t\t<p>You can install it from the \"Add-on Modules\" tab in the <a href=\"javascript:game.shutDown()\">Foundry VTT Setup</a>, from the <a href=\"https://foundryvtt.com/packages/lib-wrapper\">Foundry VTT package repository</a>, or from <a href=\"https://github.com/ruipin/fvtt-lib-wrapper/\">libWrapper's Github page</a>.</p></small>\n\t\t\t`;\n\n      // Settings key used for the \"Don't remind me again\" setting\n      const DONT_REMIND_AGAIN_KEY = \"libwrapper-dont-remind-again\";\n\n      // Dialog code\n      console.warn(`${PACKAGE_TITLE}: libWrapper not present, using fallback implementation.`);\n      game.settings.register(PACKAGE_ID, DONT_REMIND_AGAIN_KEY, {\n        name: \"\",\n        default: false,\n        type: Boolean,\n        scope: \"world\",\n        config: false,\n      });\n      if (game.user.isGM && !game.settings.get(PACKAGE_ID, DONT_REMIND_AGAIN_KEY)) {\n        new Dialog({\n          title: FALLBACK_MESSAGE_TITLE,\n          content: FALLBACK_MESSAGE,\n          buttons: {\n            ok: { icon: '<i class=\"fas fa-check\"></i>', label: \"Understood\" },\n            dont_remind: {\n              icon: '<i class=\"fas fa-times\"></i>',\n              label: \"Don't remind me again\",\n              callback: () => game.settings.set(PACKAGE_ID, DONT_REMIND_AGAIN_KEY, true),\n            },\n          },\n        }).render(true);\n      }\n    });\n  }\n});\n","import { packageId } from \"../constants.js\";\nimport { libWrapper } from \"../shims/lib-wrapper.js\";\nimport { SpecialsLayer } from \"../specialEffects/SpecialsLayer.js\";\n\nexport function registerCanvasWrappers() {\n  const methods = [\"_onClickLeft\", \"_onDragLeftStart\", \"_onDragLeftMove\", \"_onDragLeftDrop\"];\n  for (const method of methods) {\n    libWrapper.register(packageId, `Canvas.prototype.${method}`, getWrapper(method), \"WRAPPER\");\n  }\n}\n\nfunction getWrapper(method) {\n  return function (wrapped, ...args) {\n    wrapped.call(this, ...args);\n    const layer = this.activeLayer;\n    if (layer instanceof SpecialsLayer) layer[method](...args);\n  };\n}\n","import { registerCanvasWrappers } from \"./canvas.js\";\n\nexport function registerWrappers() {\n  registerCanvasWrappers();\n}\n","import { registerSettings } from \"./settings.js\";\nimport { registerHooks } from \"./hooks.js\";\nimport { FXMASTER } from \"./config.js\";\nimport { WeatherLayer } from \"./weatherEffects/WeatherLayer.js\";\nimport { filterManager } from \"./filterEffects/FilterManager.js\";\nimport { executeWhenWorldIsMigratedToLatest, isOnTargetMigration, migrate } from \"./migration.js\";\nimport { SpecialsConfig } from \"./specialEffects/applications/specials-config.js\";\nimport { SpecialsLayer } from \"./specialEffects/SpecialsLayer.js\";\nimport { registerHelpers } from \"./helpers.js\";\nimport { registerGetSceneControlButtonsHook } from \"./controls.js\";\nimport { isV9OrLater } from \"./utils.js\";\nimport { logger } from \"./logger.js\";\nimport { registerWrappers } from \"./wrappers/index.js\";\n\nimport \"../css/common.css\";\n\nwindow.FXMASTER = {\n  filters: filterManager,\n};\n\nfunction registerLayer() {\n  CONFIG.Canvas.layers.fxmaster = isV9OrLater() ? { layerClass: WeatherLayer, group: \"primary\" } : WeatherLayer;\n  CONFIG.Canvas.layers.specials = isV9OrLater() ? { layerClass: SpecialsLayer, group: \"primary\" } : SpecialsLayer;\n}\n\nfunction parseSpecialEffects() {\n  const effectData = game.settings.get(\"fxmaster\", \"specialEffects\");\n  const specials = foundry.utils.deepClone(CONFIG.fxmaster.specials);\n  effectData.reduce((acc, cur) => {\n    if (!cur.folder) cur.folder = \"Custom\";\n    const normalizedFolder = cur.folder.toLowerCase().replace(/ /g, \"\");\n    if (!acc[normalizedFolder]) acc[normalizedFolder] = { label: cur.folder, effects: [] };\n    acc[normalizedFolder].effects.push(cur);\n    return acc;\n  }, specials);\n  Object.keys(specials).forEach((k) => {\n    specials[k].effects.sort((a, b) => (\"\" + a.label).localeCompare(b.label));\n  });\n  CONFIG.fxmaster.userSpecials = specials;\n}\n\nHooks.once(\"init\", function () {\n  // Register custom system settings\n  registerSettings();\n  registerHooks();\n  registerLayer();\n  registerWrappers();\n  registerHelpers();\n\n  // Adding filters, weathers and effects\n  if (!CONFIG.fxmaster) CONFIG.fxmaster = {};\n  foundry.utils.mergeObject(CONFIG.fxmaster, {\n    filters: FXMASTER.filters,\n    specials: FXMASTER.specials,\n    weather: FXMASTER.weatherEffects,\n  });\n\n  Object.defineProperty(CONFIG.fxmaster.weather, \"nature\", {\n    get: () => {\n      logger.warn(\n        `'CONFIG.fxmaster.weather.nature' is deprecated and will be removed in a future version. Please use 'CONFIG.fxmaster.weather.leaves' instead.`,\n      );\n      return CONFIG.fxmaster.weather.leaves;\n    },\n  });\n\n  foundry.utils.mergeObject(CONFIG.weatherEffects, FXMASTER.weatherEffects);\n});\n\nHooks.once(\"ready\", () => {\n  migrate();\n});\n\nHooks.on(\"canvasInit\", () => {\n  if (!game.settings.get(\"fxmaster\", \"enable\") || game.settings.get(\"fxmaster\", \"disableAll\")) {\n    return;\n  }\n  parseSpecialEffects();\n  filterManager.clear();\n});\n\nHooks.on(\"canvasReady\", async () => {\n  executeWhenWorldIsMigratedToLatest(async () => {\n    if (!game.settings.get(\"fxmaster\", \"enable\") || game.settings.get(\"fxmaster\", \"disableAll\")) {\n      return;\n    }\n    await filterManager.activate();\n  });\n});\n\nHooks.on(\"updateScene\", (scene, data) => {\n  if (\n    !game.settings.get(\"fxmaster\", \"enable\") ||\n    game.settings.get(\"fxmaster\", \"disableAll\") ||\n    !isOnTargetMigration() ||\n    scene !== canvas.scene\n  ) {\n    return;\n  }\n  if (hasProperty(data, \"flags.fxmaster.effects\") || hasProperty(data, \"flags.fxmaster.-=effects\")) {\n    canvas.fxmaster.drawWeather({ soft: true });\n  }\n  if (hasProperty(data, \"flags.fxmaster.invert\") || hasProperty(data, \"flags.fxmaster.-=invert\")) {\n    canvas.fxmaster.updateMask();\n  }\n  if (\n    hasProperty(data, \"flags.fxmaster.filters\") ||\n    hasProperty(data, \"flags.fxmaster.-=filters\") ||\n    hasProperty(data, \"flags.fxmaster.filteredLayers\") ||\n    hasProperty(data, \"flags.fxmaster.-=filteredLayers\")\n  ) {\n    filterManager.update();\n  }\n});\n\nHooks.on(\"dropCanvasData\", async (canvas, data) => {\n  if (!(canvas.activeLayer instanceof SpecialsLayer) || !canvas.scene) return;\n  if (data.type !== \"SpecialEffect\") return;\n\n  await new Promise((resolve) => {\n    const vid = document.createElement(\"video\");\n    vid.addEventListener(\n      \"loadedmetadata\",\n      () => {\n        data.width = vid.videoWidth * data.scale.x;\n        data.height = vid.videoHeight * data.scale.y;\n        resolve();\n      },\n      false,\n    );\n    vid.src = data.file;\n  });\n\n  const tileData = {\n    alpha: 1,\n    flags: {},\n    height: data.height,\n    hidden: false,\n    img: data.file,\n    locked: false,\n    occlusion: { mode: 1, alpha: 0 },\n    overHead: false,\n    rotation: 0,\n    tileSize: 100,\n    video: { loop: true, autoplay: true, volume: 0 },\n    width: data.width,\n    x: data.x - data.anchor.x * data.width,\n    y: data.y - data.anchor.y * data.height,\n    z: 100,\n  };\n  ui.notifications.info(`A new Tile was created for effect ${data.label}`);\n  canvas.scene.createEmbeddedDocuments(\"Tile\", [tileData]).then(() => {});\n});\n\nHooks.on(\"hotbarDrop\", (hotbar, data) => {\n  if (data.type !== \"SpecialEffect\") return;\n  const macroCommand = SpecialsLayer._createMacro(data);\n  data.type = \"Macro\";\n  data.data = {\n    command: macroCommand,\n    name: data.label,\n    type: \"script\",\n    author: game.user.id,\n  };\n});\n\nHooks.on(\"updateDrawing\", (drawing) => {\n  if (drawing.parent !== canvas.scene) {\n    return;\n  }\n  canvas.fxmaster.updateMask();\n});\n\nHooks.on(\"createDrawing\", (drawing) => {\n  if (drawing.parent !== canvas.scene) {\n    return;\n  }\n  canvas.fxmaster.updateMask();\n});\n\nHooks.on(\"deleteDrawing\", (drawing) => {\n  if (drawing.parent !== canvas.scene) {\n    return;\n  }\n  canvas.fxmaster.updateMask();\n});\n\nHooks.on(\"updateSetting\", (data) => {\n  if (data.data.key === \"fxmaster.specialEffects\") {\n    parseSpecialEffects();\n  }\n  Object.values(ui.windows).forEach((w) => {\n    if (w instanceof SpecialsConfig) {\n      w.render(false);\n    }\n  });\n});\n\nHooks.on(\"renderDrawingHUD\", (hud, html, data) => {\n  const maskToggle = document.createElement(\"div\");\n  maskToggle.classList.add(\"control-icon\");\n  if (data?.flags?.fxmaster?.masking) {\n    maskToggle.classList.add(\"active\");\n  }\n  maskToggle.setAttribute(\"title\", game.i18n.localize(\"FXMASTER.MaskWeather\"));\n  maskToggle.dataset.action = \"mask\";\n  maskToggle.innerHTML = \"<i class='fas fa-cloud'></i>\";\n  html.find(\".col.left\").append(maskToggle);\n\n  html.find(\".control-icon[data-action='mask']\").click(async () => {\n    await hud.object.document.setFlag(\"fxmaster\", \"masking\", !data?.flags?.fxmaster?.masking);\n    hud.render(true);\n  });\n});\n\nregisterGetSceneControlButtonsHook();\n","export const registerHelpers = function () {\n  Handlebars.registerHelper(\"parameter\", (effectCls, parameterConfig, parameterName, options = {}) => {\n    const _default = options[parameterName] ?? effectCls.default[parameterName];\n\n    switch (parameterConfig.type) {\n      case \"color\":\n        return `\n              <input type=\"checkbox\" name=\"${effectCls.label}_${parameterName}_apply\" ${\n          _default.apply ? \"checked\" : \"\"\n        }/>\n              <input type=\"color\" name=\"${effectCls.label}_${parameterName}\" value=\"${_default.value}\">\n              `;\n      case \"range\":\n        return `\n              <input type=\"range\" step=\"${parameterConfig.step}\" min=\"${parameterConfig.min}\" max=\"${parameterConfig.max}\" name=\"${effectCls.label}_${parameterName}\" value=\"${_default}\">\n              <span class=\"range-value\">${_default}</span>\n              `;\n      case \"number\":\n        return `\n              <input type=\"text\" data-dtype=\"Number\" name=\"${effectCls.label}_${parameterName}\" value=\"${_default}\">\n              `;\n      case \"multi-select\":\n        return `<select class=\"multi-select\" multiple name=\"${effectCls.label}_${parameterName}\">${Object.entries(\n          parameterConfig.options,\n        ).map(\n          ([key, name]) =>\n            `<option value=\"${key}\"${_default.includes(key) ? \" selected\" : \"\"}>${game.i18n.localize(name)}</option>`,\n        )}</select>`;\n    }\n    return \"\";\n  });\n};\n"],"names":["packageId","getLoggingFunction","type","log","console","data","logger","Object","freeze","debug","info","warn","error","resetFlags","document","flaglabel","newFlags","oldFlags","getFlag","keys","forEach","k","setFlag","formatString","format","args","replace","match","number","isV9OrLater","game","release","generation","roundToDecimals","decimals","Number","Math","round","async","migrate","migrateClient","migration","settings","get","set","ui","notifications","permanent","localize","isError","migrateClient0to1","effects","i","length","scale","x","y","user","isGM","migrateWolrd","migrateWorld1to2","migrateScene","scene","weatherEffects","newWeatherEffects","fromEntries","entries","map","id","effect","weatherEffectClass","CONFIG","fxmaster","weather","options","convertOptionsToV2","scenes","name","e","migrateSceneCompendium","pack","metadata","entity","wasLocked","locked","configure","getDocuments","collection","packs","package","isOnTargetMigration","executeWhenWorldIsMigratedToLatest","callback","worldMigrationCallbacks","push","onWorldMigrated","debouncedReload","foundry","utils","debounce","window","location","reload","onSwitchWeather","parameters","canvas","newEffect","flags","hasProperty","mergeObject","unsetFlag","onUpdateWeather","parametersArray","randomID","deprecationFormatString","onSwitchWeatherDeprecated","v2Parameters","onUpdateWeatherDeprecated","v2ParametersArray","AbstractWeatherEffect","SpecialEffect","label","min","value","max","step","direction","this","startRotation","speed","lifetime","density","tint","apply","default","parameterName","parameterConfig","effectOptions","optionTypeMapping","color","OPTION_TYPES","VALUE","range","RANGE","applyOptionsToConfig","config","_applyScaleToConfig","_applySpeedToConfig","_applyDirectionToConfig","_applyLifetimeToConfig","_applyTintToConfig","_applyFactorToBasicTweenableOrValueListOrRandNumber","basicTweenableOrValueListOrRandNumber","factor","start","end","list","valueStep","dimensions","size","lifeTime","frequency","undefined","time","timeout","emitterPromises","emitters","emitter","Promise","resolve","emitterLifetime","playOnceAndDestroy","promises","all","setTimeout","race","stop","static","optionKey","optionValue","_convertScaleToV2","_convertSpeedToV2","_convertDensityToV2","speeds","maximumSpeed","d","width","height","BubblesWeatherEffect","icon","super","getParticleEmitters","_getBubbleEmitter","parent","p","constructor","spawnRect","sceneRect","w","h","maxParticles","inplace","PIXI","particles","Emitter","DEFAULT_CONFIG","alpha","minimumScaleMultiplier","minimumSpeedMultiplier","rotationSpeed","blendMode","CloudsWeatherEffect","_getCloudEmitter","offsetFactor","averageDiagonalTime","sqrt","minLifetime","maxLifetime","angle","toRadians","directionVector","cos","sin","isStepped","EmbersWeatherEffect","_getEmbersEmitter","startColor","ParticleUtils","createSteppedGradient","CrowsWeatherEffect","_getCrowsEmitter","framerate","textures","texture","count","loop","particleConstructor","AnimatedParticle","BatsWeatherEffect","_getBatsEmitter","FogWeatherEffect","_getFogEmitter","RaintopWeatherEffect","_getEmitter","sceneRadius","sceneWidth","sceneHeight","spawnType","spawnCircle","r","minR","RainSimpleWeatherEffect","_getRainEmitter","SnowstormWeatherEffect","_getSnowEmitter","PathParticle","extraData","path","BirdsWeatherEffect","animations","glide","flap","mixed","textureNumber","Array","fill","deepFlatten","getAnim","animation","textureFormatString","anims","filter","includes","StarsWeatherEffect","RainWeatherEffect","noRotation","_getSplashEmitter","SPLASH_CONFIG","SnowWeatherEffect","AutumnLeavesWeatherEffect","rotation","_getLeafEmitter","sprites","fromRange","n","SpiderWeatherEffect","_getSpidersEmitter","anim_sheet","String","padStart","EaglesWeatherEffect","_textures","_initializeTextures","_textureCache","spriteSheetTexture","Texture","from","spriteSheetData","meta","frames","frame","rotated","trimmed","spriteSourceSize","sourceSize","Spritesheet","parse","values","weatherDB","snowstorm","bubbles","clouds","embers","rainsimple","stars","crows","bats","spiders","fog","raintop","birds","leaves","rain","snow","eagles","FXColorFilter","filters","AdjustmentFilter","enabled","skipFading","faIcon","saturation","contrast","brightness","gamma","zeros","red","green","blue","opts","colors","hexToRGB","colorStringToHex","applyOptions","key","animateOptions","duration","anim","reduce","arr","attribute","to","CanvasAnimation","animateLinear","play","finally","FXUnderwaterFilter","DisplacementFilter","dizzyMap","Sprite","speedConfig","baseTexture","wrapMode","WRAP_MODES","REPEAT","anchor","maskSprite","background","addChild","defaults","removeChild","FXCanvasAnimation","attributes","context","ontick","ease","a","delta","done","remaining","stage","_animatePromise","_animateFrameSmooth","deltaTime","reject","complete","dt","TARGET_FPMS","da","abs","progress","err","easeFunctions","Linear","easeLinear","InSine","easeInSine","PI","OutSine","easeOutSine","InOutSine","easeInOutSine","InBack","easeInBack","c1","OutBack","easeOutBack","pow","InOutBack","easeInOutBack","c2","InCubic","easeInCubic","OutCubic","easeOutCubic","InOutCubic","easeInOutCubic","InCirc","easeInCirc","OutCirc","easeOutCirc","InOutCirc","easeInOutCirc","FXLightningFilter","next","app","ticker","lastTime","spark_duration","random","animate","target","animateSmooth","then","merged","FXPredatorFilter","CRTFilter","vignetting","curvature","noise","period","seed","FXOldFilmFilter","OldFilmFilter","vignettingAlpha","sepia","FXBloomFilter","AdvancedBloomFilter","blur","bloomScale","threshold","terminateAnimation","FXMASTER","lightning","underwater","predator","bloom","oldfilm","specials","file","author","Graphics","LegacyGraphics","WeatherLayer","CanvasLayer","_sceneMask","_sceneMaskFilter","layerOptions","zIndex","shouldMaskToScene","img","_createInvertedMask","mask","drawings","placeables","drawing","beginFill","shape","geometry","graphicsData","clone","CONST","DRAWING_TYPES","ELLIPSE","center","drawShape","POLYGON","FREEHAND","points","acc","v","drawPolygon","endFill","_createMask","rect","beginHole","endHole","updateMask","destroy","Hooks","callAll","fx","tearDown","_draw","bind","_drawSceneMask","_createSceneMaskFilter","drawWeather","soft","Container","stopPromise","fadeOut","optionName","cachedContainer","CachedContainer","intersectRectangles","b","outRect","Rectangle","x0","x1","right","y0","y1","bottom","sceneMaskFilter","InverseOcclusionMaskFilter","create","alphaOcclusion","uMaskSampler","renderTexture","_setLayerMask","_createInvertMask","FilterManager","filterInfos","_ticker","filteredLayers","foreground","tokens","update","add","_animate","filterInfo","filtersToCreate","filtersToUpdate","filtersToDelete","deletePromises","layer","_removeFilterFromContainer","applyFiltersToLayers","layerName","filtered","otherFilters","f","concat","container","dump","rmFilter","removeFilter","addFilter","filterInfoArray","apply_to","filterManager","SpecialCreate","FormApplication","defaultOptions","classes","closeOnSubmit","submitOnChange","submitOnClose","popOut","editable","template","title","i18n","setDefault","object","getData","eases","folder","position","animationDelay","preset","activateListeners","html","find","on","event","_onChangeRange","_","formData","fxs","newData","parseFloat","SpecialsConfig","Application","resizable","dragDrop","dragSelector","folders","userSpecials","click","currentTarget","closest","items","$","classList","remove","parentElement","render","hover","ev","folderId","dataset","effectId","findIndex","splice","c","children","_toggleFolder","hasClass","removeClass","addClass","_onDragStart","effectData","dataTransfer","setData","JSON","stringify","SpecialsLayer","videos","_dragging","ruler","windowVisible","socket","playVideo","draw","visible","video","_configureProjectile","vidSprite","distance","deltaX","deltaY","animationDuration","_configureRotate","_configureSprite","normalizeRadians","keepAspect","aspectRatio","playbackRate","createElement","preload","crossOrigin","src","oncanplay","videoWidth","videoHeight","onerror","onended","drawSpecialToward","tok1","tok2","origin","ray","Ray","emit","drawFacing","_drawSpecial","savedOrigin","stopPropagation","effectConfig","windows","active","element","deepClone","destination","mode","action","grid","_onDragLeftDrop","u","hypot","acos","clear","_onDragLeftStart","_isWindowVisible","_onDragLeftMove","lineStyle","drawCircle","A","moveTo","lineTo","B","_onClickLeft","WeatherConfig","currentEffects","activeEffects","_onWeatherCollapse","li","parents","expanded","_collapse","collapse","ol","slideUp","slideDown","weathersDB","weatherCls","weatherName","parameter","FiltersConfig","currentFilters","activeFilters","_onFilterCollapse","filtersDB","filterCls","filterName","defaultMacroImg","saveWeatherAndFiltersAsMacro","weatherFlags","filterFlags","filterEffects","getMacroNameAndImg","weatherLabelsAndIcons","flatMap","weatherEffectCls","filterLabels","filterEffectCls","commands","command","join","Macro","getSceneControlButtons","controls","role","tools","onClick","button","invert","toggle","Dialog","confirm","content","yes","removeAll","defaultYes","libWrapper","TGT_SPLIT_RE","RegExp","TGT_CLEANUP_RE","getWrapper","method","wrapped","call","activeLayer","registerWrappers","registerCanvasWrappers","methods","register","parseSpecialEffects","cur","normalizedFolder","toLowerCase","sort","localeCompare","once","globalThis","is_fallback","WRAPPER","MIXED","OVERRIDE","package_id","fn","chain","is_setter","endsWith","split","slice","root_nm","obj","fn_name","_eval","eval","pop","iObj","descriptor","getOwnPropertyDescriptor","getPrototypeOf","configurable","Error","original","wrapper","toUpperCase","defineProperty","PACKAGE_ID","PACKAGE_TITLE","import","url","stack","dirs","world","system","modules","has","FALLBACK_MESSAGE_TITLE","FALLBACK_MESSAGE","DONT_REMIND_AGAIN_KEY","Boolean","scope","buttons","ok","dont_remind","onChange","hint","USER_ROLES","ASSISTANT","choices","PLAYER","TRUSTED","GAMEMASTER","registerLayer","Canvas","layers","layerClass","group","Handlebars","registerHelper","effectCls","_default","activate","vid","addEventListener","tileData","hidden","occlusion","overHead","tileSize","autoplay","volume","z","createEmbeddedDocuments","hotbar","macroCommand","_createMacro","hud","maskToggle","masking","setAttribute","innerHTML","append","registerGetSceneControlButtonsHook"],"mappings":"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"}