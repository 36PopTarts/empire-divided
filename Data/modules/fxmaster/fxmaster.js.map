{"version":3,"file":"fxmaster.js","sources":["../src/constants.js","../src/utils.js","../src/logger.js","../src/migration/helpers.js","../src/migration/world/2.js","../src/migration/world/3.js","../src/migration/world/4.js","../src/migration/world/migration.js","../src/migration/client/1.js","../src/migration/client/migration.js","../src/migration/migration.js","../src/settings.js","../src/hooks.js","../src/filter-effects/filters/mixins/filter.js","../src/filter-effects/filters/mixins/fading-filter.js","../src/filter-effects/filters/bloom.js","../src/filter-effects/filters/color.js","../src/filter-effects/filters/fog.js","../src/ease.js","../src/filter-effects/filters/lightning.js","../src/filter-effects/filters/old-film.js","../src/filter-effects/filters/predator.js","../src/filter-effects/filters/underwater.js","../src/filter-effects/filter-effects-db.js","../src/particle-effects/effects/effect.js","../src/particle-effects/effects/mixins/default-retangle-spawn.js","../src/particle-effects/effects/spiders.js","../src/particle-effects/effects/helpers/with-stepped-gradient-color.js","../src/particle-effects/effects/stars.js","../src/particle-effects/effects/leaves.js","../src/particle-effects/effects/bats.js","../src/particle-effects/effects/bubbles.js","../src/particle-effects/effects/clouds.js","../src/particle-effects/effects/crows.js","../src/particle-effects/effects/eagles.js","../src/particle-effects/effects/fog.js","../src/particle-effects/effects/rats.js","../src/particle-effects/effects/snowstorm.js","../src/particle-effects/particle-effects-db.js","../src/config.js","../src/particle-effects/effects/birds.js","../src/particle-effects/effects/embers.js","../src/particle-effects/effects/rain.js","../src/particle-effects/effects/rain-top.js","../src/particle-effects/effects/rain-simple.js","../src/particle-effects/effects/snow.js","../src/special-effects/special-effects-db.js","../src/particle-effects/particle-effects-layer.js","../src/particle-effects/drawings-mask.js","../src/filter-effects/filter-manager.js","../src/special-effects/applications/special-effect-config.js","../src/special-effects/applications/special-effects-management.js","../src/special-effects/mesh.js","../src/special-effects/special-effects-layer.js","../src/base-form.js","../src/particle-effects/applications/particle-effects-management.js","../src/filter-effects/applications/filter-effects-management.js","../src/macro.js","../src/controls.js","../src/fxmaster.js","../src/handlebars-helpers.js"],"sourcesContent":["export const packageId = \"fxmaster\";\n","import { packageId } from \"./constants.js\";\n\n/**\n * Reset a flag to a given value, replacing inner objects.\n * @param {foundry.abstract.Document} document The document on which to reset the flag\n * @param {string}                    key      The flag key\n * @param {*}                         value    The flag value\n * @return {Promise<Document>}  A Promise resolving to the updated document\n */\nexport function resetFlag(document, key, value) {\n  if (typeof value === \"object\" && !Array.isArray(value) && value !== null) {\n    const oldFlags = document.getFlag(packageId, key);\n    const keys = oldFlags ? Object.keys(oldFlags) : [];\n    keys.forEach((k) => {\n      if (value[k]) return;\n      value[`-=${k}`] = null;\n    });\n  }\n  return document.setFlag(packageId, key, value);\n}\n\n/**\n * Round a number to the given number of decimals.\n * @param {number} number   The number to round\n * @param {number} decimals The number of decimals to round to\n * @returns {number} The rounded result\n */\nexport function roundToDecimals(number, decimals) {\n  return Number(Math.round(number + \"e\" + decimals) + \"e-\" + decimals);\n}\n\n/**\n * Omit a specific key from an object.\n * @param {object} object The object from which to omit\n * @param {string|number|symbol} key The key to omit\n * @returns {object} The object without the given key.\n */\nexport function omit(object, key) {\n  const { [key]: _omitted, ...rest } = object;\n  return rest;\n}\n","const loggingContext = \"FXMaster\";\nconst loggingSeparator = \"|\";\n\n/**\n * Gets a logging function for the requested log level.\n * @typedef {'debug' | 'info' | 'warn' | 'error'} LogLevel\n * @typedef {(...args: unknown[]) => void} LoggingFunction\n * @param {LogLevel} [type = 'info'] - The log level of the requested logger\n * @returns {LoggingFunction}\n */\nfunction getLoggingFunction(type = \"info\") {\n  const log = console[type];\n  return (...data) => log(loggingContext, loggingSeparator, ...data);\n}\n\n/**\n * Format a message for logging.\n * @param {string} msg The message to format for logging.\n */\nexport function format(msg) {\n  return `${loggingContext} ${loggingSeparator} ${msg}`;\n}\n\n/**\n * A singleton logger object.\n */\nexport const logger = Object.freeze({\n  debug: getLoggingFunction(\"debug\"),\n  info: getLoggingFunction(\"info\"),\n  warn: getLoggingFunction(\"warn\"),\n  error: getLoggingFunction(\"error\"),\n  getLoggingFunction,\n});\n","import { logger } from \"../logger.js\";\n\n/**\n * Migrate a world collection.\n * @param {WorldCollection} collection The world collection to migrate\n * @param {(document: Document) => Promise<void>} migrateDocument The function to use for updating a single document\n * @returns {Promise<boolean>} Whether or not there was an error during the migration\n */\nexport async function migrateWorldCollection(collection, migrateDocument) {\n  let isError = false;\n\n  for (const document of collection) {\n    logger.debug(`Migrating ${collection.documentName} '${document.name}' (${document.id}).`);\n    try {\n      await migrateDocument(document);\n    } catch (e) {\n      logger.error(`Migration of ${collection.documentName} '${document.name}' (${document.id}) failed.`, e);\n      isError = true;\n    }\n  }\n\n  return isError;\n}\n\n/**\n * Migrate a compendium pack.\n * @param {CompendiumCollection} pack The compendium pack to migrate\n * @param {(document: Document) => Promise<void>} migrateDocument The function to use for updating a single document\n * @returns {Promise<boolean>} Whether or not there was an error during the migration\n */\nexport async function migrateCompendiumCollection(pack, migrateDocument) {\n  let isError = false;\n\n  const type = pack.metadata.type;\n\n  const wasLocked = pack.locked;\n  await pack.configure({ locked: false });\n\n  const documents = await pack.getDocuments();\n\n  for (const document of documents) {\n    logger.debug(`Migrating ${type} '${document.name}' (${document.id}) in compendium ${pack.collection}.`);\n    try {\n      await migrateDocument(document);\n    } catch (e) {\n      logger.error(\n        `Migration of ${type} '${document.name}' (${document.id}) in compendium ${pack.collection} failed.`,\n        e,\n      );\n      isError = true;\n    }\n  }\n\n  await pack.configure({ locked: wasLocked });\n\n  return isError;\n}\n\n/** @typedef {Record<string, (document: Document) => Promise<void>} MigrationConfiguration */\n\n/**\n * Migrate the given world collections according to the given migration configuration.\n * @param {Iterable<WorldCollection>} collections            The world collections to migrate\n * @param {MigrationConfiguration}    migrationConfiguration The configuration for the migration\n * @returns {Promise<boolean>} Whether or not there was an error during the migration\n */\nexport async function migrateWorldCollections(collections, migrationConfiguration) {\n  let isError = false;\n\n  for (const collection of collections) {\n    const type = collection.documentName;\n    if (!(type in migrationConfiguration)) {\n      continue;\n    }\n    isError |= await migrateWorldCollection(collection, migrationConfiguration[type]);\n  }\n\n  return isError;\n}\n\n/** @typedef {{migrateNonWorldPacks?: boolean}} MigrateCompendiumCollectionsOptions */\n\n/**\n * Migrate the given compoendium packs according to the given migration configuration.\n * @param {Iterable<CompendiumCollection>}      collections            The compendium packs to migrate\n * @param {MigrationConfiguration}              migrationConfiguration The configuration for the migration\n * @param {MigrateCompendiumCollectionsOptions} [options={}]           Additional options for the migration\n * @returns {Promise<boolean>} Whether or not there was an error during the migration\n */\nexport async function migrateCompendiumCollections(\n  packs,\n  migrationConfiguration,\n  { migrateNonWorldPacks = false } = {},\n) {\n  let isError = false;\n\n  for (const pack of packs) {\n    const type = pack.metadata.type;\n    if ((pack.metadata.package !== \"world\" && !migrateNonWorldPacks) || !(type in migrationConfiguration)) {\n      continue;\n    }\n    isError |= await migrateCompendiumCollection(pack, migrationConfiguration[type]);\n  }\n\n  return isError;\n}\n\n/**\n * Perform a migration for the given migration configuration.\n * @param {MigrationConfiguration} migrationConfiguration The configuration for the migration\n * @returns {Promise<boolean>} Whether or not there was an error during the migration\n */\nexport async function migrate(migrationConfiguration) {\n  let isError = false;\n  isError |= await migrateWorldCollections(game.collections, migrationConfiguration);\n  isError |= await migrateCompendiumCollections(game.packs, migrationConfiguration);\n  return isError;\n}\n","import { packageId } from \"../../constants.js\";\nimport { resetFlag } from \"../../utils.js\";\nimport { migrate } from \"../helpers.js\";\n\nexport async function migrate2() {\n  return migrate(migrationConfiguration2);\n}\n\n/** @type {import('../helpers.js').MigrationConfiguration} */\nexport const migrationConfiguration2 = {\n  Scene: migrateScene,\n};\n\nasync function migrateScene(scene) {\n  const particleEffects = scene.getFlag(packageId, \"effects\") ?? {};\n  if (Object.keys(particleEffects).length > 0) {\n    const newParticleEffects = Object.fromEntries(\n      Object.entries(particleEffects).map(([id, effect]) => {\n        const particleEffectClass = CONFIG.fxmaster.particleEffects[effect.type];\n        return [id, { ...effect, options: particleEffectClass.convertOptionsToV2(effect.options, scene) }];\n      }),\n    );\n    await resetFlag(scene, \"effects\", newParticleEffects);\n  }\n}\n","import { packageId } from \"../../constants.js\";\nimport { migrate } from \"../helpers.js\";\n\nexport async function migrate3() {\n  return migrate(migrationConfiguration3);\n}\n\n/** @type {import('../helpers.js').MigrationConfiguration} */\nexport const migrationConfiguration3 = {\n  Macro: migrateMacro,\n  Scene: migrateScene,\n};\n\nasync function migrateMacro(macro) {\n  /** @type {{command: string, img: string | null}} */\n  const { command, img } = macro;\n\n  const newCommand = command\n    ?.replaceAll(`${packageId}.updateWeather`, `${packageId}.updateParticleEffects`)\n    .replaceAll(`updateWeather`, `${packageId}.updateParticleEffects`)\n    .replaceAll(`${packageId}.switchWeather`, `${packageId}.switchParticleEffect`)\n    .replaceAll(`switchWeather`, `${packageId}.switchParticleEffect`)\n    .replaceAll(\"fxmaster/assets/specialEffects\", \"fxmaster/assets/special-effects\")\n    .replaceAll(\n      \"fxmaster/assets/special-effects/fxmaster/smokeBomb.webm\",\n      \"fxmaster/assets/special-effects/fxmaster/smoke-bomb.webm\",\n    );\n\n  const newImg = img?.replaceAll(\"fxmaster/assets/weatherEffects/icons\", \"fxmaster/assets/particle-effects/icons\");\n\n  if (newCommand !== command || newImg !== img) {\n    await macro.update({ command: newCommand, img: newImg });\n  }\n}\n\nasync function migrateScene(scene) {\n  if (scene.getFlag(packageId, \"filteredLayers\") !== undefined) {\n    await scene.unsetFlag(packageId, \"filteredLayers\");\n  }\n}\n","import { migrate } from \"../helpers\";\n\nexport async function migrate4() {\n  return migrate(migrationConfiguration4);\n}\n\n/** @type {import('../helpers').MigrationConfiguration} */\nexport const migrationConfiguration4 = {\n  Scene: migrateScene,\n};\n\nasync function migrateScene(scene) {\n  const originalWeatherEffectKeys = Object.keys(CONFIG.originalWeatherEffects);\n  const weatherEffectsToMigrate = Object.keys(CONFIG.fxmaster.particleEffects).filter(\n    (effect) => !originalWeatherEffectKeys.includes(effect), // only migrate effects where we are certain they are ours\n  );\n\n  if (weatherEffectsToMigrate.includes(scene.weather)) {\n    await scene.update({ weather: `fxmaster.${scene.weather}` });\n  }\n}\n","/* eslint-disable no-fallthrough */\nimport { packageId } from \"../../constants.js\";\nimport { migrate2, migrationConfiguration2 } from \"./2.js\";\nimport { migrate3, migrationConfiguration3 } from \"./3.js\";\nimport { migrate4, migrationConfiguration4 } from \"./4.js\";\n\nexport const targetServerMigration = 4;\n\nexport async function migrateWorld() {\n  const migration = game.settings.get(packageId, \"migration\");\n  if (migration === -1) {\n    return game.settings.set(packageId, \"migration\", targetServerMigration);\n  }\n\n  if (migration < targetServerMigration) {\n    ui.notifications.info(\"FXMASTER.MigrationWorldStart\", { localize: true, permanent: true });\n    let isError = false;\n\n    switch (migration) {\n      case 0:\n      case 1:\n        isError |= await migrate2();\n      case 2:\n        isError |= await migrate3();\n      case 3:\n        isError |= await migrate4();\n    }\n\n    if (isError) {\n      await game.settings.set(packageId, \"disableAll\", true);\n      ui.notifications.error(\"FXMASTER.MigrationWorldCompletedWithErrors\", { localize: true, permanent: true });\n    } else {\n      ui.notifications.info(\"FXMASTER.MigrationWorldCompletedSuccessfully\", { localize: true, permanent: true });\n    }\n    await game.settings.set(packageId, \"migration\", targetServerMigration);\n  }\n}\n\nexport function isOnTargetWorldMigration() {\n  return game.settings.get(packageId, \"migration\") === targetServerMigration;\n}\n\nexport const worldMigrations = {\n  2: {\n    migrate: migrate2,\n    config: migrationConfiguration2,\n  },\n  3: {\n    migrate: migrate3,\n    config: migrationConfiguration3,\n  },\n  4: {\n    migrate: migrate4,\n    config: migrationConfiguration4,\n  },\n};\n","import { packageId } from \"../../constants.js\";\n\nexport async function migrate1() {\n  const effects = game.settings.get(packageId, \"specialEffects\");\n  for (let i = 0; i < effects.length; ++i) {\n    if (typeof effects[i].scale !== \"object\") {\n      effects[i].scale = {\n        x: effects[i].scale,\n        y: effects[i].scale,\n      };\n    }\n  }\n  await game.settings.set(packageId, \"specialEffects\", effects);\n  return false;\n}\n","import { packageId } from \"../../constants.js\";\nimport { migrate1 } from \"./1.js\";\n\nexport const targetClientMigration = 1;\n\nexport async function migrateClient() {\n  const migration = game.settings.get(packageId, \"clientMigration\");\n  if (migration === -1) {\n    return game.settings.set(packageId, \"clientMigration\", targetClientMigration);\n  }\n\n  if (migration < targetClientMigration) {\n    ui.notifications.info(\"FXMASTER.MigrationClientStart\", { permanent: true, localize: true });\n    let isError = false;\n\n    switch (migration) {\n      case 0:\n        isError |= await migrate1();\n    }\n\n    if (isError) {\n      ui.notifications.error(\"FXMASTER.MigrationClientCompletedWithErrors\", { localize: true, permanent: true });\n    } else {\n      ui.notifications.info(\"FXMASTER.MigrationClientCompletedSuccessfully\", { localize: true, permanent: true });\n    }\n    await game.settings.set(packageId, \"clientMigration\", targetClientMigration);\n  }\n}\n\nexport function isOnTargetClientMigration() {\n  return game.settings.get(packageId, \"clientMigration\") === targetClientMigration;\n}\n\nexport const clientMigrations = {\n  1: {\n    migrate: migrate1,\n  },\n};\n","import { isOnTargetWorldMigration, migrateWorld, worldMigrations } from \"./world/migration.js\";\nimport { clientMigrations, isOnTargetClientMigration, migrateClient } from \"./client/migration.js\";\nimport * as helpers from \"./helpers.js\";\n\nexport async function migrate() {\n  await migrateClient();\n  if (game.user.isGM) {\n    await migrateWorld();\n  }\n}\n\nexport function isOnTargetMigration() {\n  return isOnTargetWorldMigration() && isOnTargetClientMigration();\n}\n\n/**\n * Schedule a callback to be executed as soon as the world has been migrated to the target migration. If it is on the\n * latest migration already, the callback is executed immediately. Callbacks are executed in the order in that they have\n * been registered.\n * @param {() => (Promise<void> | void)} callback A callback to execute when the world is migrated\n */\nexport function executeWhenWorldIsMigratedToLatest(callback) {\n  if (!isOnTargetWorldMigration()) {\n    worldMigrationCallbacks.push(callback);\n  } else {\n    callback();\n  }\n}\n\n/** @type {Array<() => (Promise<void> | void)>} */\nconst worldMigrationCallbacks = [];\n\nexport async function onWorldMigrated() {\n  if (isOnTargetWorldMigration()) {\n    while (worldMigrationCallbacks.length > 0) {\n      const callback = worldMigrationCallbacks.shift();\n      await callback();\n    }\n  }\n}\n\nexport const migration = { client: clientMigrations, world: worldMigrations, helpers };\n","import { packageId } from \"./constants.js\";\nimport { onWorldMigrated } from \"./migration/migration.js\";\n\nexport function registerSettings() {\n  game.settings.register(packageId, \"enable\", {\n    name: \"FXMASTER.Enable\",\n    default: true,\n    scope: \"client\",\n    type: Boolean,\n    config: true,\n    requiresReload: true,\n  });\n\n  game.settings.register(packageId, \"specialEffects\", {\n    name: \"specialEffects\",\n    default: [],\n    scope: \"world\",\n    type: Array,\n    config: false,\n  });\n\n  game.settings.register(packageId, \"migration\", {\n    name: \"migration\",\n    default: -1,\n    scope: \"world\",\n    type: Number,\n    config: false,\n    onChange: onWorldMigrated,\n  });\n\n  game.settings.register(packageId, \"clientMigration\", {\n    name: \"clientMigration\",\n    default: -1,\n    scope: \"client\",\n    type: Number,\n    config: false,\n  });\n\n  game.settings.register(packageId, \"permission-create\", {\n    name: \"FXMASTER.PermissionCreate\",\n    hint: \"FXMASTER.PermissionCreateHint\",\n    scope: \"world\",\n    config: true,\n    default: foundry.CONST.USER_ROLES.ASSISTANT,\n    type: Number,\n    choices: {\n      [foundry.CONST.USER_ROLES.PLAYER]: \"USER.RolePlayer\",\n      [foundry.CONST.USER_ROLES.TRUSTED]: \"USER.RoleTrusted\",\n      [foundry.CONST.USER_ROLES.ASSISTANT]: \"USER.RoleAssistant\",\n      [foundry.CONST.USER_ROLES.GAMEMASTER]: \"USER.RoleGamemaster\",\n    },\n    requiresReload: true,\n  });\n\n  game.settings.register(packageId, \"disableAll\", {\n    name: \"FXMASTER.DisableAll\",\n    hint: \"FXMASTER.DisableAllHint\",\n    default: false,\n    scope: \"world\",\n    type: Boolean,\n    config: true,\n  });\n}\n\nexport function isEnabled() {\n  return game.settings.get(packageId, \"enable\") && !game.settings.get(packageId, \"disableAll\");\n}\n","import { packageId } from \"./constants.js\";\nimport { format } from \"./logger.js\";\nimport { omit, resetFlag } from \"./utils.js\";\n\nexport const registerHooks = function () {\n  Hooks.on(`${packageId}.switchParticleEffect`, onSwitchParticleEffects);\n  Hooks.on(`${packageId}.updateParticleEffects`, onUpdateParticleEffects);\n  Object.keys(deprecations).forEach((hook) => Hooks.on(hook, onDeprecated(hook)));\n};\n\n/**\n * Handle a request to toggle named a particle effect in the current scene.\n * @param {{name: string, type: string, options: object}} parameters The parameters that define the named particle effect\n */\nasync function onSwitchParticleEffects(parameters) {\n  if (!canvas.scene) {\n    return;\n  }\n\n  const currentEffects = canvas.scene.getFlag(packageId, \"effects\") ?? {};\n  const shouldSwitchOff = parameters.name in currentEffects;\n  const effects = shouldSwitchOff\n    ? omit(currentEffects, parameters.name)\n    : { ...currentEffects, [parameters.name]: { type: parameters.type, options: parameters.options } };\n\n  if (Object.keys(effects).length == 0) {\n    await canvas.scene.unsetFlag(packageId, \"effects\");\n  } else {\n    resetFlag(canvas.scene, \"effects\", effects);\n  }\n}\n\n/**\n * Handle a request to set the particle effects in the current scene.\n * @param {Array<object>} parametersArray The array of parameters defining the effects to be activated\n */\nasync function onUpdateParticleEffects(parametersArray) {\n  const effects = Object.fromEntries(parametersArray.map((parameters) => [foundry.utils.randomID(), parameters]));\n  resetFlag(canvas.scene, \"effects\", effects);\n}\n\nconst deprecations = {\n  updateWeather: {\n    replacedBy: `${packageId}.updateParticleEffects`,\n    callback: onUpdateParticleEffects,\n  },\n  switchWeather: {\n    replacedBy: `${packageId}.switchParticleEffects`,\n    callback: onSwitchParticleEffects,\n  },\n  [`${packageId}.updateWeather`]: {\n    replacedBy: `${packageId}.updateParticleEffects`,\n    callback: onUpdateParticleEffects,\n  },\n  [`${packageId}.switchWeather`]: {\n    replacedBy: `${packageId}.switchParticleEffects`,\n    callback: onSwitchParticleEffects,\n  },\n};\n\nfunction onDeprecated(hook) {\n  return function (...args) {\n    const deprecation = deprecations[hook];\n    const msg = format(`The '${hook}' hook is deprecated in favor of the '${deprecation.replacedBy}' hook`);\n    foundry.utils.logCompatibilityWarning(msg, {\n      mod: foundry.CONST.COMPATIBILITY_MODES.WARNING,\n      since: \"FXMaster v3.0.0\",\n      until: \"FXMaster v4.0.0\",\n      stack: false,\n    });\n    deprecation.callback(...args);\n  };\n}\n","/**\n * A mixin which extends {@link PIXI.Filter} with some common behavior.\n * @param {PIXI.Filter} Base The base filter class which this mixin extends\n * @returns The extended filter class\n */\nexport function FXMasterFilterEffectMixin(Base) {\n  return class extends Base {\n    /**\n     * @param {object} options Additional options to configure the filter\n     * @param {string} id The id which identifies this filter instance\n     * @param  {...any} args Additional arguments to pass to the Base constructor\n     */\n    constructor(options, id, ...args) {\n      super(...args);\n      this.id = id;\n      this.enabled = false;\n      this.configure(options);\n      this.applyOptions(this.constructor.neutral);\n    }\n\n    /**\n     * The id which identifies this filter effect instance.\n     * @type {string}\n     */\n    id;\n\n    /**\n     * The current options for this filter effect.\n     * @type {object}\n     */\n    options;\n\n    /**\n     * A human-readable label for the filter effect. This can be a localization string.\n     * @type {string}\n     */\n    static label = \"FXMASTER.FilterEffect\";\n\n    /**\n     * A Font Awesome icon to display for this filter effect in the {@link FilterEffectsManagementConfig}.\n     * @type {string}\n     */\n    static icon = \"fas fa-filter\";\n\n    /**\n     * The set of parameters the filter effect supports.\n     * @type {object}\n     */\n    static get parameters() {\n      return {};\n    }\n\n    /**\n     * The default values for the parameters of this filter effect.\n     * @type {object}\n     */\n    static get default() {\n      return Object.fromEntries(\n        Object.entries(this.parameters).map(([parameterName, parameterConfig]) => [\n          parameterName,\n          parameterConfig.value,\n        ]),\n      );\n    }\n\n    /**\n     * The set of options for this filter effect that represent a neutral state.\n     */\n    static get neutral() {\n      return {};\n    }\n\n    /**\n     * Configure the options for this filter.\n     * @param {object | undefined} options The options to use\n     */\n    configure(options) {\n      if (!options) {\n        return;\n      }\n      this.options = { ...this.constructor.default, ...options };\n    }\n\n    /**\n     * The context on which options should be applied.\n     * @type {object}\n     */\n    get optionContext() {\n      return this;\n    }\n\n    /**\n     * Apply options to this filter effect, setting the corresponding properties on this effect itself.\n     * @param {object} options The options to apply\n     */\n    applyOptions(options = this.options) {\n      const keys = Object.keys(options);\n      for (const key of keys) {\n        this.optionContext[key] = options[key];\n      }\n    }\n\n    /**\n     * Play this filter.\n     * @param {object} _options Additional options to adjust the playing behavior\n     */\n    play(_options = {}) {\n      this.applyOptions();\n      this.enabled = true;\n    }\n\n    /**\n     * Stop this filter.\n     * @param {object} _options Additional options to adjust the stopping behavior\n     * @returns {Promise<boolean>} A promise that resolves to `true` once the stop operation has concluded or `false` if\n     *                             the operation was cancelled.\n     */\n    async stop(_options = {}) {\n      this.enabled = false;\n      this.applyOptions(this.constructor.neutral);\n      return true;\n    }\n\n    /**\n     * Perform a step in any potential animation this filter effect might have. This is called periodically by ticker.\n     */\n    async step() {}\n  };\n}\n","import { packageId } from \"../../../constants.js\";\nimport { FXMasterFilterEffectMixin } from \"./filter\";\n\n/**\n * @typedef {Object} AnimationOptions\n * @property {number} [duration=4000] The duration of the animation\n */\n\n/**\n * A mixin which extends {@link PIXI.Filter} with some common behavior and fading.\n * @param {PIXI.Filter} Base The base filter class which this mixin extends\n * @returns The extended filter class\n */\nexport function FadingFilterMixin(Base) {\n  return class extends FXMasterFilterEffectMixin(Base) {\n    /**\n     * The currently running animation, if any.\n     * @type {Promise<boolean> | undefined}\n     */\n    currentAnimation;\n\n    /** Has this filter already been initialized? */\n    initialized = false;\n\n    /**\n     * Apply options to this filter effect as an animation.\n     * @param {object} [options] The options to animate\n     * @param {AnimationOptions} [animationOptions={}] Additional options to adjust the animation behavior\n     */\n    async animateOptions(options = this.options, { duration = 4_000 } = {}) {\n      const name = `${packageId}.${this.constructor.name}.${this.id}`;\n      if (this.currentAnimation !== undefined) {\n        CanvasAnimation.terminateAnimation(name);\n        await this.currentAnimation;\n      }\n      const data = { name, duration };\n\n      const [toAnimate, toSet] = Object.entries(options)\n        .partition(([key]) => !!this.constructor.parameters[key]?.skipInitialAnimation && !this.initialized)\n        .map(Object.fromEntries);\n\n      this.applyOptions(toSet);\n\n      const anim = Object.entries(toAnimate).map(([key, value]) => ({\n        parent: this.optionContext,\n        attribute: key,\n        to: value,\n      }));\n      this.currentAnimation = CanvasAnimation.animate(anim, data).finally(() => (this.currentAnimation = undefined));\n      return this.currentAnimation;\n    }\n\n    /** @override */\n    play({ skipFading = false, ...otherOptions } = {}) {\n      if (skipFading) {\n        super.play({ skipFading, ...otherOptions });\n      } else {\n        this.enabled = true;\n        this.animateOptions();\n      }\n      this.initialized = true;\n    }\n\n    /** @override */\n    async stop({ skipFading = false, ...otherOptions } = {}) {\n      if (skipFading) {\n        return super.stop({ skipFading, ...otherOptions });\n      } else {\n        const completed = await this.animateOptions(this.constructor.neutral);\n        if (completed) {\n          this.enabled = false;\n        }\n        return completed;\n      }\n    }\n  };\n}\n","import { FadingFilterMixin } from \"./mixins/fading-filter.js\";\n\nexport class BloomFilter extends FadingFilterMixin(PIXI.filters.AdvancedBloomFilter) {\n  /** @override */\n  static label = \"FXMASTER.FilterEffectBloom\";\n\n  /** @override */\n  static icon = \"fas fa-ghost\";\n\n  /** @override */\n  static get parameters() {\n    return {\n      blur: {\n        label: \"FXMASTER.Blur\",\n        type: \"range\",\n        max: 10.0,\n        min: 0.0,\n        step: 1.0,\n        value: 1.0,\n      },\n      bloomScale: {\n        label: \"FXMASTER.Bloom\",\n        type: \"range\",\n        max: 1.0,\n        min: 0.0,\n        step: 0.1,\n        value: 0.1,\n      },\n      threshold: {\n        label: \"FXMASTER.Threshold\",\n        type: \"range\",\n        max: 1.0,\n        min: 0.0,\n        step: 0.1,\n        value: 0.5,\n      },\n    };\n  }\n\n  /** @override */\n  static get neutral() {\n    return {\n      noise: 0.0,\n      bloomScale: 0.0,\n      threshold: 1.0,\n    };\n  }\n}\n","import { FadingFilterMixin } from \"./mixins/fading-filter.js\";\n\nexport class ColorFilter extends FadingFilterMixin(PIXI.filters.AdjustmentFilter) {\n  /** @override */\n  static label = \"FXMASTER.FilterEffectColor\";\n\n  /** @override */\n  static icon = \"fas fa-palette\";\n\n  /** @override */\n  static get parameters() {\n    return {\n      color: {\n        label: \"FXMASTER.Tint\",\n        type: \"color\",\n        value: {\n          value: \"#FFFFFF\",\n          apply: false,\n        },\n      },\n      saturation: {\n        label: \"FXMASTER.Saturation\",\n        type: \"range\",\n        max: 2.0,\n        min: 0.0,\n        step: 0.1,\n        value: 1.0,\n      },\n      contrast: {\n        label: \"FXMASTER.Contrast\",\n        type: \"range\",\n        max: 2.0,\n        min: 0.0,\n        step: 0.1,\n        value: 1.0,\n      },\n      brightness: {\n        label: \"FXMASTER.Brightness\",\n        type: \"range\",\n        max: 2.0,\n        min: 0.0,\n        step: 0.1,\n        value: 1.0,\n      },\n      gamma: {\n        label: \"FXMASTER.Gamma\",\n        type: \"range\",\n        max: 2.0,\n        min: 0.0,\n        step: 0.1,\n        value: 1.0,\n      },\n    };\n  }\n\n  /** @override */\n  static get neutral() {\n    return {\n      red: 1,\n      green: 1,\n      blue: 1,\n      saturation: 1,\n      gamma: 1,\n      brightness: 1,\n      contrast: 1,\n    };\n  }\n\n  /** @override */\n  configure(options) {\n    if (!options) {\n      return;\n    }\n    const { color, ...otherOptions } = options;\n    const { r: red, g: green, b: blue } = foundry.utils.Color.from(color.apply ? color.value : 0xffffff);\n    super.configure({ ...otherOptions, red, green, blue });\n  }\n}\n","import fog from \"./shaders/fog.frag\";\nimport customVertex2D from \"./shaders/custom-vertex-2d.vert\";\nimport { FadingFilterMixin } from \"./mixins/fading-filter.js\";\n\nexport class FogFilter extends FadingFilterMixin(PIXI.Filter) {\n  constructor(options, id) {\n    super(options, id, customVertex2D, fog);\n    this.uniforms.time = 0.0;\n    this.uniforms.dimensions = new Float32Array([0.0, 0.0]);\n    this.uniforms.color = new Float32Array([0.0, 0.0, 0.0, 1.0]);\n  }\n\n  /** @type {number} */\n  lastTick;\n\n  /** @override */\n  static label = \"FXMASTER.FilterEffectFog\";\n\n  /** @override */\n  static icon = \"fas fa-cloud\";\n\n  /** @override */\n  static get parameters() {\n    return {\n      dimensions: {\n        label: \"FXMASTER.Scale\",\n        type: \"range\",\n        max: 5,\n        min: 0,\n        step: 0.1,\n        value: 1,\n        skipInitialAnimation: true,\n      },\n      speed: {\n        label: \"FXMASTER.Speed\",\n        type: \"range\",\n        max: 5,\n        min: 0,\n        step: 0.1,\n        value: 1,\n        skipInitialAnimation: true,\n      },\n      density: {\n        label: \"FXMASTER.Density\",\n        type: \"range\",\n        max: 1,\n        min: 0,\n        step: 0.05,\n        value: 0.65,\n      },\n      color: {\n        label: \"FXMASTER.Tint\",\n        type: \"color\",\n        value: {\n          value: \"#000000\",\n          apply: false,\n        },\n        skipInitialAnimation: true,\n      },\n    };\n  }\n\n  /** @override */\n  static get neutral() {\n    return {\n      density: 0,\n    };\n  }\n\n  /** @type {number} */\n  get r() {\n    return this.uniforms.color[0];\n  }\n  set r(value) {\n    this.uniforms.color[0] = value;\n  }\n\n  /** @type {number} */\n  get g() {\n    return this.uniforms.color[1];\n  }\n  set g(value) {\n    this.uniforms.color[1] = value;\n  }\n\n  /** @type {number} */\n  get b() {\n    return this.uniforms.color[2];\n  }\n  set b(value) {\n    this.uniforms.color[2] = value;\n  }\n\n  /** @type {number} */\n  get density() {\n    return this.uniforms.density;\n  }\n  set density(value) {\n    this.uniforms.density = value;\n  }\n\n  /** @type {number} */\n  get dimensions() {\n    return this.uniforms.dimensions[0];\n  }\n  set dimensions(value) {\n    this.uniforms.dimensions[0] = this.uniforms.dimensions[1] = (value * 100) / (canvas?.dimensions?.size ?? 100);\n  }\n\n  /** @override */\n  configure(options) {\n    if (!options) {\n      return;\n    }\n    const { color, ...otherOptions } = options;\n    const { r, g, b } = foundry.utils.Color.from(color.apply ? color.value : 0x000000);\n    super.configure({ ...otherOptions, r, g, b });\n  }\n\n  /** @override */\n  play(options) {\n    this.lastTick = canvas.app.ticker.lastTime;\n    super.play(options);\n  }\n\n  /** @override */\n  async step() {\n    const delta = canvas.app.ticker.lastTime - this.lastTick;\n    this.lastTick = canvas.app.ticker.lastTime;\n    this.uniforms.time += delta * this.speed * 0.1;\n    await super.step();\n  }\n\n  apply(filterManager, input, output, clear, currentState) {\n    this.uniforms.filterMatrix ??= new PIXI.Matrix();\n    this.uniforms.filterMatrix.copyFrom(currentState.target.worldTransform).invert();\n    return super.apply(filterManager, input, output, clear, currentState);\n  }\n}\n","export const easeFunctions = {\n  Linear: easeLinear,\n  InSine: easeInSine,\n  OutSine: easeOutSine,\n  InOutSine: easeInOutSine,\n  InBack: easeInBack,\n  OutBack: easeOutBack,\n  InOutBack: easeInOutBack,\n  InCubic: easeInCubic,\n  OutCubic: easeOutCubic,\n  InOutCubic: easeInOutCubic,\n  InCirc: easeInCirc,\n  OutCirc: easeOutCirc,\n  InOutCirc: easeInOutCirc,\n};\n\nexport function easeLinear(x) {\n  return x;\n}\n\nexport function easeInSine(x) {\n  return 1 - Math.cos((x * Math.PI) / 2);\n}\n\nexport function easeOutSine(x) {\n  return Math.sin((x * Math.PI) / 2);\n}\n\nexport function easeInOutSine(x) {\n  return -(Math.cos(Math.PI * x) - 1) / 2;\n}\n\nexport function easeInBack(x) {\n  const c1 = 1.70158;\n  const c3 = c1 + 1;\n  return c3 * x * x * x - c1 * x * x;\n}\n\nexport function easeOutBack(x) {\n  const c1 = 1.70158;\n  const c3 = c1 + 1;\n  return 1 + c3 * Math.pow(x - 1, 3) + c1 * Math.pow(x - 1, 2);\n}\n\nexport function easeInOutBack(x) {\n  const c1 = 1.70158;\n  const c2 = c1 * 1.525;\n  return x < 0.5\n    ? (Math.pow(2 * x, 2) * ((c2 + 1) * 2 * x - c2)) / 2\n    : (Math.pow(2 * x - 2, 2) * ((c2 + 1) * (x * 2 - 2) + c2) + 2) / 2;\n}\n\nexport function easeInCubic(x) {\n  return x * x * x;\n}\n\nexport function easeOutCubic(x) {\n  return 1 - Math.pow(1 - x, 3);\n}\n\nexport function easeInOutCubic(x) {\n  return x < 0.5 ? 4 * x * x * x : 1 - Math.pow(-2 * x + 2, 3) / 2;\n}\n\nexport function easeInCirc(x) {\n  return 1 - Math.sqrt(1 - Math.pow(x, 2));\n}\n\nexport function easeOutCirc(x) {\n  return Math.sqrt(1 - Math.pow(x - 1, 2));\n}\n\nexport function easeInOutCirc(x) {\n  return x < 0.5 ? (1 - Math.sqrt(1 - Math.pow(2 * x, 2))) / 2 : (Math.sqrt(1 - Math.pow(-2 * x + 2, 2)) + 1) / 2;\n}\n","import { packageId } from \"../../constants.js\";\nimport { easeFunctions } from \"../../ease.js\";\nimport { FXMasterFilterEffectMixin } from \"./mixins/filter.js\";\n\nexport class LightningFilter extends FXMasterFilterEffectMixin(PIXI.filters.AdjustmentFilter) {\n  constructor(options, id) {\n    super(options, id);\n    this.nextLigthningTime = canvas.app.ticker.lastTime / 10;\n  }\n\n  /**\n   * The time when the next lightning flash should appear.\n   * @type {number}\n   */\n  nextLigthningTime;\n\n  /** @override */\n  static label = \"FXMASTER.FilterEffectLightning\";\n\n  /** @override */\n  static icon = \"fas fa-bolt-lightning\";\n\n  /** @override */\n  static get parameters() {\n    return {\n      frequency: {\n        label: \"FXMASTER.Period\",\n        type: \"range\",\n        max: 2000,\n        min: 100,\n        step: 5,\n        value: 500,\n      },\n      spark_duration: {\n        label: \"FXMASTER.Duration\",\n        type: \"range\",\n        max: 2000,\n        min: 100,\n        step: 5,\n        value: 300,\n      },\n      brightness: {\n        label: \"FXMASTER.Brightness\",\n        type: \"range\",\n        max: 4.0,\n        min: 0.0,\n        step: 0.1,\n        value: 1.3,\n      },\n    };\n  }\n\n  /** @override */\n  static get neutral() {\n    return {\n      frequency: 0.0,\n      spark_duration: 0.0,\n      brightness: 1.0,\n    };\n  }\n\n  /** @override */\n  play(_options = {}) {\n    // explicitly not applying the options, since it would change the brightness immediately\n    this.enabled = true;\n  }\n\n  /** @override */\n  async step() {\n    if (canvas.app.ticker.lastTime / 10 > this.nextLigthningTime) {\n      this.nextLigthningTime = canvas.app.ticker.lastTime / 10 + 40 + this.options.frequency * Math.random();\n\n      const animate = (value) => {\n        const attributes = [\n          {\n            parent: this,\n            attribute: \"brightness\",\n            to: value,\n          },\n        ];\n        return CanvasAnimation.animate(attributes, {\n          name: `${packageId}.${this.constructor.name}.${this.id}.${randomID()}`,\n          context: this,\n          duration: 100 + this.options.spark_duration * Math.random(),\n          easing: easeFunctions.InOutBack,\n        });\n      };\n\n      await animate(this.options.brightness);\n      await animate(1);\n      await super.step();\n    }\n  }\n}\n","import { FXMasterFilterEffectMixin } from \"./mixins/filter.js\";\n\nexport class OldFilmFilter extends FXMasterFilterEffectMixin(PIXI.filters.OldFilmFilter) {\n  constructor(options, id) {\n    super(options, id);\n    this.vignetting = 0;\n    this.vignettingAlpha = 0;\n  }\n\n  /** @override */\n  static label = \"FXMASTER.FilterEffectOldFilm\";\n\n  /** @override */\n  static icon = \"fas fa-film\";\n\n  /** @override */\n  static get parameters() {\n    return {\n      sepia: {\n        label: \"FXMASTER.Sepia\",\n        type: \"range\",\n        max: 1.0,\n        min: 0.0,\n        step: 0.1,\n        value: 0.3,\n      },\n      noise: {\n        label: \"FXMASTER.Noise\",\n        type: \"range\",\n        max: 1.0,\n        min: 0.0,\n        step: 0.1,\n        value: 0.1,\n      },\n    };\n  }\n\n  /** @override */\n  static get neutral() {\n    return {\n      sepia: 0.0,\n      noise: 0.0,\n    };\n  }\n\n  /** @override */\n  play(options = {}) {\n    this.seed = Math.random();\n    super.play(options);\n  }\n\n  /** @override */\n  async step() {\n    this.seed = Math.random();\n    await super.step();\n  }\n}\n","import { FXMasterFilterEffectMixin } from \"./mixins/filter.js\";\n\nexport class PredatorFilter extends FXMasterFilterEffectMixin(PIXI.filters.CRTFilter) {\n  constructor(options, id) {\n    super(options, id);\n    this.vignetting = 0;\n    this.curvature = 0;\n  }\n\n  /** @override */\n  static label = \"FXMASTER.FilterEffectPredator\";\n\n  /** @override */\n  static icon = \"fas fa-wave-square\";\n\n  /** @override */\n  static get parameters() {\n    return {\n      noise: {\n        label: \"FXMASTER.Noise\",\n        type: \"range\",\n        max: 1.0,\n        min: 0,\n        step: 0.1,\n        value: 0.1,\n      },\n      period: {\n        label: \"FXMASTER.Speed\",\n        type: \"range\",\n        max: 0.1,\n        min: 0,\n        step: 0.001,\n        value: 0.001,\n      },\n      lineWidth: {\n        label: \"FXMASTER.LineWidth\",\n        type: \"range\",\n        max: 10,\n        min: 0,\n        step: 0.1,\n        value: 1,\n      },\n    };\n  }\n\n  /** @override */\n  static get neutral() {\n    return {\n      noise: 0,\n      period: 1000,\n    };\n  }\n\n  /** @override */\n  play(options = {}) {\n    this.seed = Math.random();\n    super.play(options);\n  }\n\n  /** @override */\n  async step() {\n    this.seed = Math.random();\n    const frequency = 1.0 / this.options.period;\n    this.time = canvas.app.ticker.lastTime / frequency;\n    await super.step();\n  }\n}\n","import { FXMasterFilterEffectMixin } from \"./mixins/filter.js\";\n\nexport class UnderwaterFilter extends FXMasterFilterEffectMixin(PIXI.filters.DisplacementFilter) {\n  constructor(options, id) {\n    const displacemenntMap = PIXI.Sprite.from(\n      \"modules/fxmaster/assets/filter-effects/effects/underwater/displacement-map.png\",\n    );\n    super(options, id, displacemenntMap);\n\n    this.displacementMap = displacemenntMap;\n    this.displacementMap.texture.baseTexture.wrapMode = PIXI.WRAP_MODES.REPEAT;\n    this.displacementMap.anchor.set(0.5);\n    this.displacementMap.x = canvas.scene.width / 2;\n    this.displacementMap.y = canvas.scene.height / 2;\n  }\n\n  /** @override */\n  static label = \"FXMASTER.FilterEffectUnderwater\";\n\n  /** @override */\n  static icon = \"fas fa-water\";\n\n  static get parameters() {\n    return {\n      speed: {\n        label: \"FXMASTER.Speed\",\n        type: \"range\",\n        max: 5.0,\n        min: 0.0,\n        step: 0.1,\n        value: 0.3,\n      },\n      scale: {\n        label: \"FXMASTER.Scale\",\n        type: \"number\",\n        value: 4.0,\n      },\n    };\n  }\n\n  /** @override */\n  static get neutral() {\n    return {\n      speed: 0,\n      scale: 1.0,\n    };\n  }\n\n  /** @override */\n  applyOptions() {\n    // explicitly do nothing because setting scale / speed on this breaks the DisplacementFilter\n  }\n\n  /** @override */\n  play(options = {}) {\n    this.displacementMap.scale.x = this.options.scale;\n    this.displacementMap.scale.y = this.options.scale;\n    canvas.primary.addChild(this.displacementMap);\n    super.play(options);\n  }\n\n  /** @override */\n  async stop(options = {}) {\n    await super.stop(options);\n    canvas.primary.removeChild(this.displacementMap);\n  }\n\n  /** @override */\n  async step() {\n    this.maskSprite.x += this.options.speed;\n    await super.step();\n  }\n}\n","import { BloomFilter } from \"./filters/bloom.js\";\nimport { ColorFilter } from \"./filters/color.js\";\nimport { FogFilter } from \"./filters/fog.js\";\nimport { LightningFilter } from \"./filters/lightning.js\";\nimport { OldFilmFilter } from \"./filters/old-film.js\";\nimport { PredatorFilter } from \"./filters/predator.js\";\nimport { UnderwaterFilter } from \"./filters/underwater.js\";\n\n/** @typedef {Record<string, PIXI.Filter} FilterEffects */\n\n/** @type {FilterEffects} */\nexport const filterEffects = {\n  bloom: BloomFilter,\n  color: ColorFilter,\n  fog: FogFilter,\n  lightning: LightningFilter,\n  oldfilm: OldFilmFilter,\n  predator: PredatorFilter,\n  underwater: UnderwaterFilter,\n};\n","import { roundToDecimals } from \"../../utils.js\";\n\n/**\n * An abstract base class for defining particle-based effects\n * @param {PIXI.Container} parent     The parent container within which the effect is rendered\n * @param {object} [options]          Options passed to the getParticleEmitters method which can be used to customize\n *                                    values of the emitter configuration.\n * @abstract\n */\nexport class FXMasterParticleEffect extends ParticleEffect {\n  /**\n   * A human-readable label for the particle effect. This can be a localization string.\n   * @type {string}\n   * @override\n   */\n  static label = \"FXMASTER.ParticleEffect\";\n\n  /**\n   * The weather effect group this effect belongs to.\n   * @type {string}\n   */\n  static get group() {\n    return \"other\";\n  }\n\n  /** @type {string} */\n  static get icon() {\n    return \"modules/fxmaster/assets/particle-effects/icons/snow.png\";\n  }\n\n  static get parameters() {\n    return {\n      scale: {\n        label: \"FXMASTER.Scale\",\n        type: \"range\",\n        min: 0.1,\n        value: 1,\n        max: 5,\n        step: 0.1,\n        decimals: 1,\n      },\n      direction: {\n        label: \"FXMASTER.Direction\",\n        type: \"range\",\n        min: 0,\n        value: this.defaultDirection,\n        max: 360,\n        step: 5,\n        decimals: 0,\n      },\n      speed: {\n        label: \"FXMASTER.Speed\",\n        type: \"range\",\n        min: 0.1,\n        value: 1,\n        max: 5,\n        step: 0.1,\n        decimals: 1,\n      },\n      lifetime: {\n        label: \"FXMASTER.Lifetime\",\n        type: \"range\",\n        min: 0.1,\n        value: 1,\n        max: 5,\n        step: 0.1,\n        decimals: 1,\n      },\n      density: {\n        label: \"FXMASTER.Density\",\n        type: \"range\",\n        min: 0.1,\n        value: 0.5,\n        max: 5,\n        step: 0.1,\n        decimals: 1,\n      },\n      alpha: {\n        label: \"FXMASTER.Opacity\",\n        type: \"range\",\n        min: 0,\n        value: 1,\n        max: 1,\n        step: 0.1,\n        decimals: 1,\n      },\n      tint: {\n        label: \"FXMASTER.Tint\",\n        type: \"color\",\n        value: {\n          value: \"#FFFFFF\",\n          apply: false,\n        },\n      },\n    };\n  }\n\n  /**\n   * Merge the given options with the default parameters.\n   */\n  static mergeWithDefaults(options) {\n    return foundry.utils.mergeObject(this.parameters, options, { insertKeys: false, inplace: false });\n  }\n\n  /**\n   * Return the default config for this effect.\n   * @abstract\n   * @returns {PIXI.particles.EmitterConfigV3}\n   */\n  static get defaultConfig() {\n    throw new Error(\"Subclasses of FXMasterParticleEffect must implement defaultConfig\");\n  }\n\n  static get defaultDirection() {\n    const rotationBehavior = this.defaultConfig.behaviors.find((behavior) => behavior.type === \"rotation\");\n\n    if (rotationBehavior !== undefined) {\n      return (rotationBehavior.config.minStart + rotationBehavior.config.maxStart) / 2;\n    }\n\n    const rotationStaticBehavior = this.defaultConfig.behaviors.find((behavior) => behavior.type === \"rotationStatic\");\n\n    if (rotationStaticBehavior !== undefined) {\n      return (rotationStaticBehavior.config.min + rotationStaticBehavior.config.max) / 2;\n    }\n\n    return undefined;\n  }\n\n  static get default() {\n    return Object.fromEntries(\n      Object.entries(this.parameters).map(([parameterName, parameterConfig]) => [parameterName, parameterConfig.value]),\n    );\n  }\n\n  applyOptionsToConfig(options, config) {\n    this._applyScaleToConfig(options, config);\n    this._applySpeedToConfig(options, config);\n    this._applyDirectionToConfig(options, config);\n    this._applyLifetimeToConfig(options, config);\n    this._applyTintToConfig(options, config);\n    this._applyAlphaToConfig(options, config);\n  }\n\n  /** @protected */\n  _applyFactorToValueList(valueList, factor) {\n    valueList.list = valueList.list.map((valueStep) => ({\n      ...valueStep,\n      value: valueStep.value * factor,\n    }));\n  }\n\n  /** @protected */\n  _applyFactorToRandNumber(randNumber, factor) {\n    randNumber.min = randNumber.min * factor;\n    randNumber.max = randNumber.max * factor;\n  }\n\n  /** @protected */\n  _applyScaleToConfig(options, config) {\n    const factor = (options.scale?.value ?? 1) * (canvas.dimensions.size / 100);\n\n    config.behaviors\n      .filter((behavior) => behavior.type === \"scale\")\n      .forEach(({ config }) => this._applyFactorToValueList(config.scale, factor));\n\n    config.behaviors\n      .filter((behavior) => behavior.type === \"scaleStatic\")\n      .forEach(({ config }) => this._applyFactorToRandNumber(config, factor));\n  }\n\n  /** @protected */\n  _applySpeedToConfig(options, config) {\n    const factor = (options.speed?.value ?? 1) * (canvas.dimensions.size / 100);\n\n    config.behaviors\n      .filter((behavior) => [\"moveSpeed\", \"movePath\"].includes(behavior.type))\n      .forEach(({ config }) => this._applyFactorToValueList(config.speed, factor));\n\n    config.behaviors\n      .filter((behavior) => behavior.type === \"moveSpeedStatic\")\n      .forEach(({ config }) => this._applyFactorToRandNumber(config, factor));\n\n    this._applyFactorToRandNumber(config.lifetime, 1 / factor);\n    config.frequency /= factor;\n  }\n\n  /** @protected */\n  _applyDirectionToConfig(options, config) {\n    const direction = options.direction?.value;\n    if (direction !== undefined) {\n      config.behaviors\n        .filter((behavior) => behavior.type === \"rotation\")\n        .forEach(({ config }) => {\n          const range = config.maxStart - config.minStart;\n          config.minStart = direction - range / 2;\n          config.maxStart = direction + range / 2;\n        });\n\n      config.behaviors\n        .filter((behavior) => behavior.type === \"rotationStatic\")\n        .forEach(({ config }) => {\n          const range = config.max - config.min;\n          config.min = direction - range / 2;\n          config.max = direction + range / 2;\n        });\n    }\n  }\n\n  /** @protected */\n  _applyLifetimeToConfig(options, config) {\n    const factor = options.lifetime?.value ?? 1;\n    this._applyFactorToRandNumber(config.lifetime, factor);\n    config.frequency *= factor;\n  }\n\n  /** @protected */\n  _applyTintToConfig(options, config) {\n    if (options.tint?.value.apply) {\n      const value = options.tint.value.value;\n      config.behaviors = config.behaviors\n        .filter(({ type }) => type !== \"color\" && type !== \"colorStatic\")\n        .concat({\n          type: \"colorStatic\",\n          config: {\n            color: value,\n          },\n        });\n    }\n  }\n\n  /** @protected */\n  _applyAlphaToConfig(options, config) {\n    const factor = options.alpha?.value ?? 1;\n\n    config.behaviors\n      .filter((behavior) => behavior.type === \"alpha\")\n      .forEach(({ config }) => this._applyFactorToValueList(config.alpha, factor));\n\n    config.behaviors\n      .filter((behavior) => behavior.type === \"alphaStatic\")\n      .forEach(({ config }) => {\n        config.alpha *= factor;\n      });\n  }\n\n  /** @override */\n  play({ prewarm = false } = {}) {\n    if (prewarm) {\n      this.emitters.forEach((emitter) => {\n        emitter.autoUpdate = false;\n        emitter.emit = true;\n        emitter.update(emitter.maxLifetime);\n        emitter.autoUpdate = true;\n      });\n    }\n    super.play();\n  }\n\n  /**\n   * Fade this effect out, playing it once and then stopping it.\n   * @param {{timeout?: number}} [options]         Additional options to configure the fade out\n   * @param {number}             [options.timeout] If given, the effect will be stopped after the given number in ms,\n   *                                               regardless of if it has finished playing or not.\n   * @returns {Promise<void>}                      A promise that resolves as soon as this effect has finished fading out\n   */\n  async fadeOut({ timeout } = {}) {\n    const emitterPromises = this.emitters.map(\n      (emitter) =>\n        new Promise((resolve) => {\n          emitter.emitterLifetime = 0.1;\n          emitter.playOnceAndDestroy(() => {\n            resolve();\n          });\n        }),\n    );\n    const promises = [Promise.all(emitterPromises)];\n    if (timeout !== undefined) {\n      promises.push(new Promise((resolve) => setTimeout(resolve, timeout)).then(this.destroy.bind(this)));\n    }\n\n    await Promise.race(promises);\n    this.stop();\n  }\n\n  static convertOptionsToV2(options, scene) {\n    return Object.fromEntries(\n      Object.entries(options).map(([optionKey, optionValue]) => {\n        switch (optionKey) {\n          case \"scale\": {\n            return [optionKey, this._convertScaleToV2(optionValue, scene)];\n          }\n          case \"speed\": {\n            return [optionKey, this._convertSpeedToV2(optionValue, scene)];\n          }\n          case \"density\": {\n            return [optionKey, this._convertDensityToV2(optionValue, scene)];\n          }\n          default: {\n            return [optionKey, optionValue];\n          }\n        }\n      }),\n    );\n  }\n\n  /** @protected */\n  static _convertScaleToV2(scale, scene) {\n    const decimals = this.parameters.scale?.decimals ?? 1;\n    return roundToDecimals(scale * (100 / scene.dimensions.size), decimals);\n  }\n\n  /** @protected */\n  static _convertSpeedToV2(speed, scene) {\n    const speeds = this.defaultConfig.behaviors\n      .filter(({ type }) => type === \"moveSpeed\")\n      .flatMap(({ config }) => config.speed.list.map((valueStep) => valueStep.value));\n    const maximumSpeed = Math.max(...speeds);\n\n    const decimals = this.parameters.speed?.decimals ?? 1;\n    return roundToDecimals((speed / maximumSpeed) * (100 / scene.dimensions.size), decimals);\n  }\n\n  /** @protected */\n  static _convertDensityToV2(density, scene) {\n    const d = scene.dimensions;\n    const gridUnits = (d.width / d.size) * (d.height / d.size);\n\n    const decimals = this.parameters.density?.decimals ?? 1;\n    return roundToDecimals(density / gridUnits, decimals);\n  }\n}\n","/**\n * A mixin which extends {@link FXMasterParticleEffect} with default rectangle spawing behavior.\n * @param {typeof import(\"../effect.js\").FXMasterParticleEffect} Base The base effect class which this mixin extends\n * @returns {import(\"../effect.js\").FXMasterParticleEffect} The extended effect class\n */\nexport function DefautlRectangleSpawnMixin(Base) {\n  return class extends Base {\n    /** @override */\n    getParticleEmitters(options = {}) {\n      options = this.constructor.mergeWithDefaults(options);\n      const d = canvas.dimensions;\n      const maxParticles = (d.width / d.size) * (d.height / d.size) * options.density.value;\n      const config = foundry.utils.deepClone(this.constructor.defaultConfig);\n      config.maxParticles = maxParticles;\n      config.frequency = config.lifetime.min / maxParticles;\n      config.behaviors.push({\n        type: \"spawnShape\",\n        config: {\n          type: \"rect\",\n          data: { x: d.sceneRect.x, y: d.sceneRect.y, w: d.sceneRect.width, h: d.sceneRect.height },\n        },\n      });\n      this.applyOptionsToConfig(options, config);\n\n      return [this.createEmitter(config)];\n    }\n  };\n}\n","import { FXMasterParticleEffect } from \"./effect.js\";\nimport { DefautlRectangleSpawnMixin } from \"./mixins/default-retangle-spawn.js\";\n\n/**\n * A full-screen particle effect which renders crawling spiders.\n */\nexport class SpiderParticleEffect extends DefautlRectangleSpawnMixin(FXMasterParticleEffect) {\n  /** @override */\n  static label = \"FXMASTER.ParticleEffectSpiders\";\n\n  /** @override */\n  static get icon() {\n    return \"modules/fxmaster/assets/particle-effects/icons/spiders.png\";\n  }\n\n  /** @override */\n  static get group() {\n    return \"animals\";\n  }\n\n  /** @override */\n  static get parameters() {\n    return foundry.utils.mergeObject(\n      super.parameters,\n      {\n        density: { min: 0.05, value: 0.3, max: 0.7, step: 0.05, decimals: 2 },\n        \"-=direction\": null,\n      },\n      { performDeletions: true },\n    );\n  }\n\n  /**\n   * Configuration for the particle emitter for crawling spiders\n   * @type {PIXI.particles.EmitterConfigV3}\n   */\n  static SPIDERS_CONFIG = {\n    lifetime: { min: 5, max: 10 },\n    behaviors: [\n      {\n        type: \"alpha\",\n        config: {\n          alpha: {\n            list: [\n              { value: 0, time: 0 },\n              { value: 1, time: 0.02 },\n              { value: 1, time: 0.98 },\n              { value: 0, time: 1 },\n            ],\n          },\n        },\n      },\n      {\n        type: \"moveSpeed\",\n        config: {\n          speed: {\n            list: [\n              { time: 0, value: 15 },\n              { time: 1, value: 25 },\n            ],\n          },\n          minMult: 0.6,\n        },\n      },\n      {\n        type: \"scale\",\n        config: {\n          scale: {\n            list: [\n              { value: 0.05, time: 0 },\n              { value: 0.08, time: 0.05 },\n              { value: 0.08, time: 0.95 },\n              { value: 0.05, time: 1 },\n            ],\n          },\n          minMult: 0.2,\n        },\n      },\n      {\n        type: \"rotationStatic\",\n        config: { min: 0, max: 359 },\n      },\n      {\n        type: \"animatedSingle\",\n        config: {\n          anim: {\n            framerate: 30,\n            loop: true,\n            textures: Array.fromRange(25).map((n) => ({\n              count: 1,\n              texture: `modules/fxmaster/assets/particle-effects/effects/spiders/spider${String(n + 1).padStart(\n                2,\n                \"0\",\n              )}.png`,\n            })),\n          },\n        },\n      },\n    ],\n  };\n\n  /** @override */\n  static get defaultConfig() {\n    return this.SPIDERS_CONFIG;\n  }\n}\n","/**\n * Adjust the color behavior of an emitter to use a stepped gradient instead of interpolation.\n * @param {PIXI.particles.Emitter} emitter        The emitter to adjust\n * @param {PIXI.particles.EmitterConfigV3} config The emitter config containing the original value list\n * @param {number} [steps=10]                     The number of steps to use\n * @returns {PIXI.particles.Emitter}\n */\nexport function withSteppedGradientColor(emitter, config, steps = 10) {\n  const colorBehavior = emitter.getBehavior(\"color\");\n\n  if (colorBehavior) {\n    emitter\n      .getBehavior(\"color\")\n      .list.reset(\n        PIXI.particles.ParticleUtils.createSteppedGradient(\n          config.behaviors.find(({ type }) => type === \"color\").config.color.list,\n          steps,\n        ),\n      );\n  }\n\n  return emitter;\n}\n","import { FXMasterParticleEffect } from \"./effect.js\";\nimport { withSteppedGradientColor } from \"./helpers/with-stepped-gradient-color.js\";\n/**\n * A full-screen particle effect which renders drifting stars.\n */\nexport class StarsParticleEffect extends FXMasterParticleEffect {\n  /** @override */\n  static label = \"FXMASTER.ParticleEffectStars\";\n\n  /** @override */\n  static get icon() {\n    return \"modules/fxmaster/assets/particle-effects/icons/stars.png\";\n  }\n\n  /** @override */\n  static get parameters() {\n    return foundry.utils.mergeObject(\n      super.parameters,\n      {\n        density: { min: 0.05, value: 0.3, max: 1, step: 0.05, decimals: 2 },\n        tint: { value: { value: \"#bee8ee\" } },\n        \"-=direction\": null,\n      },\n      { performDeletions: true },\n    );\n  }\n\n  /**\n   * Configuration for the particle emitter for drifting stars\n   * @type {PIXI.particles.EmitterConfigV3}\n   */\n  static STARS_CONFIG = {\n    lifetime: { min: 8, max: 15 },\n    behaviors: [\n      {\n        type: \"alpha\",\n        config: {\n          alpha: {\n            list: [\n              { value: 0, time: 0 },\n              { value: 0.9, time: 0.3 },\n              { value: 0.9, time: 0.95 },\n              { value: 0, time: 1 },\n            ],\n          },\n        },\n      },\n      {\n        type: \"moveSpeedStatic\",\n        config: { min: 3, max: 5 },\n      },\n      {\n        type: \"scale\",\n        config: {\n          scale: {\n            list: [\n              { value: 0.05, time: 0 },\n              { value: 0.03, time: 1 },\n            ],\n          },\n          minMult: 0.85,\n        },\n      },\n      {\n        type: \"rotation\",\n        config: { accel: 0, minSpeed: 20, maxSpeed: 50, minStart: 0, maxStart: 365 },\n      },\n      {\n        type: \"textureRandom\",\n        config: {\n          textures: Array.fromRange(8).map(\n            (n) => `modules/fxmaster/assets/particle-effects/effects/stars/star${n + 1}.png`,\n          ),\n        },\n      },\n      {\n        type: \"color\",\n        config: {\n          color: {\n            list: [\n              { value: \"bee8ee\", time: 0 },\n              { value: \"d0e8ec\", time: 1 },\n            ],\n          },\n        },\n      },\n      {\n        type: \"blendMode\",\n        config: {\n          blendMode: \"screen\",\n        },\n      },\n    ],\n  };\n\n  /** @override */\n  static get defaultConfig() {\n    return this.STARS_CONFIG;\n  }\n\n  /** @override */\n  getParticleEmitters(options = {}) {\n    options = this.constructor.mergeWithDefaults(options);\n    const d = canvas.dimensions;\n    const maxParticles = (d.width / d.size) * (d.height / d.size) * options.density.value;\n    const config = foundry.utils.deepClone(this.constructor.STARS_CONFIG);\n    config.maxParticles = maxParticles;\n    config.frequency = config.lifetime.min / maxParticles;\n    config.behaviors.push({\n      type: \"spawnShape\",\n      config: {\n        type: \"rect\",\n        data: { x: d.sceneRect.x, y: d.sceneRect.y, w: d.sceneRect.width, h: d.sceneRect.height },\n      },\n    });\n    this.applyOptionsToConfig(options, config);\n\n    const emitter = withSteppedGradientColor(this.createEmitter(config), config);\n    return [emitter];\n  }\n}\n","import { FXMasterParticleEffect } from \"./effect.js\";\nimport { DefautlRectangleSpawnMixin } from \"./mixins/default-retangle-spawn.js\";\n\n/**\n * A full-screen particle effect which renders gently falling autumn leaves.\n */\nexport class AutumnLeavesParticleEffect extends DefautlRectangleSpawnMixin(FXMasterParticleEffect) {\n  /** @override */\n  static label = \"FXMASTER.ParticleEffectLeaves\";\n\n  /** @override */\n  static get icon() {\n    return \"modules/fxmaster/assets/particle-effects/icons/leaves.png\";\n  }\n\n  /** @override */\n  static get group() {\n    return \"weather\";\n  }\n\n  /** @override */\n  static get parameters() {\n    return foundry.utils.mergeObject(\n      super.parameters,\n      {\n        density: { min: 0.05, value: 0.25, max: 1, step: 0.05, decimals: 2 },\n        \"-=direction\": null,\n      },\n      { performDeletions: true },\n    );\n  }\n\n  /**\n   * Configuration for the particle emitter for falling leaves\n   * @type {PIXI.particles.EmitterConfigV3}\n   */\n  static LEAF_CONFIG = {\n    lifetime: { min: 10, max: 10 },\n    behaviors: [\n      {\n        type: \"alpha\",\n        config: {\n          alpha: {\n            list: [\n              { time: 0, value: 0.9 },\n              { time: 1, value: 0.5 },\n            ],\n          },\n        },\n      },\n      {\n        type: \"moveSpeed\",\n        config: {\n          speed: {\n            list: [\n              { time: 0, value: 20 },\n              { time: 1, value: 60 },\n            ],\n          },\n          minMult: 0.6,\n        },\n      },\n      {\n        type: \"scale\",\n        config: {\n          scale: {\n            list: [\n              { time: 0, value: 0.2 },\n              { time: 1, value: 0.4 },\n            ],\n          },\n          minMult: 0.5,\n        },\n      },\n      {\n        type: \"rotation\",\n        config: { accel: 0, minSpeed: 100, maxSpeed: 200, minStart: 0, maxStart: 365 },\n      },\n      {\n        type: \"textureRandom\",\n        config: {\n          textures: Array.fromRange(6).map((n) => `ui/particles/leaf${n + 1}.png`),\n        },\n      },\n    ],\n  };\n\n  /** @override */\n  static get defaultConfig() {\n    return this.LEAF_CONFIG;\n  }\n}\n","import { FXMasterParticleEffect } from \"./effect.js\";\nimport { DefautlRectangleSpawnMixin } from \"./mixins/default-retangle-spawn.js\";\n\n/**\n * A full-screen particle effect which renders flying bats.\n */\nexport class BatsParticleEffect extends DefautlRectangleSpawnMixin(FXMasterParticleEffect) {\n  /** @override */\n  static label = \"FXMASTER.ParticleEffectBats\";\n\n  /** @override */\n  static get icon() {\n    return \"modules/fxmaster/assets/particle-effects/icons/bats.png\";\n  }\n\n  /** @override */\n  static get group() {\n    return \"animals\";\n  }\n\n  /** @override */\n  static get parameters() {\n    return foundry.utils.mergeObject(\n      super.parameters,\n      {\n        density: { min: 0.005, value: 0.05, max: 0.1, step: 0.005, decimals: 3 },\n        \"-=direction\": null,\n      },\n      { performDeletions: true },\n    );\n  }\n\n  /**\n   * Configuration for the particle emitter for flying bats\n   * @type {PIXI.particles.EmitterConfigV3}\n   */\n  static BATS_CONFIG = {\n    lifetime: { min: 20, max: 40 },\n    behaviors: [\n      {\n        type: \"alpha\",\n        config: {\n          alpha: {\n            list: [\n              { value: 0, time: 0 },\n              { value: 1, time: 0.02 },\n              { value: 1, time: 0.98 },\n              { value: 0, time: 1 },\n            ],\n          },\n        },\n      },\n      {\n        type: \"moveSpeed\",\n        config: {\n          speed: {\n            list: [\n              { time: 0, value: 200 },\n              { time: 1, value: 260 },\n            ],\n          },\n          minMult: 0.8,\n        },\n      },\n      {\n        type: \"scale\",\n        config: {\n          scale: {\n            list: [\n              { value: 0.02, time: 0 },\n              { value: 0.1, time: 0.05 },\n              { value: 0.1, time: 0.95 },\n              { value: 0.02, time: 1 },\n            ],\n          },\n        },\n      },\n      {\n        type: \"rotationStatic\",\n        config: { min: 0, max: 359 },\n      },\n      {\n        type: \"animatedSingle\",\n        config: {\n          anim: {\n            framerate: 30,\n            loop: true,\n            textures: [\n              { texture: 1, count: 1 },\n              { texture: 2, count: 1 },\n              { texture: 3, count: 1 },\n              { texture: 4, count: 1 },\n              { texture: 5, count: 2 },\n              { texture: 4, count: 1 },\n              { texture: 3, count: 1 },\n              { texture: 2, count: 1 },\n            ].map(({ texture, count }) => ({\n              texture: `modules/fxmaster/assets/particle-effects/effects/bats/bat${texture}.png`,\n              count,\n            })),\n          },\n        },\n      },\n    ],\n  };\n\n  /** @override */\n  static get defaultConfig() {\n    return this.BATS_CONFIG;\n  }\n}\n","import { FXMasterParticleEffect } from \"./effect.js\";\nimport { DefautlRectangleSpawnMixin } from \"./mixins/default-retangle-spawn.js\";\n\n/**\n * A full-screen particle effect which renders floating bubbles.\n */\nexport class BubblesParticleEffect extends DefautlRectangleSpawnMixin(FXMasterParticleEffect) {\n  /** @override */\n  static label = \"FXMASTER.ParticleEffectBubbles\";\n\n  /** @override */\n  static get icon() {\n    return \"modules/fxmaster/assets/particle-effects/icons/bubbles.png\";\n  }\n\n  /** @override */\n  static get parameters() {\n    return foundry.utils.mergeObject(\n      super.parameters,\n      {\n        density: { min: 0.01, value: 0.15, max: 0.5, step: 0.01, decimals: 2 },\n        \"-=direction\": null,\n      },\n      { performDeletions: true },\n    );\n  }\n\n  /**\n   * Configuration for the particle emitter for floating bubbles\n   * @type {PIXI.particles.EmitterConfigV3}\n   */\n  static BUBBLES_CONFIG = {\n    lifetime: { min: 8, max: 10 },\n    behaviors: [\n      {\n        type: \"alpha\",\n        config: {\n          alpha: {\n            list: [\n              { value: 0, time: 0 },\n              { value: 0.85, time: 0.05 },\n              { value: 0.85, time: 0.98 },\n              { value: 0, time: 1 },\n            ],\n          },\n        },\n      },\n      {\n        type: \"moveSpeed\",\n        config: {\n          speed: {\n            list: [\n              { time: 0, value: 20 },\n              { time: 1, value: 60 },\n            ],\n          },\n          minMult: 0.6,\n        },\n      },\n      {\n        type: \"scale\",\n        config: {\n          scale: {\n            list: [\n              { value: 0.25, time: 0 },\n              { value: 0.5, time: 1 },\n            ],\n          },\n          minMult: 0.5,\n        },\n      },\n      {\n        type: \"rotation\",\n        config: { accel: 0, minSpeed: 100, maxSpeed: 200, minStart: 0, maxStart: 365 },\n      },\n      {\n        type: \"textureSingle\",\n        config: { texture: \"modules/fxmaster/assets/particle-effects/effects/bubbles/bubble.png\" },\n      },\n    ],\n  };\n\n  /** @override */\n  static get defaultConfig() {\n    return this.BUBBLES_CONFIG;\n  }\n}\n","import { FXMasterParticleEffect } from \"./effect.js\";\n\n/**\n * A full-screen particle effect which renders drifting bubbles.\n */\nexport class CloudsParticleEffect extends FXMasterParticleEffect {\n  /** @override */\n  static label = \"FXMASTER.ParticleEffectClouds\";\n\n  /** @override */\n  static get icon() {\n    return \"modules/fxmaster/assets/particle-effects/icons/clouds.png\";\n  }\n\n  /** @override */\n  static get group() {\n    return \"weather\";\n  }\n\n  /** @override */\n  static get parameters() {\n    return foundry.utils.mergeObject(super.parameters, {\n      density: { min: 0.001, value: 0.03, max: 0.2, step: 0.001, decimals: 3 },\n    });\n  }\n\n  /**\n   * Configuration for the particle emitter for drifting clouds\n   * @type {PIXI.particles.EmitterConfigV3}\n   */\n  static CLOUDS_CONFIG = {\n    behaviors: [\n      {\n        type: \"alpha\",\n        config: {\n          alpha: {\n            list: [\n              { value: 0, time: 0 },\n              { value: 0.5, time: 0.05 },\n              { value: 0.5, time: 0.95 },\n              { value: 0, time: 1 },\n            ],\n          },\n        },\n      },\n      { type: \"moveSpeedStatic\", config: { min: 30, max: 100 } },\n      { type: \"scaleStatic\", config: { min: 0.08, max: 0.8 } },\n      { type: \"rotationStatic\", config: { min: 80, max: 100 } },\n      {\n        type: \"textureRandom\",\n        config: {\n          textures: Array.fromRange(4).map(\n            (n) => `modules/fxmaster/assets/particle-effects/effects/clouds/cloud${n + 1}.png`,\n          ),\n        },\n      },\n    ],\n  };\n\n  /** @override */\n  static get defaultConfig() {\n    return this.CLOUDS_CONFIG;\n  }\n\n  /** @override */\n  getParticleEmitters(options = {}) {\n    options = this.constructor.mergeWithDefaults(options);\n    const d = canvas.dimensions;\n    const maxParticles = (d.width / d.size) * (d.height / d.size) * options.density.value;\n\n    const offsetFactor = 2 / 3;\n    const config = foundry.utils.deepClone(this.constructor.CLOUDS_CONFIG);\n    const speed = config.behaviors.find(({ type }) => type === \"moveSpeedStatic\")?.config;\n    if (speed === undefined) {\n      throw new Error(\"Expected CLOUDS_CONFIG to have a moveSpeedStatic behavior but it didn't.\");\n    }\n\n    const diagonal = Math.sqrt(d.sceneRect.width * d.sceneRect.width + d.sceneRect.height * d.sceneRect.height);\n    const averageSpeed = (speed.min + speed.max) / 2;\n    const averageDiagonalTime = diagonal / averageSpeed;\n    const minLifetime = averageDiagonalTime / offsetFactor / 2;\n    const maxLifetime = averageDiagonalTime / offsetFactor;\n\n    const angle = Math.toRadians(options.direction.value);\n    const directionVector = {\n      x: Math.cos(angle),\n      y: Math.sin(angle),\n    };\n\n    config.maxParticles = maxParticles;\n    config.frequency = (minLifetime + maxLifetime) / 2 / maxParticles;\n    config.lifetime = { min: minLifetime, max: maxLifetime };\n    config.behaviors.push({\n      type: \"spawnShape\",\n      config: {\n        type: \"rect\",\n        data: {\n          x: d.sceneRect.x - directionVector.x * d.sceneRect.width * offsetFactor,\n          y: d.sceneRect.y - directionVector.y * d.sceneRect.height * offsetFactor,\n          w: d.sceneRect.width,\n          h: d.sceneRect.height,\n        },\n      },\n    });\n    this.applyOptionsToConfig(options, config);\n\n    return [this.createEmitter(config)];\n  }\n}\n","import { FXMasterParticleEffect } from \"./effect.js\";\nimport { DefautlRectangleSpawnMixin } from \"./mixins/default-retangle-spawn.js\";\n\n/**\n * A full-screen particle effect which renders flying crows.\n */\nexport class CrowsParticleEffect extends DefautlRectangleSpawnMixin(FXMasterParticleEffect) {\n  /** @override */\n  static label = \"FXMASTER.ParticleEffectCrows\";\n\n  /** @override */\n  static get icon() {\n    return \"modules/fxmaster/assets/particle-effects/icons/crows.png\";\n  }\n\n  /** @override */\n  static get group() {\n    return \"animals\";\n  }\n\n  /** @override */\n  static get parameters() {\n    return foundry.utils.mergeObject(\n      super.parameters,\n      {\n        density: { min: 0.001, value: 0.006, max: 0.01, step: 0.001, decimals: 3 },\n        \"-=direction\": null,\n      },\n      { performDeletions: true },\n    );\n  }\n\n  /**\n   * Configuration for the particle emitter for flying crows\n   * @type {PIXI.particles.EmitterConfigV3}\n   */\n  static CROWS_CONFIG = {\n    lifetime: { min: 20, max: 40 },\n    behaviors: [\n      {\n        type: \"alpha\",\n        config: {\n          alpha: {\n            list: [\n              { value: 0, time: 0 },\n              { value: 1, time: 0.02 },\n              { value: 1, time: 0.98 },\n              { value: 0, time: 1 },\n            ],\n          },\n        },\n      },\n      {\n        type: \"moveSpeed\",\n        config: {\n          speed: {\n            list: [\n              { time: 0, value: 90 },\n              { time: 1, value: 100 },\n            ],\n          },\n          minMult: 0.6,\n        },\n      },\n      {\n        type: \"scale\",\n        config: {\n          scale: {\n            list: [\n              { value: 0.03, time: 0 },\n              { value: 0.12, time: 0.1 },\n              { value: 0.12, time: 0.9 },\n              { value: 0.03, time: 1 },\n            ],\n          },\n        },\n      },\n      {\n        type: \"rotationStatic\",\n        config: { min: 0, max: 359 },\n      },\n      {\n        type: \"animatedSingle\",\n        config: {\n          anim: {\n            framerate: 15,\n            loop: true,\n            textures: [\n              { texture: 1, count: 20 },\n              { texture: 2, count: 3 },\n              { texture: 3, count: 2 },\n              { texture: 4, count: 2 },\n              { texture: 3, count: 2 },\n              { texture: 2, count: 3 },\n            ].map(({ texture, count }) => ({\n              texture: `modules/fxmaster/assets/particle-effects/effects/crows/crow${texture}.png`,\n              count,\n            })),\n          },\n        },\n      },\n    ],\n  };\n\n  /** @override */\n  static get defaultConfig() {\n    return this.CROWS_CONFIG;\n  }\n}\n","import { FXMasterParticleEffect } from \"./effect.js\";\n\n/**\n * A full-screen particle effect which renders flying eagles.\n */\nexport class EaglesParticleEffect extends FXMasterParticleEffect {\n  /**\n   * The cached textures for this weather effect.\n   * @type {PIXI.Texture[] | undefined}\n   * @private\n   */\n  static _textureCache;\n\n  /** @override */\n  static label = \"FXMASTER.ParticleEffectEagles\";\n\n  /** @override */\n  static get icon() {\n    return \"modules/fxmaster/assets/particle-effects/icons/crows.png\";\n  }\n\n  /** @override */\n  static get group() {\n    return \"animals\";\n  }\n\n  /** @override */\n  static get parameters() {\n    return foundry.utils.mergeObject(\n      super.parameters,\n      {\n        density: { min: 0.0005, value: 0.002, max: 0.01, step: 0.0005, decimals: 4 },\n        \"-=direction\": null,\n        animations: {\n          label: \"FXMASTER.Animations\",\n          type: \"multi-select\",\n          options: {\n            flap: \"FXMASTER.ParicleEffectBirdsAnimationsFlap\",\n            glide: \"FXMASTER.ParicleEffectBirdsAnimationsGlide\",\n          },\n          value: [\"glide\"],\n        },\n      },\n      { performDeletions: true },\n    );\n  }\n\n  /**\n   * Configuration for the particle emitter for flying eagles\n   * @type {PIXI.particles.EmitterConfigV3}\n   */\n  static EAGLES_CONFIG = {\n    lifetime: { min: 7, max: 14 },\n    behaviors: [\n      {\n        type: \"alpha\",\n        config: {\n          alpha: {\n            list: [\n              { value: 0, time: 0 },\n              { value: 1, time: 0.02 },\n              { value: 1, time: 0.98 },\n              { value: 0, time: 1 },\n            ],\n          },\n        },\n      },\n      {\n        type: \"moveSpeed\",\n        config: {\n          speed: {\n            list: [\n              { time: 0, value: 360 },\n              { time: 1, value: 400 },\n            ],\n          },\n          minMult: 0.6,\n        },\n      },\n      {\n        type: \"scale\",\n        config: {\n          scale: {\n            list: [\n              { value: 0.15, time: 0 },\n              { value: 0.3, time: 0.1 },\n              { value: 0.3, time: 0.9 },\n              { value: 0.15, time: 1 },\n            ],\n          },\n        },\n      },\n      {\n        type: \"rotationStatic\",\n        config: { min: 0, max: 359 },\n      },\n    ],\n  };\n\n  /** @override */\n  static get defaultConfig() {\n    return this.EAGLES_CONFIG;\n  }\n\n  /** @override */\n  getParticleEmitters(options = {}) {\n    options = this.constructor.mergeWithDefaults(options);\n    const d = canvas.dimensions;\n    const maxParticles = (d.width / d.size) * (d.height / d.size) * options.density.value;\n    const config = foundry.utils.deepClone(this.constructor.EAGLES_CONFIG);\n    config.maxParticles = maxParticles;\n    config.frequency = config.lifetime.min / maxParticles;\n    config.behaviors.push({\n      type: \"spawnShape\",\n      config: {\n        type: \"rect\",\n        data: { x: d.sceneRect.x, y: d.sceneRect.y, w: d.sceneRect.width, h: d.sceneRect.height },\n      },\n    });\n    config.behaviors.push({\n      type: \"animatedRandom\",\n      config: {\n        anims: this._getAnimations(options),\n      },\n    });\n    this.applyOptionsToConfig(options, config);\n\n    return [this.createEmitter(config)];\n  }\n\n  /**\n   * Get the animation to use for this effect.\n   * @returns The animations to use for the effect\n   * @protected\n   */\n  _getAnimations(options) {\n    if (!this._textures) {\n      this._initializeTextures();\n    }\n\n    const flap = Array.fromRange(19).map((textureNumber) => ({\n      textureNumber,\n      count: 1,\n    }));\n\n    const glide = [\n      { textureNumber: 0, count: 30 },\n      ...Array(4).fill(flap).deepFlatten(),\n      { textureNumber: 0, count: 68 },\n    ];\n\n    const animations = {\n      glide,\n      flap,\n    };\n\n    const getAnim = (animation) => ({\n      framerate: 20,\n      loop: true,\n      textures: animation.map(({ textureNumber, count }) => ({\n        texture: this._textures[textureNumber],\n        count,\n      })),\n    });\n\n    const anims = (options.animations?.value ?? [])\n      .filter((animation) => Object.keys(animations).includes(animation))\n      .map((animation) => getAnim(animations[animation]));\n\n    if (anims.length === 0) {\n      anims.push(getAnim(animations.glide));\n    }\n\n    return anims;\n  }\n\n  /**\n   * Get the textures for this particle effect.\n   * @private\n   * @returns {PIXI.Texture[]}\n   */\n  get _textures() {\n    if (!this.constructor._textureCache) {\n      const spriteSheetTexture = PIXI.Texture.from(\"modules/fxmaster/assets/particle-effects/effects/eagles/eagle.png\");\n      const spriteSheetData = {\n        meta: {\n          scale: \"1\",\n        },\n        frames: {\n          \"eagle0000.png\": {\n            frame: { x: 0, y: 0, w: 512, h: 512 },\n            rotated: false,\n            trimmed: false,\n            spriteSourceSize: { x: 0, y: 0, w: 512, h: 512 },\n            sourceSize: { w: 512, h: 512 },\n          },\n          \"eagle0001.png\": {\n            frame: { x: 512, y: 0, w: 512, h: 512 },\n            rotated: false,\n            trimmed: false,\n            spriteSourceSize: { x: 0, y: 0, w: 512, h: 512 },\n            sourceSize: { w: 512, h: 512 },\n          },\n          \"eagle0002.png\": {\n            frame: { x: 0, y: 512, w: 512, h: 512 },\n            rotated: false,\n            trimmed: false,\n            spriteSourceSize: { x: 0, y: 0, w: 512, h: 512 },\n            sourceSize: { w: 512, h: 512 },\n          },\n          \"eagle0003.png\": {\n            frame: { x: 512, y: 512, w: 512, h: 512 },\n            rotated: false,\n            trimmed: false,\n            spriteSourceSize: { x: 0, y: 0, w: 512, h: 512 },\n            sourceSize: { w: 512, h: 512 },\n          },\n          \"eagle0004.png\": {\n            frame: { x: 1024, y: 0, w: 512, h: 512 },\n            rotated: false,\n            trimmed: false,\n            spriteSourceSize: { x: 0, y: 0, w: 512, h: 512 },\n            sourceSize: { w: 512, h: 512 },\n          },\n          \"eagle0005.png\": {\n            frame: { x: 1024, y: 512, w: 512, h: 512 },\n            rotated: false,\n            trimmed: false,\n            spriteSourceSize: { x: 0, y: 0, w: 512, h: 512 },\n            sourceSize: { w: 512, h: 512 },\n          },\n          \"eagle0006.png\": {\n            frame: { x: 0, y: 1024, w: 512, h: 512 },\n            rotated: false,\n            trimmed: false,\n            spriteSourceSize: { x: 0, y: 0, w: 512, h: 512 },\n            sourceSize: { w: 512, h: 512 },\n          },\n          \"eagle0007.png\": {\n            frame: { x: 512, y: 1024, w: 512, h: 512 },\n            rotated: false,\n            trimmed: false,\n            spriteSourceSize: { x: 0, y: 0, w: 512, h: 512 },\n            sourceSize: { w: 512, h: 512 },\n          },\n          \"eagle0008.png\": {\n            frame: { x: 1024, y: 1024, w: 512, h: 512 },\n            rotated: false,\n            trimmed: false,\n            spriteSourceSize: { x: 0, y: 0, w: 512, h: 512 },\n            sourceSize: { w: 512, h: 512 },\n          },\n          \"eagle0009.png\": {\n            frame: { x: 1536, y: 0, w: 512, h: 512 },\n            rotated: false,\n            trimmed: false,\n            spriteSourceSize: { x: 0, y: 0, w: 512, h: 512 },\n            sourceSize: { w: 512, h: 512 },\n          },\n          \"eagle0010.png\": {\n            frame: { x: 1536, y: 512, w: 512, h: 512 },\n            rotated: false,\n            trimmed: false,\n            spriteSourceSize: { x: 0, y: 0, w: 512, h: 512 },\n            sourceSize: { w: 512, h: 512 },\n          },\n          \"eagle0011.png\": {\n            frame: { x: 1536, y: 1024, w: 512, h: 512 },\n            rotated: false,\n            trimmed: false,\n            spriteSourceSize: { x: 0, y: 0, w: 512, h: 512 },\n            sourceSize: { w: 512, h: 512 },\n          },\n          \"eagle0012.png\": {\n            frame: { x: 0, y: 1536, w: 512, h: 512 },\n            rotated: false,\n            trimmed: false,\n            spriteSourceSize: { x: 0, y: 0, w: 512, h: 512 },\n            sourceSize: { w: 512, h: 512 },\n          },\n          \"eagle0013.png\": {\n            frame: { x: 512, y: 1536, w: 512, h: 512 },\n            rotated: false,\n            trimmed: false,\n            spriteSourceSize: { x: 0, y: 0, w: 512, h: 512 },\n            sourceSize: { w: 512, h: 512 },\n          },\n          \"eagle0014.png\": {\n            frame: { x: 1024, y: 1536, w: 512, h: 512 },\n            rotated: false,\n            trimmed: false,\n            spriteSourceSize: { x: 0, y: 0, w: 512, h: 512 },\n            sourceSize: { w: 512, h: 512 },\n          },\n          \"eagle0015.png\": {\n            frame: { x: 1536, y: 1536, w: 512, h: 512 },\n            rotated: false,\n            trimmed: false,\n            spriteSourceSize: { x: 0, y: 0, w: 512, h: 512 },\n            sourceSize: { w: 512, h: 512 },\n          },\n          \"eagle0016.png\": {\n            frame: { x: 2048, y: 0, w: 512, h: 512 },\n            rotated: false,\n            trimmed: false,\n            spriteSourceSize: { x: 0, y: 0, w: 512, h: 512 },\n            sourceSize: { w: 512, h: 512 },\n          },\n          \"eagle0017.png\": {\n            frame: { x: 2048, y: 512, w: 512, h: 512 },\n            rotated: false,\n            trimmed: false,\n            spriteSourceSize: { x: 0, y: 0, w: 512, h: 512 },\n            sourceSize: { w: 512, h: 512 },\n          },\n          \"eagle0018.png\": {\n            frame: { x: 2048, y: 1024, w: 512, h: 512 },\n            rotated: false,\n            trimmed: false,\n            spriteSourceSize: { x: 0, y: 0, w: 512, h: 512 },\n            sourceSize: { w: 512, h: 512 },\n          },\n          \"eagle0019.png\": {\n            frame: { x: 2048, y: 1536, w: 512, h: 512 },\n            rotated: false,\n            trimmed: false,\n            spriteSourceSize: { x: 0, y: 0, w: 512, h: 512 },\n            sourceSize: { w: 512, h: 512 },\n          },\n        },\n      };\n      const spriteSheet = new PIXI.Spritesheet(spriteSheetTexture, spriteSheetData);\n      this.constructor._textureCache = parseSpriteSheetSync.call(spriteSheet);\n    }\n    return this.constructor._textureCache;\n  }\n}\n\nfunction parseSpriteSheetSync() {\n  let textures;\n  this._callback = (parsedTextures) => (textures = Object.values(parsedTextures));\n  this._batchIndex = 0;\n  this._processFrames(0);\n  this._processAnimations();\n  this._parseComplete();\n  return textures;\n}\n","import { FXMasterParticleEffect } from \"./effect.js\";\nimport { DefautlRectangleSpawnMixin } from \"./mixins/default-retangle-spawn.js\";\n\n/**\n * A full-screen particle effect which renders swirling fog.\n */\nexport class FogParticleEffect extends DefautlRectangleSpawnMixin(FXMasterParticleEffect) {\n  /** @override */\n  static label = \"FXMASTER.ParticleEffectFog\";\n\n  /** @override */\n  static get icon() {\n    return \"modules/fxmaster/assets/particle-effects/icons/fog.png\";\n  }\n\n  /** @override */\n  static get group() {\n    return \"weather\";\n  }\n\n  /** @override */\n  static get parameters() {\n    return foundry.utils.mergeObject(\n      super.parameters,\n      {\n        density: { min: 0.01, value: 0.08, max: 0.15, step: 0.01, decimals: 2 },\n        \"-=direction\": null,\n      },\n      { performDeletions: true },\n    );\n  }\n\n  /**\n   * Configuration for the particle emitter for swirling fog\n   * @type {PIXI.particles.EmitterConfigV3}\n   */\n  static FOG_CONFIG = {\n    lifetime: { min: 10, max: 25 },\n    behaviors: [\n      {\n        type: \"alpha\",\n        config: {\n          alpha: {\n            list: [\n              { value: 0, time: 0 },\n              { value: 0.1, time: 0.1 },\n              { value: 0.3, time: 0.5 },\n              { value: 0.1, time: 0.9 },\n              { value: 0, time: 1 },\n            ],\n          },\n        },\n      },\n      {\n        type: \"moveSpeed\",\n        config: {\n          speed: {\n            list: [\n              { time: 0, value: 15 },\n              { time: 1, value: 10 },\n            ],\n          },\n          minMult: 0.2,\n        },\n      },\n      {\n        type: \"scale\",\n        config: {\n          scale: {\n            list: [\n              { value: 1.5, time: 0 },\n              { value: 1, time: 1 },\n            ],\n          },\n          minMult: 0.5,\n        },\n      },\n      {\n        type: \"rotation\",\n        config: { accel: 0, minSpeed: 0.15, maxSpeed: 0.35, minStart: 0, maxStart: 365 },\n      },\n      {\n        type: \"textureRandom\",\n        config: {\n          textures: Array.fromRange(4).map(\n            (n) => `modules/fxmaster/assets/particle-effects/effects/clouds/cloud${n + 1}.png`,\n          ),\n        },\n      },\n      {\n        type: \"colorStatic\",\n        config: {\n          color: \"dddddd\",\n        },\n      },\n    ],\n  };\n\n  /** @override */\n  static get defaultConfig() {\n    return this.FOG_CONFIG;\n  }\n}\n","import { FXMasterParticleEffect } from \"./effect.js\";\nimport { DefautlRectangleSpawnMixin } from \"./mixins/default-retangle-spawn.js\";\n\n/**\n * A full-screen particle effect which renders scurrying rats.\n */\nexport class RatsParticleEffect extends DefautlRectangleSpawnMixin(FXMasterParticleEffect) {\n  /** @override */\n  static label = \"FXMASTER.ParticleEffectRats\";\n\n  /** @override */\n  static get icon() {\n    return \"modules/fxmaster/assets/particle-effects/icons/rats.png\";\n  }\n\n  /** @override */\n  static get group() {\n    return \"animals\";\n  }\n\n  /** @override */\n  static get parameters() {\n    return foundry.utils.mergeObject(\n      super.parameters,\n      {\n        density: { min: 0.001, value: 0.006, max: 0.1, step: 0.001, decimals: 3 },\n        \"-=direction\": null,\n      },\n      { performDeletions: true },\n    );\n  }\n\n  /**\n   * Configuration for the particle emitter for scurrying rats\n   * @type {PIXI.particles.EmitterConfigV3}\n   */\n  static RATS_CONFIG = {\n    lifetime: { min: 20, max: 40 },\n    behaviors: [\n      {\n        type: \"alpha\",\n        config: {\n          alpha: {\n            list: [\n              { value: 0, time: 0 },\n              { value: 1, time: 0.02 },\n              { value: 1, time: 0.98 },\n              { value: 0, time: 1 },\n            ],\n          },\n        },\n      },\n      {\n        type: \"moveSpeedStatic\",\n        config: { min: 120, max: 200 },\n      },\n      {\n        type: \"scale\",\n        config: {\n          scale: {\n            list: [\n              { value: 0.03, time: 0 },\n              { value: 0.125, time: 0.1 },\n              { value: 0.125, time: 0.9 },\n              { value: 0.03, time: 1 },\n            ],\n          },\n          minMult: 0.5,\n        },\n      },\n      {\n        type: \"rotationStatic\",\n        config: { min: 0, max: 359 },\n      },\n      {\n        type: \"animatedSingle\",\n        config: {\n          anim: {\n            framerate: \"10\",\n            loop: true,\n            textures: Array.fromRange(5).map(\n              (n) => `modules/fxmaster/assets/particle-effects/effects/rats/rat${n + 1}.png`,\n            ),\n          },\n        },\n      },\n    ],\n  };\n\n  /** @override */\n  static get defaultConfig() {\n    return this.RATS_CONFIG;\n  }\n}\n","import { FXMasterParticleEffect } from \"./effect.js\";\n\n/**\n * A full-screen particle effect which renders heavy snow fall.\n */\nexport class SnowstormParticleEffect extends FXMasterParticleEffect {\n  /** @override */\n  static label = \"FXMASTER.ParticleEffectSnowstorm\";\n\n  /** @override */\n  static get icon() {\n    return \"modules/fxmaster/assets/particle-effects/icons/snow-storm.png\";\n  }\n\n  /** @override */\n  static get group() {\n    return \"weather\";\n  }\n\n  /** @override */\n  static get parameters() {\n    return foundry.utils.mergeObject(super.parameters, {\n      density: { min: 0.05, value: 0.6, max: 1, step: 0.05, decimals: 2 },\n    });\n  }\n\n  /**\n   * Configuration for the particle emitter for heavy snow fall\n   * @type {PIXI.particles.EmitterConfigV3}\n   */\n  static SNOWSTORM_CONFIG = {\n    lifetime: { min: 2.5, max: 6 },\n    behaviors: [\n      {\n        type: \"alphaStatic\",\n        config: { alpha: 1 },\n      },\n      {\n        type: \"movePath\",\n        config: {\n          path: \"sin(x / 150) * 25\",\n          speed: {\n            list: [\n              { value: 400, time: 0 },\n              { value: 350, time: 1 },\n            ],\n          },\n          minMult: 0.2,\n        },\n      },\n      {\n        type: \"scale\",\n        config: {\n          scale: {\n            list: [\n              { value: 0.2, time: 0 },\n              { value: 0.08, time: 1 },\n            ],\n          },\n          minMult: 0.8,\n        },\n      },\n      {\n        type: \"rotation\",\n        config: { accel: 0, minSpeed: -60, maxSpeed: 60, minStart: 86, maxStart: 94 },\n      },\n      {\n        type: \"textureRandom\",\n        config: {\n          textures: Array.fromRange(2).map(\n            (n) => `modules/fxmaster/assets/particle-effects/effects/snowstorm/snow${n + 1}.png`,\n          ),\n        },\n      },\n    ],\n  };\n\n  /** @override */\n  static get defaultConfig() {\n    return this.SNOWSTORM_CONFIG;\n  }\n\n  /** @override */\n  getParticleEmitters(options = {}) {\n    options = this.constructor.mergeWithDefaults(options);\n    const d = canvas.dimensions;\n    const maxParticles = (d.width / d.size) * (d.height / d.size) * options.density.value;\n    const config = foundry.utils.deepClone(this.constructor.defaultConfig);\n    config.maxParticles = maxParticles;\n    config.frequency = (config.lifetime.min + config.lifetime.max) / 2 / maxParticles;\n    config.behaviors.push({\n      type: \"spawnShape\",\n      config: {\n        type: \"rect\",\n        data: { x: d.sceneRect.x, y: d.sceneRect.y, w: d.sceneRect.width, h: d.sceneRect.height },\n      },\n    });\n    this.applyOptionsToConfig(options, config);\n\n    return [this.createEmitter(config)];\n  }\n}\n","import { SpiderParticleEffect } from \"./effects/spiders.js\";\nimport { StarsParticleEffect } from \"./effects/stars.js\";\nimport { AutumnLeavesParticleEffect } from \"./effects/leaves.js\";\nimport { BatsParticleEffect } from \"./effects/bats.js\";\nimport { BirdsParticleEffect } from \"./effects/birds.js\";\nimport { BubblesParticleEffect } from \"./effects/bubbles.js\";\nimport { CloudsParticleEffect } from \"./effects/clouds.js\";\nimport { CrowsParticleEffect } from \"./effects/crows.js\";\nimport { EaglesParticleEffect } from \"./effects/eagles.js\";\nimport { EmbersParticleEffect } from \"./effects/embers.js\";\nimport { FogParticleEffect } from \"./effects/fog.js\";\nimport { RainParticleEffect } from \"./effects/rain.js\";\nimport { RainSimpleParticleEffect } from \"./effects/rain-simple.js\";\nimport { RainTopParticleEffect } from \"./effects/rain-top.js\";\nimport { RatsParticleEffect } from \"./effects/rats.js\";\nimport { SnowParticleEffect } from \"./effects/snow.js\";\nimport { SnowstormParticleEffect } from \"./effects/snowstorm.js\";\n\n/** @typedef {Record<string, typeof import(\"./effects/effect.js\").FXMasterParticleEffect>} ParticleEffects */\n\n/** @type {ParticleEffects} */\nexport const particleEffects = {\n  bats: BatsParticleEffect,\n  birds: BirdsParticleEffect,\n  crows: CrowsParticleEffect,\n  eagles: EaglesParticleEffect,\n  rats: RatsParticleEffect,\n  spiders: SpiderParticleEffect,\n\n  bubbles: BubblesParticleEffect,\n  embers: EmbersParticleEffect,\n  stars: StarsParticleEffect,\n\n  leaves: AutumnLeavesParticleEffect,\n  clouds: CloudsParticleEffect,\n  fog: FogParticleEffect,\n  rain: RainParticleEffect,\n  raintop: RainTopParticleEffect,\n  rainsimple: RainSimpleParticleEffect,\n  snow: SnowParticleEffect,\n  snowstorm: SnowstormParticleEffect,\n};\n","import { filterEffects } from \"./filter-effects/filter-effects-db.js\";\nimport { particleEffects } from \"./particle-effects/particle-effects-db.js\";\nimport { specialEffects } from \"./special-effects/special-effects-db.js\";\n\nexport const FXMASTER = {\n  filterEffects,\n  particleEffects,\n  specialEffects,\n};\n","import { FXMasterParticleEffect } from \"./effect.js\";\n\n/**\n * A full-screen particle effect which renders flying birds.\n */\nexport class BirdsParticleEffect extends FXMasterParticleEffect {\n  /** @override */\n  static label = \"FXMASTER.ParticleEffectBirds\";\n\n  /** @override */\n  static get icon() {\n    return \"modules/fxmaster/assets/particle-effects/icons/crows.png\";\n  }\n\n  /** @override */\n  static get group() {\n    return \"animals\";\n  }\n\n  /** @override */\n  static get parameters() {\n    return foundry.utils.mergeObject(\n      super.parameters,\n      {\n        density: { min: 0.001, value: 0.006, max: 0.01, step: 0.001, decimals: 3 },\n        \"-=direction\": null,\n        animations: {\n          label: \"FXMASTER.Animations\",\n          type: \"multi-select\",\n          options: {\n            glide: \"FXMASTER.ParicleEffectBirdsAnimationsGlide\",\n            flap: \"FXMASTER.ParicleEffectBirdsAnimationsFlap\",\n            mixed: \"FXMASTER.ParicleEffectBirdsAnimationsMixed\",\n          },\n          value: [\"mixed\"],\n        },\n      },\n      { performDeletions: true },\n    );\n  }\n\n  /**\n   * Configuration for the particle emitter for flying birds\n   * @type {PIXI.particles.EmitterConfigV3}\n   */\n  static BIRDS_CONFIG = {\n    lifetime: { min: 20, max: 40 },\n    behaviors: [\n      {\n        type: \"alpha\",\n        config: {\n          alpha: {\n            list: [\n              { value: 0, time: 0 },\n              { value: 1, time: 0.02 },\n              { value: 1, time: 0.98 },\n              { value: 0, time: 1 },\n            ],\n          },\n        },\n      },\n      {\n        type: \"moveSpeed\",\n        config: {\n          speed: {\n            list: [\n              { time: 0, value: 90 },\n              { time: 1, value: 100 },\n            ],\n          },\n          minMult: 0.6,\n        },\n      },\n      {\n        type: \"scale\",\n        config: {\n          scale: {\n            list: [\n              { value: 0.3, time: 0 },\n              { value: 0.7, time: 0.1 },\n              { value: 0.7, time: 0.9 },\n              { value: 0.3, time: 1 },\n            ],\n          },\n        },\n      },\n      {\n        type: \"rotationStatic\",\n        config: { min: 0, max: 359 },\n      },\n    ],\n  };\n\n  /** @override */\n  static get defaultConfig() {\n    return this.BIRDS_CONFIG;\n  }\n\n  /** @override */\n  getParticleEmitters(options = {}) {\n    options = this.constructor.mergeWithDefaults(options);\n    const d = canvas.dimensions;\n    const maxParticles = (d.width / d.size) * (d.height / d.size) * options.density.value;\n    const config = foundry.utils.deepClone(this.constructor.BIRDS_CONFIG);\n    config.maxParticles = maxParticles;\n    config.frequency = config.lifetime.min / maxParticles;\n    config.behaviors.push({\n      type: \"spawnShape\",\n      config: {\n        type: \"rect\",\n        data: { x: d.sceneRect.x, y: d.sceneRect.y, w: d.sceneRect.width, h: d.sceneRect.height },\n      },\n    });\n    config.behaviors.push({\n      type: \"animatedRandom\",\n      config: {\n        anims: this._getAnimations(options),\n      },\n    });\n    this.applyOptionsToConfig(options, config);\n\n    return [this.createEmitter(config)];\n  }\n\n  /**\n   * Get the animation to use for this effect.\n   * @returns The animations to use for the effect\n   * @protected\n   */\n  _getAnimations(options) {\n    const animations = {\n      glide: [\n        { textureNumber: 2, count: 30 },\n        ...Array(4)\n          .fill([\n            { texture: 1, count: 3 },\n            { texture: 2, count: 2 },\n            { texture: 3, count: 3 },\n            { texture: 2, count: 2 },\n          ])\n          .deepFlatten(),\n        { texture: 2, count: 68 },\n      ],\n      flap: [\n        { texture: 1, count: 3 },\n        { texture: 2, count: 2 },\n        { texture: 3, count: 3 },\n        { texture: 2, count: 2 },\n      ],\n      mixed: [\n        { texture: 2, count: 7 },\n        { texture: 1, count: 3 },\n        { texture: 2, count: 2 },\n        { texture: 3, count: 3 },\n        { texture: 2, count: 7 },\n      ],\n    };\n\n    const getAnim = (animation) => ({\n      framerate: 20,\n      loop: true,\n      textures: animation.map(({ texture, count }) => ({\n        texture: `modules/fxmaster/assets/particle-effects/effects/birds/bird${texture}.png`,\n        count,\n      })),\n    });\n\n    const anims = (options.animations?.value ?? [])\n      .filter((animation) => Object.keys(animations).includes(animation))\n      .map((animation) => getAnim(animations[animation]));\n\n    if (anims.length === 0) {\n      anims.push(getAnim(animations.mixed));\n    }\n\n    return anims;\n  }\n}\n","import { FXMasterParticleEffect } from \"./effect.js\";\nimport { withSteppedGradientColor } from \"./helpers/with-stepped-gradient-color.js\";\n\n/**\n * A full-screen particle effect which renders floating embers.\n */\nexport class EmbersParticleEffect extends FXMasterParticleEffect {\n  /** @override */\n  static label = \"FXMASTER.ParticleEffectEmbers\";\n\n  /** @override */\n  static get icon() {\n    return \"modules/fxmaster/assets/particle-effects/icons/embers.png\";\n  }\n\n  /** @override */\n  static get parameters() {\n    return foundry.utils.mergeObject(\n      super.parameters,\n      {\n        density: { min: 0.05, value: 0.7, max: 1.4, step: 0.05, decimals: 2 },\n        tint: { value: { value: \"#f77300\" } },\n        \"-=direction\": null,\n      },\n      { performDeletions: true },\n    );\n  }\n\n  /**\n   * Configuration for the particle emitter for floating embers\n   * @type {PIXI.particles.EmitterConfigV3}\n   */\n  static EMBERS_CONFIG = {\n    lifetime: { min: 4, max: 6 },\n    behaviors: [\n      {\n        type: \"alpha\",\n        config: {\n          alpha: {\n            list: [\n              { value: 0, time: 0 },\n              { value: 0.9, time: 0.3 },\n              { value: 0.9, time: 0.95 },\n              { value: 0, time: 1 },\n            ],\n          },\n        },\n      },\n      {\n        type: \"moveSpeedStatic\",\n        config: { min: 24, max: 40 },\n      },\n      {\n        type: \"scale\",\n        config: {\n          scale: {\n            list: [\n              { value: 0.15, time: 0 },\n              { value: 0.01, time: 1 },\n            ],\n          },\n          minMult: 0.85,\n        },\n      },\n      {\n        type: \"rotation\",\n        config: { accel: 0, minSpeed: 100, maxSpeed: 200, minStart: 0, maxStart: 365 },\n      },\n      {\n        type: \"textureSingle\",\n        config: { texture: \"modules/fxmaster/assets/particle-effects/effects/embers/ember.png\" },\n      },\n      {\n        type: \"color\",\n        config: {\n          color: {\n            list: [\n              { value: \"f77300\", time: 0 },\n              { value: \"f72100\", time: 1 },\n            ],\n          },\n        },\n      },\n      {\n        type: \"blendMode\",\n        config: {\n          blendMode: \"screen\",\n        },\n      },\n    ],\n  };\n\n  /** @override */\n  static get defaultConfig() {\n    return this.EMBERS_CONFIG;\n  }\n\n  /** @override */\n  getParticleEmitters(options = {}) {\n    options = this.constructor.mergeWithDefaults(options);\n    const d = canvas.dimensions;\n    const maxParticles = (d.width / d.size) * (d.height / d.size) * options.density.value;\n    const config = foundry.utils.deepClone(this.constructor.EMBERS_CONFIG);\n    config.maxParticles = maxParticles;\n    config.frequency = config.lifetime.min / maxParticles;\n    config.behaviors.push({\n      type: \"spawnShape\",\n      config: {\n        type: \"rect\",\n        data: { x: d.sceneRect.x, y: d.sceneRect.y, w: d.sceneRect.width, h: d.sceneRect.height },\n      },\n    });\n    this.applyOptionsToConfig(options, config);\n\n    const emitter = withSteppedGradientColor(this.createEmitter(config), config);\n    return [emitter];\n  }\n}\n","import { FXMasterParticleEffect } from \"./effect.js\";\n\n/**\n * A full-screen weather effect which renders rain drops and splashes.\n */\nexport class RainParticleEffect extends FXMasterParticleEffect {\n  /** @override */\n  static label = \"FXMASTER.ParticleEffectRain\";\n\n  /** @override */\n  static get icon() {\n    return \"modules/fxmaster/assets/particle-effects/icons/rain.png\";\n  }\n\n  /** @override */\n  static get group() {\n    return \"weather\";\n  }\n\n  /**\n   * Configuration for the particle emitter for rain\n   * @type {PIXI.particles.EmitterConfigV3}\n   */\n  static RAIN_CONFIG = {\n    lifetime: { min: 0.5, max: 0.5 },\n    pos: { x: 0, y: 0 },\n    behaviors: [\n      {\n        type: \"alpha\",\n        config: {\n          alpha: {\n            list: [\n              { time: 0, value: 0.7 },\n              { time: 1, value: 0.1 },\n            ],\n          },\n        },\n      },\n      {\n        type: \"moveSpeedStatic\",\n        config: { min: 2800, max: 3500 },\n      },\n      {\n        type: \"scaleStatic\",\n        config: { min: 0.8, max: 1 },\n      },\n      {\n        type: \"rotationStatic\",\n        config: { min: 75, max: 75 },\n      },\n      {\n        type: \"textureSingle\",\n        config: { texture: \"ui/particles/rain.png\" },\n      },\n    ],\n  };\n\n  /**\n   * Configuration for the particle emitter for splashes\n   * @type {PIXI.particles.EmitterConfigV3}\n   */\n  static SPLASH_CONFIG = {\n    lifetime: { min: 0.5, max: 0.5 },\n    pos: { x: 0, y: 0 },\n    behaviors: [\n      {\n        type: \"moveSpeedStatic\",\n        config: { min: 0, max: 0 },\n      },\n      {\n        type: \"scaleStatic\",\n        config: { min: 0.48, max: 0.6 },\n      },\n      {\n        type: \"rotationStatic\",\n        config: { min: -90, max: -90 },\n      },\n      {\n        type: \"noRotation\",\n        config: {},\n      },\n      {\n        type: \"textureSingle\",\n        config: { texture: \"ui/particles/drop.png\" },\n      },\n    ],\n  };\n\n  /** @override */\n  static get defaultConfig() {\n    return this.RAIN_CONFIG;\n  }\n\n  /** @override */\n  getParticleEmitters(options = {}) {\n    options = this.constructor.mergeWithDefaults(options);\n    const d = canvas.dimensions;\n    const maxParticles = (d.width / d.size) * (d.height / d.size) * options.density.value;\n\n    // Create an emitter for rain drops\n    const rainConfig = foundry.utils.deepClone(this.constructor.RAIN_CONFIG);\n    rainConfig.maxParticles = maxParticles;\n    rainConfig.frequency = 1 / maxParticles;\n    rainConfig.behaviors.push({\n      type: \"spawnShape\",\n      config: {\n        type: \"rect\",\n        data: {\n          x: -0.05 * d.width,\n          y: -0.1 * d.height,\n          w: d.width,\n          h: 0.8 * d.height,\n        },\n      },\n    });\n    this.applyOptionsToConfig(options, rainConfig);\n\n    // Create a second emitter for splashes\n    const splashConfig = foundry.utils.deepClone(this.constructor.SPLASH_CONFIG);\n    splashConfig.maxParticles = 0.5 * maxParticles;\n    splashConfig.frequency = 2 / maxParticles;\n    splashConfig.behaviors.push({\n      type: \"spawnShape\",\n      config: {\n        type: \"rect\",\n        data: {\n          x: 0,\n          y: 0.25 * d.height,\n          w: d.width,\n          h: 0.75 * d.height,\n        },\n      },\n    });\n    this.applyOptionsToConfig(options, splashConfig);\n\n    // Return both emitters\n    return [this.createEmitter(rainConfig), this.createEmitter(splashConfig)];\n  }\n}\n","import { FXMasterParticleEffect } from \"./effect.js\";\n\n/**\n * A full-screen weather effect which renders rain drops from top down.\n */\nexport class RainTopParticleEffect extends FXMasterParticleEffect {\n  /**\n   * The id of the canvasPan hook registered by this effect.\n   * @type {number|undefined}\n   * @private\n   */\n  _canvasPanHookId;\n\n  /** @override */\n  static label = \"FXMASTER.ParticleEffectRainTop\";\n\n  /** @override */\n  static get icon() {\n    return \"modules/fxmaster/assets/particle-effects/icons/rain.png\";\n  }\n\n  /** @override */\n  static get group() {\n    return \"weather\";\n  }\n\n  /** @override */\n  static get parameters() {\n    return foundry.utils.mergeObject(\n      super.parameters,\n      {\n        density: { min: 0.01, value: 0.3, max: 1, step: 0.01, decimals: 2 },\n        \"-=direction\": null,\n      },\n      { performDeletions: true },\n    );\n  }\n\n  /**\n   * Configuration for the particle emitter for raindrops from top down\n   * @type {PIXI.particles.EmitterConfigV3}\n   */\n  static RAIN_TOP_CONFIG = {\n    lifetime: { min: 0.6, max: 0.7 },\n    behaviors: [\n      {\n        type: \"alpha\",\n        config: {\n          alpha: {\n            list: [\n              { value: 0, time: 0 },\n              { value: 0.6, time: 0.8 },\n              { value: 0.23, time: 1 },\n            ],\n          },\n        },\n      },\n      {\n        type: \"scale\",\n        config: {\n          scale: {\n            list: [\n              { value: 3, time: 0 },\n              { value: 0.4, time: 1 },\n            ],\n          },\n          minMult: 0.7,\n        },\n      },\n      {\n        type: \"rotationStatic\",\n        config: { min: 180, max: 180 },\n      },\n      {\n        type: \"textureSingle\",\n        config: { texture: \"ui/particles/rain.png\" },\n      },\n    ],\n  };\n\n  /** @override */\n  static get defaultConfig() {\n    return this.RAIN_TOP_CONFIG;\n  }\n\n  /** @override */\n  getParticleEmitters(options = {}) {\n    options = this.constructor.mergeWithDefaults(options);\n    const d = canvas.dimensions;\n    const maxParticles = (d.width / d.size) * (d.height / d.size) * options.density.value;\n    const sceneRadius = Math.sqrt(d.sceneWidth * d.sceneWidth + d.sceneHeight * d.sceneHeight) / 2;\n    const config = foundry.utils.deepClone(this.constructor.RAIN_TOP_CONFIG);\n    config.maxParticles = maxParticles;\n    config.frequency = config.lifetime.min / maxParticles;\n    config.behaviors.push({\n      type: \"moveSpeed\",\n      config: {\n        speed: {\n          list: [\n            { time: 0, value: 1600 },\n            { time: 1, value: 2000 },\n          ],\n        },\n        minMult: 0.8,\n      },\n    });\n    this.applyOptionsToConfig(options, config);\n    const moveSpeedList = config.behaviors.find(({ type }) => type === \"moveSpeed\").config.speed.list;\n    const averageSpeed = moveSpeedList.reduce((acc, cur) => acc + cur.value, 0) / moveSpeedList.length;\n    config.behaviors.push({\n      type: \"spawnShape\",\n      config: {\n        type: \"torus\",\n        data: {\n          x: d.sceneRect.x + d.sceneWidth / 2,\n          y: d.sceneRect.y + d.sceneHeight / 2,\n          radius: averageSpeed * config.lifetime.max + sceneRadius * 2,\n          innerRadius: averageSpeed * config.lifetime.max,\n          affectRotation: true,\n        },\n      },\n    });\n\n    const emitter = this.createEmitter(config);\n    emitter.updateOwnerPos(\n      canvas.stage.pivot.x - d.sceneX - d.sceneWidth / 2,\n      canvas.stage.pivot.y - d.sceneY - d.sceneHeight / 2,\n    );\n    return [emitter];\n  }\n\n  /** @override */\n  play() {\n    this._unregisterCanvasPanHook();\n    this._canvasPanHookId = Hooks.on(\"canvasPan\", (_canvas, position) => {\n      const d = canvas.dimensions;\n      for (let e of this.emitters) {\n        e.updateOwnerPos(position.x - d.sceneX - d.sceneWidth / 2, position.y - d.sceneY - d.sceneHeight / 2);\n      }\n    });\n    super.play();\n  }\n\n  /** @override */\n  stop() {\n    this._unregisterCanvasPanHook();\n    super.stop();\n  }\n\n  /**\n   * Unregister the canvasPan hook used by this effect.\n   * @private\n   */\n  _unregisterCanvasPanHook() {\n    if (this._canvasPanHookId !== undefined) {\n      Hooks.off(\"canvasPan\", this._canvasPanHookId);\n      this._canvasPanHookId = undefined;\n    }\n  }\n}\n","import { FXMasterParticleEffect } from \"./effect.js\";\n\n/**\n * A full-screen weather effect which renders rain drops.\n */\nexport class RainSimpleParticleEffect extends FXMasterParticleEffect {\n  /** @override */\n  static label = \"FXMASTER.ParticleEffectRainSimple\";\n\n  /** @override */\n  static get icon() {\n    return \"modules/fxmaster/assets/particle-effects/icons/rain.png\";\n  }\n\n  /** @override */\n  static get group() {\n    return \"weather\";\n  }\n\n  /**\n   * Configuration for the particle emitter for rain\n   * @type {PIXI.particles.EmitterConfigV3}\n   */\n  static RAIN_CONFIG = {\n    lifetime: { min: 0.5, max: 0.5 },\n    pos: { x: 0, y: 0 },\n    behaviors: [\n      {\n        type: \"alpha\",\n        config: {\n          alpha: {\n            list: [\n              { time: 0, value: 0.7 },\n              { time: 1, value: 0.1 },\n            ],\n          },\n        },\n      },\n      {\n        type: \"moveSpeedStatic\",\n        config: { min: 2800, max: 3500 },\n      },\n      {\n        type: \"scaleStatic\",\n        config: { min: 0.8, max: 1 },\n      },\n      {\n        type: \"rotationStatic\",\n        config: { min: 75, max: 75 },\n      },\n      {\n        type: \"textureSingle\",\n        config: { texture: \"ui/particles/rain.png\" },\n      },\n    ],\n  };\n\n  /** @override */\n  static get defaultConfig() {\n    return this.RAIN_CONFIG;\n  }\n\n  /** @override */\n  getParticleEmitters(options = {}) {\n    options = this.constructor.mergeWithDefaults(options);\n    const d = canvas.dimensions;\n    const maxParticles = (d.width / d.size) * (d.height / d.size) * options.density.value;\n\n    const config = foundry.utils.deepClone(this.constructor.RAIN_CONFIG);\n    config.maxParticles = maxParticles;\n    config.frequency = 1 / maxParticles;\n    config.behaviors.push({\n      type: \"spawnShape\",\n      config: {\n        type: \"rect\",\n        data: {\n          x: -0.05 * d.width,\n          y: -0.1 * d.height,\n          w: d.width,\n          h: 0.8 * d.height,\n        },\n      },\n    });\n    this.applyOptionsToConfig(options, config);\n\n    return [this.createEmitter(config)];\n  }\n}\n","import { FXMasterParticleEffect } from \"./effect.js\";\n\n/**\n * A full-screen weather effect which renders drifting snowflakes.\n */\nexport class SnowParticleEffect extends FXMasterParticleEffect {\n  /** @override */\n  static label = \"FXMASTER.ParticleEffectSnow\";\n\n  /** @override */\n  static get icon() {\n    return \"modules/fxmaster/assets/particle-effects/icons/snow.png\";\n  }\n\n  /** @override */\n  static get group() {\n    return \"weather\";\n  }\n\n  /**\n   * Configuration for the particle emitter for snow\n   * @type {PIXI.particles.EmitterConfigV3}\n   */\n  static SNOW_CONFIG = {\n    lifetime: { min: 4, max: 4 },\n    behaviors: [\n      {\n        type: \"alpha\",\n        config: {\n          alpha: {\n            list: [\n              { time: 0, value: 0.9 },\n              { time: 1, value: 0.5 },\n            ],\n          },\n        },\n      },\n      {\n        type: \"moveSpeed\",\n        config: {\n          speed: {\n            list: [\n              { time: 0, value: 190 },\n              { time: 1, value: 210 },\n            ],\n          },\n          minMult: 0.6,\n        },\n      },\n      {\n        type: \"scale\",\n        config: {\n          scale: {\n            list: [\n              { time: 0, value: 0.2 },\n              { time: 1, value: 0.4 },\n            ],\n          },\n          minMult: 0.5,\n        },\n      },\n      {\n        type: \"rotation\",\n        config: { accel: 0, minSpeed: 0, maxSpeed: 200, minStart: 50, maxStart: 75 },\n      },\n      {\n        type: \"textureSingle\",\n        config: {\n          texture: \"ui/particles/snow.png\",\n        },\n      },\n    ],\n  };\n\n  /** @override */\n  static get defaultConfig() {\n    return this.SNOW_CONFIG;\n  }\n\n  /** @override */\n  getParticleEmitters(options = {}) {\n    options = this.constructor.mergeWithDefaults(options);\n    const d = canvas.dimensions;\n    const maxParticles = (d.width / d.size) * (d.height / d.size) * options.density.value;\n    const config = foundry.utils.deepClone(this.constructor.SNOW_CONFIG);\n    config.maxParticles = maxParticles;\n    config.frequency = (config.lifetime.min + config.lifetime.max) / 2 / maxParticles;\n    config.behaviors.push({\n      type: \"spawnShape\",\n      config: {\n        type: \"rect\",\n        data: { x: 0, y: -0.1 * d.height, w: d.width, h: d.height },\n      },\n    });\n    this.applyOptionsToConfig(options, config);\n    return [this.createEmitter(config)];\n  }\n}\n","export const specialEffects = {\n  fxmaster: {\n    label: \"FXMaster\",\n    effects: [\n      {\n        label: \"Smoke Bomb\",\n        file: \"modules/fxmaster/assets/special-effects/fxmaster/smoke-bomb.webm\",\n        scale: {\n          x: 1.0,\n          y: 1.0,\n        },\n        angle: 0,\n        anchor: {\n          x: 0.5,\n          y: 0.5,\n        },\n        speed: 0,\n        author: \"U~man\",\n      },\n      {\n        label: \"Fireball\",\n        file: \"modules/fxmaster/assets/special-effects/fxmaster/fireball.webm\",\n        scale: {\n          x: 1.0,\n          y: 1.0,\n        },\n        angle: 0,\n        anchor: {\n          x: 0.5,\n          y: 0.5,\n        },\n        author: \"U~man\",\n      },\n      {\n        label: \"Blood Splatter\",\n        file: \"modules/fxmaster/assets/special-effects/fxmaster/blood.webm\",\n        scale: {\n          x: 0.7,\n          y: 0.7,\n        },\n        angle: 0,\n        anchor: {\n          x: 0.5,\n          y: 0.5,\n        },\n        author: \"U~man\",\n      },\n      {\n        label: \"Red Fire Cone\",\n        file: \"modules/fxmaster/assets/special-effects/jinker/dragonBornGold-RedFire15Cone.webm\",\n        scale: {\n          x: 1.0,\n          y: 1.0,\n        },\n        angle: 0,\n        anchor: {\n          x: 0,\n          y: 0.5,\n        },\n        author: \"Jinker\",\n      },\n      {\n        label: \"Acid Line\",\n        file: \"modules/fxmaster/assets/special-effects/jinker/dragonBornBlack-CopperAcid30x5Line.webm\",\n        scale: {\n          x: 1.0,\n          y: 1.0,\n        },\n        angle: 0,\n        anchor: {\n          x: 0,\n          y: 0.5,\n        },\n        author: \"Jinker\",\n      },\n      {\n        label: \"Witch Bolt\",\n        file: \"modules/fxmaster/assets/special-effects/jb2a/Witch_Bolt_Blue_600x200.webm\",\n        scale: {\n          x: 0.7,\n          y: 0.7,\n        },\n        angle: 0,\n        anchor: {\n          x: 0,\n          y: 0.5,\n        },\n        author: \"JB2A\",\n      },\n    ],\n  },\n};\n","import { packageId } from \"../constants.js\";\nimport { logger } from \"../logger.js\";\nimport { executeWhenWorldIsMigratedToLatest, isOnTargetMigration } from \"../migration/migration.js\";\nimport { isEnabled } from \"../settings.js\";\n\nexport class ParticleEffectsLayer extends FullCanvasObjectMixin(CanvasLayer) {\n  constructor() {\n    super();\n    this.#initializeInverseOcclusionFilter();\n    this.mask = canvas.masks.scene;\n    this.sortableChildren = true;\n    this.eventMode = \"none\";\n  }\n\n  /**\n   * Initialize the inverse occlusion filter.\n   */\n  #initializeInverseOcclusionFilter() {\n    this.occlusionFilter = WeatherOcclusionMaskFilter.create({\n      occlusionTexture: canvas.masks.depth.renderTexture,\n    });\n    this.occlusionFilter.enabled = false;\n    this.occlusionFilter.elevation = this.elevation;\n    this.occlusionFilter.blendMode = PIXI.BLEND_MODES.NORMAL;\n    this.filterArea = canvas.app.renderer.screen;\n    this.filters = [this.occlusionFilter];\n  }\n\n  /** @override */\n  static get layerOptions() {\n    return foundry.utils.mergeObject(super.layerOptions, { name: \"particle-effects\" });\n  }\n\n  /**\n   * The currently active particle effects.\n   * @type {Map<string, import('./effects/effect.js').FXMasterParticleEffect>}\n   */\n  particleEffects = new Map();\n\n  /**\n   * The inverse occlusion mask filter bound to this container.\n   * @type {WeatherOcclusionMaskFilter}\n   */\n  occlusionFilter;\n\n  /**\n   * Define an elevation property on the ParticleEffectsLayer layer.\n   * For now, it simply referenes the elevation property of the {@link WeatherEffects} provided by\n   * foundry.\n   * @type {number}\n   */\n  get elevation() {\n    return canvas.weather?.elevation ?? Infinity;\n  }\n\n  set elevation(value) {\n    const weatherEffects = canvas.weather;\n    if (weatherEffects) {\n      weatherEffects.elevation = value;\n    }\n  }\n\n  /** @override */\n  async _draw() {\n    if (!isEnabled()) {\n      return;\n    }\n    if (isOnTargetMigration()) {\n      await this.#draw();\n    } else {\n      // If migrations need to be performed, defer drawing to when they are done.\n      executeWhenWorldIsMigratedToLatest(this.#draw.bind(this));\n    }\n  }\n\n  /** @override */\n  async _tearDown() {\n    this.#destroyEffects();\n    return super._tearDown();\n  }\n\n  #destroyEffects() {\n    if (this.particleEffects.size === 0) return;\n    for (const ec of this.particleEffects.values()) {\n      ec.destroy();\n    }\n    this.particleEffects.clear();\n  }\n\n  /**\n   * Actual implementation of drawing the layer.\n   */\n  async #draw() {\n    await this.drawParticleEffects();\n  }\n\n  async drawParticleEffects({ soft = false } = {}) {\n    if (!canvas.scene) {\n      return;\n    }\n    let zIndex = 0;\n\n    const stopPromise = Promise.all(\n      [...this.particleEffects.entries()].map(async ([id, effect]) => {\n        if (soft) {\n          await effect.fadeOut({ timeout: 20000 });\n        } else {\n          effect.stop();\n        }\n        effect.destroy();\n        // The check is needed because a new effect might have been set already.\n        if (this.particleEffects.get(id) === effect) {\n          this.particleEffects.delete(id);\n        }\n      }),\n    );\n\n    const flags = canvas.scene.getFlag(packageId, \"effects\") ?? {};\n    if (Object.keys(flags).length > 0) {\n      this.occlusionFilter.enabled = true;\n    }\n    for (const [id, { type, options: flagOptions }] of Object.entries(flags)) {\n      if (!(type in CONFIG.fxmaster.particleEffects)) {\n        logger.warn(`Particle effect '${id}' is of unknown type '${flags[id].type}', skipping it.`);\n        continue;\n      }\n      const options = Object.fromEntries(\n        Object.entries(flagOptions).map(([optionName, value]) => [optionName, { value }]),\n      );\n\n      const ec = new CONFIG.fxmaster.particleEffects[type](options);\n      ec.zIndex = zIndex++;\n      ec.blendMode = PIXI.BLEND_MODES.NORMAL;\n\n      this.addChild(ec);\n      this.particleEffects.set(id, ec);\n      ec.play({ prewarm: !soft });\n    }\n\n    await stopPromise;\n\n    if (this.particleEffects.size === 0) {\n      this.occlusionFilter.enabled = false;\n    }\n  }\n}\n","import { packageId } from \"../constants.js\";\n\nexport function registeDrawingsMaskFunctionality() {\n  Hooks.on(\"canvasReady\", drawDrawingsMask);\n\n  for (const hook of [\"updateDrawing\", \"createDrawing\", \"deleteDrawing\"]) {\n    Hooks.on(hook, (drawing) => {\n      drawDrawingsMaskIfCurrentScene(drawing.parent);\n    });\n  }\n\n  Hooks.on(\"updateScene\", (scene, data) => {\n    if (\n      foundry.utils.hasProperty(data, \"flags.fxmaster.invert\") ||\n      foundry.utils.hasProperty(data, \"flags.fxmaster.-=invert\")\n    ) {\n      drawDrawingsMaskIfCurrentScene(scene);\n    }\n  });\n}\n\nfunction drawDrawingsMaskIfCurrentScene(scene) {\n  if (scene === canvas.scene) {\n    drawDrawingsMask();\n  }\n}\n\nfunction drawDrawingsMask() {\n  const msk = canvas.masks.depth;\n  if (msk.fxmasterDrawingsMask) {\n    msk.removeChild(msk.fxmasterDrawingsMask);\n    delete msk.fxmasterDrawingsMask;\n  }\n  const invert = canvas.scene.getFlag(packageId, \"invert\");\n  const mask = invert ? createInvertedMask() : createMask();\n  mask.mask = new PIXI.MaskData();\n  mask.mask.colorMask = PIXI.COLOR_MASK_BITS.BLUE;\n  msk.fxmasterDrawingsMask = msk.addChild(mask);\n}\n\nfunction createMask() {\n  const mask = new PIXI.LegacyGraphics();\n  canvas.drawings.placeables.forEach((drawing) => {\n    const isMask = drawing.document.getFlag(packageId, \"masking\");\n    if (!isMask) return;\n    mask.beginFill(0x0000ff);\n    drawShapeToMask(mask, drawing);\n    mask.endFill();\n  });\n  return mask;\n}\n\nfunction createInvertedMask() {\n  const mask = new PIXI.LegacyGraphics();\n  mask.beginFill(0x0000ff).drawShape(canvas.dimensions.rect).endFill();\n\n  canvas.drawings.placeables.forEach((drawing) => {\n    const isMask = drawing.document.getFlag(packageId, \"masking\");\n    if (!isMask) return;\n    mask.beginHole();\n    drawShapeToMask(mask, drawing);\n    mask.endHole();\n  });\n  return mask;\n}\n\n/**\n * Draw a shape to a mask.\n * @param {PIXI.Graphics} mask    The mask to draw to\n * @param {Drawing}       drawing The drawing of which to draw the dhape\n */\nfunction drawShapeToMask(mask, drawing) {\n  const shape = drawing.shape.geometry.graphicsData[0].shape.clone();\n  switch (drawing.type) {\n    case Drawing.SHAPE_TYPES.ELLIPSE: {\n      shape.x = drawing.center.x;\n      shape.y = drawing.center.y;\n      mask.drawShape(shape);\n      break;\n    }\n    case Drawing.SHAPE_TYPES.POLYGON: {\n      const points = drawing.document.shape.points.map((p, i) =>\n        i % 2 === 0 ? p + drawing.bounds.x : p + drawing.bounds.y,\n      );\n      mask.drawPolygon(points);\n      break;\n    }\n    default: {\n      const s = drawing.document.shape;\n      shape.x = drawing.center.x - s.width / 2;\n      shape.y = drawing.center.y - s.height / 2;\n      mask.drawShape(shape);\n    }\n  }\n}\n","import { packageId } from \"../constants.js\";\nimport { logger } from \"../logger.js\";\nimport { executeWhenWorldIsMigratedToLatest, isOnTargetMigration } from \"../migration/migration.js\";\nimport { isEnabled } from \"../settings.js\";\nimport { resetFlag } from \"../utils.js\";\n\nexport class FilterManager {\n  /** @private */\n  constructor() {\n    this.filters = {};\n    this._ticker = false;\n    this.#registerHooks();\n  }\n\n  /**\n   * A private reference for the global {@link FilterManager} instance.\n   * @type {FilterManager | undefined}\n   */\n  static #instance;\n\n  /**\n   * The container effects should be a pplied to.\n   * @type {PIXI.Container}\n   */\n  static get container() {\n    return canvas.environment;\n  }\n\n  /**\n   * The singleton {@link FilterManager} instance.\n   * @type {FilterManager}\n   */\n  static get instance() {\n    if (!this.#instance) {\n      this.#instance = new this();\n    }\n    return this.#instance;\n  }\n\n  /**\n   * Activate this {@link FilterManager}. This includes creating all the necessary filters, attaching them to the\n   * configured layers, starting their animations.\n   * @returns {Promise<void>} A promise that resolves as soon as filters are activated\n   */\n  async #activate() {\n    await this.#update({ skipFading: true });\n\n    if (!this._ticker) {\n      canvas.app.ticker.add(this.#animate, this);\n      this._ticker = true;\n    }\n  }\n\n  /**\n   * Update the filters to the state that is configured for the active scene.\n   * @param {{skipFading?: boolean}} [options]            Additional options to configure this update\n   * @param {boolean}                [options.skipFading] Whether or not newly created filters should skip their fading\n   * @returns {Promise<void>}                             A promise that resolves as soon as the filters have been updated\n   */\n  async #update({ skipFading = false } = {}) {\n    if (!canvas.scene) {\n      return;\n    }\n    const filterInfos = Object.fromEntries(\n      Object.entries(canvas.scene.getFlag(packageId, \"filters\") ?? {}).filter(([id, filterInfo]) => {\n        if (!(filterInfo.type in CONFIG.fxmaster.filterEffects)) {\n          logger.warn(`Filter effect '${id}' is of unknown type '${filterInfo.type}', skipping it.`);\n          return false;\n        }\n        return true;\n      }),\n    );\n\n    const filtersToCreate = Object.keys(filterInfos).filter((key) => !(key in this.filters));\n    const filtersToUpdate = Object.keys(filterInfos).filter((key) => key in this.filters);\n    const filtersToDelete = Object.keys(this.filters).filter((key) => !(key in filterInfos));\n\n    for (const key of filtersToCreate) {\n      const { type, options } = filterInfos[key];\n      this.filters[key] = new CONFIG.fxmaster.filterEffects[type](options, key);\n      this.filters[key].play({ skipFading });\n    }\n\n    for (const key of filtersToUpdate) {\n      const { options } = filterInfos[key];\n      const filter = this.filters[key];\n      filter.configure(options);\n      filter.play({ skipFading });\n    }\n\n    const deletePromises = filtersToDelete.map(async (key) => {\n      const filter = this.filters[key];\n      const completed = await filter.stop({ skipFading });\n      if (completed) {\n        delete this.filters[key];\n        FilterManager.#removeFilterFromContainer(this.constructor.container, filter);\n      }\n    });\n    await Promise.all(deletePromises);\n\n    this.#applyFilters();\n  }\n\n  /**\n   * Apply the filters to the configured canvas layers.\n   */\n  #applyFilters() {\n    const filters = Object.values(this.filters);\n    const otherFilters = this.constructor.container.filters?.filter((f) => !filters.includes(f)) ?? [];\n    this.constructor.container.filters = otherFilters.concat(filters);\n  }\n\n  /**\n   * Remove a filter from a container.\n   * @param {PIXI.container} container A container\n   * @param {PIXI.Filter} filter A filter\n   */\n  static #removeFilterFromContainer(container, filter) {\n    container.filters = container.filters?.filter((f) => f !== filter) ?? null;\n  }\n\n  /**\n   * Stop all filters and remove them from the manager.\n   * @remarks This does _not_ remove the filters from the canvas layers.\n   * @returns {Promise<void>} A promise that resolves as soon as all filters have been stopped and removed from the\n   *                          manager\n   */\n  async #clear() {\n    const promises = Object.values(this.filters).map((filter) => filter.stop());\n    this.filters = {};\n    await Promise.all(promises);\n  }\n\n  /**\n   * Add a named filter.\n   * @param {string | undefined} name The name of the filter\n   * @param {string} type             The type of the filter\n   * @param {object} options          The options for the filter\n   * @returns {Prmise<void>} A promise that resolves as soon as the filter has been added to the scene's fxmaster flags\n   */\n  async addFilter(name, type, options) {\n    name = name ?? foundry.utils.randomID();\n    await canvas.scene?.setFlag(packageId, \"filters\", { [name]: { type, options } });\n  }\n\n  /**\n   * Remove a named filter.\n   * @param {string} name     The name of the filter to remove\n   * @returns {Promise<void>} A promise that resolves when the filter has been removed from the scene's fxmaster flags\n   */\n  async removeFilter(name) {\n    await canvas.scene?.setFlag(packageId, \"filters\", { [`-=${name}`]: null });\n  }\n\n  /**\n   * Remove all filters.\n   * @returns {Promise<void>} A promise that resolves as soon as all filters have been removed from the scene's fxmaster\n   *                          flags\n   */\n  async removeAll() {\n    await canvas.scene?.unsetFlag(packageId, \"filters\");\n  }\n\n  /**\n   * Toggle a named filter on or off.\n   * @param {string} name     The name of the filter\n   * @param {string} type     The type of the filter\n   * @param {object} options  The options for the filter\n   * @returns {Promise<void>} A promise that resolves as soon as the filter has been toggled\n   */\n  async switch(name, type, options) {\n    if (!canvas.scene) {\n      return;\n    }\n    const filterInfos = canvas.scene.getFlag(packageId, \"filters\") ?? {};\n    if (filterInfos[name]) {\n      return this.removeFilter(name);\n    } else {\n      return this.addFilter(name, type, options);\n    }\n  }\n\n  async setFilters(filterInfoArray) {\n    const filterInfos = Object.fromEntries(filterInfoArray.map((filterInfo) => [foundry.utils.randomID(), filterInfo]));\n    await resetFlag(canvas.scene, \"filters\", filterInfos);\n  }\n\n  #animate() {\n    for (const key in this.filters) {\n      this.filters[key].step();\n    }\n  }\n\n  #registerHooks() {\n    Hooks.on(\"canvasInit\", () => {\n      if (isEnabled()) {\n        this.#clear();\n      }\n    });\n\n    Hooks.on(\"canvasReady\", () => {\n      executeWhenWorldIsMigratedToLatest(async () => {\n        if (isEnabled()) {\n          await this.#activate();\n        }\n      });\n    });\n\n    Hooks.on(\"updateScene\", (scene, data) => {\n      if (!isEnabled() || !isOnTargetMigration() || scene !== canvas.scene) {\n        return;\n      }\n      if (\n        foundry.utils.hasProperty(data, \"flags.fxmaster.filters\") ||\n        foundry.utils.hasProperty(data, \"flags.fxmaster.-=filters\")\n      ) {\n        this.#update();\n      }\n    });\n  }\n}\n","import { easeFunctions } from \"../../ease.js\";\nimport { packageId } from \"../../constants.js\";\n\nexport class SpecialEffectConfig extends FormApplication {\n  static get defaultOptions() {\n    return foundry.utils.mergeObject(super.defaultOptions, {\n      classes: [\"form\"],\n      closeOnSubmit: true,\n      submitOnChange: false,\n      submitOnClose: false,\n      popOut: true,\n      editable: game.user.isGM,\n      width: 320,\n      height: \"auto\",\n      template: \"modules/fxmaster/templates/special-effect-config.hbs\",\n      id: \"add-effect\",\n      title: game.i18n.localize(\"FXMASTER.AddSpecialEffect\"),\n    });\n  }\n\n  /* -------------------------------------------- */\n\n  setDefault(object) {\n    this.default = object;\n  }\n\n  /**\n   * Obtain module metadata and merge it with game settings which track current module visibility\n   * @return {Object}   The data provided to the template when rendering the form\n   */\n  getData() {\n    const eases = easeFunctions;\n    const values = foundry.utils.mergeObject(\n      {\n        folder: \"Custom\",\n        angle: 0,\n        position: {\n          x: 0,\n          y: 0,\n        },\n        anchor: {\n          x: 0.5,\n          y: 0.5,\n        },\n        scale: {\n          x: 1.0,\n          y: 1.0,\n        },\n        speed: 0,\n        animationDelay: {\n          start: 0,\n          end: 0,\n        },\n        ease: \"Linear\",\n        author: \"\",\n        preset: false,\n      },\n      this.default,\n    );\n\n    // Return data to the template\n    return {\n      default: values,\n      ease: Object.keys(eases),\n    };\n  }\n\n  /* -------------------------------------------- */\n  /*  Event Listeners and Handlers                */\n  /* -------------------------------------------- */\n\n  /** @override */\n  activateListeners(html) {\n    super.activateListeners(html);\n    html.find('input[type=\"range\"]').on(\"input\", (event) => this._onChangeRange(event));\n  }\n\n  /**\n   * This method is called upon form submission after form data is validated\n   * @param event {Event}       The initial triggering submission event\n   * @param formData {object}   The object of validated form data with which to update the object\n   * @protected\n   */\n  async _updateObject(_, formData) {\n    const fxs = game.settings.get(packageId, \"specialEffects\");\n\n    const newData = {\n      folder: formData[\"folder\"],\n      label: formData[\"label\"],\n      file: formData[\"file\"],\n      scale: {\n        x: parseFloat(formData[\"scaleX\"]),\n        y: parseFloat(formData[\"scaleY\"]),\n      },\n      angle: parseFloat(formData[\"angle\"]),\n      anchor: {\n        x: formData[\"anchorX\"],\n        y: formData[\"anchorY\"],\n      },\n      speed: parseFloat(formData[\"speed\"]),\n      animationDelay: {\n        start: parseFloat(formData[\"animationDelayStart\"]),\n        end: parseFloat(formData[\"animationDelayEnd\"]),\n      },\n      ease: formData[\"ease\"],\n      preset: false,\n      author: \"\",\n    };\n    const fx = fxs.filter((f) => f.label == newData.label);\n    if (fx.length > 0) {\n      fx[0] = foundry.utils.mergeObject(fx[0], newData);\n    } else {\n      fxs.push(newData);\n    }\n    await game.settings.set(packageId, \"specialEffects\", fxs);\n  }\n}\n","import { SpecialEffectConfig } from \"./special-effect-config.js\";\nimport { packageId } from \"../../constants.js\";\n\nimport \"../../../css/specials-config.css\";\n\nexport class SpecialEffectsManagement extends Application {\n  /** @override */\n  static get defaultOptions() {\n    return foundry.utils.mergeObject(super.defaultOptions, {\n      classes: [\"fxmaster\", \"specials\", \"sidebar-popout\"],\n      closeOnSubmit: true,\n      submitOnChange: false,\n      submitOnClose: false,\n      popOut: true,\n      editable: game.user.isGM,\n      width: 120,\n      height: 200,\n      resizable: true,\n      dragDrop: [{ dragSelector: \".special-effects\" }],\n      template: \"modules/fxmaster/templates/special-effects-management.hbs\",\n      id: \"specials-config\",\n      title: game.i18n.localize(\"FXMASTER.SpecialEffectsManagementTitle\"),\n    });\n  }\n\n  /** @override */\n  getData() {\n    return {\n      folders: CONFIG.fxmaster.userSpecials,\n    };\n  }\n\n  /** @override */\n  activateListeners(html) {\n    html.find(\".special-effects .description\").click((event) => {\n      let list = event.currentTarget.closest(\".directory-list\");\n      let items = $(list).find(\".directory-item\");\n      for (let i = 0; i < items.length; i++) {\n        items[i].classList.remove(\"active\");\n      }\n      event.currentTarget.parentElement.classList.add(\"active\");\n    });\n\n    // Dialog\n    html.find(\"a[data-action=add-effect]\").click(async () => {\n      new SpecialEffectConfig().render(true);\n    });\n\n    html.find(\".preview video\").hover((ev) => {\n      ev.currentTarget.play();\n    });\n\n    html.find(\".del-effect\").click((ev) => {\n      const folderId = ev.currentTarget.closest(\".folder\").dataset[\"folderId\"];\n      const effectId = ev.currentTarget.closest(\".special-effects\").dataset[\"effectId\"];\n      const data = CONFIG.fxmaster.userSpecials[folderId].effects[effectId];\n      const settings = game.settings.get(packageId, \"specialEffects\");\n      const id = settings.findIndex((v) => {\n        return v.label === data.label && v.folder === data.folder;\n      });\n      if (id === -1) {\n        return;\n      }\n      settings.splice(id, 1);\n      game.settings.set(packageId, \"specialEffects\", settings);\n    });\n\n    html.find(\".edit-effect\").click((ev) => {\n      const folderId = ev.currentTarget.closest(\".folder\").dataset[\"folderId\"];\n      const effectId = ev.currentTarget.closest(\".special-effects\").dataset[\"effectId\"];\n      const d = new SpecialEffectConfig();\n      d.setDefault(CONFIG.fxmaster.userSpecials[folderId].effects[effectId]);\n      d.render(true);\n    });\n\n    html.find(\".action-toggle\").click((ev) => {\n      for (const c of ev.currentTarget.parentElement.children) {\n        c.classList.remove(\"active\");\n      }\n      ev.currentTarget.classList.add(\"active\");\n    });\n\n    const directory = html.find(\".directory-list\");\n    directory.on(\"click\", \".folder-header\", this._toggleFolder.bind(this));\n  }\n\n  _toggleFolder(event) {\n    let folder = $(event.currentTarget.parentElement);\n    let collapsed = folder.hasClass(\"collapsed\");\n\n    // Expand\n    if (collapsed) folder.removeClass(\"collapsed\");\n    // Collapse\n    else {\n      folder.addClass(\"collapsed\");\n      folder.find(\".folder\").addClass(\"collapsed\");\n    }\n  }\n\n  /** @override */\n  _onDragStart(event) {\n    const effectId = event.currentTarget.closest(\".special-effects\").dataset.effectId;\n    const folderId = event.currentTarget.closest(\".folder\").dataset.folderId;\n    const effectData = CONFIG.fxmaster.userSpecials[folderId].effects[effectId];\n    effectData.type = \"SpecialEffect\";\n    event.dataTransfer.setData(\"text/plain\", JSON.stringify(effectData));\n  }\n}\n","/**\n * A SpriteMesh which visualizes a special effect object in the PrimaryCanvasGroup.\n */\nexport class SpecialEffectMesh extends SpriteMesh {\n  /** @type {number} */\n  get elevation() {\n    return this.#elevation;\n  }\n\n  set elevation(value) {\n    this.#elevation = value;\n  }\n\n  #elevation = 0;\n}\n","import { packageId } from \"../constants.js\";\nimport { easeFunctions } from \"../ease.js\";\nimport { SpecialEffectMesh } from \"./mesh.js\";\n\nexport class SpecialEffectsLayer extends InteractionLayer {\n  constructor() {\n    super();\n    this.videos = [];\n    this._dragging = false;\n    this.ruler = null;\n    this.windowVisible = false;\n    // Listen to the socket\n    game.socket.on(`module.${packageId}`, (data) => {\n      this.playVideo(data);\n    });\n  }\n\n  static get layerOptions() {\n    return foundry.utils.mergeObject(super.layerOptions, {\n      name: \"specials\",\n      zIndex: 245,\n    });\n  }\n\n  /** @override */\n  async _draw() {\n    await super._draw();\n    this.ruler = this.addChild(new PIXI.Graphics());\n  }\n\n  /** @inheritdoc */\n  async _tearDown() {\n    this.ruler = null;\n    for (const video of this.videos) {\n      video.remove();\n    }\n    this.videos = [];\n    return super._tearDown();\n  }\n\n  _configureProjectile(mesh, data) {\n    if (data.distance && (!data.speed || data.speed == \"auto\")) {\n      data.speed = data.distance / data.duration;\n    }\n    // Compute final position\n    const delta = data.duration * data.speed;\n    const deltaX = delta * Math.cos(data.rotation);\n    const deltaY = delta * Math.sin(data.rotation);\n\n    // Move the sprite\n    const attributes = [\n      {\n        parent: mesh,\n        attribute: \"x\",\n        to: data.position.x + deltaX,\n      },\n      {\n        parent: mesh,\n        attribute: \"y\",\n        to: data.position.y + deltaY,\n      },\n    ];\n\n    let animationDuration = data.duration * 1000;\n    if (foundry.utils.hasProperty(data, \"animationDelay\")) {\n      animationDuration -= Math.max(0, 1000 * (data.animationDelay.end + data.animationDelay.start));\n    }\n    const animationName = `${packageId}.video.${randomID()}.move`;\n    const animate = function () {\n      CanvasAnimation.animate(attributes, {\n        name: animationName,\n        context: this,\n        duration: animationDuration,\n        easing: easeFunctions[data.ease],\n      });\n    };\n    if (foundry.utils.hasProperty(data, \"animationDelay.start\")) {\n      setTimeout(animate, data.animationDelay.start * 1000.0);\n    } else {\n      animate();\n    }\n    return () => CanvasAnimation.terminateAnimation(animationName);\n  }\n\n  _configureRotate(mesh, data) {\n    const attributes = [\n      {\n        parent: mesh,\n        attribute: \"angle\",\n        to: 90 * data.rotationSpeed,\n      },\n    ];\n    let animationDuration = data.duration * 1000;\n    if (foundry.utils.hasProperty(data, \"animationDelay\")) {\n      animationDuration -= Math.max(0, 1000 * (data.animationDelay.end + data.animationDelay.start));\n    }\n    const animationName = `${packageId}.video.${randomID()}.rotate`;\n\n    const animate = function () {\n      CanvasAnimation.animate(attributes, {\n        name: animationName,\n        context: this,\n        duration: animationDuration,\n        easing: easeFunctions[data.ease],\n      });\n    };\n    if (foundry.utils.hasProperty(data, \"animationDelay.start\")) {\n      setTimeout(animate, data.animationDelay.start * 1000.0);\n    } else {\n      animate();\n    }\n    return () => CanvasAnimation.terminateAnimation(animationName);\n  }\n\n  #configureSpecialEffectMesh(mesh, data) {\n    mesh.anchor.set(data.anchor.x, data.anchor.y);\n    mesh.rotation = Math.normalizeRadians(data.rotation - Math.toRadians(data.angle));\n    mesh.scale.set(data.scale.x, data.scale.y);\n    mesh.position.set(data.position.x, data.position.y);\n    mesh.elevation = data.elevation ?? 1;\n\n    if (data.width) {\n      if (data.keepAspect) {\n        const aspectRatio = mesh.height / mesh.width;\n        mesh.height = data.width * aspectRatio;\n      }\n      mesh.width = data.width;\n    }\n\n    /** @type {(() => void) | undefined} */\n    let terminateMovementAnimation;\n    if (data.speed || data.distance) {\n      terminateMovementAnimation = this._configureProjectile(mesh, data);\n    }\n    /** @type {(() => void) | undefined} */\n    let terminateRotationtAnimation;\n    if (data.rotationSpeed) {\n      terminateRotationtAnimation = this._configureRotate(mesh, data);\n    }\n\n    return () => {\n      terminateMovementAnimation?.();\n      terminateRotationtAnimation?.();\n    };\n  }\n\n  playVideo(data) {\n    return new Promise((resolve) => {\n      // Set default values\n      data = foundry.utils.mergeObject(\n        {\n          anchor: { x: 0.5, y: 0.5 },\n          rotation: 0,\n          scale: { x: 1.0, y: 1.0 },\n          position: { x: 0, y: 0 },\n          playbackRate: 1.0,\n          ease: \"Linear\",\n        },\n        data,\n      );\n\n      // Create video\n      const video = document.createElement(\"video\");\n      video.preload = \"auto\";\n      video.crossOrigin = \"anonymous\";\n      video.src = data.file;\n      video.playbackRate = data.playbackRate;\n      this.videos.push(video);\n\n      /** @type {SpriteMesh | undefined} */\n      let mesh;\n      /** @type {(() => void) | undefined} */\n      let terminateAnimation;\n\n      const onCanPlay = () => {\n        mesh = new SpecialEffectMesh(PIXI.Texture.from(video));\n\n        data.dimensions = { w: video.videoWidth, h: video.videoHeight };\n        data.duration = video.duration;\n        terminateAnimation = this.#configureSpecialEffectMesh(mesh, data);\n\n        canvas.primary.addChild(mesh);\n        canvas.primary.videoMeshes.add(mesh);\n      };\n\n      const onEnd = () => {\n        terminateAnimation?.();\n        canvas.primary.removeChild(mesh);\n        canvas.primary.videoMeshes.delete(mesh);\n        resolve();\n        if (!mesh?._destroyed) mesh?.destroy({ children: true });\n      };\n\n      video.oncanplay = onCanPlay;\n      video.onerror = onEnd;\n      video.onended = onEnd;\n    });\n  }\n\n  static _createMacro(effectData) {\n    return `\n      const data = {\n        file: \"${effectData.file}\",\n        position: {\n          x: canvas.scene.dimensions.width / 2,\n          y: canvas.scene.dimensions.height / 2\n        },\n        anchor : {\n          x: ${effectData.anchor.x},\n          y: ${effectData.anchor.y}\n        },\n        angle: ${effectData.angle},\n        speed: ${effectData.speed},\n        scale: {\n          x: ${effectData.scale.x},\n          y: ${effectData.scale.y}\n        }\n      };\n      const tokens = canvas.tokens.controlled;\n      // No tokens are selected, play in a random position\n      if (tokens.length === 0) {\n        canvas.specials.playVideo(data);\n        game.socket.emit(\"module.${packageId}\", data);\n        return;\n      }\n      const targets = game.user.targets;\n      if (targets.size !== 0) {\n        tokens.forEach(t1 => {\n          targets.forEach(t2 => {\n            canvas.specials.drawFacing(data, t1, t2);\n          })\n        })\n        return;\n      }\n      // Play effect on each token\n      tokens.forEach(t => {\n        data.position = {\n          x: t.position.x + t.w / 2,\n          y: t.position.y + t.h / 2\n        };\n        canvas.specials.playVideo(data);\n        game.socket.emit(\"module.${packageId}\", data);\n      })\n\n    `;\n  }\n\n  drawSpecialToward(effect, tok1, tok2) {\n    const origin = {\n      x: tok1.position.x + tok1.w / 2,\n      y: tok1.position.y + tok1.h / 2,\n    };\n    const effectData = foundry.utils.mergeObject(effect, {\n      position: {\n        x: origin.x,\n        y: origin.y,\n      },\n    });\n    const target = {\n      x: tok2.position.x + tok2.w / 2,\n      y: tok2.position.y + tok2.h / 2,\n    };\n    // Compute angle\n    const ray = new Ray(origin, target);\n    effectData.distance = ray.distance;\n    effectData.rotation = ray.angle;\n    // Play to other clients\n    game.socket.emit(`module.${packageId}`, effectData);\n    // Play effect locally\n    return this.playVideo(effectData);\n  }\n\n  drawFacing(effect, tok1, tok2) {\n    const origin = {\n      x: tok1.position.x + tok1.w / 2,\n      y: tok1.position.y + tok1.h / 2,\n    };\n    const effectData = foundry.utils.mergeObject(effect, {\n      position: {\n        x: origin.x,\n        y: origin.y,\n      },\n    });\n    const target = {\n      x: tok2.position.x + tok2.w / 2,\n      y: tok2.position.y + tok2.h / 2,\n    };\n    // Compute angle\n    const ray = new Ray(origin, target);\n    effectData.rotation = ray.angle;\n    // Play to other clients\n    game.socket.emit(`module.${packageId}`, effectData);\n    // Play effect locally\n    return this.playVideo(effectData);\n  }\n\n  /**\n   * Draw a special effect.\n   * @param {PIXI.InteractionEvent} event         The event that triggered the drawing of the special effect\n   * @param {PIXI.Point}            [savedOrigin] The point that was originally clicked on\n   * @returns {Promise<void>}\n   * @remarks\n   * The savedOrigin parameter is required for regular click events because for some reason, the origin has been removed\n   * from the event's data by the time the event is handled.\n   * TODO: investigate further.\n   */\n  _drawSpecial(event, savedOrigin) {\n    event.stopPropagation();\n\n    const windows = Object.values(ui.windows);\n    const effectConfig = windows.find((w) => w.id == \"specials-config\");\n    if (!effectConfig) return;\n    const active = effectConfig.element.find(\".special-effects.active\");\n    if (active.length == 0) return;\n\n    const id = active[0].dataset.effectId;\n    const folder = active[0].closest(\".folder\").dataset.folderId;\n    const effect = CONFIG.fxmaster.userSpecials[folder].effects[id];\n\n    const effectData = foundry.utils.deepClone(effect);\n    const { x, y } = event.interactionData.origin ?? savedOrigin;\n    const data = {\n      ...effectData,\n      position: { x, y },\n      rotation: event.interactionData.rotation,\n      elevation: this.#elevation,\n    };\n\n    if (!event.interactionData.destination) {\n      game.socket.emit(`module.${packageId}`, data);\n      return this.playVideo(data);\n    }\n\n    // Handling different casting modes\n    const actionToggle = effectConfig.element.find(\".action-toggle.active a\");\n    const mode = actionToggle[0].dataset.action;\n    const ray = new Ray(event.interactionData.origin, event.interactionData.destination);\n    switch (mode) {\n      case \"cast-throw\":\n        data.distance = ray.distance;\n        data.speed = \"auto\";\n        break;\n      case \"cast-extend\":\n        data.width = ray.distance || data.width;\n        data.speed = 0;\n        break;\n      case \"cast-expand\":\n        data.width = ray.distance || data.width;\n        data.keepAspect = true;\n        data.speed = 0;\n        break;\n      case \"cast-rotate\":\n        data.rotationSpeed = ray.distance / canvas.grid.w;\n        data.speed = 0;\n        break;\n      case \"cast-static\":\n        break;\n    }\n\n    game.socket.emit(`module.${packageId}`, data);\n    return this.playVideo(data);\n  }\n\n  /** @override */\n  _onDragLeftDrop(event) {\n    const u = {\n      x: event.interactionData.destination.x - event.interactionData.origin.x,\n      y: event.interactionData.destination.y - event.interactionData.origin.y,\n    };\n    const cos = u.x / Math.hypot(u.x, u.y);\n    event.interactionData.rotation = u.y > 0 ? Math.acos(cos) : -Math.acos(cos);\n    this._drawSpecial(event);\n    this.ruler.clear();\n  }\n\n  /** @override */\n  _onDragLeftStart() {\n    this.windowVisible = this._isWindowVisible();\n    if (!this.windowVisible) return;\n    this._dragging = true;\n  }\n\n  /** @override */\n  _onDragLeftMove(event) {\n    if (!this.windowVisible) return;\n    const ray = new Ray(event.interactionData.origin, event.interactionData.destination);\n    this.ruler.clear();\n    this.ruler\n      .lineStyle(3, 0xaa0033, 0.6)\n      .drawCircle(ray.A.x, ray.A.y, 2)\n      .moveTo(ray.A.x, ray.A.y)\n      .lineTo(ray.B.x, ray.B.y)\n      .drawCircle(ray.B.x, ray.B.y, 2);\n  }\n\n  _isWindowVisible() {\n    const windows = Object.values(ui.windows);\n    const effectConfig = windows.find((w) => w.id == \"specials-config\");\n    if (!effectConfig) return false;\n    return true;\n  }\n\n  /** @override */\n  _onClickLeft(event) {\n    this._dragging = false;\n    const origin = event.interactionData.origin;\n    setTimeout(() => {\n      if (!this._dragging) {\n        event.interactionData.rotation = 0;\n        event.interactionData.destination = undefined;\n        this._drawSpecial(event, origin);\n      }\n      this._dragging = false;\n    }, 400);\n  }\n\n  get #elevation() {\n    const effectConfig = Object.values(ui.windows).find((w) => w.id == \"specials-config\");\n    const elevationString = effectConfig?.element.find(\"input[name='elevation']\").val();\n    const elevation = Number.parseFloat(elevationString);\n    if (Number.isNaN(elevation) || !Number.isFinite(elevation)) return 1;\n    return elevation;\n  }\n}\n","/**\n * An abstract FormApplication that handles functionality common to multiple FXMaster forms.\n * In particular, it provides the following functionality:\n * * Handling of collapsible elements\n * * Making slider changes for range inputs update the accompanying text box immediately\n * * Handling the disabled state of the submission button\n *\n * @extends FormApplication\n * @abstract\n * @interface\n *\n * @param {Object} object                     Some object which is the target data structure to be be updated by the form.\n * @param {FormApplicationOptions} [options]  Additional options which modify the rendering of the sheet.\n */\nexport class FXMasterBaseForm extends FormApplication {\n  /** @override */\n  activateListeners(html) {\n    super.activateListeners(html);\n    html\n      .find(\".fxmaster-groups-list__collapse\")\n      .click((event) =>\n        this._onClickCollapse(\n          event,\n          \"fxmaster-groups-list__item\",\n          \"fxmaster-groups-list__collapsible\",\n          \"fxmaster-groups-list__collapse-icon\",\n        ),\n      );\n    html\n      .find(\".fxmaster-list__collapse\")\n      .click((event) =>\n        this._onClickCollapse(\n          event,\n          \"fxmaster-list__item\",\n          \"fxmaster-list__collapsible\",\n          \"fxmaster-list__collapse-icon\",\n        ),\n      );\n    html.find(\".fxmaster-range-input\").on(\"input\", this._onChangeRange.bind(this));\n  }\n\n  /**\n   * Handle toggling a a collapsible. To collapse the collapsible, the class `${collapsibleClass}--collapsed` is\n   * added to it.\n   *\n   * @param {JQuery.ClickEvent} event            The originating click event\n   * @param {string}            parentClass      The CSS class for selecting the parent that contains both the collapse\n   *                                             \"button\" and the collapsible\n   * @param {string}            collapsibleClass The CSS class for selecting the collapsible inside the parent\n   * @param {string}            [iconClass]      An optional CSS class to select an up/down arrow icon to be toggled\n   * @private\n   */\n  _onClickCollapse(event, parentClass, collapsibleClass, iconClass) {\n    const parentItem = $(event.currentTarget).parents(`.${parentClass}`);\n    const collapsible = parentItem.children(`.${collapsibleClass}`);\n    const icon = iconClass !== undefined ? parentItem.find(`.${iconClass}`) : undefined;\n    this._collapse(collapsible, icon, `${collapsibleClass}--collapsed`);\n  }\n\n  /**\n   * Toggle the collapsed state of an element.\n   * @param {JQuery}      collapsible                 The element to collapse\n   * @param {JQuery|null} [icon]                      An up/down arrow icon to be toggled\n   * @param {string}      [collapsedClass=\"collaped\"] The CSS clas to use to mark the element as collapsed\n   * @param {number}      [speed=250]                 The speed for sliding the element in and out, in milliseconds\n   * @private\n   */\n  _collapse(collapsible, icon, collapsedClass = \"collapsed\", speed = 250) {\n    const shouldCollapse = !collapsible.hasClass(collapsedClass);\n\n    if (shouldCollapse) {\n      collapsible.slideUp(speed, () => {\n        collapsible.addClass(collapsedClass);\n        icon?.removeClass(\"fa-angle-down\").addClass(\"fa-angle-up\");\n      });\n    } else {\n      collapsible.slideDown(speed, () => {\n        collapsible.removeClass(collapsedClass);\n        icon?.removeClass(\"fa-angle-up\").addClass(\"fa-angle-down\");\n      });\n    }\n  }\n\n  /** @override */\n  async _onChangeInput(...args) {\n    this.element.find('button[type=\"submit\"]').prop(\"disabled\", false);\n    return super._onChangeInput(...args);\n  }\n\n  /** @override */\n  async _onSubmit(...args) {\n    this.element.find('button[type=\"submit\"]').prop(\"disabled\", true);\n    return super._onSubmit(...args);\n  }\n}\n","import \"../../../css/particle-effects-config.css\";\n\nimport { packageId } from \"../../constants.js\";\nimport { FXMasterBaseForm } from \"../../base-form.js\";\nimport { resetFlag } from \"../../utils.js\";\n\nexport class ParticleEffectsManagement extends FXMasterBaseForm {\n  /** @override */\n  static get defaultOptions() {\n    return foundry.utils.mergeObject(super.defaultOptions, {\n      classes: [\"form\", \"fxmaster\", \"particle-effects\", \"sidebar-popout\"],\n      closeOnSubmit: false,\n      submitOnChange: false,\n      submitOnClose: false,\n      popOut: true,\n      editable: game.user.isGM,\n      width: 300,\n      height: \"auto\",\n      template: \"modules/fxmaster/templates/particle-effects-management.hbs\",\n      id: \"effects-config\",\n      title: game.i18n.localize(\"FXMASTER.ParticleEffectsManagementTitle\"),\n    });\n  }\n\n  /** @override */\n  getData() {\n    const currentParticleEffects = canvas.scene?.getFlag(packageId, \"effects\") ?? {};\n\n    const activeParticleEffects = Object.fromEntries(\n      Object.values(currentParticleEffects).map((effect) => [effect.type, effect.options]),\n    );\n\n    /** @type {import(\"../particle-effects-db.js\").ParticleEffects} */\n    const { particleEffects } = CONFIG.fxmaster;\n\n    /** @type {Record<string, {label: string, expanded: boolean, effects: import(\"../particle-effects-db.js\").ParticleEffects}>}} */\n    const initialParticleEffectGroups = {};\n\n    const particleEffectGroups = Object.entries(particleEffects)\n      .sort(([, clsA], [, clsB]) => clsA.group.localeCompare(clsB.group) || clsA.label.localeCompare(clsB.label))\n      .reduce((groups, [type, cls]) => {\n        const group = cls.group;\n        return {\n          ...groups,\n          [group]: {\n            label: `FXMASTER.ParticleEffectsGroup${group.titleCase()}`,\n            expanded: groups[group]?.expanded || Object.keys(activeParticleEffects).includes(type),\n            effects: {\n              ...groups[group]?.effects,\n              [type]: cls,\n            },\n          },\n        };\n      }, initialParticleEffectGroups);\n\n    return {\n      particleEffectGroups,\n      effects: particleEffects,\n      activeEffects: activeParticleEffects,\n    };\n  }\n\n  /** @override */\n  async _updateObject(_, formData) {\n    /** @type {import(\"../particle-effects-db.js\").ParticleEffects} */\n    const { particleEffects } = CONFIG.fxmaster;\n    const effects = Object.fromEntries(\n      Object.entries(particleEffects)\n        .filter(([type]) => !!formData[type])\n        .map(([type, particleEffectCls]) => {\n          const label = particleEffectCls.label;\n\n          const options = Object.fromEntries(\n            Object.entries(particleEffectCls.parameters).map(([key, parameter]) => {\n              const optionValue =\n                parameter.type === \"color\"\n                  ? { apply: formData[`${label}_${key}_apply`], value: formData[`${label}_${key}`] }\n                  : formData[`${label}_${key}`];\n\n              return [key, optionValue];\n            }),\n          );\n\n          const particleEffect = {\n            type,\n            options,\n          };\n          return [`core_${type}`, particleEffect];\n        }),\n    );\n    resetFlag(canvas.scene, \"effects\", effects);\n  }\n}\n","import \"../../../css/filters-config.css\";\n\nimport { packageId } from \"../../constants.js\";\nimport { FXMasterBaseForm } from \"../../base-form.js\";\nimport { resetFlag } from \"../../utils.js\";\n\nexport class FilterEffectsManagementConfig extends FXMasterBaseForm {\n  /** @override */\n  static get defaultOptions() {\n    return foundry.utils.mergeObject(super.defaultOptions, {\n      classes: [\"form\", \"fxmaster\", \"filters\", \"sidebar-popout\"],\n      closeOnSubmit: false,\n      submitOnChange: false,\n      submitOnClose: false,\n      popOut: true,\n      editable: game.user.isGM,\n      width: 300,\n      height: \"auto\",\n      template: \"modules/fxmaster/templates/filter-effects-management.hbs\",\n      id: \"filters-config\",\n      title: game.i18n.localize(\"FXMASTER.FilterEffectsManagementTitle\"),\n    });\n  }\n\n  /** @override */\n  getData() {\n    const currentFilters = canvas.scene?.getFlag(packageId, \"filters\") ?? {};\n    const activeFilters = Object.fromEntries(\n      Object.values(currentFilters).map((filter) => [filter.type, filter.options]),\n    );\n\n    const filters = Object.fromEntries(\n      Object.entries(CONFIG.fxmaster.filterEffects).sort(([, clsA], [, clsB]) => clsA.label.localeCompare(clsB.label)),\n    );\n\n    return {\n      filters,\n      activeFilters,\n    };\n  }\n\n  /** @override */\n  async _updateObject(_, formData) {\n    if (!canvas.scene) {\n      return;\n    }\n    const filtersDB = CONFIG.fxmaster.filterEffects;\n\n    const filters = Object.fromEntries(\n      Object.entries(filtersDB)\n        .filter(([type]) => !!formData[type])\n        .map(([filterName, filterCls]) => {\n          const label = filterCls.label;\n\n          const options = Object.fromEntries(\n            Object.entries(filterCls.parameters).map(([key, parameter]) => {\n              const optionValue =\n                parameter.type === \"color\"\n                  ? { apply: formData[`${label}_${key}_apply`], value: formData[`${label}_${key}`] }\n                  : formData[`${label}_${key}`];\n\n              return [key, optionValue];\n            }),\n          );\n\n          const filter = {\n            type: filterName,\n            options,\n          };\n          return [`core_${filterName}`, filter];\n        }),\n    );\n\n    resetFlag(canvas.scene, \"filters\", filters);\n  }\n}\n","import { logger } from \"./logger.js\";\nimport { packageId } from \"./constants.js\";\n\nconst defaultMacroImg = \"icons/svg/windmill.svg\";\n\nexport async function saveParticleAndFilterEffectsAsMacro() {\n  const particleEffectFlags = canvas.scene?.getFlag(packageId, \"effects\") ?? {};\n  const particleEffects = Object.values(particleEffectFlags);\n\n  const filterFlags = canvas.scene?.getFlag(packageId, \"filters\") ?? {};\n  const filterEffects = Object.values(filterFlags);\n\n  const { name, img } = getMacroNameAndImg(particleEffects, filterEffects);\n\n  const commands = [];\n  if (particleEffects.length > 0) {\n    commands.push(`Hooks.call('${packageId}.updateParticleEffects', ${JSON.stringify(particleEffects)});`);\n  }\n  if (filterEffects.length > 0) {\n    commands.push(`FXMASTER.filters.setFilters(${JSON.stringify(filterEffects)});`);\n  }\n  const command = commands.join(\"\\n\");\n\n  await Macro.create({ type: \"script\", name, command, img });\n  ui.notifications.info(`Macro '${name}' has been saved in the macro directory`);\n}\n\nfunction getMacroNameAndImg(particleEffects, filterEffects) {\n  const particleEffectLabelsAndIcons = particleEffects.flatMap(({ type }) => {\n    const particleEffectCls = CONFIG.fxmaster.particleEffects[type];\n    if (!particleEffectCls) {\n      logger.warn(`Encountered unknown particle effect type '${type}' during macro creation, skipping it.`);\n      return [];\n    }\n    return [{ label: game.i18n.localize(particleEffectCls.label), icon: particleEffectCls.icon }];\n  });\n  const filterLabels = filterEffects.flatMap(({ type }) => {\n    const filterEffectCls = CONFIG.fxmaster.filterEffects[type];\n    if (!filterEffectCls) {\n      logger.warn(`Encountered unknown filter effect type '${type}' during macro creation, skipping it.`);\n      return [];\n    }\n    return [{ label: game.i18n.localize(filterEffectCls.label) }];\n  });\n\n  if (filterLabels.length === 0) {\n    return particleEffectLabelsAndIcons.length === 1\n      ? {\n          name: `Particle Effect: ${particleEffectLabelsAndIcons[0].label}`,\n          img: particleEffectLabelsAndIcons[0].icon,\n        }\n      : { name: \"Particle Effects\", img: defaultMacroImg };\n  } else if (particleEffectLabelsAndIcons.length === 0) {\n    return filterLabels.length === 1\n      ? {\n          name: `Filter Effect: ${filterLabels[0].label}`,\n          img: defaultMacroImg,\n        }\n      : { name: \"Filter Effects\", img: defaultMacroImg };\n  } else {\n    return { name: `Particle & Filter Effects`, img: defaultMacroImg };\n  }\n}\n","import { packageId } from \"./constants.js\";\nimport { FilterManager } from \"./filter-effects/filter-manager.js\";\nimport { ParticleEffectsManagement } from \"./particle-effects/applications/particle-effects-management.js\";\nimport { SpecialEffectsManagement } from \"./special-effects/applications/special-effects-management.js\";\nimport { FilterEffectsManagementConfig } from \"./filter-effects/applications/filter-effects-management.js\";\nimport { saveParticleAndFilterEffectsAsMacro } from \"./macro.js\";\n\nexport function registerGetSceneControlButtonsHook() {\n  Hooks.on(\"getSceneControlButtons\", getSceneControlButtons);\n}\n\nfunction getSceneControlButtons(controls) {\n  if (canvas == null) {\n    return;\n  }\n  controls.push({\n    name: \"effects\",\n    title: \"CONTROLS.Effects\",\n    icon: \"fas fa-wand-magic-sparkles\",\n    layer: \"specials\",\n    visible: game.user.role >= game.settings.get(packageId, \"permission-create\"),\n    tools: [\n      {\n        name: \"specials\",\n        title: \"CONTROLS.SpecialFX\",\n        icon: \"fas fa-hat-wizard\",\n        onClick: () => {\n          new SpecialEffectsManagement().render(true);\n        },\n        button: true,\n      },\n      {\n        name: \"particle-effects\",\n        title: \"CONTROLS.ParticleEffects\",\n        icon: \"fas fa-cloud-rain\",\n        onClick: () => {\n          new ParticleEffectsManagement().render(true);\n        },\n        visible: game.user.isGM,\n        button: true,\n      },\n      {\n        name: \"invertmask\",\n        title: \"CONTROLS.InvertMask\",\n        icon: \"fas fa-mask\",\n        onClick: () => {\n          if (canvas.scene) {\n            const invert = canvas.scene.getFlag(packageId, \"invert\") ?? false;\n            canvas.scene.setFlag(packageId, \"invert\", !invert);\n          }\n        },\n        visible: game.user.isGM,\n        active: canvas.scene?.getFlag(packageId, \"invert\") ?? false,\n        toggle: true,\n      },\n      {\n        name: \"filters\",\n        title: \"CONTROLS.Filters\",\n        icon: \"fas fa-filter\",\n        onClick: () => {\n          new FilterEffectsManagementConfig().render(true);\n        },\n        visible: game.user.isGM,\n        button: true,\n      },\n      {\n        name: \"save\",\n        title: \"CONTROLS.SaveMacro\",\n        icon: \"fas fa-floppy-disk\",\n        onClick: saveParticleAndFilterEffectsAsMacro,\n        visible: game.user.isGM,\n        button: true,\n      },\n      {\n        name: \"clearfx\",\n        title: \"CONTROLS.ClearFX\",\n        icon: \"fas fa-trash\",\n        onClick: () => {\n          Dialog.confirm({\n            title: game.i18n.localize(\"FXMASTER.ClearParticleAndFilterEffectsTitle\"),\n            content: game.i18n.localize(\"FXMASTER.ClearParticleAndFilterEffectsContent\"),\n            yes: () => {\n              if (canvas.scene) {\n                FilterManager.instance.removeAll();\n                canvas.scene.unsetFlag(packageId, \"effects\");\n              }\n            },\n            defaultYes: true,\n          });\n        },\n        visible: game.user.isGM,\n        button: true,\n      },\n    ],\n    activeTool: \"effect\",\n  });\n}\n","import { isEnabled, registerSettings } from \"./settings.js\";\nimport { registerHooks } from \"./hooks.js\";\nimport { FXMASTER } from \"./config.js\";\nimport { ParticleEffectsLayer } from \"./particle-effects/particle-effects-layer.js\";\nimport { registeDrawingsMaskFunctionality } from \"./particle-effects/drawings-mask.js\";\nimport { FilterManager } from \"./filter-effects/filter-manager.js\";\nimport { isOnTargetMigration, migrate, migration } from \"./migration/migration.js\";\nimport { SpecialEffectsManagement } from \"./special-effects/applications/special-effects-management.js\";\nimport { SpecialEffectsLayer } from \"./special-effects/special-effects-layer.js\";\nimport { registerHandlebarsHelpers } from \"./handlebars-helpers.js\";\nimport { registerGetSceneControlButtonsHook } from \"./controls.js\";\nimport { format } from \"./logger.js\";\n\nimport \"../css/common.css\";\n\nwindow.FXMASTER = {\n  filters: FilterManager.instance,\n  migration,\n};\n\nfunction registerLayers() {\n  CONFIG.Canvas.layers.fxmaster = { layerClass: ParticleEffectsLayer, group: \"primary\" };\n  CONFIG.Canvas.layers.specials = { layerClass: SpecialEffectsLayer, group: \"interface\" };\n}\n\nfunction parseSpecialEffects() {\n  const effectData = game.settings.get(\"fxmaster\", \"specialEffects\");\n  const specialEffects = foundry.utils.deepClone(CONFIG.fxmaster.specialEffects);\n  effectData.reduce((acc, cur) => {\n    if (!cur.folder) cur.folder = \"Custom\";\n    const normalizedFolder = cur.folder.toLowerCase().replace(/ /g, \"\");\n    if (!acc[normalizedFolder]) acc[normalizedFolder] = { label: cur.folder, effects: [] };\n    acc[normalizedFolder].effects.push(cur);\n    return acc;\n  }, specialEffects);\n  Object.keys(specialEffects).forEach((k) => {\n    specialEffects[k].effects.sort((a, b) => (\"\" + a.label).localeCompare(b.label));\n  });\n  CONFIG.fxmaster.userSpecials = specialEffects;\n}\n\nHooks.once(\"init\", function () {\n  registerSettings();\n  registerHooks();\n  registerLayers();\n  registerHandlebarsHelpers();\n\n  if (!CONFIG.fxmaster) CONFIG.fxmaster = {};\n\n  const configDeprecations = {\n    weather: \"particleEffects\",\n    filters: \"filterEffects\",\n    specials: \"specialEffects\",\n  };\n\n  const getConfigDeprecationMessage = (old, replacement) =>\n    format(`CONFIG#fxmaster#${old} is deprecated in favor of CONFIG#fxmaster#${replacement}'`);\n\n  for (const [old, replacement] of Object.entries(configDeprecations)) {\n    if (CONFIG.fxmaster[old]) {\n      CONFIG.fxmaster[replacement] = CONFIG.fxmaster[old];\n      delete CONFIG.fxmaster[old];\n      const msg = getConfigDeprecationMessage(old, replacement);\n      foundry.utils.logCompatibilityWarning(msg, {\n        mod: foundry.CONST.COMPATIBILITY_MODES.WARNING,\n        since: \"FXMaster v3.0.0\",\n        until: \"FXMaster v4.0.0\",\n        stack: false,\n      });\n    }\n  }\n\n  foundry.utils.mergeObject(CONFIG.fxmaster, {\n    filterEffects: FXMASTER.filterEffects,\n    particleEffects: FXMASTER.particleEffects,\n    specialEffects: FXMASTER.specialEffects,\n  });\n\n  for (const [old, replacement] of Object.entries(configDeprecations)) {\n    Object.defineProperty(CONFIG.fxmaster, old, {\n      get: () => {\n        const msg = getConfigDeprecationMessage(old, replacement);\n        foundry.utils.logCompatibilityWarning(msg, {\n          mod: foundry.CONST.COMPATIBILITY_MODES.WARNING,\n          since: \"FXMaster v3.0.0\",\n          until: \"FXMaster v4.0.0\",\n          stack: false,\n        });\n        return CONFIG.fxmaster[replacement];\n      },\n    });\n  }\n\n  const weatherEffects = Object.fromEntries(\n    Object.entries(CONFIG.fxmaster.particleEffects).map(([id, effectClass]) => [\n      `fxmaster.${id}`,\n      {\n        id: `fxmaster.${id}`,\n        label: `${effectClass.label}WeatherEffectsConfig`,\n        effects: [{ id: `${id}Particles`, effectClass }],\n      },\n    ]),\n  );\n\n  CONFIG.originalWeatherEffects = CONFIG.weatherEffects;\n  CONFIG.weatherEffects = { ...CONFIG.weatherEffects, ...weatherEffects };\n});\n\nHooks.once(\"ready\", () => {\n  migrate();\n});\n\nHooks.on(\"canvasInit\", () => {\n  if (isEnabled()) {\n    parseSpecialEffects();\n  }\n});\n\nHooks.on(\"updateScene\", (scene, data) => {\n  if (!isEnabled() || !isOnTargetMigration() || scene !== canvas.scene) {\n    return;\n  }\n  if (\n    foundry.utils.hasProperty(data, \"flags.fxmaster.effects\") ||\n    foundry.utils.hasProperty(data, \"flags.fxmaster.-=effects\")\n  ) {\n    canvas.fxmaster.drawParticleEffects({ soft: true });\n  }\n});\n\nHooks.on(\"dropCanvasData\", async (canvas, data) => {\n  if (!(canvas.activeLayer instanceof SpecialEffectsLayer) || !canvas.scene) return;\n  if (data.type !== \"SpecialEffect\") return;\n\n  await new Promise((resolve) => {\n    const vid = document.createElement(\"video\");\n    vid.addEventListener(\n      \"loadedmetadata\",\n      () => {\n        data.width = vid.videoWidth * data.scale.x;\n        data.height = vid.videoHeight * data.scale.y;\n        resolve();\n      },\n      false,\n    );\n    vid.src = data.file;\n  });\n\n  const tileData = {\n    alpha: 1,\n    flags: {},\n    height: data.height,\n    hidden: false,\n    img: data.file,\n    locked: false,\n    occlusion: { mode: 1, alpha: 0 },\n    overHead: false,\n    rotation: 0,\n    tileSize: 100,\n    video: { loop: true, autoplay: true, volume: 0 },\n    width: data.width,\n    x: data.x - data.anchor.x * data.width,\n    y: data.y - data.anchor.y * data.height,\n    z: 100,\n  };\n  ui.notifications.info(`A new Tile was created for effect ${data.label}`);\n  canvas.scene.createEmbeddedDocuments(\"Tile\", [tileData]).then(() => {});\n});\n\nHooks.on(\"hotbarDrop\", (hotbar, data) => {\n  if (data.type !== \"SpecialEffect\") return;\n  const macroCommand = SpecialEffectsLayer._createMacro(data);\n  data.type = \"Macro\";\n  data.data = {\n    command: macroCommand,\n    name: data.label,\n    type: \"script\",\n    author: game.user.id,\n  };\n});\n\nHooks.on(\"updateSetting\", (setting) => {\n  if (setting.key === \"fxmaster.specialEffects\") {\n    parseSpecialEffects();\n    Object.values(ui.windows).forEach((w) => {\n      if (w instanceof SpecialEffectsManagement) {\n        w.render(false);\n      }\n    });\n  }\n});\n\nHooks.on(\"renderDrawingHUD\", (hud, html) => {\n  const maskToggle = document.createElement(\"div\");\n  maskToggle.classList.add(\"control-icon\");\n  if (hud.object.document.flags?.fxmaster?.masking) {\n    maskToggle.classList.add(\"active\");\n  }\n  maskToggle.setAttribute(\"title\", game.i18n.localize(\"FXMASTER.MaskParticleEffects\"));\n  maskToggle.dataset.action = \"mask\";\n  maskToggle.innerHTML = `<i class=\"fas fa-cloud\"></i>`;\n  html.find(\".col.left\").append(maskToggle);\n\n  html.find(\".control-icon[data-action='mask']\").on(\"click\", (event) => {\n    event.preventDefault();\n\n    const isMask = hud.object.document.flags?.fxmaster?.masking;\n    const updates = hud.layer.controlled.map((object) => {\n      return { _id: object.id, \"flags.fxmaster.masking\": !isMask };\n    });\n\n    event.currentTarget.classList.toggle(\"active\", !isMask);\n    canvas.scene.updateEmbeddedDocuments(hud.object.document.documentName, updates);\n  });\n});\n\nregisterGetSceneControlButtonsHook();\nregisteDrawingsMaskFunctionality();\n","export function registerHandlebarsHelpers() {\n  Handlebars.registerHelper(\"fxmasterParameter\", (effectCls, parameterConfig, parameterName, options = {}) => {\n    const _default = options[parameterName] ?? effectCls.default[parameterName];\n\n    switch (parameterConfig.type) {\n      case \"color\":\n        return `\n              <input type=\"checkbox\" name=\"${effectCls.label}_${parameterName}_apply\" ${\n          _default.apply ? \"checked\" : \"\"\n        }/>\n              <input type=\"color\" name=\"${effectCls.label}_${parameterName}\" value=\"${_default.value}\">\n              `;\n      case \"range\":\n        return `\n              <input class=\"fxmaster-range-input\" type=\"range\" step=\"${parameterConfig.step}\" min=\"${parameterConfig.min}\" max=\"${parameterConfig.max}\" name=\"${effectCls.label}_${parameterName}\" value=\"${_default}\">\n              <span class=\"range-value\">${_default}</span>\n              `;\n      case \"number\":\n        return `\n              <input class=\"fxmaster-text-input\" type=\"text\" data-dtype=\"Number\" name=\"${effectCls.label}_${parameterName}\" value=\"${_default}\">\n              `;\n      case \"multi-select\":\n        return `<select class=\"fxmaster-multi-select\" multiple name=\"${\n          effectCls.label\n        }_${parameterName}\">${Object.entries(parameterConfig.options).map(\n          ([key, name]) =>\n            `<option class=\"fxmaster-multi-select__option\" value=\"${key}\"${\n              _default.includes(key) ? \" selected\" : \"\"\n            }>${game.i18n.localize(name)}</option>`,\n        )}</select>`;\n    }\n    return \"\";\n  });\n}\n"],"names":["packageId","resetFlag","document","key","value","Array","isArray","oldFlags","getFlag","Object","keys","forEach","k","setFlag","roundToDecimals","number","decimals","Number","Math","round","loggingContext","loggingSeparator","getLoggingFunction","type","log","console","data","format","msg","logger","freeze","debug","info","warn","error","async","migrateWorldCollection","collection","migrateDocument","isError","documentName","name","id","e","migrateCompendiumCollection","pack","metadata","wasLocked","locked","configure","documents","getDocuments","migrateWorldCollections","collections","migrationConfiguration","migrateCompendiumCollections","packs","migrateNonWorldPacks","package","migrate","game","migrate2","migrationConfiguration2","Scene","migrateScene","scene","particleEffects","length","newParticleEffects","fromEntries","entries","map","effect","particleEffectClass","CONFIG","fxmaster","options","convertOptionsToV2","migrate3","migrationConfiguration3","Macro","migrateMacro","macro","command","img","newCommand","replaceAll","newImg","update","undefined","unsetFlag","migrate4","migrationConfiguration4","originalWeatherEffectKeys","originalWeatherEffects","filter","includes","weather","targetServerMigration","isOnTargetWorldMigration","settings","get","migrate1","effects","i","scale","x","y","set","targetClientMigration","migrateClient","migration","ui","notifications","permanent","localize","user","isGM","migrateWorld","isOnTargetMigration","isOnTargetClientMigration","executeWhenWorldIsMigratedToLatest","callback","worldMigrationCallbacks","push","onWorldMigrated","shift","client","world","config","helpers","isEnabled","registerHooks","Hooks","on","onSwitchParticleEffects","onUpdateParticleEffects","deprecations","hook","onDeprecated","args","deprecation","replacedBy","foundry","utils","logCompatibilityWarning","mod","CONST","COMPATIBILITY_MODES","WARNING","since","until","stack","parameters","canvas","currentEffects","omit","object","_omitted","rest","parametersArray","randomID","updateWeather","switchWeather","FXMasterFilterEffectMixin","Base","constructor","super","this","enabled","applyOptions","neutral","static","default","parameterName","parameterConfig","optionContext","play","_options","FadingFilterMixin","currentAnimation","initialized","duration","CanvasAnimation","terminateAnimation","toAnimate","toSet","partition","skipInitialAnimation","anim","parent","attribute","to","animate","finally","skipFading","otherOptions","animateOptions","stop","completed","BloomFilter","PIXI","filters","AdvancedBloomFilter","blur","label","max","min","step","bloomScale","threshold","noise","ColorFilter","AdjustmentFilter","color","apply","saturation","contrast","brightness","gamma","red","green","blue","r","g","b","Color","from","FogFilter","Filter","uniforms","time","dimensions","Float32Array","lastTick","speed","density","size","app","ticker","lastTime","delta","filterManager","input","output","clear","currentState","filterMatrix","Matrix","copyFrom","target","worldTransform","invert","easeFunctions","Linear","easeLinear","InSine","easeInSine","cos","PI","OutSine","easeOutSine","sin","InOutSine","easeInOutSine","InBack","easeInBack","c1","OutBack","easeOutBack","pow","InOutBack","easeInOutBack","c2","InCubic","easeInCubic","OutCubic","easeOutCubic","InOutCubic","easeInOutCubic","InCirc","easeInCirc","sqrt","OutCirc","easeOutCirc","InOutCirc","easeInOutCirc","LightningFilter","nextLigthningTime","frequency","spark_duration","random","attributes","context","easing","OldFilmFilter","vignetting","vignettingAlpha","sepia","seed","PredatorFilter","CRTFilter","curvature","period","lineWidth","UnderwaterFilter","DisplacementFilter","displacemenntMap","Sprite","displacementMap","texture","baseTexture","wrapMode","WRAP_MODES","REPEAT","anchor","width","height","primary","addChild","removeChild","maskSprite","filterEffects","bloom","fog","lightning","oldfilm","predator","underwater","FXMasterParticleEffect","ParticleEffect","group","icon","direction","defaultDirection","lifetime","alpha","tint","mergeObject","insertKeys","inplace","defaultConfig","Error","rotationBehavior","behaviors","find","behavior","minStart","maxStart","rotationStaticBehavior","applyOptionsToConfig","_applyScaleToConfig","_applySpeedToConfig","_applyDirectionToConfig","_applyLifetimeToConfig","_applyTintToConfig","_applyAlphaToConfig","_applyFactorToValueList","valueList","factor","list","valueStep","_applyFactorToRandNumber","randNumber","range","concat","prewarm","emitters","emitter","autoUpdate","emit","maxLifetime","timeout","emitterPromises","Promise","resolve","emitterLifetime","playOnceAndDestroy","promises","all","setTimeout","then","destroy","bind","race","optionKey","optionValue","_convertScaleToV2","_convertSpeedToV2","_convertDensityToV2","speeds","flatMap","maximumSpeed","d","DefautlRectangleSpawnMixin","getParticleEmitters","mergeWithDefaults","maxParticles","deepClone","sceneRect","w","h","createEmitter","SpiderParticleEffect","performDeletions","minMult","framerate","loop","textures","fromRange","n","count","String","padStart","SPIDERS_CONFIG","withSteppedGradientColor","steps","getBehavior","reset","particles","ParticleUtils","createSteppedGradient","StarsParticleEffect","accel","minSpeed","maxSpeed","blendMode","STARS_CONFIG","AutumnLeavesParticleEffect","LEAF_CONFIG","BatsParticleEffect","BATS_CONFIG","BubblesParticleEffect","BUBBLES_CONFIG","CloudsParticleEffect","CLOUDS_CONFIG","offsetFactor","averageDiagonalTime","minLifetime","angle","toRadians","directionVector","CrowsParticleEffect","CROWS_CONFIG","parseSpriteSheetSync","_callback","parsedTextures","values","_batchIndex","_processFrames","_processAnimations","_parseComplete","FogParticleEffect","FOG_CONFIG","RatsParticleEffect","RATS_CONFIG","SnowstormParticleEffect","path","SNOWSTORM_CONFIG","FXMASTER","bats","birds","BirdsParticleEffect","animations","glide","flap","mixed","BIRDS_CONFIG","anims","_getAnimations","textureNumber","fill","deepFlatten","getAnim","animation","crows","eagles","EaglesParticleEffect","EAGLES_CONFIG","_textures","_initializeTextures","_textureCache","spriteSheetTexture","Texture","spriteSheetData","meta","frames","frame","rotated","trimmed","spriteSourceSize","sourceSize","spriteSheet","Spritesheet","call","rats","spiders","bubbles","embers","EmbersParticleEffect","EMBERS_CONFIG","stars","leaves","clouds","rain","RainParticleEffect","pos","RAIN_CONFIG","rainConfig","splashConfig","SPLASH_CONFIG","raintop","RainTopParticleEffect","_canvasPanHookId","RAIN_TOP_CONFIG","sceneRadius","sceneWidth","sceneHeight","moveSpeedList","averageSpeed","reduce","acc","cur","radius","innerRadius","affectRotation","updateOwnerPos","stage","pivot","sceneX","sceneY","_unregisterCanvasPanHook","_canvas","position","off","rainsimple","RainSimpleParticleEffect","snow","SnowParticleEffect","SNOW_CONFIG","snowstorm","specialEffects","file","author","ParticleEffectsLayer","FullCanvasObjectMixin","CanvasLayer","initializeInverseOcclusionFilter","mask","masks","sortableChildren","eventMode","occlusionFilter","WeatherOcclusionMaskFilter","create","occlusionTexture","depth","renderTexture","elevation","BLEND_MODES","NORMAL","filterArea","renderer","screen","layerOptions","Map","Infinity","weatherEffects","draw","destroyEffects","_tearDown","ec","drawParticleEffects","soft","zIndex","stopPromise","fadeOut","delete","flags","flagOptions","optionName","drawDrawingsMaskIfCurrentScene","drawDrawingsMask","msk","fxmasterDrawingsMask","createInvertedMask","LegacyGraphics","beginFill","drawShape","rect","endFill","drawings","placeables","drawing","beginHole","drawShapeToMask","endHole","createMask","MaskData","colorMask","COLOR_MASK_BITS","BLUE","shape","geometry","graphicsData","clone","Drawing","SHAPE_TYPES","ELLIPSE","center","POLYGON","points","p","bounds","drawPolygon","s","FilterManager","_ticker","container","environment","instance","add","filterInfos","filterInfo","filtersToCreate","filtersToUpdate","filtersToDelete","deletePromises","removeFilterFromContainer","applyFilters","otherFilters","f","removeFilter","addFilter","filterInfoArray","activate","hasProperty","SpecialEffectConfig","FormApplication","defaultOptions","classes","closeOnSubmit","submitOnChange","submitOnClose","popOut","editable","template","title","i18n","setDefault","getData","eases","folder","animationDelay","start","end","ease","preset","activateListeners","html","event","_onChangeRange","_","formData","fxs","newData","parseFloat","fx","SpecialEffectsManagement","Application","resizable","dragDrop","dragSelector","folders","userSpecials","click","currentTarget","closest","items","$","classList","remove","parentElement","render","hover","ev","folderId","dataset","effectId","findIndex","v","splice","c","children","_toggleFolder","hasClass","removeClass","addClass","_onDragStart","effectData","dataTransfer","setData","JSON","stringify","SpecialEffectMesh","SpriteMesh","SpecialEffectsLayer","InteractionLayer","videos","_dragging","ruler","windowVisible","socket","playVideo","_draw","Graphics","video","_configureProjectile","mesh","distance","deltaX","rotation","deltaY","animationDuration","animationName","_configureRotate","rotationSpeed","configureSpecialEffectMesh","normalizeRadians","keepAspect","aspectRatio","terminateMovementAnimation","terminateRotationtAnimation","playbackRate","createElement","preload","crossOrigin","src","onEnd","videoMeshes","_destroyed","oncanplay","videoWidth","videoHeight","onerror","onended","drawSpecialToward","tok1","tok2","origin","ray","Ray","drawFacing","_drawSpecial","savedOrigin","stopPropagation","effectConfig","windows","active","element","interactionData","destination","mode","action","grid","_onDragLeftDrop","u","hypot","acos","_onDragLeftStart","_isWindowVisible","_onDragLeftMove","lineStyle","drawCircle","A","moveTo","lineTo","B","_onClickLeft","elevationString","val","isNaN","isFinite","FXMasterBaseForm","_onClickCollapse","parentClass","collapsibleClass","iconClass","parentItem","parents","collapsible","_collapse","collapsedClass","slideUp","slideDown","prop","_onChangeInput","_onSubmit","ParticleEffectsManagement","currentParticleEffects","activeParticleEffects","particleEffectGroups","sort","clsA","clsB","localeCompare","groups","cls","titleCase","expanded","activeEffects","particleEffectCls","parameter","FilterEffectsManagementConfig","currentFilters","activeFilters","filtersDB","filterName","filterCls","defaultMacroImg","saveParticleAndFilterEffectsAsMacro","particleEffectFlags","filterFlags","getMacroNameAndImg","particleEffectLabelsAndIcons","filterLabels","filterEffectCls","commands","join","getSceneControlButtons","controls","layer","visible","role","tools","onClick","button","toggle","Dialog","confirm","content","yes","removeAll","defaultYes","activeTool","parseSpecialEffects","normalizedFolder","toLowerCase","replace","a","window","once","registerSettings","register","scope","Boolean","requiresReload","onChange","hint","USER_ROLES","ASSISTANT","choices","PLAYER","TRUSTED","GAMEMASTER","registerLayers","Canvas","layers","layerClass","specials","registerHandlebarsHelpers","Handlebars","registerHelper","effectCls","_default","configDeprecations","getConfigDeprecationMessage","old","replacement","defineProperty","effectClass","activeLayer","vid","addEventListener","tileData","hidden","occlusion","overHead","tileSize","autoplay","volume","z","createEmbeddedDocuments","hotbar","macroCommand","_createMacro","setting","hud","maskToggle","masking","setAttribute","innerHTML","append","preventDefault","isMask","updates","controlled","_id","updateEmbeddedDocuments","registerGetSceneControlButtonsHook","registeDrawingsMaskFunctionality"],"mappings":"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"}