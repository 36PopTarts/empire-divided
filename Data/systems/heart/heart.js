(()=>{"use strict";var e={7:(e,t,a)=>{a.d(t,{Z:()=>r});var i=a(761),s=a.n(i)()((function(e){return e[1]}));s.push([e.id,".sticky{position:sticky;top:0;z-index:1}.section{padding:.5em}.item-list>*{padding:.5em;margin:.5em 0;border:1px solid rgba(99,0,0,.2);border-radius:5px}a[disabled]{opacity:.5;pointer-events:none}.heart.sheet.actor.adversary{position:relative;background:#fff}.heart.sheet.actor.adversary h3{font-size:1.5em}.heart.sheet.actor.adversary .info .grid-2{grid-gap:1em;align-items:center}.heart.sheet.actor.adversary img.profile{object-fit:contain;width:100%;min-height:100px;max-height:256px;border:0;background:rgba(99,0,0,.2)}.heart.sheet.actor.adversary .faded{opacity:66%}.heart.sheet.actor.adversary .right{float:right;flex:auto 0 0}.heart.sheet.actor.adversary .col{margin:0 .5em}.heart.sheet.actor.adversary .grid-2 input:not([type]){border:0;border-bottom:1px dotted #630000;font-size:1.5em}.heart.sheet.actor.adversary .grid-3{display:grid;grid-template-columns:1fr 1fr 1fr;place-items:stretch;column-gap:.5em}.heart.sheet.actor.adversary .grid-3.resistances{grid-template-columns:auto auto auto;align-items:start;justify-content:space-evenly}.heart.sheet.actor.adversary .grid-3.resistances.left{justify-self:left}.heart.sheet.actor.adversary .bold{font-weight:bold;font-size:16px}",""]);const r=s},875:(e,t,a)=>{a.d(t,{Z:()=>r});var i=a(761),s=a.n(i)()((function(e){return e[1]}));s.push([e.id,'.heart.sheet.actor h2{font-family:"MelmaCracked";text-transform:uppercase;color:#630000;border:0;font-weight:bold;margin:0;padding:0;flex-grow:0}.heart.sheet.actor h2>div{font-size:1rem;color:#000}.heart.sheet.actor h3{font-family:"MelmaCracked";font-size:1.5em;text-transform:uppercase;color:#630000;border:0;font-weight:bold;margin:0;padding:0;flex-grow:0}.heart.sheet.actor .editor-content{font-size:15px;line-height:20px;background-image:-moz-linear-gradient(top, transparent, transparent 19px, rgba(99, 0, 0, 0.2) 0px);background-image:-webkit-linear-gradient(top, transparent, transparent 19px, rgba(99, 0, 0, 0.2) 0px);background-size:100% 20px;min-height:8em}.heart.sheet.actor .editor-content p{margin:0}.heart.sheet.actor.base img.profile{flex-grow:1;background:rgba(0,0,0,.5);cursor:pointer;max-height:6em}.heart.sheet.actor.base .text{flex-grow:3;display:flex;flex-flow:column}.heart.sheet.actor.base input[name=name]{grid-area:1/2/2/3;flex-grow:0;font-size:2em;border:0;align-self:bottom;text-align:center;background:none;color:#630000;font-weight:bold}.heart.sheet.actor.base .actor-type{color:#2c2c2c;font-size:1.2em;text-transform:uppercase;font-style:italic;align-self:top;flex-grow:0;text-align:center}',""]);const r=s},963:(e,t,a)=>{a.d(t,{Z:()=>r});var i=a(761),s=a.n(i)()((function(e){return e[1]}));s.push([e.id,'.sticky{position:sticky;top:0;z-index:1}.section{padding:.5em}.item-list>*{padding:.5em;margin:.5em 0;border:1px solid rgba(99,0,0,.2);border-radius:5px}a[disabled]{opacity:.5;pointer-events:none}.heart.sheet.actor.character{position:relative;background:#fff}.heart.sheet.actor.character h3{font-size:1.5em}.heart.sheet.actor.character .info .grid-2{grid-gap:1em;align-items:center}.heart.sheet.actor.character .calling,.heart.sheet.actor.character .class{align-items:top}.heart.sheet.actor.character .calling .name,.heart.sheet.actor.character .class .name{font-weight:bold;text-transform:uppercase;font-size:1.5em}.heart.sheet.actor.character img.profile{object-fit:contain;width:100%;min-height:100px;max-height:256px;border:0;background:rgba(99,0,0,.2)}.heart.sheet.actor.character .faded{opacity:66%}.heart.sheet.actor.character .right{float:right;flex:auto 0 0}.heart.sheet.actor.character .col{margin:0 .5em}.heart.sheet.actor.character .grid-2 input:not([type]){border:0;border-bottom:1px dotted #630000;font-size:1.5em}.heart.sheet.actor.character .grid-3{display:grid;grid-template-columns:1fr 1fr 1fr;place-items:stretch;column-gap:.5em}.heart.sheet.actor.character .grid-3.resistances{grid-template-columns:auto auto auto;align-items:start;justify-content:space-evenly}.heart.sheet.actor.character .grid-3.resistances.left{justify-self:left}.heart.sheet.actor.character .bold{font-weight:bold;font-size:16px}.heart.sheet.actor.character .resistance-input{font-family:"MelmaCracked";font-size:1.5em;font-weight:bold;color:#630000;border:none;margin:0 2px;padding:0;vertical-align:top}',""]);const r=s},278:(e,t,a)=>{a.d(t,{Z:()=>r});var i=a(761),s=a.n(i)()((function(e){return e[1]}));s.push([e.id,".sticky{position:sticky;top:0;z-index:1}.section{padding:.5em}.item-list>*{padding:.5em;margin:.5em 0;border:1px solid rgba(99,0,0,.2);border-radius:5px}a[disabled]{opacity:.5;pointer-events:none}.heart.sheet.actor.delve{position:relative;background:#fff}.heart.sheet.actor.delve h3{font-size:1.5em}.heart.sheet.actor.delve .info .grid-2{grid-gap:1em;align-items:center}.heart.sheet.actor.delve img.profile{object-fit:contain;width:100%;min-height:100px;max-height:256px;border:0;background:rgba(99,0,0,.2)}.heart.sheet.actor.delve .faded{opacity:66%}.heart.sheet.actor.delve .right{float:right;flex:auto 0 0}.heart.sheet.actor.delve .col{margin:0 .5em}.heart.sheet.actor.delve .grid-2 input:not([type]){border:0;border-bottom:1px dotted #630000;font-size:1.5em}.heart.sheet.actor.delve .grid-3{display:grid;grid-template-columns:1fr 1fr 1fr;place-items:stretch;column-gap:.5em}.heart.sheet.actor.delve .grid-3.resistances{grid-template-columns:auto auto auto;align-items:start;justify-content:space-evenly}.heart.sheet.actor.delve .grid-3.resistances.left{justify-self:left}.heart.sheet.actor.delve .bold{font-weight:bold;font-size:16px}",""]);const r=s},520:(e,t,a)=>{a.d(t,{Z:()=>r});var i=a(761),s=a.n(i)()((function(e){return e[1]}));s.push([e.id,".sticky{position:sticky;top:0;z-index:1}.section{padding:.5em}.item-list>*{padding:.5em;margin:.5em 0;border:1px solid rgba(99,0,0,.2);border-radius:5px}a[disabled]{opacity:.5;pointer-events:none}.heart.sheet.actor.landmark{position:relative;background:#fff}.heart.sheet.actor.landmark h3{font-size:1.5em}.heart.sheet.actor.landmark .info .grid-2{grid-gap:1em;align-items:center}.heart.sheet.actor.landmark img.profile{object-fit:contain;width:100%;min-height:100px;max-height:256px;border:0;background:rgba(99,0,0,.2)}.heart.sheet.actor.landmark .faded{opacity:66%}.heart.sheet.actor.landmark .right{float:right;flex:auto 0 0}.heart.sheet.actor.landmark .col{margin:0 .5em}.heart.sheet.actor.landmark .grid-2 input:not([type]){border:0;border-bottom:1px dotted #630000;font-size:1.5em}.heart.sheet.actor.landmark .grid-3{display:grid;grid-template-columns:1fr 1fr 1fr;place-items:stretch;column-gap:.5em}.heart.sheet.actor.landmark .grid-3.resistances{grid-template-columns:auto auto auto;align-items:start;justify-content:space-evenly}.heart.sheet.actor.landmark .grid-3.resistances.left{justify-self:left}.heart.sheet.actor.landmark .bold{font-weight:bold;font-size:16px}",""]);const r=s},780:(e,t,a)=>{a.d(t,{Z:()=>r});var i=a(761),s=a.n(i)()((function(e){return e[1]}));s.push([e.id,'.heart.form .options,.chat-message .options{display:flex;align-items:center;justify-content:start}.heart.form .options .option,.chat-message .options .option{color:#000;font-family:"Alegreya";border:1px solid #000;border-radius:5px;background:#fff;margin:2px;padding:4px;display:inline-block;text-transform:uppercase}.heart.form input:checked+.option,.chat-message input:checked+.option{background:#630000;color:#fff}.heart.form .window-content{background:#fff}.heart.form label{font-weight:bold;font-family:"MelmaCracked";display:flex;align-items:center;justify-content:start;text-align:left}.heart.form .description{text-align:center}.active-beats{display:flex;flex-flow:row wrap;justify-content:center}.active-beats .character-box{border:1px solid #000;border-radius:.5em;margin:.5em;display:flex;flex-direction:column;align-items:flex-start}.active-beats .character-box .character-header{background:#630000;color:#fff;padding:.5em;width:100%;box-sizing:border-box;font-size:1.2em}.active-beats .character-box .char-active-beats{padding:0 .5em;display:flex;flex-direction:column;justify-content:center}',""]);const r=s},429:(e,t,a)=>{a.d(t,{Z:()=>r});var i=a(761),s=a.n(i)()((function(e){return e[1]}));s.push([e.id,".chat-message{background:#630000;color:#fff;border-color:#949494}.chat-message .heart.sheet{background:none;color:#000}.chat-message .item-type{text-transform:capitalize}.chat-message .message-header{color:#fff}.chat-message .dice-roll .dice-formula,.chat-message .dice-roll .dice-total{background:#fff;color:#630000;border-color:#949494}.chat-message .dice-roll .dice-formula{background:#000;color:#fff;font-size:1.2em;padding:.2em}.chat-message .dice-roll .dice .part-header{border-bottom-color:#fff}.chat-message .dice-roll .dice .part-header .part-formula{text-transform:uppercase}.chat-message .dice-roll .dice .dice-rolls .roll.discarded{filter:sepia(0.5) contrast(0.75) opacity(0.5)}.chat-message .message-content+.message-content{margin-top:.5em}.chat-message .heart h1{border:0;text-align:center}.chat-message .heart button{background:#949494;color:#fff}.chat-message .heart button .fas{padding:0 .5em}.chat-message .heart button+button{margin-top:.2em}.chat-message .roll-request{background:#000;padding:1em;border-radius:.5em;font-size:1.1em}.chat-message .roll-request label{display:flex;align-items:center;justify-items:end;place-content:end}.chat-message .roll-request select{color:#fff;appearance:none;width:100%;overflow:auto}.chat-message .roll-request select option{appearance:none;text-align:center;background:#000}.chat-message .roll-request button>*{text-overflow:ellipsis}.chat-message .roll-request .options{align-items:stretch;flex-wrap:wrap}.chat-message .roll-request .options .option img{height:3em;width:100%;object-fit:contain;border:0;background:rgba(0,0,0,.5);padding:0;margin:0;border-radius:0}.chat-message.whisper{color:#000}.chat-message.whisper .message-header{color:#000}.resistance-text{text-transform:capitalize}",""]);const r=s},746:(e,t,a)=>{a.d(t,{Z:()=>r});var i=a(761),s=a.n(i)()((function(e){return e[1]}));s.push([e.id,'.heart.sheet{background:#fff}.heart.sheet img.profile{flex-grow:1;background:rgba(0,0,0,.5);cursor:pointer}.heart.sheet .text{flex-grow:3;display:flex;flex-flow:column}.heart.sheet .subtitle{color:#2c2c2c;font-size:1.2em;text-transform:uppercase;font-style:italic;align-self:top;flex-grow:0;text-align:center}.heart.sheet .editor-content{font-size:15px;line-height:20px;background-image:-moz-linear-gradient(top, transparent, transparent 19px, rgba(99, 0, 0, 0.2) 0px);background-image:-webkit-linear-gradient(top, transparent, transparent 19px, rgba(99, 0, 0, 0.2) 0px);background-size:100% 20px;min-height:8em}.heart.sheet .editor-content p{margin:0}.heart.sheet .item-list{font-size:1.2em}.heart.sheet.base .info{display:flex;flex:0% 0 1;flex-flow:row wrap;place-items:center;place-content:center;background:#949494}.heart.sheet.base .info>*{flex:0% 1 1}.heart.sheet.base img.profile{flex-grow:1;background:rgba(0,0,0,.5);cursor:pointer;max-height:6em}.heart.sheet.base .text{flex-grow:3;display:flex;flex-flow:column}.heart.sheet.base input[name=name]{grid-area:1/2/2/3;flex-grow:0;font-size:2em;border:0;align-self:bottom;text-align:center;background:none;color:#630000;font-weight:bold}.heart.sheet h1,.heart.sheet h2,.heart.sheet h3,.heart.sheet h4{font-family:"MelmaCracked";color:#000}.heart.sheet h1 .right,.heart.sheet h2 .right,.heart.sheet h3 .right,.heart.sheet h4 .right{float:right;font-family:Alegreya;font-size:.8em}',""]);const r=s},402:(e,t,a)=>{a.d(t,{Z:()=>d});var i=a(761),s=a.n(i),r=a(80),n=a.n(r),l=a(618),o=s()((function(e){return e[1]}));o.push([e.id,"@import url(https://fonts.googleapis.com/css2?family=Alegreya:ital,wght@0,400;0,500;0,600;1,400&display=swap);"]);var c=n()(l);o.push([e.id,'@font-face{font-family:"MelmaCracked";src:url('+c+')}.title-font{font-family:"MelmaCracked"}input.hidden{display:none !important}input.toggle-display~*{max-height:0;overflow:hidden;transition:max-height .2s ease-out}input.toggle-display:checked~*{max-height:20em;transition:max-height .2s ease-in}.toggle-button{font-family:"MelmaCracked";color:#000;font-size:1.5em;text-align:center;display:flex;flex-flow:row wrap;justify-content:center;padding:.2em;margin:.3em 0;border-radius:.2em;background:#fff;border:3px solid #000;cursor:pointer}.chat-message{background:#630000;color:#fff;border-color:#949494}.chat-message .message-header{color:#fff}.chat-message .dice-roll .dice-formula,.chat-message .dice-roll .dice-total{background:#fff;color:#630000;border-color:#949494}.chat-message .dice-roll .dice-formula{background:#000;color:#fff}.chat-message .dice-roll .dice .part-header{border-bottom-color:#fff}.chat-message .dice-roll .dice .part-header .part-formula{text-transform:uppercase}.chat-message .dice-roll .dice .dice-rolls .roll.discarded{filter:sepia(0.5) contrast(0.75) opacity(0.5)}.chat-message .message-content+.message-content{margin-top:.5em}.chat-message .heart button{background:#949494;color:#fff}.chat-message .heart button .fas{padding:0 .5em}.chat-message .heart button+button{margin-top:.2em}.heart{font-family:"Alegreya",serif}.heart input{font-family:inherit}.heart button{font-family:"Alegreya";background:#630000;color:#fff;border-color:#2c2c2c;font-size:1rem;text-transform:uppercase;font-weight:bold;cursor:pointer}.heart.buttons{display:flex;flex-flow:row wrap;background:#000}.heart.buttons>*{flex:50px 1 0;min-width:calc(50% - 10px)}.heart table{border:0}.heart .ordered-checkable-box{flex:14px 0 0}.heart .ordered-checkable-box::after,.heart .ordered-checkable-box.checked::after{content:"";display:inline-block;width:14px;height:14px;border:3px solid #000;margin:0 2px}.heart .ordered-checkable-box.checked::after{background-image:linear-gradient(90deg, #000 0%, #000 100%);background-size:12px 12px;background-position:center;background-repeat:no-repeat}.heart input[type=checkbox]{flex:14px 0 0;appearance:none;display:inline-block;width:14px;height:14px;border:3px solid #000;margin:0 2px;box-sizing:content-box}.heart input[type=checkbox]:disabled:checked{background-image:linear-gradient(90deg, #2c2c2c 0%, #2c2c2c 100%);background-size:12px 12px;background-position:center;background-repeat:no-repeat}.heart input[type=checkbox]:checked{background-image:linear-gradient(90deg, #000 0%, #000 100%);background-size:12px 12px;background-position:center;background-repeat:no-repeat}.heart input[type=checkbox]:disabled{background-image:linear-gradient(90deg, #D4D4D4 0%, #D4D4D4 100%);background-size:12px 12px;background-position:center;background-repeat:no-repeat;cursor:not-allowed}.heart input[type=checkbox].invert{border-color:#fff}.heart input[type=checkbox].invert:checked{background-image:linear-gradient(90deg, #fff 0%, #fff 100%)}.heart .red .ordered-checkable-box::after,.heart .red .ordered-checkable-box.checked:after{border-color:#630000}.heart .red .ordered-checkable-box.checked::after{background-image:linear-gradient(90deg, #630000 0%, #630000 100%)}.window-app .window-content{padding:0}.window-app .window-content>*{padding:8px}.grid-2{display:grid;grid-template-columns:1fr 1fr;place-items:stretch;grid-gap:.5em;margin:.5em}.grid-2.auto-first-col{grid-template-columns:auto 1fr;margin:.5em 0}.grid-2 .wide{grid-column:1/3}.grid-2.place-center{place-content:center}.grid-2.place-top{align-items:start}.version-tabs{flex-wrap:wrap;gap:5px 10px;justify-content:flex-start}',""]);const d=o},180:(e,t,a)=>{a.d(t,{Z:()=>r});var i=a(761),s=a.n(i)()((function(e){return e[1]}));s.push([e.id,'.item.preview{position:relative;border:1px solid rgba(99,0,0,.4);border-radius:5px;background:#fffefe;padding:.5em;margin:.5em 0}.item.preview .actionbar{float:right}.item.preview .actionbar a:hover{transform:scale(1.05)}.item.preview h1,.item.preview h2,.item.preview h3,.item.preview h4{font-family:"MelmaCracked";color:#000}.item.preview h1 .right,.item.preview h2 .right,.item.preview h3 .right,.item.preview h4 .right{float:right;font-family:Alegreya;font-size:.8em}',""]);const r=s},621:(e,t,a)=>{a.d(t,{Z:()=>r});var i=a(761),s=a.n(i)()((function(e){return e[1]}));s.push([e.id,'form.heart.calling{display:block;font-size:1.1em;background:#fff}form.heart.calling h1,form.heart.calling h2{font-family:"MelmaCracked"}form.heart.calling h1,form.heart.calling h2,form.heart.calling h3{text-transform:uppercase}form.heart.calling h4{font-weight:bold}form.heart.calling h1,form.heart.calling h2,form.heart.calling h3,form.heart.calling h4{border:0;margin:0;flex:auto 0 0}form.heart.calling h1 .right,form.heart.calling h2 .right,form.heart.calling h3 .right,form.heart.calling h4 .right{float:right;font-family:Alegreya;font-size:.8em}form.heart.calling h1{background:#630000;color:#fff;padding:.2em}form.heart.calling h1 input{color:#fff !important;border:0;width:100%;font-size:1em !important;text-align:left !important}form.heart.calling h2{color:#630000;padding:.2em 0}form.heart.calling .description{flex:auto 0 0;font-size:1.2em;font-style:italic;padding:0 1em;margin:.5em}form.heart.calling .description .editor-content{font-size:1.7em !important;line-height:1em;background:rgba(0,0,0,.1);min-height:6.5em;padding:.5em;text-align:center}form.heart.calling li .action{padding:.2em}form.heart.calling .action{flex:auto 0 0}form.heart.calling p{margin:0}form.heart.calling p+p{margin-top:.2em}form.heart.calling .flexrow{align-content:center}form.heart.calling .right{flex:auto 0 0}form.heart.calling .question{font-weight:bold;font-style:italic}form.heart.calling .question .editor-content{min-height:7em !important}form.heart.calling .name{text-transform:uppercase;font-weight:bold;color:#630000}',""]);const r=s},817:(e,t,a)=>{a.d(t,{Z:()=>r});var i=a(761),s=a.n(i)()((function(e){return e[1]}));s.push([e.id,'form.heart.class{display:block;font-size:1.1em;background:#fff}form.heart.class h1,form.heart.class h2{font-family:"MelmaCracked"}form.heart.class h1,form.heart.class h2,form.heart.class h3{text-transform:uppercase}form.heart.class h4{font-weight:bold}form.heart.class h1,form.heart.class h2,form.heart.class h3,form.heart.class h4{border:0;margin:0;flex:auto 0 0}form.heart.class h1 .right,form.heart.class h2 .right,form.heart.class h3 .right,form.heart.class h4 .right{float:right;font-family:Alegreya;font-size:.8em}form.heart.class h1{background:#630000;color:#fff;padding:.2em}form.heart.class h1 input{color:#fff !important;border:0;width:100%;font-size:1em !important;text-align:left !important}form.heart.class h2{color:#630000;padding:.2em 0}form.heart.class .description{flex:auto 0 0;font-style:italic;padding:0 1em;margin:.5em}form.heart.class .description .editor-content{font-size:1.7em !important;line-height:1em;background:rgba(0,0,0,.1);min-height:6.5em;padding:.5em;text-align:center}form.heart.class li .action{padding:.2em}form.heart.class .action{flex:auto 0 0}form.heart.class p{margin:0}form.heart.class p+p{margin-top:.2em}form.heart.class .flexrow{align-content:center}form.heart.class .right{flex:auto 0 0}form.heart.class .question{font-weight:bold;font-style:italic}form.heart.class .question .editor-content{min-height:7em !important}form.heart.class .name{text-transform:uppercase;font-weight:bold;color:#630000}form.heart.class .equipment-group{margin:5px 0;padding:5px;border-radius:3px;border:1px dashed #630000}form.heart.class .equipment-group:hover{box-shadow:0px 0px 5px #630000;cursor:pointer}form.heart.class .equipment-group.active{border-style:solid}',""]);const r=s},887:(e,t,a)=>{a.d(t,{Z:()=>r});var i=a(761),s=a.n(i)()((function(e){return e[1]}));s.push([e.id,".equipment.resistances{display:flex;flex-flow:row wrap;justify-content:space-around;color:#630000}.equipment.resistances h3{color:#630000}",""]);const r=s},212:(e,t,a)=>{a.d(t,{Z:()=>r});var i=a(761),s=a.n(i)()((function(e){return e[1]}));s.push([e.id,'form.heart.haunt{display:block;font-size:1.1em;background:#fff}form.heart.haunt h1,form.heart.haunt h2{font-family:"MelmaCracked"}form.heart.haunt h1,form.heart.haunt h2,form.heart.haunt h3{text-transform:uppercase}form.heart.haunt h4{font-weight:bold}form.heart.haunt h1,form.heart.haunt h2,form.heart.haunt h3,form.heart.haunt h4{border:0;margin:0;flex:auto 0 0}form.heart.haunt h1 .right,form.heart.haunt h2 .right,form.heart.haunt h3 .right,form.heart.haunt h4 .right{float:right;font-family:Alegreya;font-size:.8em}form.heart.haunt h1{background:#630000;color:#fff;padding:.2em}form.heart.haunt h1 input{color:#fff !important;border:0;width:100%;font-size:1em !important;text-align:left !important}form.heart.haunt h2{color:#630000;padding:.2em 0}form.heart.haunt .description{flex:auto 0 0;font-style:italic;padding:0 1em;margin:.5em}form.heart.haunt .description .editor-content{font-size:1.7em !important;line-height:1em;background:rgba(0,0,0,.1);min-height:6.5em;padding:.5em;text-align:center}form.heart.haunt li .action{padding:.2em}form.heart.haunt .action{flex:auto 0 0}form.heart.haunt p{margin:0}form.heart.haunt p+p{margin-top:.2em}form.heart.haunt .flexrow{align-content:center}form.heart.haunt .right{float:right}form.heart.haunt .question{font-weight:bold;font-style:italic}form.heart.haunt .question .editor-content{min-height:7em !important}form.heart.haunt .name{text-transform:uppercase;font-weight:bold;color:#630000}form.heart.haunt .equipment-group{margin:5px 0;padding:5px;border-radius:3px;border:1px dashed #630000}form.heart.haunt .equipment-group:hover{box-shadow:0px 0px 5px #630000;cursor:pointer}form.heart.haunt .equipment-group.active{border-style:solid}',""]);const r=s},979:(e,t,a)=>{a.d(t,{Z:()=>r});var i=a(761),s=a.n(i)()((function(e){return e[1]}));s.push([e.id,'.heart.fallout-roll .dice-total{font-family:"MelmaCracked"}.heart.fallout-roll .flexrow .dice-total{flex:1;display:flex;place-items:center;place-content:center}.heart.fallout-roll .flexrow .icon-button{padding:0;flex:1em 0 0}.heart.fallout-roll .flexrow .icon-button+.icon-button{margin:0}',""]);const r=s},107:(e,t,a)=>{a.d(t,{Z:()=>r});var i=a(761),s=a.n(i)()((function(e){return e[1]}));s.push([e.id,'.heart.heart-roll .dice-total{font-family:"MelmaCracked"}.heart.heart-roll .dice-tooltip{text-align:center;display:flex;flex-flow:row wrap;align-items:flex-end}.heart.heart-roll .dice-tooltip .tooltip-part{flex:33% 1 1;text-align:center}.heart.heart-roll .dice-tooltip .tooltip-part .dice-rolls{text-align:center;display:flex;flex-flow:row wrap;justify-content:center}.heart.heart-roll+.heart.heart-roll{margin-top:.5em}',""]);const r=s},361:(e,t,a)=>{a.d(t,{Z:()=>r});var i=a(761),s=a.n(i)()((function(e){return e[1]}));s.push([e.id,".heart.dice-roll .flexrow .dice-total{flex:1;display:flex;place-items:center;place-content:center}.heart.dice-roll .flexrow .icon-button{padding:0;flex:1em 0 0}.heart.dice-roll .flexrow .icon-button+.icon-button{margin:0}",""]);const r=s},695:e=>{var t={};e.exports=function(e){if(void 0===t[e]){var a=document.querySelector(e);if(window.HTMLIFrameElement&&a instanceof window.HTMLIFrameElement)try{a=a.contentDocument.head}catch(e){a=null}t[e]=a}return t[e]}},379:e=>{var t=[];function a(e){for(var a=-1,i=0;i<t.length;i++)if(t[i].identifier===e){a=i;break}return a}function i(e,i){for(var r={},n=[],l=0;l<e.length;l++){var o=e[l],c=i.base?o[0]+i.base:o[0],d=r[c]||0,h="".concat(c," ").concat(d);r[c]=d+1;var m=a(h),u={css:o[1],media:o[2],sourceMap:o[3]};-1!==m?(t[m].references++,t[m].updater(u)):t.push({identifier:h,updater:s(u,i),references:1}),n.push(h)}return n}function s(e,t){var a=t.domAPI(t);return a.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;a.update(e=t)}else a.remove()}}e.exports=function(e,s){var r=i(e=e||[],s=s||{});return function(e){e=e||[];for(var n=0;n<r.length;n++){var l=a(r[n]);t[l].references--}for(var o=i(e,s),c=0;c<r.length;c++){var d=a(r[c]);0===t[d].references&&(t[d].updater(),t.splice(d,1))}r=o}}},216:e=>{e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t),t}},795:e=>{e.exports=function(e){var t=e.insertStyleElement(e);return{update:function(a){!function(e,t,a){var i=a.css,s=a.media,r=a.sourceMap;s?e.setAttribute("media",s):e.removeAttribute("media"),r&&"undefined"!=typeof btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),t.styleTagTransform(i,e)}(t,e,a)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},761:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var a=e(t);return t[2]?"@media ".concat(t[2]," {").concat(a,"}"):a})).join("")},t.i=function(e,a,i){"string"==typeof e&&(e=[[null,e,""]]);var s={};if(i)for(var r=0;r<this.length;r++){var n=this[r][0];null!=n&&(s[n]=!0)}for(var l=0;l<e.length;l++){var o=[].concat(e[l]);i&&s[o[0]]||(a&&(o[2]?o[2]="".concat(a," and ").concat(o[2]):o[2]=a),t.push(o))}},t}},80:e=>{e.exports=function(e,t){return t||(t={}),"string"!=typeof(e=e&&e.__esModule?e.default:e)?e:(/^['"].*['"]$/.test(e)&&(e=e.slice(1,-1)),t.hash&&(e+=t.hash),/["'() \t\n]/.test(e)||t.needQuotes?'"'.concat(e.replace(/"/g,'\\"').replace(/\n/g,"\\n"),'"'):e)}},618:(e,t,a)=>{e.exports=a.p+"ece5e5658ae157a8cf70.ttf"}},t={};function a(i){var s=t[i];if(void 0!==s)return s.exports;var r=t[i]={id:i,exports:{}};return e[i](r,r.exports,a),r.exports}a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},a.d=(e,t)=>{for(var i in t)a.o(t,i)&&!a.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),a.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.p="/systems/heart/",a.nc=void 0;var i={};(()=>{a.r(i);var e={};a.r(e),a.d(e,{default:()=>be});var t={};a.r(t),a.d(t,{default:()=>we});var s={};a.r(s),a.d(s,{default:()=>xe});var r={};a.r(r),a.d(r,{default:()=>ke});var n={};a.r(n),a.d(n,{default:()=>ze});var l={};a.r(l),a.d(l,{default:()=>Te});var o={};a.r(o),a.d(o,{default:()=>He});var c={};a.r(c),a.d(c,{default:()=>_e});var d={};a.r(d),a.d(d,{default:()=>Se});var h={};a.r(h),a.d(h,{default:()=>Ce});var m={};a.r(m),a.d(m,{default:()=>Ie});var u={};a.r(u),a.d(u,{default:()=>Oe});var p={};a.r(p),a.d(p,{default:()=>De});var f={};a.r(f),a.d(f,{default:()=>Ae});var g={};a.r(g),a.d(g,{default:()=>qe});var v={};a.r(v),a.d(v,{default:()=>Ee});var y={};a.r(y),a.d(y,{default:()=>je});var b={};a.r(b),a.d(b,{default:()=>Re});var w={};a.r(w),a.d(w,{default:()=>$e});var x={};a.r(x),a.d(x,{default:()=>Be});var k={};a.r(k),a.d(k,{default:()=>Ne});var z={};a.r(z),a.d(z,{default:()=>Me});var T={};a.r(T),a.d(T,{default:()=>Pe});var H={};a.r(H),a.d(H,{default:()=>Ze});var _={};a.r(_),a.d(_,{default:()=>Le});var S={};a.r(S),a.d(S,{default:()=>Fe});var C={};a.r(C),a.d(C,{default:()=>Ue});var I={};a.r(I),a.d(I,{default:()=>Ge});var O={};a.r(O),a.d(O,{default:()=>Je});var D={};a.r(D),a.d(D,{default:()=>Ve});var A={};a.r(A),a.d(A,{default:()=>Ke});var q={};a.r(q),a.d(q,{default:()=>We});var E={};a.r(E),a.d(E,{default:()=>Qe});var j={};a.r(j),a.d(j,{default:()=>Ye});var R={};a.r(R),a.d(R,{default:()=>Xe});var B={};a.r(B),a.d(B,{default:()=>HeartActorSheet});var N={};a.r(N),a.d(N,{default:()=>AdversarySheet});var M={};a.r(M),a.d(M,{default:()=>CharacterSheet});var P={};a.r(P),a.d(P,{default:()=>DelveSheet});var Z={};a.r(Z),a.d(Z,{default:()=>LandmarkSheet});var L={};a.r(L),a.d(L,{default:()=>St});var F={};a.r(F),a.d(F,{default:()=>Ct});var U={};a.r(U),a.d(U,{default:()=>It});var G={};a.r(G),a.d(G,{default:()=>Ot});var J={};a.r(J),a.d(J,{initialise:()=>qt});var V={};a.r(V),a.d(V,{default:()=>HeartApplication});var K={};a.r(K),a.d(K,{default:()=>BeatTrackerApplication});var W={};a.r(W),a.d(W,{default:()=>PrepareRollRequestApplication});var Q={};a.r(Q),a.d(Q,{default:()=>RequirementApplication});var Y={};a.r(Y),a.d(Y,{initialise:()=>$t});var X={};a.r(X),a.d(X,{initialise:()=>Zt});var ee={};a.r(ee),a.d(ee,{default:()=>HeartItemSheet});var te={};a.r(te),a.d(te,{data:()=>Gt});var ae={};a.r(ae),a.d(ae,{data:()=>Vt});var ie={};a.r(ie),a.d(ie,{data:()=>Yt,default:()=>Xt});var se={};a.r(se),a.d(se,{data:()=>ia,default:()=>sa});var re={};a.r(re),a.d(re,{data:()=>ha,default:()=>ma,initialise:()=>da});var ne={};a.r(ne),a.d(ne,{data:()=>ga,initialise:()=>fa});var le={};a.r(le),a.d(le,{data:()=>wa,default:()=>xa});var oe={};a.r(oe),a.d(oe,{data:()=>za});var ce={};a.r(ce),a.d(ce,{data:()=>Ha});var de={};a.r(de),a.d(de,{default:()=>_a});var he={};a.r(he),a.d(he,{default:()=>Sa});var me={};a.r(me),a.d(me,{initialise:()=>Oa});var ue={};a.r(ue),a.d(ue,{default:()=>FalloutRoll,initialise:()=>Ea});var pe={};a.r(pe),a.d(pe,{default:()=>HeartRoll,initialise:()=>Pa});var fe={};a.r(fe),a.d(fe,{default:()=>ItemRoll});var ge={};a.r(ge),a.d(ge,{default:()=>StressRoll});var ve={};a.r(ve),a.d(ve,{initialise:()=>Ua});var ye={};a.r(ye);const be={path:"heart:actors/adversary/sheet.html",source:'{{#*inline "itemListSection"}}\n<div class="section {{localizeHeart type \'label-multiple\'}}">\n    <h2>\n        {{#if overrideTitle}}\n        {{overrideTitle}}\n        {{else}}\n        {{localizeHeart type "label-multiple"}}\n        {{/if}}\n        {{#if actor.isOwner}}\n        <div class="right">\n            <a data-action="add" data-type="{{type}}" data-data=\'{"active": true}\'><span class="fas fa-plus"></span></a>\n        </div>\n        {{/if}}\n    </h2>\n\n    <div class="item-list">\n    {{#each list as |item|}}\n        {{> (join "/" "heart:items" type "preview.html") item=item dataPath="???" hideInactive=../hideInactive showActivate=../showActivate showDelete=(or (not item.isChild) user.isGM )}}\n    {{/each}}\n    </div>\n    \n    {{#if (and showTextboxesBelowItems description_path)}}\n    {{editor (lookup actor.system description_path) target=(join "." "system" description_path) button=true editable=editable owner=owner}}\n    {{/if}}\n</div>\n{{/inline}}\n\n<div>\n<form class="heart sheet actor adversary {{cssClass}}" autocomplete="off">\n        <img class="profile" src="{{actor.img}}" title="{{actor.name}}" data-edit="img"/>\n\n        <div class="section grid-2 resistances place-top">\n            <h3 class="center">{{localizeHeart "resistance" "label-single"}}</h3> \n            <h3 class="center">{{localizeHeart "protection" "label-single"}}</h3> \n            <div class="red" data-target=\'system.resistance\'>{{{ordered-checkable actor.system.resistance actor.system.resistanceMax}}}</div>\n            <div class="red" data-target=\'system.protection\'>{{{ordered-checkable actor.system.protection 10}}}</div>\n            \n        </div>\n        \n        <div class="section info">\n            <div class="grid-2 auto-first-col place-center">\n                <h2>{{localizeHeart "adversary" "name"}}</h2>\n                <input name="name" value="{{actor.name}}"/>\n            </div>\n        </div>\n\n        <div class="section info">\n            <div class="grid-2 auto-first-col place-center">\n                <h2>{{localizeHeart "adversary" "resistanceMax"}}</h2>\n                <input name="system.resistanceMax" value="{{actor.system.resistanceMax}}"/>\n            </div>\n        </div>\n\n        \x3c!--The dropdown for difficulty should be slapped in here, but I couldn\'t quite get it working--\x3e\n        <div class="section info">\n            <div class="grid-2 auto-first-col place-center">\n                <h2>{{localizeHeart "adversary" "difficulty"}}</h2>\n                <input name="system.difficulty" value="{{actor.system.difficulty}}"/>\n            </div>\n        </div>\n\n        <div class="section center wide notes">\n            <h3>{{localizeHeart "adversary" "descriptors"}}</h3>\n            {{editor actor.system.descriptors target="system.descriptors" button=true editable=editable owner=owner}}\n        </div>\n\n        <div class="section center wide notes">\n            <h3>{{localizeHeart "adversary" "motivation"}}</h3>\n            {{editor actor.system.motivation target="system.motivation" button=true editable=editable owner=owner}}\n        </div>\n\n        <div class="section center wide notes">\n            <h3>{{localizeHeart "adversary" "special"}}</h3>\n            {{editor actor.system.special target="system.special" button=true editable=editable owner=owner}}\n        </div>\n\n        {{> itemListSection type="equipment" list=actor.proxy.equipment description_path="equipment" showActivate=true}}\n        {{> itemListSection type="resource" list=actor.proxy.resources description_path="resources"}}\n        \n        <div class="section center wide notes">\n            <h3>{{localizeHeart "adversary" "notes"}}</h3>\n            {{editor actor.system.notes target="system.notes" button=true editable=editable owner=owner}}\n        </div>\n        \n        <div class="section center wide inactive-items">\n            <h3>{{localizeHeart "adversary" "inactive-items"}}</h3>\n            <div>{{localizeHeart "adversary" "inactive-items-description"}}</div>\n            <div class="item-list">\n            {{#each actor.items as |item|}}\n                {{#if (and (not (undef item.system.active)) (not item.system.active)) }}\n                    {{> (join "/" "heart:items" item.type "preview.html") item=item dataPath="???" showActivate=../user.isOwner showDelete=../user.isOwner}}\n                {{/if}}\n            {{/each}}\n            </div>\n        </div>\n</form>\n</div>'},we={path:"heart:actors/base/sheet.html",source:'{{#> "heart:common/sheet.html" documentName="actor" type=type}}\n    {{editor system.description target="system.description" button=true editable=editable owner=owner}}\n{{/ "heart:common/sheet.html" }}'},xe={path:"heart:actors/character/sheet.html",source:'{{#*inline "itemListSection"}}\n<div class="section {{localizeHeart type \'label-multiple\'}}">\n    <h2>\n        {{#if overrideTitle}}\n        {{overrideTitle}}\n        {{else}}\n        {{localizeHeart type "label-multiple"}}\n        {{/if}}\n        {{#if actor.isOwner}}\n        <div class="right">\n            <a data-action="add" data-type="{{type}}" data-data=\'{"active": true}\'><span class="fas fa-plus"></span></a>\n        </div>\n        {{/if}}\n    </h2>\n\n    <div class="item-list">\n    {{#each list as |item|}}\n        {{> (join "/" "heart:items" type "preview.html") item=item dataPath="???" hideInactive=../hideInactive showActivate=../showActivate showDelete=(or (not item.isChild) user.isGM )}}\n    {{/each}}\n    </div>\n    \n    {{#if (and showTextboxesBelowItems description_path)}}\n    {{editor (lookup actor.system description_path) target=(join "." "system" description_path) button=true editable=editable owner=owner}}\n    {{/if}}\n</div>\n{{/inline}}\n\n<div>\n<div class="heart flexrow buttons sticky">\n    <button data-action="prepare-request-roll"><span class="fas fa-dice"></span> {{localizeHeart "perform" "request-roll"}}</button>\n    <button data-action="roll"><span class="fas fa-dice"></span> {{localizeHeart "perform" "roll"}}</button>\n    <button data-action="stress-roll"><span class="fas fa-dice"></span> {{localizeHeart "perform" "roll-stress"}}</button>\n    <button data-action="fallout-roll"><span class="fas fa-dice"></span> {{localizeHeart "perform" "roll-fallout"}}</button>\n</div>\n<form class="heart sheet actor character {{cssClass}}" autocomplete="off">\n        <img class="profile" src="{{actor.img}}" title="{{actor.name}}" data-edit="img"/>\n        <div class="section grid-3 resistances place-top">\n            <div></div>\n            <div>\n                {{#if showTotalStress}}\n                <h3 class="left">Total Stress: {{actor.proxy.totalStress}}</h3>\n                {{/if}}\n            </div>\n            <h3 class="center">{{localizeHeart "resistance" "protection" "label-multiple"}}</h3>\n            {{#each actor.system.resistances as |resistance name|}}\n                <h3 class="left">{{localizeHeart "resistance" name}}</h3>\n                <div class="red" data-target=\'system.resistances.{{name}}.value\'>{{{ordered-checkable resistance.value 12}}}\n                    {{#if ../showStressInputBox}}\n                    <input class="resistance-input red" size="2" name=\'{{localizeHeart "resistance" name}} Input\' value=\'{{resistance.value}}\'/>\n                    {{/if}}\n                </div>\n                <div class="red" data-target=\'system.resistances.{{name}}.protection\'>{{{ordered-checkable resistance.protection 5}}}</div>\n            {{/each}}\n        </div>\n        \n        <div class="section info">\n            <div class="grid-2 auto-first-col place-center">\n                <h2>{{localizeHeart "character" "name"}}</h2>\n                <input name="name" value="{{actor.name}}"/>\n                <h2>{{localizeHeart "character" "class"}}</h2>\n                {{#if classItem}}\n                <div data-item-id="{{classItem.uuid}}" class="flexrow class item">\n                    <div class="name">{{localizeHeart classItem.name}}</div>\n                    <div class="right">\n                        <a data-action="view" title="{{localizeHeart \'base\' \'view\'}}"><span class="fas fa-eye"></span></a>\n                        {{#if classItem.isOwner}}\n                        <a data-action="delete" title="{{localizeHeart \'base\' \'delete\'}}"><span class="fas fa-trash"></span></a>\n                        {{/if}}\n                    </div>\n                </div>\n                {{else}}\n                <input name="system.class" value="{{actor.system.class}}"/>\n                {{/if}}\n                <h2>{{localizeHeart "character" "calling"}}</h2>\n                {{#if callingItem}}\n                <div data-item-id="{{callingItem.uuid}}" class="flexrow calling item">\n                    <div class="name">{{localizeHeart callingItem.name}}</div>\n                    <div class="right">\n                        <a data-action="view" title="{{localizeHeart \'base\' \'view\'}}"><span class="fas fa-eye"></span></a>\n                        {{#if callingItem.isOwner}}\n                        <a data-action="delete" title="{{localizeHeart \'base\' \'delete\'}}"><span class="fas fa-trash"></span></a>\n                        {{/if}}\n                    </div>\n                </div>\n                {{else}}\n                <input name="system.calling" value="{{actor.system.calling}}"/>\n                {{/if}}\n            </div>\n        </div>\n\n        {{> itemListSection type="beat" list=actor.proxy.beats description_path="active_beats" overrideTitle=(localizeHeart "beat" "active" "label-multiple")}}\n        {{> itemListSection type="equipment" list=actor.proxy.equipment description_path="equipment" showActivate=true}}\n        {{> itemListSection type="resource" list=actor.proxy.resources description_path="resources"}}\n        {{> itemListSection type="ability" list=actor.proxy.abilities description_path="abilities" hideInactive=true}}\n        {{> itemListSection type="fallout" list=(lookup actor.itemTypes "fallout") description_path="fallout"}}\n\n        <div class="section skills grid-2 auto-first-col">\n            <h3 class="center">{{localizeHeart "skill" "label-multiple"}}</h3>\n            <h3 class="faded">{{localizeHeart "skill" "knack" "label-multiple"}}</h3>\n            {{#each actor.system.skills as |skill name|}}\n                <div class="flexrow">\n                    <input type="checkbox" name="system.skills.{{name}}.value" {{checked skill.value}}/>\n                    <span class="bold">{{localizeHeart "skill" name}}</span>\n                </div>\n                <input name="system.skills.{{name}}.knack" value="{{skill.knack}}"/>\n            {{/each}}\n        </div>\n\n        <div class="section domains grid-2 auto-first-col">\n            <h3 class="center">{{localizeHeart "domain" "label-multiple"}}</h3>\n            <h3 class="faded">{{localizeHeart "domain" "knack" "label-multiple"}}</h3>\n            {{#each actor.system.domains as |domain name|}}\n                <div class="flexrow">\n                    <input type="checkbox" name="system.domains.{{name}}.value" {{checked domain.value}}/>\n                    <span class="bold">{{localizeHeart "domain" name}}</span>\n                </div>\n                <input name="system.domains.{{name}}.knack" value="{{domain.knack}}"/>\n            {{/each}}\n        </div>\n        \n        <div class="section center wide notes">\n            <h3>{{localizeHeart "character" "notes"}}</h3>\n            {{editor actor.system.notes target="system.notes" button=true editable=editable owner=owner}}\n        </div>\n        \n        <div class="section center wide inactive-items">\n            <h3>{{localizeHeart "character" "inactive-items"}}</h3>\n            <div>{{localizeHeart "character" "inactive-items-description"}}</div>\n            <div class="item-list">\n            {{#each actor.items as |item|}}\n                {{#if (and (not (undef item.system.active)) (not item.system.active)) }}\n                    {{> (join "/" "heart:items" item.type "preview.html") item=item dataPath="???" showActivate=../user.isOwner showDelete=../user.isOwner}}\n                {{/if}}\n            {{/each}}\n            </div>\n        </div>\n</form>\n</div>'},ke={path:"heart:actors/delve/sheet.html",source:'{{#*inline "itemListSection"}}\n<div class="section {{localizeHeart type \'label-multiple\'}}">\n    <h2>\n        {{#if overrideTitle}}\n        {{overrideTitle}}\n        {{else}}\n        {{localizeHeart type "label-multiple"}}\n        {{/if}}\n        {{#if actor.isOwner}}\n        <div class="right">\n            <a data-action="add" data-type="{{type}}" data-data=\'{"active": true}\'><span class="fas fa-plus"></span></a>\n        </div>\n        {{/if}}\n    </h2>\n\n    <div class="item-list">\n    {{#each list as |item|}}\n        {{> (join "/" "heart:items" type "preview.html") item=item dataPath="???" hideInactive=../hideInactive showActivate=../showActivate showDelete=(or (not item.isChild) user.isGM )}}\n    {{/each}}\n    </div>\n\n    {{#if (and showTextboxesBelowItems description_path)}}\n    {{editor (lookup actor.system description_path) target=(join "." "system" description_path) button=true editable=editable owner=owner}}\n    {{/if}}\n</div>\n{{/inline}}\n\n<div>\n<form class="heart sheet actor delve {{cssClass}}" autocomplete="off">\n        <img class="profile" src="{{actor.img}}" title="{{actor.name}}" data-edit="img"/>\n\n\n        <div class="section info">\n            <div class="grid-2 auto-first-col place-center">\n                <h2>{{localizeHeart "delve" "name"}}</h2>\n                <input name="name" value="{{actor.name}}"/>\n            </div>\n        </div>\n\n        <div class="section info">\n            <div class="grid-2 auto-first-col place-center">\n                <h2>{{localizeHeart "delve" "resistance"}}</h2>\n                <span>\n                    <input name="system.resistance" value="{{actor.system.resistance}}" size="2"/>\n                    /\n                    <input name="system.resistanceMax" value="{{actor.system.resistanceMax}}" size="2"/>\n                </span>\n            </div>\n        </div>\n\n        <div class="section info">\n            <div class="grid-2 auto-first-col place-center">\n                <h2>{{localizeHeart "delve" "domain" "label-multiple"}}</h2>\n                <input name="system.domains" value="{{actor.system.domains}}"/>\n            </div>\n        </div>\n\n        <div class="section info">\n            <div class="grid-2 auto-first-col place-center">\n                <h2>{{localizeHeart "delve" "tier"}}</h2>\n                <input name="system.tier" value="{{actor.system.tier}}"/>\n            </div>\n        </div>\n\n        \x3c!--The dropdown for difficulty should be slapped in here, but I couldn\'t quite get it working--\x3e\n        \x3c!-- <div class="section info">\n            <div class="grid-2 auto-first-col place-center">\n                <h2>{{localizeHeart "delve" "difficulty"}}</h2>\n                <input name="system.difficulty" value="{{actor.system.difficulty}}"/>\n            </div>\n        </div> --\x3e\n\n        <div class="section center wide notes">\n            <h3>{{localizeHeart "delve" "description"}}</h3>\n            {{editor actor.system.description target="system.description" button=true editable=editable owner=owner}}\n        </div>\n\n        <div class="section center wide notes">\n            <h3>{{localizeHeart "delve" "connection"}}</h3>\n            {{editor actor.system.connection target="system.connection" button=true editable=editable owner=owner}}\n        </div>\n\n        {{> itemListSection type="equipment" list=actor.proxy.equipment description_path="equipment"}}\n        {{> itemListSection type="resource" list=actor.proxy.resources description_path="resources"}}\n\n        <div class="section center wide notes">\n            <h3>{{localizeHeart "delve" "notes"}}</h3>\n            {{editor actor.system.notes target="system.notes" button=true editable=editable owner=owner}}\n        </div>\n\n        <div class="section center wide inactive-items">\n            <h3>{{localizeHeart "delve" "inactive-items"}}</h3>\n            <div>{{localizeHeart "delve" "inactive-items-description"}}</div>\n            <div class="item-list">\n            {{#each actor.items as |item|}}\n                {{#if (and (not (undef item.system.active)) (not item.system.active)) }}\n                    {{> (join "/" "heart:items" item.type "preview.html") item=item dataPath="???" showActivate=../user.isOwner showDelete=../user.isOwner}}\n                {{/if}}\n            {{/each}}\n            </div>\n        </div>\n</form>\n</div>'},ze={path:"heart:actors/landmark/sheet.html",source:'{{#*inline "itemListSection"}}\n<div class="section {{localizeHeart type \'label-multiple\'}}">\n    <h2>\n        {{#if overrideTitle}}\n        {{overrideTitle}}\n        {{else}}\n        {{localizeHeart type "label-multiple"}}\n        {{/if}}\n        {{#if actor.isOwner}}\n        <div class="right">\n            <a data-action="add" data-type="{{type}}" data-data=\'{"active": true}\'><span class="fas fa-plus"></span></a>\n        </div>\n        {{/if}}\n    </h2>\n\n    <div class="item-list">\n    {{#each list as |item|}}\n        {{> (join "/" "heart:items" type "preview.html") item=item dataPath="???" hideInactive=../hideInactive showActivate=../showActivate showDelete=(or (not item.isChild) user.isGM ) die_sizes=../die_sizes resistances=../resistances}}\n    {{/each}}\n    </div>\n    \n    {{#if (and showTextboxesBelowItems description_path)}}\n    {{editor (lookup actor.system description_path) target=(join "." "system" description_path) button=true editable=editable owner=owner}}\n    {{/if}}\n</div>\n{{/inline}}\n\n<div>\n<form class="heart sheet actor landmark {{cssClass}}" autocomplete="off">\n        <img class="profile" src="{{actor.img}}" title="{{actor.name}}" data-edit="img"/>\n        \n        <div class="section info">\n            <div class="grid-2 auto-first-col place-center">\n                <h2>{{localizeHeart "landmark" "name"}}</h2>\n                <input name="name" value="{{actor.name}}"/>\n            </div>\n        </div>\n\n        <div class="section info">\n            <div class="grid-2 auto-first-col place-center">\n                <h2>{{localizeHeart "landmark" "defaultStress"}}</h2>\n                <select name="system.stress">\n                    {{selectOptions die_sizes selected=actor.system.stress}}\n                </select>\n            </div>\n        </div>\n\n        <div class="section info">\n            <div class="grid-2 auto-first-col place-center">\n                <h2>{{localizeHeart "landmark" "domain" "label-multiple"}}</h2>\n                <input name="system.domains" value="{{actor.system.domains}}"/>\n            </div>\n        </div>\n\n        <div class="section info">\n            <div class="grid-2 auto-first-col place-center">\n                <h2>{{localizeHeart "landmark" "tier"}}</h2>\n                <input name="system.tier" value="{{actor.system.tier}}"/>\n            </div>\n        </div>\n\n        {{> itemListSection type="haunt" list=actor.proxy.haunts showActivate=true}}\n        {{> itemListSection type="resource" list=actor.proxy.resources}}\n\n        <div class="section center wide notes">\n            <h3>{{localizeHeart "landmark" "specialRule" "label-multiple"}}</h3>\n            {{editor actor.system.specialRules target="system.specialRules" button=true editable=editable owner=owner}}\n        </div>\n\n        <div class="section center wide notes">\n            <h3>{{localizeHeart "landmark" "potentialPlot" "label-multiple"}}</h3>\n            {{editor actor.system.potentialPlots target="system.potentialPlots" button=true editable=editable owner=owner}}\n        </div>\n\n        <div class="section center wide notes">\n            <h3>{{localizeHeart "landmark" "description"}}</h3>\n            {{editor actor.system.description target="system.description" button=true editable=editable owner=owner}}\n        </div>\n        \n        <div class="section center wide inactive-items">\n            <h3>{{localizeHeart "landmark" "inactive-items"}}</h3>\n            <div>{{localizeHeart "landmark" "inactive-items-description"}}</div>\n            <div class="item-list">\n            {{#each actor.items as |item|}}\n                {{#if (and (not (undef item.system.active)) (not item.system.active)) }}\n                    {{> (join "/" "heart:items" item.type "preview.html") item=item dataPath="???" showActivate=../user.isOwner showDelete=../user.isOwner die_sizes=../die_sizes resistances=../resistances}}\n                {{/if}}\n            {{/each}}\n            </div>\n        </div>\n</form>\n</div>'},Te={path:"heart:applications/base/application.html",source:'<form class="heart form {{type}} {{classes}} {{#if showRoll}}grid-2{{/if}} auto-first-col">\n    <div class="wide description">\n        {{localizeHeart "applications" type "description"}}\n    </div>\n    {{> @partial-block}}\n    {{#if showRoll }}\n    <div class="wide grid-2">\n        <button data-action=\'cancel\'><span class="fas fa-times"></span> {{localizeHeart \'cancel\'}}</button>\n        <button data-action=\'submit\'><span class="fas fa-dice"></span> {{localizeHeart \'roll\'}}</button>\n    </div>\n    {{/if}}\n</form>'},He={path:"heart:applications/beat-tracker/application.html",source:'{{#> "heart:applications/base/application.html" type="beat-tracker"}}\n<div class="active-beats">\n    {{#if (gt characters.length 0)}}\n    {{#each characters as |char|}}\n    <div class="character-box">\n        <label class="character-header">\n            {{char.character.name}}\n        </label>\n        <div class="char-active-beats">\n            {{#if (gt char.activeBeats.length 0)}}\n            {{#each char.activeBeats as |beat|}}\n            {{> "heart:items/beat/preview.html" item=beat showDelete=false showComplete=false showActivate=false}}\n            {{/each}}\n            {{else}}\n            <p class="no-beats">{{localizeHeart "No active beats"}}</p>\n            {{/if}}\n        </div>\n    </div>\n    {{/each}}\n    {{else}}\n    <p class="no-characters">{{localizeHeart "No characters available"}}</p>\n    {{/if}}\n</div>\n{{/ "heart:applications/base/application.html"}}'},_e={path:"heart:applications/prepare-roll-request/application.html",source:'{{#> "heart:applications/base/application.html" type="prepare-roll-request" showRoll=true}}\n<label>\n    {{localizeHeart "difficulty" "label-single"}}\n</label>\n<select name="difficulty">\n    {{selectOptions difficulties}}\n</select>\n\n<label>\n    {{localizeHeart "character" "label-multiple"}}\n</label>\n<div class="options">\n    {{#each characters as |character char_id|}}\n    {{#with (randomID) as |id|}}\n    <input class="hidden" type="checkbox" id="{{id}}" name="character" value="{{char_id}}" />\n    <label for="{{id}}" class="option">\n        {{character}}\n    </label>\n    {{/with}}\n    {{/each}}\n</div>\n\n<label>\n    {{localizeHeart "skill" "label-multiple"}}\n</label>\n<div class="options">\n    {{#each skills as |skill name|}}\n    {{#with (randomID) as |id|}}\n    <input class="hidden" type="checkbox" id="{{id}}" name="skill" value="{{name}}" />\n    <label for="{{id}}" class="option">\n        {{skill}}\n    </label>\n    {{/with}}\n    {{/each}}\n</div>\n\n\n<label>\n    {{localizeHeart "domain" "label-multiple"}}\n</label>\n<div class="options">\n    {{#each domains as |domain name|}}\n    {{#with (randomID) as |id|}}\n    <input class="hidden" type="checkbox" id="{{id}}" name="domain" value="{{name}}" />\n    <label for="{{id}}" class="option">\n        {{domain}}\n    </label>\n    {{/with}}\n    {{/each}}\n</div>\n\n<label>\n    {{localizeHeart "character" "label-valid-helpers"}}\n</label>\n<div class="options">\n    {{#each characters as |character char_id|}}\n    {{#with (randomID) as |id|}}\n    <input class="hidden" type="checkbox" id="{{id}}" name="helper" value="{{char_id}}" />\n    <label for="{{id}}" class="option">\n        {{character}}\n    </label>\n    {{/with}}\n    {{/each}}\n</div>\n{{/ "heart:applications/base/application.html"}}'},Se={path:"heart:applications/prepare-roll-request/chat-message.html",source:'<form class="heart roll-request grid-2 auto-first-col place-center">\n    <h1 class="wide title-font ">{{localizeHeart "rolls" "roll-request" "label"}}</h1>\n    <label class="title-font">{{localizeHeart "difficulty" "label-single"}}</label>\n    <div>\n        {{localizeHeart "difficulty" difficulty}}\n        <input type="hidden" name="difficulty" value="{{difficulty}}"/>\n    </div>\n\n    <label class="title-font">{{localizeHeart "skill" "label-single"}}</label>\n    {{#if (lt skills.length 2)}}\n        {{#if (eq skills.length 1)}}\n            <div>\n                {{localizeHeart "skill" (lookup skills 0)}}\n                <input type="hidden" name="skill" value="{{lookup skills 0}}"/>\n            </div>\n        {{else}}\n            <div>{{localizeHeart "none"}}</div>\n        {{/if}}\n    {{else}}\n    <select name="skill">\n        {{#each skills as |skill|}}\n        <option value="{{skill}}">{{localizeHeart "skill" skill}}</option>\n        {{/each}}\n    </select>\n    {{/if}}\n\n    <label class="title-font">{{localizeHeart "domain" "label-single"}}</label>\n    {{#if (lt domains.length 2)}}\n        {{#if (eq domains.length 1)}}\n        <div>\n            {{localizeHeart "domain" (lookup domains 0)}}\n            <input type="hidden" name="domain" value="{{lookup domains 0}}"/>\n        </div>\n        {{else}}\n            <div>{{localizeHeart "none"}}</div>\n        {{/if}}\n    {{else}}\n    <select name="domain">\n        {{#each domains as |domain|}}\n        <option value="{{domain}}">{{localizeHeart "domain" domain}}</option>\n        {{/each}}\n    </select>\n    {{/if}}\n\n    <label class="title-font">{{localizeHeart "mastery" "short"}}</label>\n    <input class="invert" type="checkbox" name="mastery"/>\n\n    <label class="title-font">{{localizeHeart "help"}}</label>\n    {{#if validHelpers}}\n    <select name="helper" multiple>\n        {{#each validHelpers as |helper_id|}}\n        {{#with (getActor helper_id) as |actor|}}\n        <option value="{{helper_id}}">{{actor.name}}</option>\n        {{/with}}\n        {{/each}}\n    </select>\n    {{else}}\n    <div>{{localizeHeart "none"}}</div>\n    {{/if}}\n\n    <div class="wide">\n        {{#each characters as |character|}}\n        {{#with (getActor character) as |actor|}}\n        {{#if actor.isOwner}}\n            <button data-action="roll" data-character="{{character}}"> <span class="fas fa-dice"></span> {{actor.name}}</button>\n        {{/if}}\n        {{/with}}\n        {{/each}}\n    </div>\n</form>'},Ce={path:"heart:applications/requirement-form/application.html",source:'{{#> "heart:applications/base/application.html" type=options.type showRoll=true}}\n{{#each options.requirements as |entry name|}}\n<label>\n    {{entry.label}}\n</label>\n{{#if entry.isCheckbox}}\n<input type="checkbox" name="{{name}}" value="{{entry.value}}" />\n{{else}}\n<select name="{{name}}" {{#if entry.isMany}}multiple{{/if}}>\n    {{#each entry.options as |label value|}}\n    <option value="{{value}}">{{label}}</option>\n    {{/each}}\n</select>\n{{/if}}\n{{/each}}\n{{/ "heart:applications/base/application.html"}}'},Ie={path:"heart:common/sheet.html",source:'<form class="heart sheet base {{documentName}} {{type}} {{cssClass}} flexcol" autocomplete="off">\n    <div class="info">\n        <img class="profile" src="{{document.img}}" title="{{localizeHeart document.name}}" data-edit="img" />\n        <div class="text">\n            <input name="name" value="{{localizeHeart document.name}}" placeholder="{{localizeHeart type \'name\'}}" />\n            <div class="subtitle">{{localizeHeart type "label-single"}}</div>        \n        </div>\n    </div>\n    {{> @partial-block }}\n</form>'},Oe={path:"heart:items/ability/preview.html",source:'\n{{#> "heart:items/base/preview.html" showActive=showActive}}\n    <h4>\n        {{#if showTypeInTitle}}{{localizeHeart "ability" "type" item.system.type}}:{{/if}}\n        {{localizeHeart item.name}}\n    </h4>\n    <div>\n        {{{localizeHeart item.system.description}}}\n    </div>\n    <div>\n        {{#each item.proxy.abilities as |ability|}}\n            {{#if (or (not ../hideInactive) ability.system.active)}}\n            {{> "heart:items/ability/preview.html" document=../document item=ability showTypeInTitle=true showActivate=true}}\n            {{/if}}\n        {{/each}}\n    </div>\n{{/ "heart:items/base/preview.html"}}'},De={path:"heart:items/ability/sheet.html",source:'{{#> "heart:items/base/sheet.html" type="ability"}}\n\n<div>\n    {{#each item.proxy.abilities as |ability|}}\n        {{> "heart:items/ability/preview.html" document=../document item=ability}}\n    {{/each}}\n    {{#if user.isGM }}\n    <a data-action="add-child" data-type="ability" data-data=\'{"type": "minor", "name": "New Ability"}\'><span class="fas fa-plus"></span> {{localizeHeart "ability" "add-child-ability"}}</a>\n    {{/if}}\n</div>\n\n{{/ "heart:items/base/sheet.html" }}'},Ae={path:"heart:items/base/preview.html",source:'<div data-item-id="{{item.uuid}}" data-document-id="{{item.uuid}}" class="item preview {{item.type}}">\n    <div class="actionbar">\n        <a data-action="view" title="{{localizeHeart \'base\' \'view\'}}"><span class="fas fa-eye"></span></a>\n        {{#if item.isOwner}}\n            {{#if showComplete}}\n                {{#if item.system.complete}}\n                <a data-action="uncomplete" title="{{localizeHeart \'base\' \'uncomplete\'}}"><span class="fas fa-times"></span></a>\n                {{else}}\n                <a data-action="complete" title="{{localizeHeart \'base\' \'complete\'}}"><span class="fas fa-check"></span></a>\n                {{/if}}\n            {{/if}}\n            {{#if showActivate}}\n                {{#if item.system.active}}\n                <a data-action="deactivate" title="{{localizeHeart \'base\' \'deactivate\'}}"><span class="fas fa-toggle-on"></span></a>\n                {{else}}\n                <a data-action="activate" title="{{localizeHeart \'base\' \'activate\'}}"><span class="fas fa-toggle-off"></span></a>\n                {{/if}}\n            {{/if}}\n            {{#if showDelete }}\n                <a data-action="delete" title="{{localizeHeart \'base\' \'delete\'}}"><span class="fas fa-trash"></span></a>\n            {{/if}}\n        {{/if}}\n    </div>\n\n    {{> @partial-block }}\n\n</div>'},qe={path:"heart:items/base/sheet.html",source:'{{#> "heart:common/sheet.html" documentName="item" type=type}}\n    <div class="grid-2 auto-first-col place-center" style="flex: auto 0 0">\n    {{#if system.die_size}}\n        <label>\n            {{localizeHeart "die_size" "label-single"}}\n        </label>\n        {{#if editable}}\n        <select name="system.die_size">\n            {{selectOptions die_sizes selected=system.die_size}}\n        </select>\n        \n        {{else}}\n        {{system.die_size}}\n        {{/if}}\n    {{/if}}\n    {{#if item.isOwner }}\n        {{#if (not (undef system.active))}}\n            <label>\n                {{localizeHeart "base" "is-active"}}\n            </label>\n            <input type="checkbox" value="system.active" {{checked system.active}}/>\n        {{/if}}\n\n        {{#if (not (undef system.complete))}}\n            <label>\n                {{localizeHeart "base" "is-complete"}}\n            </label>\n            <input type="checkbox" value="system.complete" {{checked system.complete}}/>\n        {{/if}}\n\n        {{#if (eq type "beat")}}\n            <label>\n                Level\n            </label>\n            <select name="system.type">\n                {{selectOptions beat_levels selected=system.type}}\n            </select>\n        {{/if}}\n\n        {{#if (eq type "fallout")}}\n            <label>\n                Level\n            </label>\n            <select name="system.type">\n                {{selectOptions fallout_levels selected=system.type}}\n            </select>\n\n            <label>\n                Resistance\n            </label>\n            <select name="system.resistance">\n                {{selectOptions resistances selected=system.resistance}}\n            </select>\n        {{/if}}\n    {{/if}}\n    </div>\n\n    {{editor (localizeHeart system.description) target="system.description" button=true editable=editable owner=owner}}\n        \n    {{> @partial-block }}\n{{/ "heart:common/sheet.html" }}'},Ee={path:"heart:items/beat/preview.html",source:'{{#> "heart:items/base/preview.html"}}\n\x3c!-- This should probably be a class toggle but I couldn\'t figure it out. Something like the below--\x3e\n\x3c!-- <div class="{{#if item.system.complete}}completed-beat{{/if}};"></div> --\x3e\n<div {{#if item.system.complete}}style="text-decoration: line-through;" {{/if}}>\n    <b>{{{titlecase (localizeHeart item.system.type)}}}:</b> {{{localizeHeart item.system.description}}}\n</div>\n{{/ "heart:items/base/preview.html"}}'},je={path:"heart:items/beat/sheet.html",source:'{{#> "heart:items/base/sheet.html" type="beat"}}\n{{/ "heart:items/base/sheet.html" }}'},Re={path:"heart:items/calling/sheet.html",source:'{{#*inline "beatSection"}}\n<h2>\n    {{localizeHeart "beat" (join "" type "-beat") "label-multiple"}}\n    {{#if user.isGM }}\n    <a class="right" data-action="add-child" data-type="beat" data-data=\'{"type": "{{type}}"}\'><span class="fas fa-plus"></span> {{localizeHeart "beat" (join "" type "-beat") "add"}}</a>\n    {{/if}}\n</h2>\n<div class="item-list">\n    {{#each beats as |beat|}}\n        {{> "heart:items/beat/preview.html" item=beat showDelete=../user.isGM}}\n    {{/each}}\n</div>\n{{/inline}}\n\n<form class="heart sheet base Item calling {{cssClass}}" autocomplete="off">\n    <h1>\n        {{#if (and editable (not item.isOwned))}}\n        <input name="name" value="{{localizeHeart item.name}}"/>\n        {{else}}\n        {{localizeHeart item.name}}\n        {{/if}}\n    </h1>\n    <div class="description">\n        {{#if (and editable (not item.isOwned))}}\n        {{editor (localizeHeart system.description) target="system.description" button=true editable=editable owner=owner}}\n        {{else}}\n        {{{localizeHeart system.description}}}\n        {{/if}}\n    </div>\n\n    <h4>\n        {{localizeHeart "calling" "questions" "prompt"}}\n        {{#if user.isGM }}\n        <a class="right" data-action="add-question"><span class="fas fa-plus"></span> {{localizeHeart "calling" "questions" "add"}}</a>\n        {{/if}}\n    </h4>\n    <ul>\n    {{#each system.questions as |question id|}}\n        <li data-id="{{id}}">\n            <div class="flexrow">\n                {{#if ../item.isOwned}}\n                <div>\n                    <div class="question">{{{localizeHeart question.question}}}</div>\n                    {{#if ../editable}}\n                    {{editor question.answer target=(join "." "system.questions" id "answer") button=true editable=../editable owner=owner}}\n                    {{else}}\n                    <div>{{{localizeHeart question.answer}}}</div>\n                    {{/if}}\n                </div>\n                {{else}}\n                    {{#if ../editable}}\n                    <div class="question">\n                        {{editor (localizeHeart question.question) target=(join "." "system.questions" id "question") button=true editable=../editable owner=owner}}\n                    </div>\n                    {{else}}\n                    <div>{{{localizeHeart question.question}}}</div>\n                    {{/if}}\n                {{/if}}\n                {{#if user.isGM }}\n                <a class="action" data-action="delete-question"><span class="fas fa-trash"></span> {{localizeHeart "calling" "questions" "delete"}}</a>\n                {{/if}}\n            </div>    \n        </li>\n    {{/each}}\n    </ul>\n\n\n    <h2>\n        {{#if (eq system.abilities.length 1)}}\n            {{localizeHeart "calling" "core-ability" "label-single"}}\n        {{else}}\n            {{localizeHeart "calling" "core-ability" "label-multiple"}}\n        {{/if}}\n        {{#if user.isGM }}\n        <a class="right" data-action="add-child" data-type="ability" data-data=\'{"active": true}\'><span class="fas fa-plus"></span> {{localizeHeart "calling" "core-ability" "add"}}</a>\n        {{/if}}\n    </h2>\n    <div class="item-list">\n        {{#each childrenTypes.ability as |ability|}}\n            {{> "heart:items/ability/preview.html" item=ability showActivate=true showDelete=../user.isGM}}\n        {{/each}}\n    </div>\n\n    {{> beatSection beats=minorBeats type="minor"}}\n    {{> beatSection beats=majorBeats type="major"}}\n    {{> beatSection beats=zenithBeats type="zenith"}}\n</form>'},$e={path:"heart:items/class/sheet.html",source:'{{#*inline "abilitySection"}}\n<h2>\n    {{localizeHeart "class" (join "" type "-ability") "label-multiple"}}\n    {{#if (and editable (not item.isOwned))}}\n    <a class="right" data-action="add-child" data-type="ability" data-data=\'{"type": "{{type}}"{{#if (eq type "core")}}, "active": true{{/if}} }\'><span class="fas fa-plus"></span> {{localizeHeart "class" (join "" type "-ability") "add"}}</a>\n    {{/if}}\n</h2>\n<div class="item-list">\n    {{#each abilities as |ability|}}\n        {{> "heart:items/ability/preview.html" document=../document item=ability showActivate=true showDelete=../user.isGM}}\n    {{/each}}\n</div>\n{{/inline}}\n\n<form class="heart sheet base Item class {{cssClass}}" autocomplete="off">\n    <h1>\n        {{#if (and editable (not item.isOwned))}}\n        <input name="name" value="{{localizeHeart item.name}}"/>\n        {{else}}\n        {{localizeHeart item.name}}\n        {{/if}}\n    </h1>\n    <div class="description">\n        {{#if (and editable (not item.isOwned))}}\n        {{editor (localizeHeart system.description) target="system.description" button=true editable=editable owner=owner}}\n        {{else}}\n        {{{localizeHeart system.description}}}\n        {{/if}}\n    </div>\n\n    <h2>\n        {{localizeHeart "class" "core-traits" "label-multiple"}}\n    </h2>\n    <div class="grid-2 auto-first-col">\n        <div class="title-font">{{localizeHeart "skill" "label-single"}}</div>\n        {{#if (and editable (not item.isOwned))}}\n        <select name="system.core_skill">\n            {{selectOptions skills selected=system.core_skill}}\n        </select>\n        {{else}}\n        <div>{{localizeHeart "skill" system.core_skill}}</div>\n        {{/if}}\n\n        <div class="title-font">{{localizeHeart "domain" "label-single"}}</div>\n        {{#if (and editable (not item.isOwned))}}\n        <select name="system.core_domain">\n            {{selectOptions domains selected=system.core_domain}}\n        </select>\n        {{else}}\n        <div>{{localizeHeart "domain" system.core_domain}}</div>\n        {{/if}}\n\n        <div class="title-font">{{localizeHeart "resource" "label-single"}}</div>\n        <div>\n            {{#each (lookup childrenTypes "resource") as |resource|}}\n                {{> "heart:items/resource/preview.html" document=../document item=resource user=../user showDelete=../user.isGM}}\n            {{/each}}\n            \n            {{#if user.isGM }}\n            <a class="right" data-action="add-child" data-type="resource" data-data=\'{"name": "New Resource", "domain": "cursed", "active": true}\'><span class="fas fa-plus"></span> {{localizeHeart "class" "resource" "add"}}</a>\n            {{/if}}\n        </div>\n        <div class="wide">\n        </div>\n    \n        <div class="title-font">{{localizeHeart "equipment" "label-single"}}</div>\n        <div>\n            {{#if (gt item.system.equipment_groups.length 1)}}\n                {{localizeHeart "class" "equipment" "pick-one"}}\n            {{/if}}\n            {{#each item.system.equipment_groups as |groupId|}}\n                <div class="equipment-group {{#if (or (eq groupId ../item.system.active_equipment_group) (includes ../item.system.active_equipment_groups groupId))}}active{{/if}}" data-group-id="{{groupId}}">\n                    {{#if (or ../item.isEmbedded ../item.isChild) }}\n                    <div class="actionbar">\n                        {{#if (or (eq groupId ../item.system.active_equipment_group) (includes ../item.system.active_equipment_groups groupId))}}\n                        <a data-action="deactivate-group" title="{{localizeHeart \'base\' \'deactivate\'}}"><span class="fas fa-toggle-on"></span></a>\n                        {{else}}\n                        <a data-action="activate-group" title="{{localizeHeart \'base\' \'activate\'}}"><span class="fas fa-toggle-off"></span></a>\n                        {{/if}}\n                    </div>\n                    {{/if}}\n                    {{#each (lookup ../childrenTypes "equipment") as |item|}}\n                        {{#if (eq item.system.group groupId )}}\n                            {{> "heart:items/equipment/preview.html" document=../document item=item showActivate=false showDelete=../../user.isGM}}\n                        {{/if}}\n                    {{/each}}\n                    {{#if ../user.isGM }}\n                    <div class="flexcol">\n                        <a class="right" data-action="add-child" data-type="equipment" data-data=\'{"name": "New Resource", "domain": "cursed", "group": "{{groupId}}"}\'><span class="fas fa-plus"></span> {{localizeHeart "class" "equipment" "add"}}</a>\n                        <a class="right" data-action="delete-equipment-group"><span class="fas fa-trash"></span> {{localizeHeart "class" "equipment" "delete-group"}}</a>\n                    </div>\n                    {{/if}}\n                </div>\n            {{/each}}\n            \n            {{#if user.isGM }}\n                <a class="right" data-action="add-equipment-group"><span class="fas fa-plus"></span> {{localizeHeart "class" "equipment" "add-group"}}</a>\n            {{/if}}          \n        </div>\n    </div>\n\n    {{> abilitySection abilities=coreAbilities type="core"}}\n    {{> abilitySection abilities=minorAbilities type="minor"}}\n    {{> abilitySection abilities=majorAbilities type="major"}}\n    {{> abilitySection abilities=zenithAbilities type="zenith"}}\n</form>'},Be={path:"heart:items/equipment/preview.html",source:'{{#> "heart:items/base/preview.html" showActivate=showActivate}}\n    {{localizeHeart item.name}}\n    ({{localizeHeart "equipment" "type" item.system.type}}, <a data-action="item-roll"><span class="fas fa-dice"></span> {{item.system.die_size}}</a>\n    {{#each item.system.resistances}}\n        {{titlecase (localizeHeart this)}}\n    {{/each}}\n    )\n    {{#if item.childrenTypes.tag}}\n    <span class="fas fa-tag"></span>\n    {{/if}}\n    {{#each item.childrenTypes.tag as |tag|}}\n        <a data-action="view" data-item-id="{{tag.uuid}}" title="{{localizeHeart \'base\' \'view\'}}">\n            {{localizeHeart tag.name}}{{#unless @last}}, {{/unless}}\n        </a>\n        \n    {{/each}}\n{{/ "heart:items/base/preview.html"}}'},Ne={path:"heart:items/equipment/sheet.html",source:'{{#> "heart:items/base/sheet.html" type="equipment"}}\n<div class="grid-2 auto-first-col place-center" style="flex: auto 0 0">\n    <label>{{localizeHeart "equipment" "type" "label-single"}}</label>\n    <select name="system.type">\n        {{selectOptions equipment_types selected=system.type}}\n    </select>\n</div>\n{{#if (itemIsKillOrMend system.type) }}\n<div class="equipment resistances red">\n    {{#with (getHeartResistances) as |resistances|}}\n    {{#each resistances}}\n        <div>\n            <h3>{{localizeHeart this}}</h3>\n            <div data-target=\'system.resistances\' data-value="{{this}}">\n                {{{ordered-checkable (includes ../../system.resistances this) 1}}}\n            </div>\n        </div>\n    {{/each}}\n    {{/with}}\n</div>\n{{/if}}\n\n<div>\n    <h2>\n        <span class="fas fa-tag"></span>\n        {{localizeHeart "tag" "label-multiple"}}\n        {{#if user.isGM }}\n        <a class="right" data-action="add-child" data-type="tag"><span class="fas fa-plus"></span> {{localizeHeart "tag" "add"}}</a>\n        {{/if}}\n    </h2>\n    <div class="item-list">\n        {{#each item.childrenTypes.tag as |tag|}}\n            {{> "heart:items/tag/preview.html" item=tag showActivate=false showDelete=../item.isOwner}}\n        {{/each}}\n    </div>\n</div>\n{{/ "heart:items/base/sheet.html" }}'},Me={path:"heart:items/fallout/preview.html",source:'{{#> "heart:items/base/preview.html" }}\n    <h4>{{localizeHeart item.name}} ({{localizeHeart item.system.type}} {{localizeHeart item.system.resistance}})</h4>\n    <div>\n        {{{localizeHeart item.system.description}}}\n    </div>\n{{/ "heart:items/base/preview.html"}}'},Pe={path:"heart:items/fallout/sheet.html",source:'{{#> "heart:items/base/sheet.html" type="fallout"}}\n{{/ "heart:items/base/sheet.html" }}'},Ze={path:"heart:items/haunt/preview.html",source:'{{#> "heart:items/base/preview.html" showActivate=true showComplete=false showDelete=true die_sizes=undefined resistances=undefined}}\n    <h4>\n        {{localizeHeart item.name}}\n    </h4>\n    <div class="section {{localizeHeart haunt upgradeTrack \'label-single\'}}">\n        <h4>\n            {{localizeHeart "haunt" "upgradeTrack" "label-single"}}\n            <div class="right">\n                <a data-action="upgrade" data-type="haunt"><span class="fas fa-level-up-alt"></span>{{localizeHeart "haunt" "upgrade"}}</a>\n                <a data-action="downgrade" data-type="haunt"><span class="fas fa-level-down-alt"></span>{{localizeHeart "haunt" "downgrade"}}</a>\n            </div>\n        </h4>\n        <div class="red" data-target=\'system.upgradeTrack\'>{{{ordered-checkable item.system.upgradeTrack 6}}}</div>\n    </div>\n    \n    <div class="section {{localizeHeart haunt service \'label-multiple\'}}">\n        <h4>\n            {{#if overrideTitle}}\n            {{overrideTitle}}\n            {{else}}\n            {{localizeHeart "haunt" "service" "label-multiple"}}\n            {{/if}}\n            <div class="right">\n                <a data-action="add-service" data-type="service"><span class="fas fa-plus"></span></a>\n            </div>\n        </h4>\n        \n        <div class="item-list">\n            {{#each item.system.resistances as |service id|}}\n                <div data-id="{{id}}">\n                    <a data-action="service-roll"><span class="fas fa-dice"></span></a>\n                    <select name="service-selector-die">\n                        {{selectOptions ../die_sizes selected=service.die_size}}\n                    </select>\n                    <select name="service-selector-resistance">\n                        {{selectOptions ../resistances selected=service.resistance}}\n                    </select>\n                    {{#if ../showDelete}}\n                    <a class="action right" data-action="delete-service"><span class="fas fa-trash"></span></a>\n                    {{/if}}\n                </div>\n            {{/each}}\n        </div>\n    </div>\n{{/ "heart:items/base/preview.html"}}'},Le={path:"heart:items/haunt/sheet.html",source:'{{#> "heart:common/sheet.html" documentName="item" type="haunt"}}\n\n<div class="section {{localizeHeart haunt upgradeTrack \'label-single\'}}">\n    <h3>\n        {{localizeHeart "haunt" "upgradeTrack" "label-single"}}\n        <div class="right">\n            <a data-action="upgrade" data-type="haunt"><span class="fas fa-level-up-alt"></span>{{localizeHeart "haunt" "upgrade"}}</a>\n            <a data-action="downgrade" data-type="haunt"><span class="fas fa-level-down-alt"></span>{{localizeHeart "haunt" "downgrade"}}</a>\n        </div>\n    </h3>\n    <div class="red" data-target=\'system.upgradeTrack\'>{{{ordered-checkable item.system.upgradeTrack 6}}}</div>\n</div>\n\n<div class="section {{localizeHeart haunt service \'label-multiple\'}}" data-item-id="{{item.uuid}}">\n    <h3>\n        {{#if overrideTitle}}\n            {{overrideTitle}}\n            {{else}}\n            {{localizeHeart "haunt" "service" "label-multiple"}}\n            {{/if}}\n        <div class="right">\n            <a data-action="add-service" data-type="service"><span class="fas fa-plus"></span></a>\n        </div>\n    </h3>\n    <div class="item-list">\n        {{#each system.resistances as |service id|}}\n            <div data-id="{{id}}">\n                <a data-action="service-roll"><span class="fas fa-dice"></span></a>\n                <select name="system.resistances.{{id}}.die_size">\n                    {{selectOptions ../die_sizes selected=service.die_size}}\n                </select>\n                <select name="system.resistances.{{id}}.resistance">\n                    {{selectOptions ../resistances selected=service.resistance}}\n                </select>\n                {{#if ../user.isGM }}\n                <a class="action right" data-action="delete-service"><span class="fas fa-trash"></span></a>\n                {{/if}}\n            </div>\n        {{/each}}\n    </div>\n</div>\n\n\n{{/ "heart:common/sheet.html"}}'},Fe={path:"heart:items/resource/preview.html",source:'{{#> "heart:items/base/preview.html" showActivate=true showComplete=false}}\n    {{localizeHeart item.name}}\n    (<a data-action="item-roll"><span class="fas fa-dice"></span> {{item.system.die_size}}</a>\n    {{localizeHeart "domain" item.system.domain}}\n    )\n    {{#if item.childrenTypes.tag}}\n    <span class="fas fa-tag"></span>\n    {{/if}}\n    {{#each item.childrenTypes.tag as |tag|}}\n        <a data-action="view" data-item-id="{{tag.uuid}}" title="{{localizeHeart \'base\' \'view\'}}">\n            {{localizeHeart tag.name}}\n        </a>\n        {{#unless @last}}, {{/unless}}\n    {{/each}}\n{{/ "heart:items/base/preview.html"}}'},Ue={path:"heart:items/resource/sheet.html",source:'{{#> "heart:items/base/sheet.html" type="resource"}}\n<div class="grid-2 auto-first-col">\n\n    <label>\n        {{localizeHeart "domain" "label-single"}}\n    </label>\n    {{#if editable}}\n        <select name="system.domain">\n            {{selectOptions domains selected=system.domain}}\n        </select>\n    {{else}}\n        {{localizeHeart "domain" system.domain}}\n    {{/if}}\n</div>\n\n<div>\n    <h2>\n        {{localizeHeart "tag" "label-multiple"}}\n        {{#if user.isGM }}\n        <a class="right" data-action="add-child" data-type="tag"><span class="fas fa-plus"></span> {{localizeHeart "tag" "add"}}</a>\n        {{/if}}\n    </h2>\n    <div class="item-list">\n        {{#each item.childrenTypes.tag as |tag|}}\n            {{> "heart:items/tag/preview.html" item=tag showActivate=false showDelete=../item.isOwner}}\n        {{/each}}\n    </div>\n</div>\n{{/ "heart:items/base/sheet.html"}}'},Ge={path:"heart:items/tag/preview.html",source:'{{#> "heart:items/base/preview.html" }}\n    {{localizeHeart item.name}}\n{{/ "heart:items/base/preview.html"}}'},Je={path:"heart:items/tag/sheet.html",source:'{{#> "heart:items/base/sheet.html" type="tag"}}\n{{/ "heart:items/base/sheet.html"}}'},Ve={path:"heart:rolls/fallout-roll/roll.html",source:'<div class="dice-roll heart fallout-roll">\n    {{#if flavor}}\n    <div class="dice-flavor">{{flavor}}</div>\n    {{/if}}\n    <div class="dice-result">\n        <div class="dice-formula">{{description}}</div>\n        {{{tooltip}}}\n        <div class="flexrow">\n            <h4 class="dice-total text">{{localizeHeart \'rolls\' \'fallout-roll\' \'results\' result}}</h4>\n            {{#if showClearStressButton}}\n            <button class="icon-button" data-action="clear-stress" title="{{localizeHeart \'rolls\' \'fallout-roll\' \'clear-stress\' }}">\n                <span class="fas fa-refresh"></span>\n            </button>\n            {{/if}}\n        </div>\n    </div>\n\n</div>'},Ke={path:"heart:rolls/heart-roll/roll.html",source:'<form class="dice-roll heart heart-roll">\n    <input type="hidden" name="character" value="{{character}}"/>\n    {{#if flavor}}\n    <div class="dice-flavor">{{flavor}}</div>\n    {{/if}}\n    <div class="dice-result">\n        <div class="dice-formula">{{description}}</div>\n        {{{tooltip}}}\n        <div class="flexrow">\n            <h4 class="dice-total text">{{localizeHeart "result" result}}</h4>\n            {{#if (and showStressRollButton (lookup (getActor character) "isOwner"))}}\n            <button class="icon-button" data-action=\'roll-stress\' title="{{localizeHeart \'rolls\' \'stress-roll\' \'action\'}}">\n                <span class="fas fa-dice"></span>\n            </button>\n            {{/if}}\n        </div>\n    </div>\n</form>'},We={path:"heart:rolls/heart-roll/tooltip.html",source:'<div class="dice-tooltip" style="display: none;">\n    {{#each parts}}\n    <section class="tooltip-part">\n        <div class="dice">\n            <header class="part-header">\n                {{#if this.flavor}}<span class="part-formula">{{this.flavor}}</span>{{/if}}\n            </header>\n            <ol class="dice-rolls">\n            {{#each this.rolls as |roll index|}}\n                {{#if (numEq @../index ../../kept)}}\n                <li class="roll {{this.classes}}">{{{roll.result}}}</li>\n                {{else}}\n                <li class="roll discarded {{this.classes}}">{{{roll.result}}}</li>\n                {{/if}}\n            {{/each}}\n            </ol>\n        </div>\n    </section>\n    {{/each}}\n</div>\n'},Qe={path:"heart:rolls/stress-roll/roll.html",source:'<form class="dice-roll heart stress-roll">\n    <input type="hidden" name="character" value="{{character}}"/>\n    {{#if flavor}}\n    <div class="dice-flavor">{{flavor}}</div>\n    {{/if}}\n    <div class="dice-result">\n        <div class="dice-formula">{{description}}</div>\n        {{{tooltip}}}\n        <div class="flexrow">\n            <h4 class="dice-total">{{total}} {{#if resistance}}{{titlecase (localizeHeart resistance)}}{{/if}} {{localizeHeart \'stress\'}}</h4>\n            {{#if showTakeStressButton}}\n            <button class="icon-button" data-action="take-stress" title="{{localizeHeart \'rolls\' \'stress-roll\' \'take-stress\' }}">\n                <span class="fas fa-heart-broken"></span>\n            </button>\n            {{/if}}\n            {{#if showFalloutRollButton}}\n            <button class="icon-button" data-action="roll-fallout" title="{{localizeHeart \'rolls\' \'fallout-roll\' \'action\' }}">\n                <span class="fas fa-radiation-alt"></span>\n            </button>\n            {{/if}}\n        </div>\n    </div>\n</form>'},Ye={path:"heart:templates/apps/compendium.html",source:'<div class="compendium directory flexcol" data-pack="{{collection.collection}}">\n\n    \x3c!-- Directory Header --\x3e\n    <header class="directory-header flexrow">\n        <div class="header-search flexrow">\n            <i class="fas fa-search"></i>\n            <input type="text" name="search" value="" placeholder="{{ localize \'FILES.Search\' }}" autocomplete="off"/>\n        </div>\n    </header>\n\n    \x3c!-- Directory Contents --\x3e\n    <ol class="directory-list">\n        {{#each index}}\n        <li class="directory-item document {{@root.documentCls}} flexrow" data-entry-id="{{this._id}}" data-document-id="{{this._id}}">\n            {{#if this.thumb}}\n            <img class="thumbnail" title="{{this.name}}" alt="{{this.name}}" data-src="{{this.thumb}}"/>\n            {{else if this.img}}\n            <img class="thumbnail" title="{{this.name}}" alt="{{this.name}}" data-src="{{this.img}}"/>\n            {{/if}}\n            <h4 class="document-name entry-name"><a>{{localizeHeart this.name}}</a></h4>\n        </li>\n        {{/each}}\n    </ol>\n</div>\n'},Xe={path:"heart:templates/startup.html",source:'{{{localize "heart.dialog.content(VERSION)" VERSION=version}}}\n<h2>{{localizeHeart "changelog"}}</h2>\n\n<nav class="tabs version-tabs" data-group="version-tabs">\n    {{#each versions as |version|}}\n        <a class="item" data-tab="{{version.version}}" data-group="version-tabs">{{version.version}}</a>\n    {{/each}}\n</nav>\n<section class="content">\n    {{#each versions as |version|}}\n    <div class="tab" data-tab="{{version.version}}" data-group="version-tabs">\n        {{#if version.changes}}\n        <h3>{{localizeHeart "version" "changes"}}</h3>\n        <ul>\n            {{#each version.changes as |change|}}\n            <li>{{change}}</li>\n            {{/each}}\n        </ul>\n        {{/if}}\n        {{#if version.bug_fixes}}\n        <h3>{{localizeHeart "version" "bug_fixes"}}</h3>\n        <ul>\n            {{#each version.bug_fixes as |bug_fix|}}\n            <li>{{bug_fix}}</li>\n            {{/each}}\n        </ul>\n        {{/if}}\n    </div>\n    {{/each}}\n</section>\n'};var et=a(379),tt=a.n(et),at=a(795),it=a.n(at),st=a(695),rt=a.n(st),nt=a(216),lt=a.n(nt),ot=a(402),ct={styleTagTransform:function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}},setAttributes:function(e){var t=a.nc;t&&e.setAttribute("nonce",t)},insert:function(e){var t=rt()("head");if(!t)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");t.appendChild(e)}};ct.domAPI=it(),ct.insertStyleElement=lt();tt()(ot.Z,ct);ot.Z&&ot.Z.locals&&ot.Z.locals;var dt=a(746),ht={styleTagTransform:function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}},setAttributes:function(e){var t=a.nc;t&&e.setAttribute("nonce",t)},insert:function(e){var t=rt()("head");if(!t)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");t.appendChild(e)}};ht.domAPI=it(),ht.insertStyleElement=lt();tt()(dt.Z,ht);dt.Z&&dt.Z.locals&&dt.Z.locals;var mt=a(7),ut={styleTagTransform:function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}},setAttributes:function(e){var t=a.nc;t&&e.setAttribute("nonce",t)},insert:function(e){var t=rt()("head");if(!t)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");t.appendChild(e)}};ut.domAPI=it(),ut.insertStyleElement=lt();tt()(mt.Z,ut);mt.Z&&mt.Z.locals&&mt.Z.locals;var pt=a(875),ft={styleTagTransform:function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}},setAttributes:function(e){var t=a.nc;t&&e.setAttribute("nonce",t)},insert:function(e){var t=rt()("head");if(!t)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");t.appendChild(e)}};ft.domAPI=it(),ft.insertStyleElement=lt();tt()(pt.Z,ft);pt.Z&&pt.Z.locals&&pt.Z.locals;function gt(e){return class extends e{get template(){return Ie.path}get default_img(){return CONST.DEFAULT_TOKEN}get img(){return"systems/heart/assets/battle-gear.svg"}get title(){const e="heart."+super.title,t=game.i18n.localize(e);return t==e?super.title:t}getData(){const e=super.getData();return e.actor&&e.actor.img===this.default_img?e.actor.img=this.img:e.item?e.item.img=this.img:e.img=this.img,e}}}class HeartActorSheet extends(gt(ActorSheet)){static get type(){return"base"}get template(){return we.path}get img(){return this.default_img}getData(){const e=super.getData(),t={};return Object.keys(CONFIG.Item.typeLabels).forEach((e=>{t[e]=[]})),this.actor.items.forEach((e=>{t[e.type].push(e)})),e.heart=t,e.system=this.actor.system,e}activateListeners(e){super.activateListeners(e),e.find("[data-action=add][data-type]").click((e=>{const t=$(e.currentTarget),a=t.data("type"),i=t.data("data")||{},s=new CONFIG.Item.documentClass({type:a,name:`New ${a}`,system:i});this.actor.createEmbeddedDocuments("Item",[s.toObject()])})),e.find("[data-action=view]").click((async e=>{const t=$(e.currentTarget).closest("[data-item-id]").data("itemId");(await fromUuid(t)).sheet.render(!0)})),e.find("[data-action=delete]").click((async e=>{const t=$(e.currentTarget).closest("[data-item-id]").data("itemId"),a=await fromUuid(t);await a.deleteDialog()})),e.find("[data-action=item-roll]").click((async e=>{const t=$(e.currentTarget).closest("[data-item-id]").data("itemId"),a=await fromUuid(t);let i={stepIncrease:!1,stepDecrease:!1};e.shiftKey&&(i.stepIncrease=!0),e.altKey&&(i.stepDecrease=!0),e.altKey&&e.shiftKey&&(i={stepIncrease:!1,stepDecrease:!1});const s=game.heart.rolls.ItemRoll.build({item:a},{},i);s.evaluateSync(),s.toMessage({flavor:`${localizeHeart(a.name)} (<span class="item-type">${a.type}</span>)`,speaker:{actor:this.actor.id}})})),e.find("[data-action=roll]").click((async e=>{(await game.heart.rolls.HeartRoll.build({character:this.actor.id})).toMessage({speaker:{actor:this.actor.id}})})),e.find("[data-action=stress-roll]").click((async e=>{(await game.heart.rolls.StressRoll.build({character:this.actor.id})).toMessage({speaker:{actor:this.actor.id}})})),e.find("[data-item-id] [data-action=activate]").click((async e=>{const t=$(e.currentTarget).closest("[data-item-id]").data("itemId");(await fromUuid(t)).update({"system.active":!0})})),e.find("[data-item-id] [data-action=deactivate]").click((async e=>{const t=$(e.currentTarget).closest("[data-item-id]").data("itemId");(await fromUuid(t)).update({"system.active":!1})})),e.find("[data-item-id] [data-action=complete]").click((async e=>{const t=$(e.currentTarget).closest("[data-item-id]").data("itemId");(await fromUuid(t)).update({"system.complete":!0})})),e.find("[data-item-id] [data-action=uncomplete]").click((async e=>{const t=$(e.currentTarget).closest("[data-item-id]").data("itemId");(await fromUuid(t)).update({"system.complete":!1})}))}async _onDragStart(e){const t=e.currentTarget;if(e.target.classList.contains("content-link"))return;let a={actorId:this.actor.id,sceneId:this.actor.isToken?canvas.scene?.id:null,tokenId:this.actor.isToken?this.actor.token.id:null,pack:this.actor.pack};if(t.dataset.itemId){const e=await fromUuid(t.dataset.itemId);a.type="Item",a.data=e.toObject(),delete a.data._id}if(t.dataset.effectId){const e=this.actor.heart_effects.get(t.dataset.effectId);a.type="ActiveEffect",a.data=e.data}e.dataTransfer.setData("text/plain",JSON.stringify(a))}}const vt=JSON.parse('{"v":{"adversary":{"names":"","descriptors":"","motivation":"","difficulty":"","resistance":"","resistanceMax":"5","protection":"","resources":[],"equipment":[],"special":"","notes":""}}}');class AdversarySheet extends HeartActorSheet{static get defaultOptions(){const e=super.defaultOptions;return foundry.utils.mergeObject(e,{dragDrop:[{dragSelector:".item",dropSelector:null}]})}async _onDropItemCreate(e){return"adversary"===this.actor.type&&(e.system.active=!0),super._onDropItemCreate(e)}static get type(){return Object.keys(vt.v)[0]}get template(){return be.path}get img(){return"systems/heart/assets/high-punch.svg"}getData(){const e=super.getData();return e.user=game.user,e.showTextboxesBelowItems=game.settings.get("heart","showTextboxesBelowItems"),e}activateListeners(e){super.activateListeners(e),e.find(".ordered-checkable-box:not(.checked)").click((e=>{e.preventDefault();const t=e.currentTarget,a=parseInt(t.dataset.index),i={};i[t.parentElement.dataset.target]=a+1,this.actor.update(i)})),e.find(".ordered-checkable-box.checked").click((e=>{e.preventDefault();const t=e.currentTarget,a=parseInt(t.dataset.index),i=t.parentElement.dataset.target,s={};a+1===foundry.utils.getProperty(this.data,i)?s[i]=a:s[i]=a+1,this.actor.update(s)}))}}var yt=a(963),bt={styleTagTransform:function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}},setAttributes:function(e){var t=a.nc;t&&e.setAttribute("nonce",t)},insert:function(e){var t=rt()("head");if(!t)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");t.appendChild(e)}};bt.domAPI=it(),bt.insertStyleElement=lt();tt()(yt.Z,bt);yt.Z&&yt.Z.locals&&yt.Z.locals;const wt=JSON.parse('{"v":{"character":{"templates":["resistance","skills","domains"],"class":"","calling":"","active_beats":[],"equipment":[],"resources":[],"abilities":[],"fallout":[],"notes":""}}}');class CharacterSheet extends HeartActorSheet{static get defaultOptions(){const e=super.defaultOptions;return foundry.utils.mergeObject(e,{dragDrop:[{dragSelector:".item",dropSelector:null}]})}async _onDragStart(e){const t=e.currentTarget.dataset.itemId,a=(await fromUuid(t)).toDragData();e.dataTransfer.setData("text/plain",JSON.stringify(a))}async _onDropItemCreate(e){return"character"===this.actor.type&&("calling"===e.type&&this.actor.itemTypes.calling.forEach((e=>{e.delete()})),"class"===e.type&&this.actor.itemTypes.class.forEach((e=>{e.delete()})),e.system.active=!0),super._onDropItemCreate(e)}static get type(){return Object.keys(wt.v)[0]}get template(){return xe.path}get img(){return"systems/heart/assets/high-punch.svg"}getData(){const e=super.getData(),t=this.actor.proxy.calling,a=this.actor.proxy.class;return e.user=game.user,e.callingItem=t,e.classItem=a,e.showTextboxesBelowItems=game.settings.get("heart","showTextboxesBelowItems"),e.showTotalStress=game.settings.get("heart","showTotalStress"),e.showStressInputBox=game.settings.get("heart","showStressInputBox"),e}activateListeners(e){super.activateListeners(e),e.find(".ordered-checkable-box:not(.checked)").click((e=>{e.preventDefault();const t=e.currentTarget,a=parseInt(t.dataset.index),i={};i[t.parentElement.dataset.target]=a+1,this.actor.update(i)})),e.find(".ordered-checkable-box.checked").click((e=>{e.preventDefault();const t=e.currentTarget,a=parseInt(t.dataset.index),i=t.parentElement.dataset.target,s={};a+1===foundry.utils.getProperty(this.actor,i)?s[i]=a:s[i]=a+1,this.actor.update(s)})),e.find(".resistance-input").change((e=>{e.preventDefault();const t=e.currentTarget,a={};a[t.parentElement.dataset.target]=parseInt(t.value),this.actor.update(a)})),e.find("[data-action=prepare-request-roll]").click((e=>{new game.heart.applications.PrepareRollRequestApplication({}).render(!0)})),e.find("[data-action=fallout-roll]").click((async e=>{(await game.heart.rolls.FalloutRoll.build({character:this.actor.id})).toMessage({speaker:{actor:this.actor.id}})}))}}var xt=a(278),kt={styleTagTransform:function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}},setAttributes:function(e){var t=a.nc;t&&e.setAttribute("nonce",t)},insert:function(e){var t=rt()("head");if(!t)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");t.appendChild(e)}};kt.domAPI=it(),kt.insertStyleElement=lt();tt()(xt.Z,kt);xt.Z&&xt.Z.locals&&xt.Z.locals;const zt=JSON.parse('{"v":{"delve":{"domains":[],"tier":[],"stress":"","resistance":10,"resistanceMax":10,"resources":[],"equipment":[],"events":[],"connection":"","description":"","notes":""}}}');class DelveSheet extends HeartActorSheet{static get type(){return Object.keys(zt.v)[0]}getData(){const e=super.getData();return e.user=game.user,e.showTextboxesBelowItems=game.settings.get("heart","showTextboxesBelowItems"),e}get template(){return ke.path}get img(){return"systems/heart/assets/dungeon-light.svg"}}var Tt=a(520),Ht={styleTagTransform:function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}},setAttributes:function(e){var t=a.nc;t&&e.setAttribute("nonce",t)},insert:function(e){var t=rt()("head");if(!t)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");t.appendChild(e)}};Ht.domAPI=it(),Ht.insertStyleElement=lt();tt()(Tt.Z,Ht);Tt.Z&&Tt.Z.locals&&Tt.Z.locals;const _t=JSON.parse('{"v":{"landmark":{"domains":"","description":"","haunts":[],"potentialPlots":"","resources":[],"specialRules":"","stress":"d4","tier":""}}}');class LandmarkSheet extends HeartActorSheet{static get defaultOptions(){const e=super.defaultOptions;return foundry.utils.mergeObject(e,{dragDrop:[{dragSelector:".item",dropSelector:null}]})}async _onDropItemCreate(e){return"landmark"===this.actor.type&&(e.system.active=!0),super._onDropItemCreate(e)}static get type(){return Object.keys(_t.v)[0]}get template(){return ze.path}get img(){return"systems/heart/assets/monument.svg"}getData(){const e=super.getData();return e.user=game.user,e.showTextboxesBelowItems=game.settings.get("heart","showTextboxesBelowItems"),e.die_sizes=game.heart.die_sizes.reduce(((e,t)=>(e[t]=game.i18n.format("heart.die_size.d(N)",{N:t.replace(/^d/,"")}),e)),{}),e.resistances=game.heart.resistances.reduce(((e,t)=>(e[t]=game.i18n.localize(`heart.resistance.${t}`),e)),{}),e}activateListeners(e){super.activateListeners(e),e.find(".ordered-checkable-box:not(.checked)").click((async e=>{e.preventDefault();const t=e.currentTarget,a=parseInt(t.dataset.index),i=t.parentElement.dataset.target,s=$(e.currentTarget).closest("[data-item-id]").data("itemId"),r=await fromUuid(s),n={};n[i]=a+1,r.update(n)})),e.find(".ordered-checkable-box.checked").click((async e=>{e.preventDefault();const t=e.currentTarget,a=parseInt(t.dataset.index),i=t.parentElement.dataset.target,s=$(e.currentTarget).closest("[data-item-id]").data("itemId"),r=await fromUuid(s),n={};a+1===foundry.utils.getProperty(r.data,i)?n[i]=a:n[i]=a+1,r.update(n)})),e.find("[data-action=add-child][data-type]").click((async e=>{const t=$(e.currentTarget),a=t.data("document-name")||"Item",i=t.data("type"),s=$(e.currentTarget).closest("[data-item-id]").data("itemId"),r=await fromUuid(s);const n={documentName:a,type:i,name:`New ${i}`,system:t.data("data")||{}};r.addChildren([n])})),e.find("[data-action=upgrade]").click((async e=>{const t=$(e.currentTarget).closest("[data-item-id]").data("itemId"),a=await fromUuid(t),i=game.heart.die_sizes,s=a.system.resistances,r={"system.upgradeTrack":0};Object.keys(s).forEach((e=>{var t=s[e],a=i.indexOf(t.die_size);if(a<i.length-1){var n=i[a+1];r[`system.resistances.${e}.die_size`]=n}})),a.update(r)})),e.find("[data-action=downgrade]").click((async e=>{const t=$(e.currentTarget).closest("[data-item-id]").data("itemId"),a=await fromUuid(t),i=game.heart.die_sizes,s=a.system.resistances,r={};Object.keys(s).forEach((e=>{var t=s[e],a=i.indexOf(t.die_size);if(a>0){var n=i[a-1];r[`system.resistances.${e}.die_size`]=n}})),a.update(r)})),e.find("[data-action=add-service]").click((async e=>{const t=$(e.currentTarget),a=foundry.utils.randomID(),i=t.closest("[data-item-id]").data("itemId");(await fromUuid(i)).update({[`system.resistances.${a}`]:{die_size:"d4",resistance:"blood"}})})),e.find("[data-action=delete-service]").click((async e=>{const t=$(e.currentTarget),a=t.closest("[data-item-id]").data("itemId"),i=await fromUuid(a),s=t.closest("[data-id]").data("id");i.update({[`system.resistances.-=${s}`]:null})})),e.find("[name=service-selector-die]").change((async e=>{const t=$(e.currentTarget),a=t.closest("[data-item-id]").data("itemId"),i=await fromUuid(a),s=t.closest("[data-id]").data("id"),r=e.target.value;i.update({[`system.resistances.${s}`]:{die_size:r}})})),e.find("[name=service-selector-resistance]").change((async e=>{const t=$(e.currentTarget),a=t.closest("[data-item-id]").data("itemId"),i=await fromUuid(a),s=t.closest("[data-id]").data("id"),r=e.target.value;i.update({[`system.resistances.${s}`]:{resistance:r}})})),e.find("[data-action=service-roll]").click((async e=>{const t=$(e.currentTarget).closest("[data-item-id]").data("itemId"),a=await fromUuid(t),i=$(e.currentTarget).closest("[data-id]").data("id"),s=a.system.resistances[i],r={system:{die_size:s.die_size}},n=game.heart.rolls.ItemRoll.build({item:r});await n.evaluateSync(),n.toMessage({flavor:`${localizeHeart(a.name)} (<span class="item-type">${a.type}</span>)<div class="resistance-text">${localizeHeart(s.resistance)}</div>`,speaker:{alias:"GM"}})}))}}const St={adversary:function(e){return new Proxy(e,{get(e,t,a){if("totalStress"===t)return e.system.resistance;if("effects"===t)return e.items.reduce(((e,t)=>e.concat(t.transferredEffects)),[]);if("resources"===t){function i(e){const t=e.system.active??!0,a=e.system.complete??!1;return"resource"===e.type&&t&&!a}const s=e.proxy.class,r=[];return void 0!==s&&r.push(...s.children.filter(i)),r.push(...e.items.filter(i)),r}if("equipment"===t){function n(e){const t=e.system.active??!0,a=e.system.complete??!1;return"equipment"===e.type&&t&&!a}const l=[],o=e.proxy.class;return void 0!==o&&l.push(...o.children.filter(n)),l.push(...e.items.filter(n)),l}}})}},Ct={character:function(e){return new Proxy(e,{get(e,t,a){if("totalStress"===t)return Object.values(e.system.resistances).reduce(((e,t)=>e+t.value),0);if("calling"===t){return e.items.find((e=>"calling"===e.type))}if("class"===t){return e.items.find((e=>"class"===e.type))}if("beats"===t){function i(e){return"beat"===e.type&&e.system.active&&!e.system.complete}const s=[],r=e.proxy.calling;return void 0!==r&&s.push(...r.children.filter(i)),s.push(...e.items.filter(i)),s}if("abilities"===t){function n(e){return"ability"===e.type&&e.system.active}const l=[],o=e.proxy.calling;void 0!==o&&l.push(...o.children.filter((e=>"ability"===e.type)));const c=e.proxy.class;return void 0!==c&&l.push(...c.children.filter(n)),l.push(...e.items.filter((e=>"ability"===e.type))),l}if("effects"===t)return e.items.reduce(((e,t)=>e.concat(t.transferredEffects)),[]);if("resources"===t){function d(e){const t=e.system.active??!0,a=e.system.complete??!1;return"resource"===e.type&&t&&!a}const h=e.proxy.class,m=[];return void 0!==h&&m.push(...h.children.filter(d)),m.push(...e.items.filter(d)),m}if("equipment"===t){function u(e){const t=e.system.active??!0,a=e.system.complete??!1;return"equipment"===e.type&&t&&!a}const p=[],f=e.proxy.class;return void 0!==f&&p.push(...f.children.filter(u)),p.push(...e.items.filter(u)),p}}})}},It={delve:function(e){return new Proxy(e,{get(e,t,a){if("effects"===t)return e.items.reduce(((e,t)=>e.concat(t.transferredEffects)),[]);if("resources"===t){function i(e){const t=e.system.active??!0,a=e.system.complete??!1;return"resource"===e.type&&t&&!a}const s=e.proxy.class,r=[];return void 0!==s&&r.push(...s.children.filter(i)),r.push(...e.items.filter(i)),r}if("equipment"===t){function n(e){const t=e.system.active??!0,a=e.system.complete??!1;return"equipment"===e.type&&t&&!a}const l=[],o=e.proxy.class;return void 0!==o&&l.push(...o.children.filter(n)),l.push(...e.items.filter(n)),l}}})}},Ot={landmark:function(e){return new Proxy(e,{get(e,t,a){if("totalStress"===t)return e.system.resistance;if("effects"===t)return e.items.reduce(((e,t)=>e.concat(t.transferredEffects)),[]);if("haunts"===t){function i(e){const t=e.system.active??!0,a=e.system.complete??!1;return"haunt"===e.type&&t&&!a}const s=e.proxy.class,r=[];return void 0!==s&&r.push(...s.children.filter(i)),r.push(...e.items.filter(i)),r}if("resources"===t){function n(e){const t=e.system.active??!0,a=e.system.complete??!1;return"resource"===e.type&&t&&!a}const l=e.proxy.class,o=[];return void 0!==l&&o.push(...l.children.filter(n)),o.push(...e.items.filter(n)),o}}})}};var Dt=[N,B,M,P,Z],At=[L,F,U,G];class HeartActor extends Actor{get proxy(){return void 0===this._proxy&&void 0!==this.constructor.proxies[this.type]&&(this._proxy=this.constructor.proxies[this.type](this)),this._proxy}get heart_effects(){if(void 0!==this.proxy){const e=new Collection(super.effects.entries());return this.proxy.effects.forEach((t=>{e.set(t.id,t)})),e}return super.effects}getEmbeddedDocument(e,t){if(e.startsWith("@")){if(void 0===this.system.children)return;const a=this.system.children[t];if(void 0===a)return;const i=e.slice(1)||a.documentName;return new CONFIG[i].documentClass(a,{parentItem:this})}return super.getEmbeddedDocument(e,t)}}function qt(){console.log("heart | Registering actor sheets"),Actors.unregisterSheet("core",ActorSheet),Dt.forEach((function(e){const t=e.default,a=t.type;void 0===game.heart.actors&&(game.heart.actors={}),void 0===game.heart.actors[a]&&(game.heart.actors[a]={}),CONFIG.Actor.typeLabels[a]=`heart.${a}.label-single`,game.heart.actors[a].sheet=t,"base"!==a&&Actors.registerSheet("heart",t,{types:[a],makeDefault:!0,label:`heart.${a}`})})),CONFIG.Actor.documentClass=HeartActor,At.forEach((function(e){Object.entries(e.default).forEach((([e,t])=>{HeartActor.proxies[e]=t}))}))}HeartActor.proxies={};class HeartApplication extends FormApplication{static get defaultOptions(){return foundry.utils.mergeObject(super.defaultOptions,{classes:["form","heart",this.formType],resizable:!0})}static get formType(){return"base"}static async build(e,t){try{const a=Object.entries(e).reduce(((e,[t,a])=>(e[t]=a.value[0],e)),{});await this._roll(a,t)}catch(a){return new this({},{heart:e,msg:t}).render(!0)}}static async _roll(e){ui.notifications.error(`_roll has not been defined for ${this.formType}`)}get title(){return"base"!==this.constructor.formType?game.i18n.localize(`heart.applications.${this.constructor.formType}.title`):super.title}activateListeners(e){e.find("button").click((e=>{e.preventDefault()})),e.find("[data-action=cancel]").click((e=>{this.close()}))}}class BeatTrackerApplication extends HeartApplication{static get defaultOptions(){return foundry.utils.mergeObject(super.defaultOptions,{template:He.path,classes:["form","heart",this.formType],resizable:!0})}static get defaultOptions(){return foundry.utils.mergeObject(super.defaultOptions,{template:He.path})}static get formType(){return"beat-tracker"}getData(){const e=super.getData(),t=game.actors.filter((e=>"character"===e.type)).reduce(((e,t)=>(e.push({character:t,activeBeats:t.items.filter((e=>"beat"===e.type&&e.system.active))}),e)),[]);return foundry.utils.mergeObject(e,{characters:t})}activateListeners(e){super.activateListeners(e),e.find("[data-action=close]").click((()=>{this.close()}))}}class PrepareRollRequestApplication extends HeartApplication{static get defaultOptions(){return foundry.utils.mergeObject(super.defaultOptions,{template:_e.path})}static get formType(){return"prepare-roll-request"}getData(){const e=super.getData();return foundry.utils.mergeObject(e,{characters:game.actors.filter((e=>"character"===e.type)).reduce(((e,t)=>(e[t.id]=t.name,e)),{}),skills:game.heart.skills.reduce(((e,t)=>(e[t]=game.i18n.localize(`heart.skill.${t}`),e)),{}),domains:game.heart.domains.reduce(((e,t)=>(e[t]=game.i18n.localize(`heart.domain.${t}`),e)),{}),difficulties:game.heart.difficulties.reduce(((e,t)=>(e[t]=game.i18n.localize(`heart.difficulty.${t}`),e)),{})})}activateListeners(e){super.activateListeners(e);const t=e.get(0);e.find("[data-action=submit]").click((async e=>{const a=new FormData(t),i=a.get("difficulty"),s=a.getAll("character"),r=a.getAll("skill"),n=a.getAll("domain"),l=a.getAll("helper");CONFIG.ChatMessage.documentClass.create({flags:{heart:{"roll-request":{difficulty:i,characters:s,skills:r,domains:n,validHelpers:l}}}}),this.close()}))}}class RequirementApplication extends HeartApplication{static get defaultOptions(){return foundry.utils.mergeObject(super.defaultOptions,{template:Ce.path})}static get formType(){return"requirement"}static build({requirements:e,callback:t,type:a}){new this({},{type:a,requirements:e,callback:t}).render(this)}activateListeners(e){super.activateListeners(e);const t=e.get(0);e.find("[data-action=submit]").click((async e=>{const a=new FormData(t),i=Object.entries(this.options.requirements).reduce(((e,[t,i])=>{if(i.isCheckbox){const i=a.get(t);e[t]=null!==i}else i.isMany?e[t]=a.getAll(t):e[t]=a.get(t);return e}),{});this.options.callback(i),this.close()}))}}var Et=a(780),jt={styleTagTransform:function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}},setAttributes:function(e){var t=a.nc;t&&e.setAttribute("nonce",t)},insert:function(e){var t=rt()("head");if(!t)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");t.appendChild(e)}};jt.domAPI=it(),jt.insertStyleElement=lt();tt()(Et.Z,jt);Et.Z&&Et.Z.locals&&Et.Z.locals;var Rt=[V,K,W,Q];function $t(){console.log("heart | Registering applications"),void 0===game.heart.applications&&(game.heart.applications={}),Rt.forEach((function(e){game.heart.applications[e.default.name]=e.default,e.initialise&&e.initialise()}))}var Bt=a(429),Nt={styleTagTransform:function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}},setAttributes:function(e){var t=a.nc;t&&e.setAttribute("nonce",t)},insert:function(e){var t=rt()("head");if(!t)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");t.appendChild(e)}};Nt.domAPI=it(),Nt.insertStyleElement=lt();tt()(Bt.Z,Nt);Bt.Z&&Bt.Z.locals&&Bt.Z.locals;class HeartChatMessage extends ChatMessage{get isRollRequest(){return void 0!==this.getFlag("heart","roll-request")}get stressRoll(){if(this.rolls[0]instanceof game.heart.rolls.StressRoll)return this.rolls[0];const e=this.getFlag("heart","stress-roll");if(void 0===e)return;return CONFIG.Dice.rolls.find((t=>t.name===e.class)).fromData(e)}async setStressRoll(e){const t=e.toJSON();await this.setFlag("heart","stress-roll",t)}get showStressRollButton(){const e=this.getFlag("heart","show-stress-roll-button");return void 0===this.stressRoll&&(void 0===e||Boolean(e))}set showStressRollButton(e){return this.setFlag("heart","show-stress-roll-button",e)}get showTakeStressButton(){const e=this.getFlag("heart","show-take-stress-button");return void 0!==this.stressRoll&&(void 0===e||Boolean(e))}set showTakeStressButton(e){return this.setFlag("heart","show-take-stress-button",e)}get falloutRoll(){if(this.rolls[0]instanceof game.heart.rolls.FalloutRoll)return this.rolls[0];const e=this.getFlag("heart","fallout-roll");if(void 0===e)return;return CONFIG.Dice.rolls.find((t=>t.name===e.class)).fromData(e)}set falloutRoll(e){const t=e.toJSON();this.setFlag("heart","fallout-roll",t)}async setFalloutRoll(e){const t=e.toJSON();await this.setFlag("heart","fallout-roll",t)}get showFalloutRollButton(){const e=this.getFlag("heart","show-fallout-roll-button");return void 0===this.falloutRoll&&(void 0===e||Boolean(e))}set showFalloutRollButton(e){return this.setFlag("heart","show-fallout-roll-button",e)}get showClearStressButton(){const e=this.getFlag("heart","show-clear-stress-button");return void 0!==this.falloutRoll&&(void 0===e?"no-fallout"!=this.falloutRoll.result:Boolean(e))}set showClearStressButton(e){return this.setFlag("heart","show-clear-stress-button",e)}async getHTML(){const e=await super.getHTML();if(this.isRoll&&this.isContentVisible){const t=await this.rolls[0].render({isPrivate:!1,showStressRollButton:this.showStressRollButton,showTakeStressButton:this.showTakeStressButton,showFalloutRollButton:this.showFalloutRollButton,showClearStressButton:this.showClearStressButton});if(e.find(".message-content").find(".dice-roll").html($(t).children()),this.stressRoll&&this.stressRoll!==this.rolls[0]){const t=await this.stressRoll.render({isPrivate:!1,showTakeStressButton:this.showTakeStressButton,showFalloutRollButton:this.showFalloutRollButton,showClearStressButton:this.showClearStressButton});e.append($('<div class="message-content"></div>').append(t))}if(this.falloutRoll&&this.falloutRoll!==this.rolls[0]){const t=await this.falloutRoll.render({isPrivate:!1,showClearStressButton:this.showClearStressButton});e.append($('<div class="message-content"></div>').append(t))}}if(this.isRollRequest){const t=this.getFlag("heart","roll-request"),a=await renderTemplate("heart:applications/prepare-roll-request/chat-message.html",t);e.append(a)}return e}}const Mt=new DragDrop({dragSelector:".item",dropSelector:null,permissions:{dragstart:!0,drop:!1},callbacks:{dragstart:async function(e){const t=e.currentTarget.dataset.itemId,a=(await fromUuid(t)).toDragData();e.dataTransfer.setData("text/plain",JSON.stringify(a))}}});function Pt(e){e.on("click","form button",(e=>{e.preventDefault()})),e.on("click","form.roll-request [data-action=roll][data-character]",(async e=>{const t=$(e.currentTarget),{character:a}=t.data(),i=t.closest("form.roll-request"),s=new FormData(i.get(0));(await game.heart.rolls.HeartRoll.build({character:a,difficulty:s.get("difficulty"),skill:s.get("skill"),domain:s.get("domain"),mastery:"on"===s.get("mastery"),helpers:s.getAll("helper")})).toMessage({speaker:{actor:a}})})),e.find("[data-item-id] [data-action=view]").click((async e=>{const t=$(e.currentTarget).closest("[data-item-id]").data("itemId");(await fromUuid(t)).sheet.render(!0)})),Mt.bind(e.get(0))}class HeartTextEditor extends TextEditor{static async _createContentLink(e,{relativeTo:t}={}){const[a,i,s,r]=e.slice(1,5),n=await fromUuid(i);if(n&&"Item"===n.documentName){const e=await n.sheet.getData(),t=Handlebars.partials[`heart:items/${n.type}/preview.html`](e,{allowedProtoProperties:{uuid:!0,childrenTypes:!0,isOwner:!0}}),a=document.createElement("div");return a.innerHTML=t,a.classList.add("heart","sheet"),a}return super._createContentLink(e,{relativeTo:t})}}function Zt(){console.log("heart | Registering ChatMessage"),CONFIG.ChatMessage.documentClass=HeartChatMessage,TextEditor=HeartTextEditor,Hooks.once("renderChatLog",((e,t,a)=>Pt(t))),Hooks.once("renderChatPopout",((e,t,a)=>Pt(t)))}var Lt=a(180),Ft={styleTagTransform:function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}},setAttributes:function(e){var t=a.nc;t&&e.setAttribute("nonce",t)},insert:function(e){var t=rt()("head");if(!t)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");t.appendChild(e)}};Ft.domAPI=it(),Ft.insertStyleElement=lt();tt()(Lt.Z,Ft);Lt.Z&&Lt.Z.locals&&Lt.Z.locals;class HeartItemSheet extends(gt(ItemSheet)){static get type(){return"base"}static get defaultOptions(){const e=super.defaultOptions;return foundry.utils.mergeObject(e,{dragDrop:e.dragDrop.concat([{dragSelector:".item",dropSelector:null}])})}get template(){return qe.path}get default_img(){return"icons/svg/item-bag.svg"}get img(){return this.default_img}get children(){return this.item.children}get childrenTypes(){return this.item.children?.reduce(((e,t)=>(void 0===e[t.type]?e[t.type]=[t]:e[t.type].push(t),e)),{})}activateListeners(e){super.activateListeners(e),e.find("[data-action=add-child][data-type]").click((e=>{const t=$(e.currentTarget),a=t.data("document-name")||"Item",i=t.data("type");const s={documentName:a,type:i,name:`New ${i}`,system:t.data("data")||{}};this.item.addChildren([s])})),e.find("[data-item-id] [data-action=view]").click((async e=>{const t=$(e.currentTarget).closest("[data-item-id]").data("itemId");(await fromUuid(t)).sheet.render(!0)})),e.find("[data-item-id] [data-action=delete]").click((async e=>{const t=$(e.currentTarget).closest("[data-item-id]").data("itemId"),a=await fromUuid(t);null!==a&&await a.deleteDialog()})),e.find("[data-item-id] [data-action=activate]").click((async e=>{const t=$(e.currentTarget).closest("[data-item-id]").data("itemId"),a=await fromUuid(t);await a.update({"system.active":!0}),this.render(!0)})),e.find("[data-item-id] [data-action=deactivate]").click((async e=>{const t=$(e.currentTarget).closest("[data-item-id]").data("itemId"),a=await fromUuid(t);await a.update({"system.active":!1}),this.render(!0)})),e.find("[data-item-id] [data-action=complete]").click((async e=>{const t=$(e.currentTarget).closest("[data-item-id]").data("itemId"),a=await fromUuid(t);await a.update({"system.complete":!0}),this.render(!0)})),e.find("[data-item-id] [data-action=uncomplete]").click((async e=>{const t=$(e.currentTarget).closest("[data-item-id]").data("itemId"),a=await fromUuid(t);await a.update({"system.complete":!1}),this.render(!0)}))}getData(){const e=super.getData();return e.user=game.user,e.die_sizes=game.heart.die_sizes.reduce(((e,t)=>(e[t]=game.i18n.format("heart.die_size.d(N)",{N:t.replace(/^d/,"")}),e)),{}),e.skills=game.heart.skills.reduce(((e,t)=>(e[t]=game.i18n.localize(`heart.skill.${t}`),e)),{}),e.domains=game.heart.domains.reduce(((e,t)=>(e[t]=game.i18n.localize(`heart.domain.${t}`),e)),{}),e.equipment_types=game.heart.equipment_types.reduce(((e,t)=>(e[t]=game.i18n.localize(`heart.equipment.type.${t}`),e)),{}),e.resistances=game.heart.resistances.reduce(((e,t)=>(e[t]=game.i18n.localize(`heart.resistance.${t}`),e)),{}),e.beat_levels=game.heart.beat_levels.reduce(((e,t)=>(e[t]=game.i18n.localize(`heart.beat.level.${t}`),e)),{}),e.fallout_levels=game.heart.fallout_levels.reduce(((e,t)=>(e[t]=game.i18n.localize(`heart.fallout.level.${t}`),e)),{}),e.children=this.children,e.childrenTypes=this.childrenTypes,e.system=this.item.system,e}async _onDrop(e){let t;try{t=JSON.parse(e.dataTransfer.getData("text/plain"))}catch(e){return!1}if(!1!==Hooks.call("dropItemSheetData",this.item,this,t))return"Item"===t.type?(t.documentName="Item",this._onDropItem(e,t)):void 0}async _onDropItem(e,t){if(!this.item.isOwner)return!1;const a=await Item.implementation.fromDropData(t);if(!this._canDragDropItem(a))return;const i=a.toObject();i.documentName="Item";const s=this.item;return t.parentItemId===s.id?void 0:s.addChildren([i])}async _canDragDropItem(e){return!1}async _onDragStart(e){const t=e.currentTarget;if(e.target.classList.contains("entity-link"))return;let a={parentItemId:this.item.id,uuid:e.target.dataset.documentId,type:"Item"};if(a.uuid.startsWith("Compendium")){const e=await fromUuid(t.dataset.itemId);a.data=e.toObject(),delete a.data._id,delete a.uuid}e.dataTransfer.setData("text/plain",JSON.stringify(a))}}const Ut=JSON.parse('{"c":{"ability":{"templates":["has_description","is_activatable","has_children"],"mechanics":"","type":"core"}}}'),Gt=Object.freeze({type:Object.keys(Ut.c)[0],img:"systems/heart/assets/skills.svg",template:De.path}),Jt=JSON.parse('{"c":{"beat":{"templates":["has_description","is_activatable","is_completable"],"type":"minor"}}}'),Vt=Object.freeze({type:Object.keys(Jt.c)[0],img:"systems/heart/assets/drum.svg",template:je.path}),Kt=JSON.parse('{"c":{"calling":{"templates":["has_description","has_children"],"questions":{},"mark":null}}}');var Wt=a(621),Qt={styleTagTransform:function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}},setAttributes:function(e){var t=a.nc;t&&e.setAttribute("nonce",t)},insert:function(e){var t=rt()("head");if(!t)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");t.appendChild(e)}};Qt.domAPI=it(),Qt.insertStyleElement=lt();tt()(Wt.Z,Qt);Wt.Z&&Wt.Z.locals&&Wt.Z.locals;const Yt=Object.freeze({type:Object.keys(Kt.c)[0],img:"systems/heart/assets/drum.svg",template:Re.path}),Xt=class extends HeartItemSheet{static get type(){return Yt.type}get template(){return Yt.template}get img(){return Yt.img}getData(){const e=super.getData();return e.minorBeats=this.item.children.filter((e=>"beat"===e.type&&"minor"===e.system.type)),e.majorBeats=this.item.children.filter((e=>"beat"===e.type&&"major"===e.system.type)),e.zenithBeats=this.item.children.filter((e=>"beat"===e.type&&"zenith"===e.system.type)),e}activateListeners(e){super.activateListeners(e),e.find("[data-action=add-question]").click((e=>{const t=foundry.utils.randomID();this.item.update({[`system.questions.${t}`]:{question:"",answer:""}})})),e.find("[data-action=delete-question]").click((e=>{const t=$(e.currentTarget).closest("[data-id]").data("id");this.item.update({[`system.questions.-=${t}`]:null})}))}async _canDragDropItem(e){return"ability"===e.type&&void 0===e.type&&await e.update({"system.type":"core"}),"beat"===e.type&&void 0===e.type&&await e.update({"system.type":"minor"}),["ability","beat"].includes(e.type)}async _onDropItem(e,t){return super._onDropItem(e,t)}},ea=JSON.parse('{"c":{"class":{"templates":["has_description","has_children"],"type":"core","core_skill":"hunt","core_domain":"cursed","equipment_groups":["core"],"active_equipment_group":"","active_equipment_groups":["core"]}}}');var ta=a(817),aa={styleTagTransform:function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}},setAttributes:function(e){var t=a.nc;t&&e.setAttribute("nonce",t)},insert:function(e){var t=rt()("head");if(!t)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");t.appendChild(e)}};aa.domAPI=it(),aa.insertStyleElement=lt();tt()(ta.Z,aa);ta.Z&&ta.Z.locals&&ta.Z.locals;const ia=Object.freeze({type:Object.keys(ea.c)[0],img:"systems/heart/assets/drum.svg",template:$e.path}),sa=class extends HeartItemSheet{static get type(){return ia.type}get template(){return ia.template}get img(){return ia.img}getData(){const e=super.getData();return e.coreAbilities=this.item.children.filter((e=>"ability"===e.type&&"core"===e.system.type)),e.minorAbilities=this.item.children.filter((e=>"ability"===e.type&&"minor"===e.system.type)),e.majorAbilities=this.item.children.filter((e=>"ability"===e.type&&"major"===e.system.type)),e.zenithAbilities=this.item.children.filter((e=>"ability"===e.type&&"zenith"===e.system.type)),e}activateListeners(e){super.activateListeners(e),e.find("[data-action=add-equipment-group]").click((e=>{const t=foundry.utils.randomID(),a=this.item.system.equipment_groups||[];return a.push(t),this.item.update({"system.equipment_groups":a})})),e.find("[data-group-id] [data-action=delete-equipment-group]").click((async e=>{const t=$(e.currentTarget).closest("[data-group-id]").data("groupId"),a=this.item.system.equipment_groups.filter((e=>e!==t)),i=this.item.children.filter((e=>"equipment"===e.type&&e.system.group===t)).map((e=>e.id));Dialog.confirm({title:"Confirm Deletion",content:"Are you sure you want to delete this equipment group? It cannot be recovered.",yes:()=>(this.item.deleteChildren(i),this.render(),this.item.update({"system.equipment_groups":a}))})})),e.find("[data-group-id] [data-action=activate-group]").click((async e=>{const t=$(e.currentTarget).closest("[data-group-id]").data("groupId"),a=(this.item.system.active_equipment_group,{}),i=[...this.item.system.active_equipment_groups];let s=this.item.system.active_equipment_groups;"core"===t&&void 0===s.find((e=>"core"===e))&&s.push("core"),"core"!==t&&void 0===s.find((e=>e===t))&&(s=s.filter((e=>"core"===e)),s.push(t)),await this.item.update({"system.active_equipment_groups":s}),this.item.children.filter((e=>"equipment"===e.type)).forEach((async e=>{i.includes(e.system.group)&&!s.includes(e.system.group)&&(a[`${e.id}.system.active`]=!1),s.includes(e.system.group)&&(a[`${e.id}.system.active`]=!0)})),await this.item.updateChildren(a)})),e.find("[data-group-id] [data-action=deactivate-group]").click((async e=>{const t=$(e.currentTarget).closest("[data-group-id]").data("groupId"),a={};this.item.children.filter((e=>"equipment"===e.type)).forEach((async e=>{e.system.group===t&&(a[`${e.id}.system.active`]=!1)})),await this.item.updateChildren(a);const i=this.item.system.active_equipment_groups.filter((e=>e!==t));await this.item.update({"system.active_equipment_groups":i})}))}async _canDragDropItem(e){return"ability"===e.type&&void 0===e.type&&await e.update({"system.type":"core"}),["ability","resource","equipment"].includes(e.type)}},ra=JSON.parse('{"c":{"equipment":{"templates":["is_rollable","has_description","is_activatable","has_children","has_resistances"],"type":"miscellaneous","group":"core"}}}');var na=a(887),la={styleTagTransform:function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}},setAttributes:function(e){var t=a.nc;t&&e.setAttribute("nonce",t)},insert:function(e){var t=rt()("head");if(!t)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");t.appendChild(e)}};la.domAPI=it(),la.insertStyleElement=lt();tt()(na.Z,la);na.Z&&na.Z.locals&&na.Z.locals;const oa=["miscellaneous","delve","kill","mend"],ca=["minor","major","zenith"];function da(){game.heart.equipment_types=oa,game.heart.beat_levels=ca}const ha=Object.freeze({type:Object.keys(ra.c)[0],img:"systems/heart/assets/battle-gear.svg",template:Ne.path}),ma=class extends HeartItemSheet{static get type(){return ha.type}get template(){return ha.template||Ne.path}get img(){return ha.img}get id(){return`${this.constructor.name}-${this.document.uuid.replace(/[\.@]/g,"-")}`}get resistanceTypes(){return this.system.resistances}getData(){return super.getData()}activateListeners(e){super.activateListeners(e),e.find(".ordered-checkable-box:not(.checked)").click((e=>{e.preventDefault();const t=e.currentTarget.parentElement,a=t.dataset.target,i=t.dataset.value;let s=foundry.utils.getProperty(this.item,a);s.push(i);let r={};r[a]=s,this.item.update(r)})),e.find(".ordered-checkable-box.checked").click((e=>{e.preventDefault();const t=e.currentTarget.parentElement,a=t.dataset.target,i=t.dataset.value;let s=foundry.utils.getProperty(this.item,a).filter((e=>e!==i)),r={};r[a]=s,this.item.update(r)}))}},ua=JSON.parse('{"c":{"fallout":{"templates":["has_description","is_activatable","is_completable"],"type":"minor","resistance":"blood"}}}'),pa=["minor","major","critical"];function fa(){game.heart.fallout_levels=pa}const ga=Object.freeze({type:Object.keys(ua.c)[0],img:"systems/heart/assets/fallout-shelter.svg",template:Pe.path}),va=JSON.parse('{"c":{"haunt":{"templates":["has_description","is_activatable"],"resistances":[],"upgradeTrack":""}}}');var ya=a(212),ba={styleTagTransform:function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}},setAttributes:function(e){var t=a.nc;t&&e.setAttribute("nonce",t)},insert:function(e){var t=rt()("head");if(!t)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");t.appendChild(e)}};ba.domAPI=it(),ba.insertStyleElement=lt();tt()(ya.Z,ba);ya.Z&&ya.Z.locals&&ya.Z.locals;const wa=Object.freeze({type:Object.keys(va.c)[0],img:"systems/heart/assets/prayer.svg",template:Le.path}),xa=class extends HeartItemSheet{static get type(){return wa.type}get template(){return wa.template}get img(){return wa.img}getData(){return super.getData()}activateListeners(e){super.activateListeners(e),e.find(".ordered-checkable-box:not(.checked)").click((e=>{e.preventDefault();const t=e.currentTarget,a=parseInt(t.dataset.index),i={};i[t.parentElement.dataset.target]=a+1,this.item.update(i)})),e.find(".ordered-checkable-box.checked").click((e=>{e.preventDefault();const t=e.currentTarget,a=parseInt(t.dataset.index),i=t.parentElement.dataset.target,s={};a+1===foundry.utils.getProperty(this.item.data,i)?s[i]=a:s[i]=a+1,this.item.update(s)})),e.find("[data-action=service-roll]").click((async e=>{const t=$(e.currentTarget).closest("[data-id]").data("id"),a=this.item.system.resistances[t],i={system:{die_size:a.die_size}},s=game.heart.rolls.ItemRoll.build({item:i});await s.evaluateSync(),s.toMessage({flavor:`${localizeHeart(this.item.name)} (<span class="item-type">${localizeHeart(this.item.type)}</span>)<div class="resistance-text">${localizeHeart(a.resistance)}</div>`,speaker:{alias:"GM"}})})),e.find("[data-action=upgrade]").click((async e=>{const t=game.heart.die_sizes,a=this.item.system.resistances,i={"system.upgradeTrack":0};Object.keys(a).forEach((e=>{var s=a[e],r=t.indexOf(s.die_size);if(r<t.length-1){var n=t[r+1];i[`system.resistances.${e}.die_size`]=n}})),this.item.update(i)})),e.find("[data-action=downgrade]").click((async e=>{const t=game.heart.die_sizes,a=this.item.system.resistances,i={};Object.keys(a).forEach((e=>{var s=a[e],r=t.indexOf(s.die_size);if(r>0){var n=t[r-1];i[`system.resistances.${e}.die_size`]=n}})),this.item.update(i)})),e.find("[data-action=add-service]").click((e=>{const t=foundry.utils.randomID();this.item.update({[`system.resistances.${t}`]:{die_size:"d4",resistance:"blood"}})})),e.find("[data-action=delete-service]").click((e=>{const t=$(e.currentTarget).closest("[data-id]").data("id");this.item.update({[`system.resistances.-=${t}`]:null})}))}async _canDragDropItem(e){return"service"===e.type&&void 0===e.type&&await e.update({"system.type":"core"}),["service"].includes(e.type)}async _onDropItem(e,t){return super._onDropItem(e,t)}},ka=JSON.parse('{"c":{"resource":{"templates":["is_rollable","has_description","has_children","is_activatable","is_completable"],"domain":"cursed"}}}'),za=Object.freeze({type:Object.keys(ka.c)[0],img:"systems/heart/assets/ore.svg",template:Ue.path}),Ta=JSON.parse('{"c":{"tag":{"templates":["has_description"],"limited_uses":-1}}}'),Ha=Object.freeze({type:Object.keys(Ta.c)[0],img:"systems/heart/assets/ore.svg",template:Je.path}),_a={ability:function(e){return new Proxy(e,{get(e,t,a){if("abilities"===t)return e.children.filter((e=>"ability"===e.type))}})}},Sa={class:function(e){return new Proxy(e,{get(e,t,a){if("effects"===t){const t=e.system.core_skill,a=new ActiveEffect({_id:foundry.utils.randomID(),label:"Core Skill from Class",changes:[{key:`system.skills.${t}.value`,value:!0,mode:CONST.ACTIVE_EFFECT_MODES.OVERRIDE,priority:0,transfer:!0}]},this),i=e.system.core_domain;return[a,new ActiveEffect({_id:foundry.utils.randomID(),label:"Core Domain from Class",changes:[{key:`system.domains.${i}.value`,value:!0,mode:CONST.ACTIVE_EFFECT_MODES.OVERRIDE,priority:0,transfer:!0}]},this)]}}})}};var Ca=[te,ee,ae,ie,se,re,ne,le,oe,ce],Ia=[de,he];class HeartItem extends Item{constructor(e={},t={}){super(e,t),Object.defineProperty(this,"parentItem",{value:t.parentItem||null,writable:!1}),this.children}get proxy(){return void 0===this._proxy&&void 0!==this.constructor.proxies[this.type]&&(this._proxy=this.constructor.proxies[this.type](this)),this._proxy}get isChild(){return null!==this.parentItem}get heart_effects(){if(void 0!==this.proxy&&void 0!==this.proxy.effects){const e=new Collection(super.effects.entries());return this.proxy.effects.forEach((t=>{e.set(t.id,t)})),e}return super.effects}get uuid(){return this.isChild?this.parentItem.uuid+".@"+super.uuid:super.uuid}get children(){if(void 0!==this._children)return this._children;if(void 0===this.system.children)return void 0!==game.model.Item[this.type].children?new Collection:void 0;const e=new Collection;return Object.entries(this.system.children).forEach((([t,a])=>{let i=a.documentName;i||(i="Item");const s=new CONFIG[i].documentClass(a,{parentItem:this});e.set(t,s)})),this._children=e,e}get childrenTypes(){return this.children.reduce(((e,t)=>(void 0===e[t.type]&&(e[t.type]=[]),e[t.type].push(t),e)),{})}get isOwner(){return this.isChild?this.parentItem.testUserPermission(game.user,"OWNER"):this.testUserPermission(game.user,"OWNER")}_onUpdate(e,t,a){super._onUpdate(e,t,a),e.system&&e.system.children&&this.refreshChildren()}async update(e={},t={}){if(!this.isChild)return await super.update(e,t);await this.parentItem.updateChildren({[`${this.id}`]:e},t)}updateSource(e={},t={}){return this.isChild?(this.parentItem.updateChildren({[`${this.id}`]:e},t),{}):super.updateSource(e,t)}_addChild(e){let t;t=Item.TYPES.includes(e.type)?CONFIG.Item.documentClass:CONFIG.Actor.documentClass;const a=new t(e,{parentItem:this}),i=a.id;return this.children.set(i,a),a}async addChildren(e=[]){const t={};return e.forEach((e=>{const a=foundry.utils.randomID();e._id=a;const i=this._addChild(e),s=i.toObject();s.documentName=e.documentName,t[i.id]=s})),this.update(flattenObject({"system.children":t}),{render:!0})}async refreshChildren(){void 0!==this.system.children&&(Object.entries(this.system.children).forEach((([e,t])=>{if(this.children.has(e)){const t=this.children.get(e);t.updateSource(this.system.children[t.id]),t.prepareData(),t.children&&t.children.size&&t.children.size>=0&&t.refreshChildren(),t.sheet.rendered&&t.sheet.render()}else this._addChild(t)})),this.children.forEach((e=>{void 0===this.system.children[e.id]&&this._deleteChild(e.id)})),this.sheet.rendered&&this.sheet.render())}async updateChildren(e={},t={}){const a={...t},i=await this.update({"system.children":e},a);if(void 0!==i)return this.isEmbedded&&this.parent.sheet.rendered&&await this.parent.sheet.render(!0),i}async delete(){if(!this.isChild)return super.delete();this.sheet.rendered&&await this.sheet.close(),await this.parentItem.deleteChildren([this.id])}_deleteChild(e){this.children.get(e).sheet.close(),this.children.delete(e)}async deleteChildren(e){if(void 0===this.system.children)return;const t={};return e.forEach((e=>{this._deleteChild(e),t[`system.children.-=${e}`]=null})),this.update(t)}getEmbeddedDocument(e,t){if(e.startsWith("@")){if(void 0===this.system.children)return;return this.children.get(t)}return super.getEmbeddedDocument(e,t)}get permission(){return this.isChild?this.parentItem.permission:super.permission}testUserPermission(e,t,{exact:a=!1}={}){return this.isChild?this.parentItem.testUserPermission(e,t,{exact:a}):super.testUserPermission(e,t,{exact:a})}}function Oa(){console.log("heart | Assigning new Item documentClass"),CONFIG.Item.documentClass=HeartItem,console.log("heart | Registering item sheets"),Items.unregisterSheet("core",ItemSheet),Ca.forEach((e=>{const t=e.data;let a;a=void 0!==e.default?e.default:t.sheet instanceof ItemSheet?t.sheet:function(e){const t=Object.freeze({...e});return class extends HeartItemSheet{static get type(){return e.type}get template(){return t.template}get img(){return t.img}get id(){return`${this.constructor.name}-${this.document.uuid.replace(/[\.@]/g,"-")}`}}}(t);const i=a.type;console.log(`heart | -- Registering ${i} sheet`),void 0===game.heart.items&&(game.heart.items={}),void 0===game.heart.items[i]&&(game.heart.items[i]={}),game.heart.items[i].sheet=a,e.initialise&&e.initialise(),"base"!==i&&(CONFIG.Item.typeLabels[i]=`heart.${i}.label-single`,Items.registerSheet("heart",a,{types:[i],makeDefault:!0,label:`heart.${i}.label-single`}))})),Ia.forEach((function(e){Object.entries(e.default).forEach((([e,t])=>{HeartItem.proxies[e]=t}))}))}HeartItem.proxies={};var Da=a(979),Aa={styleTagTransform:function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}},setAttributes:function(e){var t=a.nc;t&&e.setAttribute("nonce",t)},insert:function(e){var t=rt()("head");if(!t)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");t.appendChild(e)}};Aa.domAPI=it(),Aa.insertStyleElement=lt();tt()(Da.Z,Aa);Da.Z&&Da.Z.locals&&Da.Z.locals;const qa={"no-fallout":(e,t)=>e>t,"minor-fallout":(e,t)=>e<=t&&e<=6,"major-fallout":(e,t)=>e<=t&&e>6};function Ea(){game.heart.fallout_results=Object.keys(qa)}class FalloutRoll extends Roll{static get CHAT_TEMPLATE(){return Ve.path}static get requirements(){const e=game.actors.filter((e=>"character"===e.type));return{character:{label:game.i18n.localize("heart.character.label-single"),options:e.reduce(((e,t)=>(e[t.id]=t.name,e)),{})}}}static build({character:e}={},t={},a={}){return new Promise(((i,s)=>{const r=this.requirements;void 0!==e&&delete r.character;const n={character:e};if(!(Object.keys(r).length>0))return i(this._build(n,t,a));game.heart.applications.RequirementApplication.build({requirements:r,callback:e=>{foundry.utils.mergeObject(n,e),i(this._build(n,t,a))},type:"prepare-fallout-roll"})}))}static _build({character:e},t={},a={}){const i=game.actors.get(e).proxy;return a.totalStress=i.totalStress,new this("1d12",t,a)}get result(){return Object.keys(qa).find((e=>qa[e](this.total,this.options.totalStress)))}async render(e={}){const t=(e=foundry.utils.mergeObject({user:game.user.id,flavor:null,template:this.constructor.CHAT_TEMPLATE,blind:!1},e)).isPrivate,a=void 0!==e.showClearStressButton&&e.showClearStressButton;this._evaluated||await this.evaluateSync();const i=game.i18n.format("heart.rolls.fallout-roll.description(totalStress)",{totalStress:this.options.totalStress}),s={description:t?"???":i,formula:t?"???":this._formula,flavor:t?null:e.flavor,user:e.user,tooltip:t?"":await this.getTooltip(),total:t?"?":this.total,result:t?"?":this.result,showClearStressButton:!t&&a};return await renderTemplate(e.template,s)}async clearStress(e){return new Promise(((a,i)=>{let s=e.rolls[0].options.character||e.speaker.actor,r=e.rolls[0].options.resistance||"",n=game.actors.get(s),l=n.system.resistances;"major-fallout"==this.result&&Dialog.confirm({title:"Confirm Stress Reset",content:`Are you sure you want to reset ${n.name}'s stress? This cannot be reversed.`,yes:()=>{Object.keys(l).forEach((e=>{Object.assign(l[e],{value:0})}));let t={};t["system.resistances"]=l,n.update(t),e.showClearStressButton=!1}}),"minor-fallout"==this.result&&r&&t(r,n,l),"minor-fallout"==this.result&&""==r&&game.heart.applications.RequirementApplication.build({requirements:{resistance:{options:game.heart.resistances.reduce(((e,t)=>(e[t]=game.i18n.localize(`heart.resistance.${t}`),e)),{})}},callback:({resistance:e})=>{t(e,n,l)},type:"clear-stress"})}));function t(t,a,i){Dialog.confirm({title:`Confirm Set ${t} to 0`,content:`Are you sure you want to reset ${a.name}'s ${t} stress to 0? This cannot be reversed.`,yes:()=>{i[t].value=0;let s={};s["system.resistances"]=i,a.update(s),e.showClearStressButton=!1}})}}static activateListeners(e){e.on("click",".fallout-roll [data-action=clear-stress]",(async function(e){e.preventDefault();const t=$(e.currentTarget).closest(".chat-message").data("messageId"),a=game.messages.get(t),i=a.falloutRoll;await i.clearStress(a),await ui.chat.updateMessage(a,!0),ui.chat.scrollBottom()}))}}var ja=a(107),Ra={styleTagTransform:function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}},setAttributes:function(e){var t=a.nc;t&&e.setAttribute("nonce",t)},insert:function(e){var t=rt()("head");if(!t)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");t.appendChild(e)}};Ra.domAPI=it(),Ra.insertStyleElement=lt();tt()(ja.Z,Ra);ja.Z&&ja.Z.locals&&ja.Z.locals;const $a={standard:0,risky:1,dangerous:2,impossible:1/0},Ba={critical_failure:[1,1],failure:[2,5],success_at_a_cost:[6,7],success:[8,9],critical_success:[10,10]},Na={critical_failure:[1,1],failure:[2,9],success_at_a_cost:[10,10]},Ma=["n_a","success_at_a_cost","failure","critical_failure"];function Pa(){const e={...Ba,...Na};game.heart.difficulties=Object.keys($a),game.heart.results=Object.keys(e),game.heart.stress_results=Ma}class HeartRoll extends Roll{static get CHAT_TEMPLATE(){return Ke.path}static get TOOLTIP_TEMPLATE(){return We.path}static get requirements(){const e=game.actors.filter((e=>"character"===e.type)),t=game.heart.skills,a=game.heart.domains,i=game.heart.difficulties;return{character:{label:game.i18n.localize("heart.character.label-single"),options:e.reduce(((e,t)=>(e[t.id]=t.name,e)),{})},difficulty:{label:game.i18n.localize("heart.difficulty.label-single"),options:i.reduce(((e,t)=>(e[t]=game.i18n.localize(`heart.difficulty.${t}`),e)),{})},skill:{label:game.i18n.localize("heart.skill.label-single"),options:t.reduce(((e,t)=>(e[t]=game.i18n.localize(`heart.skill.${t}`),e)),{})},domain:{label:game.i18n.localize("heart.domain.label-single"),options:a.reduce(((e,t)=>(e[t]=game.i18n.localize(`heart.domain.${t}`),e)),{})},mastery:{label:game.i18n.localize("heart.mastery.label-single"),isCheckbox:!0},helpers:{label:game.i18n.localize("heart.helper.label-single"),isMany:!0,options:e.reduce(((e,t)=>(e[t.id]=t.name,e)),{})}}}static build(e={},t={},a={}){return new Promise(((i,s)=>{let{character:r,skill:n,domain:l,mastery:o,helpers:c,difficulty:d}=e;const h=this.requirements;void 0!==r&&delete h.character,void 0!==d&&delete h.difficulty,void 0!==n&&delete h.skill,void 0!==l&&delete h.domain,void 0!==o&&delete h.mastery,void 0!==c&&delete h.helpers;const m={character:r,difficulty:d,skill:n,domain:l,mastery:o,helpers:c};if(!(Object.keys(h).length>0))return i(this._build(m,t,a));game.heart.applications.RequirementApplication.build({requirements:h,callback:e=>{foundry.utils.mergeObject(m,e),i(this._build(m,t,a))},type:"prepare-roll"})}))}static _build({character:e,difficulty:t,skill:a,domain:i,mastery:s,helpers:r}={},n={},l={}){const o=game.actors.get(e);null!==a&&(a=o.system.skills[a].value?a:void 0),null!==i&&(i=o.system.domains[i].value?i:void 0),r=r.filter((t=>t!==e));let c=[];[game.i18n.localize("heart.rolls.roll.base"),a?game.i18n.localize(`heart.skill.${a}`):void 0,i?game.i18n.localize(`heart.domain.${i}`):void 0,!!s&&game.i18n.localize("heart.mastery.short"),...r.map((e=>game.actors.get(e).name))].forEach((e=>{e&&c.push(`1d10[${e}]`)})),"impossible"===t&&(c=[]);const d=$a[t],h=d>0?`dh${d}`:"",m=`{${c.join(", ")}}${h}kh`;return l.character=e,l.result_set=c.length>d?"normal":"difficult",l.skill=a,l.domain=i,l.mastery=s,l.difficulty=t,l.helpers=r,new this(m,n,l)}get result(){if("impossible"===this.options.difficulty)return"failure";let e=Ba;return"difficult"===this.options.result_set&&(e=Na),Object.keys(e).find((t=>{const[a,i]=e[t];return a<=this.total&&this.total<=i}))}async render(e={}){const t=(e=foundry.utils.mergeObject({user:game.user.id,flavor:null,template:this.constructor.CHAT_TEMPLATE,blind:!1},e)).isPrivate,a=void 0!==e.showStressRollButton&&e.showStressRollButton;this._evaluated||await this.evaluateSync();const i=game.i18n.format("heart.rolls.roll.description(difficulty,count)",{difficulty:game.i18n.localize(`heart.difficulty.${this.options.difficulty}`),count:this.dice.length}),s={character:e.character||this.options.character,description:t?"???":i,formula:t?"???":this._formula,flavor:t?null:e.flavor,user:e.user,tooltip:t?"":await this.getTooltip(),showStressRollButton:!t&&(a&&Ma.includes(this.result)),total:t?"?":this.total,result:t?"?":this.result};return renderTemplate(e.template,s)}async getTooltip(){const e=this.dice.map((e=>e.getTooltipData())),t=this.dice.findIndex((e=>e.total==this.total));return renderTemplate(this.constructor.TOOLTIP_TEMPLATE,{kept:t,parts:e})}static activateListeners(e){e.on("click",".heart-roll [data-action=roll-stress]",(async function(e){const t=$(e.currentTarget).closest(".chat-message").data("messageId"),a=game.messages.get(t),i=a.roll;i._evaluated||await this.evaluateSync();const s=await game.heart.rolls.StressRoll.build({character:i.options.character,result:i.result},a);await s.evaluateSync(),game.dice3d&&game.settings.get("heart","showStressRoll3dDice")&&await game.dice3d.showForRoll(s,game.user,!0),await a.setStressRoll(s),a.showStressRollButton=!1,await ui.chat.updateMessage(a,!0),ui.chat.scrollBottom()}))}}class ItemRoll extends Roll{static build({item:e}={},t={},a={}){a.item=e;let i=a.stepIncrease?function(e){const t=game.heart.die_sizes;var a=t.indexOf(e);if(a<t.length-1){return t[a+1]}return e}(e.system.die_size):e.system.die_size;return i=a.stepDecrease?function(e){const t=game.heart.die_sizes;var a=t.indexOf(e);if(a>1){return t[a-1]}return e}(e.system.die_size):i,new this(i,t,a)}}class StressRoll extends Roll{static get CHAT_TEMPLATE(){return Qe.path}static get requirements(){const e=game.actors.filter((e=>"character"===e.type)),t=game.heart.stress_results,a=game.heart.stress_dice,i=[""].concat(game.heart.resistances);let s={character:{label:game.i18n.localize("heart.character.label-single"),options:e.reduce(((e,t)=>(e[t.id]=t.name,e)),{})},result:{label:game.i18n.localize("heart.result.label-single"),options:t.reduce(((e,t)=>(e[t]=game.i18n.localize(`heart.result.${t}`),e)),{})},die_size:{label:game.i18n.localize("heart.die_size.label-single"),options:a.reduce(((e,t)=>(e[t]=game.i18n.format("heart.die_size.d(N)",{N:t.replace(/^d/,"")}),e)),{})},resistance:void 0,ignoreProtection:{label:game.i18n.localize("heart.rolls.stress-roll.ignore-protection"),isCheckbox:!0}};if(game.settings.get("heart","preSelectStressType")){const e={label:game.i18n.localize("heart.resistance.label-single"),options:i.reduce(((e,t)=>(e[t]=game.i18n.format(`heart.resistance.${t}`),""===t&&(e[t]=t),e)),{})};s.resistance=e}return void 0===s.resistance&&delete s.resistance,s}static build({result:e,die_size:t,character:a,resistance:i,ignoreProtection:s}={},r={},n={}){return new Promise(((l,o)=>{const c=this.requirements;void 0!==e&&delete c.result,void 0!==t&&delete c.die_size,void 0!==a&&delete c.character,void 0!==i&&delete c.resistance,void 0!==s&&delete c.ignoreProtection;const d={result:e,die_size:t,character:a,resistance:i,ignoreProtection:s};if(!(Object.keys(c).length>0))return l(this._build(d,r,n));game.heart.applications.RequirementApplication.build({requirements:c,callback:e=>{foundry.utils.mergeObject(d,e),l(this._build(d,r,n))},type:"prepare-stress-roll"})}))}static _build({result:e,die_size:t,character:a,resistance:i,ignoreProtection:s},r={},n={}){n.result=e,n.die_size=t,n.character=a,n.resistance=i,n.ignoreProtection=s;let l=t;return"critical_failure"===e&&(l=`2 * {${t}}`),new this(l,r,n)}async render(e={}){const t=(e=foundry.utils.mergeObject({user:game.user.id,flavor:null,template:this.constructor.CHAT_TEMPLATE,blind:!1},e)).isPrivate,a=void 0!==e.showTakeStressButton&&e.showTakeStressButton,i=void 0!==e.showFalloutRollButton&&e.showFalloutRollButton;this._evaluated||await this.evaluateSync();const s=game.i18n.format("heart.rolls.stress-roll.description(die_size)",{die_size:this.options.die_size,result:game.i18n.localize(`heart.result:${this.options.result}`)}),r={character:e.character||this.options.character,description:t?"???":s,formula:t?"???":this._formula,flavor:t?null:e.flavor,user:e.user,tooltip:t?"":await this.getTooltip(),showTakeStressButton:!t&&a,showFalloutRollButton:!t&&(!a&&i),resistance:t?"":this.options.resistance,ignoreProtection:t?"":this.options.ignoreProtection,total:t?"?":this.total,result:t?"?":this.result};return renderTemplate(e.template,r)}async takeStress(e,t="",a=!1){return new Promise(((i,s)=>{if(e=e||this.options.character,t=t||this.options.resistance,a=a||this.options.ignoreProtection,t)return this.applyStress(e,t,a),void i();game.heart.applications.RequirementApplication.build({requirements:{resistance:{options:game.heart.resistances.reduce(((e,t)=>(e[t]=game.i18n.localize(`heart.resistance.${t}`),e)),{})}},callback:({resistance:t})=>{this.applyStress(e,t,a,s),i()},type:"take-stress"})}))}applyStress(e,t,a,i){const s=game.actors.get(e),r={},n=s.system.resistances[t],l=a?0:n.protection,o=this.total;void 0===o&&(ui.notifications.error("Somehow this roll isn't evaluated",this),i());const c=(n.value||0)+Math.max(0,parseInt(o)-l);r[`system.resistances.${t}.value`]=c,s.update(r)}static activateListeners(e){e.on("click",".stress-roll [data-action=take-stress]",(async function(e){e.preventDefault();const t=$(e.currentTarget).closest(".chat-message").data("messageId"),a=game.messages.get(t),i=a.stressRoll,s=i.options.character;await i.takeStress(s),a.showTakeStressButton=!1,a.showFalloutRollButton=!0,await ui.chat.updateMessage(a,!0),ui.chat.scrollBottom()})),e.on("click",".stress-roll [data-action=roll-fallout]",(async function(e){e.preventDefault();const t=$(e.currentTarget).closest(".chat-message").data("messageId"),a=game.messages.get(t),i=a.stressRoll,s=await game.heart.rolls.FalloutRoll.build({character:i.options.character});await s.evaluateSync(),game.dice3d&&game.settings.get("heart","showFalloutRoll3dDice")&&await game.dice3d.showForRoll(s,game.user,!0),await a.setFalloutRoll(s),a.showFalloutRollButton=!1,await ui.chat.updateMessage(a,!0),ui.chat.scrollBottom()}))}}var Za=a(361),La={styleTagTransform:function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}},setAttributes:function(e){var t=a.nc;t&&e.setAttribute("nonce",t)},insert:function(e){var t=rt()("head");if(!t)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");t.appendChild(e)}};La.domAPI=it(),La.insertStyleElement=lt();tt()(Za.Z,La);Za.Z&&Za.Z.locals&&Za.Z.locals;var Fa=[ue,pe,fe,ge];function Ua(){console.log("heart | Registering rolls"),Fa.forEach((e=>{const t=e.default,a=CONFIG.Dice.rolls.findIndex((e=>e.name===t.name));a<0?CONFIG.Dice.rolls.push(t):CONFIG.Dice.rolls[a]=t,void 0===game.heart.rolls&&(game.heart.rolls={}),game.heart.rolls[t.name]=t,void 0!==t.activateListeners&&(Hooks.on("renderChatLog",((e,a,i)=>t.activateListeners(a))),Hooks.on("renderChatPopout",((e,a,i)=>t.activateListeners(a)))),void 0!==e.initialise&&e.initialise()}))}var Ga=[e,t,s,r,n,l,o,c,d,h,m,u,p,f,g,v,y,b,w,x,k,z,T,H,_,S,C,I,O,D,A,q,E,j,R],Ja=[J,Y,X,ye,me,ve];Hooks.once("init",(function(){const e=Compendium.defaultOptions;function t(...e){let t={};"object"==typeof e[e.length-1]&&(t=e.splice(-1,1)[0]);const a=e.join("."),i=`heart.${a}`,s=game.i18n.localize(i);return s==i?a:s}e.template="heart:"+e.template,Object.defineProperty(Compendium,"defaultOptions",{get:function(){return e}}),Ga.forEach((function(e){const t=e.default,a=Handlebars.compile(t.source);Handlebars.registerPartial(t.path,a)})),game.heart={difficulties:["standard","risky","dangerous","impossible"],resistances:["blood","mind","echo","fortune","supplies"],skills:["compel","delve","discern","endure","evade","hunt","kill","mend","sneak"],domains:["cursed","desolate","haven","occult","religion","technology","warren","wild"],stress_dice:["d4","d6","d8","d10","d12"],die_sizes:["d4","d6","d8","d10","d12"]},console.log(`heart | Registering ${Ja.length} modules`),Ja.forEach((e=>{void 0!==e.initialise&&e.initialise()})),Handlebars.registerHelper("ordered-checkable",(function(e,t){let a="";for(let i=0;i<t;i++)a+=`<a data-index="${i}" class="ordered-checkable-box${i<e?" checked":""}"></a>`;return a})),Handlebars.registerHelper("join",(function(e,...t){const a=t.pop().hash.array||[];return[...t,...a].join(e)})),Handlebars.registerHelper("concat",(function(e,t){return e+t})),Handlebars.registerHelper("undef",(function(e){return void 0===e})),Handlebars.registerHelper("titlecase",(function(e){return e[0].toUpperCase()+e.slice(1)})),Handlebars.registerHelper("includes",(function(e,t,a){return void 0===e?(console.warn("includes has undefined array",e,t,a),!1):e.includes(t)})),Handlebars.registerHelper("randomID",(function(){return foundry.utils.randomID()})),Handlebars.registerHelper("numEq",(function(e,t){return e==t})),Handlebars.registerHelper("not",(function(e){return!Boolean(e)})),Handlebars.registerHelper("notification",(function(e,t,a){const i=Boolean(e)?"check":"times";let s=a.hash.optional?"optional":"required";return`<span class="fas fa-${i}-circle" data-notification="${s}" data-target="${t}" title="${game.i18n.localize(`heart.notification:${s}`)}" data-type="${a.hash.type}"></span>`})),Handlebars.registerHelper("getActor",(function(e){return game.actors.get(e)})),Handlebars.registerHelper("itemIsKillOrMend",(function(e){return["kill","mend"].includes(e)})),Handlebars.registerHelper("getHeartResistances",(function(){return game.heart.resistances})),window.localizeHeart=t,Handlebars.registerHelper("localizeHeart",t),Handlebars.registerHelper("ownsAnyActors",(function(e){for(let t of e){const e=game.actors.get(t);if(e&&e.isOwner)return!0}return!1}))})),Hooks.once("ready",(function(){game.settings.register("heart","showStartupMessage",{name:"Show Startup Message",hint:"Show the startup message, which provides a brief tutorial on how to use Heart.",scope:"client",config:!0,default:!0,type:Boolean}),game.settings.register("heart","showTextboxesBelowItems",{name:"Show Textboxes Below Item Lists",hint:"On the character sheet, toggle the legacy text boxes",scope:"client",config:!0,default:!0,type:Boolean}),game.settings.register("heart","showStressRoll3dDice",{name:"Show 3D Dice for Stress Rolls",hint:"Shows 3D Dice rolls for Stress Rolls using modules like Dice So Nice!",scope:"client",config:!0,default:!0,type:Boolean}),game.settings.register("heart","showFalloutRoll3dDice",{name:"Show 3D Dice for Fallout Rolls",hint:"Shows 3D Dice rolls for Fallout Rolls using modules like Dice So Nice!",scope:"client",config:!0,default:!0,type:Boolean}),game.settings.register("heart","showTotalStress",{name:"Show Total Stress on Character Sheet",hint:"Show Total Stress on Character Sheet",scope:"client",config:!0,default:!0,type:Boolean}),game.settings.register("heart","showStressInputBox",{name:"Show Input Box Beside Character Resistances",hint:"Show Input Box Beside Character Resistances for editing",scope:"client",config:!0,default:!1,type:Boolean}),game.settings.register("heart","preSelectStressType",{name:"Select Stress Type When Beginning a Stress Roll",hint:"Select Stress Type When Beginning a Stress Roll",scope:"client",config:!0,default:!0,type:Boolean}),new Promise((async function(){if(game.settings.get("heart","showStartupMessage")){new Dialog({title:game.i18n.format("heart.dialog.title(VERSION)",{VERSION:game.system.version}),content:await renderTemplate("heart:templates/startup.html",{versions:Object.values(game.i18n.translations.heart.versions).sort(((e,t)=>e.version>t.version?-1:1)),version:game.system.version}),buttons:{close:{icon:'<i class="fas fa-times"></i>',label:game.i18n.localize("heart.dialog.skip"),callback:()=>{}},prevent:{icon:'<i class="fas fa-check"></i>',label:game.i18n.localize("heart.dialog.dont-show-again"),callback:()=>game.settings.set("heart","showStartupMessage",!1)}},default:"skip",render:e=>{new Tabs({navSelector:".tabs",contentSelector:".content",initial:`v${game.system.version}`}).bind(e[0])},close:e=>{}}).render(!0)}}))})),Hooks.on("preCreateItem",(function(e,t,a,i){e.updateSource({name:localizeHeart(e.name)})})),Hooks.on("preCreateActor",(function(e,t,a,i){e.updateSource({name:localizeHeart(e.name)})}))})()})();